<HTML>
<HEAD>
<TITLE>E2fsprogs Release Notes</TITLE>
</HEAD>

<BODY bgcolor=#FFFFFF topmargin="0" bottommargin="0" leftmargin="0" rightmargin="0" marginheight="0" marginwidth="0">

    <!-- top title table -->
    <TABLE width="100%" border=3 bordercolor="#543a48"
      bordercolorlight="#543a48" bordercolordark="#543a48" cellspacing=0 cellpadding=0 bgcolor="" valign="center">
      <TR valign="center" bgcolor="#eeeef8">
        <TD>
	<center>
        <h1>E2fsprogs Release Notes</h1>
	</center>
        </TD>
      </TR>
      <tr><td>
      <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=2406&amp;type=2" width="1" height="1" border="0"></tr><td>
    </TABLE>
    <!-- end top title table -->


<!-- center table -->
<TABLE width="100%" border="0" cellspacing="0" cellpadding="10" bgcolor="#FFFFFF" align="center">
  <TR>
    <TD>

<!-- Begin actual content -->

<H2>Release notes for the e2fsprogs package</H2>
<UL>
<LI><A HREF="#1.47.1">E2fsprogs 1.47.1 (May 20, 2024)</A>
<LI><A HREF="#1.47.0">E2fsprogs 1.47.0 (February 5, 2023)</A>
<LI><A HREF="#1.46.6">E2fsprogs 1.46.6 (February 1, 2023)</A>
<LI><A HREF="#1.46.5">E2fsprogs 1.46.5 (December 30, 2021)</A>
<LI><A HREF="#1.46.4">E2fsprogs 1.46.4 (August 18, 2021)</A>
<LI><A HREF="#1.46.3">E2fsprogs 1.46.3 (July 27, 2021)</A>
<LI><A HREF="#1.46.2">E2fsprogs 1.46.2 (February 28, 2021)</A>
<LI><A HREF="#1.46.1">E2fsprogs 1.46.1 (February 9, 2021)</A>
<LI><A HREF="#1.46.0">E2fsprogs 1.46.0 (January 29, 2021)</A>
<LI><A HREF="#1.45.7">E2fsprogs 1.45.7 (January 28, 2021)</A>
<LI><A HREF="#1.45.6">E2fsprogs 1.45.6 (March 20, 2020)</A>
<LI><A HREF="#1.45.5">E2fsprogs 1.45.5 (January 7, 2020)</A>
<LI><A HREF="#1.45.4">E2fsprogs 1.45.4 (September 23, 2019)</A>
<LI><A HREF="#1.45.3">E2fsprogs 1.45.3 (July 14, 2019)</A>
<LI><A HREF="#1.45.2">E2fsprogs 1.45.2 (May 27, 2019)</A>
<LI><A HREF="#1.45.1">E2fsprogs 1.45.1 (May 12, 2019)</A>
<LI><A HREF="#1.45.0">E2fsprogs 1.45.0 (March 6, 2019)</A>
<LI><A HREF="#1.44.6">E2fsprogs 1.44.6 (March 5, 2019)</A>
<LI><A HREF="#1.44.5">E2fsprogs 1.44.5 (December 15, 2018)</A>
<LI><A HREF="#1.44.4">E2fsprogs 1.44.4 (August 18, 2018)</A>
<LI><A HREF="#1.44.3">E2fsprogs 1.44.3 (July 10, 2018)</A>
<LI><A HREF="#1.44.2">E2fsprogs 1.44.2 (May 14, 2018)</A>
<LI><A HREF="#1.44.1">E2fsprogs 1.44.1 (March 24, 2018)</A>
<LI><A HREF="#1.44.0">E2fsprogs 1.44.0 (March 7, 2018)</A>
<LI><A HREF="#1.43.9">E2fsprogs 1.43.9 (February 8, 2018)</A>
<LI><A HREF="#1.43.8">E2fsprogs 1.43.8 (January 1, 2018)</A>
<LI><A HREF="#1.43.7">E2fsprogs 1.43.7 (October 16, 2017)</A>
<LI><A HREF="#1.43.6">E2fsprogs 1.43.6 (August 29, 2017)</A>
<LI><A HREF="#1.43.5">E2fsprogs 1.43.5 (August 4, 2017)</A>
<LI><A HREF="#1.43.4">E2fsprogs 1.43.4 (January 31, 2017)</A>
<LI><A HREF="#1.43.3">E2fsprogs 1.43.3 (September 4, 2016)</A>
<LI><A HREF="#1.43.2">E2fsprogs 1.43.2 (September 1, 2016)</A>
<LI><A HREF="#1.43.1">E2fsprogs 1.43.1 (June 8, 2016)</A>
<LI><A HREF="#1.43">E2fsprogs 1.43 (May 17, 2016)</A>
<LI><A HREF="#1.42.13">E2fsprogs 1.42.13 (May 17, 2015)</A>
<LI><A HREF="#1.42.12">E2fsprogs 1.42.12 (August 29, 2014)</A>
<LI><A HREF="#1.42.11">E2fsprogs 1.42.11 (July 9, 2014)</A>
<LI><A HREF="#1.42.10">E2fsprogs 1.42.10 (May 18, 2014)</A>
<LI><A HREF="#1.42.9">E2fsprogs 1.42.9 (December 28, 2013)</A>
<LI><A HREF="#1.42.8">E2fsprogs 1.42.8 (June 20, 2013)</A>
<LI><A HREF="#1.42.7">E2fsprogs 1.42.7 (January 21, 2013)</A>
<LI><A HREF="#1.42.6">E2fsprogs 1.42.6 (September 21, 2012)</A>
<LI><A HREF="#1.42.5">E2fsprogs 1.42.5 (July 29, 2012)</A>
<LI><A HREF="#1.42.4">E2fsprogs 1.42.4 (June 12, 2012)</A>
<LI><A HREF="#1.42.3">E2fsprogs 1.42.3 (May 14, 2012)</A>
<LI><A HREF="#1.42.2">E2fsprogs 1.42.2 (March 27, 2012)</A>
<LI><A HREF="#1.42.1">E2fsprogs 1.42.1 (February 17, 2012)</A>
<LI><A HREF="#1.42">E2fsprogs 1.42 (November 29, 2011)</A>
<LI><A HREF="#1.41.14">E2fsprogs 1.41.14 (December 22, 2010)</A>
<LI><A HREF="#1.41.13">E2fsprogs 1.41.13 (December 13, 2010)</A>
<LI><A HREF="#1.41.12">E2fsprogs 1.41.12 (May 17, 2010)</A>
<LI><A HREF="#1.41.11">E2fsprogs 1.41.11 (March 14, 2010)</A>
<LI><A HREF="#1.41.10">E2fsprogs 1.41.10 (February 10, 2010)</A>
<LI><A HREF="#1.41.9">E2fsprogs 1.41.9 (August 22, 2009)</A>
<LI><A HREF="#1.41.8">E2fsprogs 1.41.8 (July 11, 2009)</A>
<LI><A HREF="#1.41.7">E2fsprogs 1.41.7 (June 29, 2009)</A>
<LI><A HREF="#1.41.6">E2fsprogs 1.41.6 (May 30, 2009)</A>
<LI><A HREF="#1.41.5">E2fsprogs 1.41.5 (April 23, 2009)</A>
<LI><A HREF="#1.41.4">E2fsprogs 1.41.4 (January 27, 2009)</A>
<LI><A HREF="#1.41.3">E2fsprogs 1.41.3 (October 12, 2008)</A>
<LI><A HREF="#1.41.2">E2fsprogs 1.41.2 (October 2, 2008)</A>
<LI><A HREF="#1.41.1">E2fsprogs 1.41.1 (September 1, 2008)</A>
<LI><A HREF="#1.41.0">E2fsprogs 1.41.0 (July 10, 2008)</A>
<LI><A HREF="#1.40.11">E2fsprogs 1.40.11 (June 17, 2008)</A>
<LI><A HREF="#1.40.10">E2fsprogs 1.40.10 (May 21, 2008)</A>
<LI><A HREF="#1.40.9">E2fsprogs 1.40.9 (April 27, 2008)</A>
<LI><A HREF="#1.40.8">E2fsprogs 1.40.8 (March 13, 2008)</A>
<LI><A HREF="#1.40.7">E2fsprogs 1.40.7 (February 28, 2008)</A>
<LI><A HREF="#1.40.6">E2fsprogs 1.40.6 (February 9, 2008)</A>
<LI><A HREF="#1.40.5">E2fsprogs 1.40.5 (January 27, 2008)</A>
<LI><A HREF="#1.40.4">E2fsprogs 1.40.4 (December 31, 2007)</A>
<LI><A HREF="#1.40.3">E2fsprogs 1.40.3 (December 5, 2007)</A>
<LI><A HREF="#1.40.2">E2fsprogs 1.40.2 (July 12, 2007)</A>
<LI><A HREF="#1.40.1">E2fsprogs 1.40.1 (July 7, 2007)</A>
<LI><A HREF="#1.40">E2fsprogs 1.40 (June 29, 2007)</A>
<LI><A HREF="#1.39">E2fsprogs 1.39 (May 29, 2006)</A>
<LI><A HREF="#1.38">E2fsprogs 1.38 (June 30, 2005)</A>
<LI><A HREF="#1.37">E2fsprogs 1.37 (March 21, 2005)</A>
<LI><A HREF="#1.36">E2fsprogs 1.36 (February 5, 2005)</A>
<LI><A HREF="#1.35">E2fsprogs 1.35 (February 28, 2004)</A>
<LI><A HREF="#1.34">E2fsprogs 1.34 (July 25, 2003)</A>
<LI><A HREF="#1.33">E2fsprogs 1.33 (April 21, 2003)</A>
<LI><A HREF="#1.32">E2fsprogs 1.32 (November 9, 2002)</A>
<LI><A HREF="#1.31">E2fsprogs 1.31 (November 8, 2002)</A>
<LI><A HREF="#1.30">E2fsprogs 1.30 (October 31, 2002)</A>
<LI><A HREF="#1.29">E2fsprogs 1.29 (September 24, 2002)</A>
<LI><A HREF="#1.28">E2fsprogs 1.28 (August 31, 2002)</A>
<LI><A HREF="#1.27">E2fsprogs 1.27 (March 8, 2002)</A>
<LI><A HREF="#1.26">E2fsprogs 1.26 (February 3, 2002)</A>
<LI><A HREF="#1.25">E2fsprogs 1.25 (September 20, 2001)</A>
<LI><A HREF="#1.24a">E2fsprogs 1.24a (September 2, 2001)</A>
<LI><A HREF="#1.24">E2fsprogs 1.24 (August 30, 2001)</A>
<LI><A HREF="#1.23">E2fsprogs 1.23 (August 15, 2001)</A>
<LI><A HREF="#1.22">E2fsprogs 1.22 (June 22, 2001)</A>
<LI><A HREF="#1.21">E2fsprogs 1.21 (June 15, 2001)</A>
<LI><A HREF="#1.20">E2fsprogs 1.20 (May 20, 2001)</A>
<LI><A HREF="#1.19">E2fsprogs 1.19 (July 13, 2000)</A>
<LI><A HREF="#1.18">E2fsprogs 1.18 (November 10, 1999)</A>
<LI><A HREF="#1.17">E2fsprogs 1.17 (October 26, 1999)</A>
<LI><A HREF="#1.16">E2fsprogs 1.16 (October 22, 1999)</A>
<LI><A HREF="#1.15">E2fsprogs 1.15 (July 18, 1999)</A>
<LI><A HREF="#1.14">E2fsprogs 1.14 (January 9, 1999)</A>
<LI><A HREF="#1.13">E2fsprogs 1.13 (December 15, 1998)</A>
<LI><A HREF="#1.12">E2fsprogs 1.12 (July 4, 1998)</A>
<LI><A HREF="#1.11">E2fsprogs 1.11 (June 17, 1997)</A>
<LI><A HREF="#1.10">E2fsprogs 1.10 (April 24, 1997)</A>
<LI><A HREF="#1.09">E2fsprogs 1.09 (April 14, 1997)</A>
<LI><A HREF="#1.08">E2fsprogs 1.08 (April 10, 1997)</A>
<LI><A HREF="#1.07">E2fsprogs 1.07 (March 14, 1997)</A>
<LI><A HREF="#1.06">E2fsprogs 1.06 (October 7, 1996)</A>
<LI><A HREF="#1.05">E2fsprogs 1.05 (September 7, 1996)</A>
<LI><A HREF="#1.04">E2fsprogs 1.04 (May 16, 1996)</A>
<LI><A HREF="#1.03">E2fsprogs 1.03 (March 27, 1996)</A>
<LI><A HREF="#1.02">E2fsprogs 1.02 (January 16, 1996)</A>
</UL>

<H2><A NAME="1.47.1">E2fsprogs 1.47.1 (May 20, 2024)</A></H2>

<H3>UI and Features</H3>

<P>Add post-2038 handling when e2fsprogs is compiled on a system with a
64-bit time_t.</P>

<P>Mke2fs -d can now support an input tar file if the libarchive library is
available.</P>

<P>Add a udev rule which inhibits ext4 file systems from being automounted
by udisks.  This avoid security issues from exposing potentially
maliciously fuzzed file systems from being mounted without being
inspected using fsck first.  Distributions can of course override this
feature inhibition, but then they get to own the security vulnerability
liability.  Upstream ext4 file system developers are putting
distributions on notice that blindly automounting file systems from
(potentially) USB thumb drives which clueless users may have picked up
in a parking lot is a ***bad*** idea, no matter what clueless enterprise
Linux product managers might think.</P>

<P>The debugfs 'hash' command will use the hash seed and algorithm from the
superblock if debugfs has a file system open, instead of requiring the
user to specify those parameters explicitly as options to the hash
command.  Also add a hash -v option which prints the hash parameters so
the user knows what parameters were used when calculating the hash for
the filename.</P>

<P>Teach mke2fs a new extended options, root_perms, which overrides the
permissions for the root directory for the new file system.</P>

<H3>Fixes</H3>

<P>When various e2fsprogs are replaying the journal (tune2fs, fuse2fs,
e2fsck, etc.) save any error indicator in the superblock, so it can be
restored afterwards.  Most of the time (at least with modern kernels) if
file system corruptions are discovered, the superblock update is
journalled.  However, if the journal is aborted or the journal commit
fails, the error code might only be written in the superblock, so we
need to save it so that a subsequent fsck can repair the file system
after the journal replay.</P>

<P>When mke2fs was creating a file system with the orphan file inode, it
tries to read and truncate the orphan inode before it has been
initialized.  If there is an inode from a previous file system located
there (as opposed to a all zeroes inode table block caused by a discard
of the flash device or a newly created cloud block device or fille
image), it can fail with bad checksum error, aborting the mke2fs
operation.  Fix this in ext2fs_create_orphan_file() not trying to
truncate the orphan file if it is newly allocated (which will always be
the case when mke2fs calls this library function).</P>

<P>In the case where e2fsck comes across an orphan file which is empty but
the orphan_present feature is set, in preen mode, e2fsck will now clear
the orphan_present feature flag silently.</P>

<P>E2fsck will now perform more consistency checks on EA (extended
attribute value) inodes.</P>

<P>Fix a big where e2fsck could potentially leak an acl block when
releasing an orphan inode.</P>

<P>Avoid a divide by zero crash in libext2fs if the container
infrastructure, such as lxcfs, reports that the system has zero CPU's
via sysconf(_SC_NPROCESSORS_CONF).</P>

<P>When resize2fs is performing an online resize, it's possible for reading
the superblock can race with a kernel modifying the superblock with the
checksum being invalid and causing the resize to fail with an bad
superblock checksum in the buffer cache.  Have resize2fs open the file
system using O_DIRECT to avoid the superblock with an invalid checksum.</P>

<P>Fix a bug where a checksum failure in an htree directory can cause
e2fsck's preen mode to abort unnecessarily.</P>

<P>Fix e2fsck's handling of an invalid symlink in an inline_data directory.</P>

<P>Fix e4crypt from issuing a spurious "success" error message when trying
to set a policy on a non-directory.</P>

<P>Fix a potential infinite loop in debugfs's logdump command in some edge
cases.</P>

<P>Fix e2fsck to correctly update quota usage after optimizing directories
or deleting corrupted inodes.</P>

<P>Fix fuse2fs so that directories are created with the correct permissions
instead of having the other and group write permissions masked off.</P>

<P>Fix a potential e2fsck divide by zero crash caused by a maliciously
fuzzed file system.</P>

<P>Fix dumpe2fs to report free block ranges correctly for bigalloc file
systems.</P>

<P>Fix resize2fs where resizing a bigalloc file system can result in the
free cluster count in the last block group and the total free clusters
count to be incorrect.</P>

<P>Avoid spurious e2scrub failures caused by trying to scrub file syustems
that do not have the journal enabled, and by aborting scrub runs while
upgrading the e2fsprogs package on Debian/Ubuntu.</P>

<P>Teach tune2fs to detect a file system which is mounted but is not
mentioned in the mount namespace where tune2fs is run by treating a
block device which is busy as if it is mounted.</P>

<P>If tune2fs can't find the mountpoint for a file system which is
apparently mounted (perhaps because it's not present in the current
mount namespace) when attempting to set the label or UUID in the
superblock, fall back to the old method of modifying block device and
silence printing any error messages.</P>

<P>If both the primary superblock and first block group's backup superblock
are corrupted, e2fsck will now try additional backup superblocks if they
are available.</P>

<P>Avoid mke2fs from creating an invalid file system with an insufficient
number of inodes when creating a file system which is very small (100k),
a block size of 1k, and an inode size of 256 bytes.</P>

<P>Fix a potential deadlock caused by e2fsck being run in Direct I/O mode
with the threading optimization enabled.</P>

<P>Fix e2scrub when the "systemctl" package is installed instead of
systemd.  (Addresses Debian Bug #1070107)</P>

<P>Fixed/improved various Debian packaging issues.</P>

<P>Update and clarify various man pages.  (Addresses Debian Bugs #1038286,
#1041115)</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Add support for SOURCE_DATE_EPOCH environment variable per the
specification https://reproducible-builds.org/specs/source-date-epoch</P>

<P>Improve resize2fs's performance by eliminating extra cache flushes.</P>

<P>Improve mke2fs's performance when zeroing a large number of inode table
blocks (when lazy inode table initialization is not enabled) by batching
calls to ext2fs_zero_blocks.</P>

<P>Use a safe_getenv function for all calls to fetch the environment
variable in libext2fs.</P>

<P>Fix a massive buffer overrun bug in ext2fs_image_super_read().  This
function isn't actually used by e2image, and it's unlikely that there
are any users of this function since the most common way the e2image
file is read is via ext2fs_openfs() with the EXT2_FLAG_IMAGE_FILE, which
doesn't actually use ext2fs_image_super_read().</P>

<P>Add support for building fuse2fs using Fuse V3.</P>

<P>Use FORTIFY_SOURCE=3 when hardening is enabled for more protection.</P>

<P>Add support for continuous integration tests using Github Actions.</P>

<P>Fix Windows-specific portability bugs to allow mke2fs to create a file
system in a file which doesn't yet exist and to support file systems
larger than 2GB.</P>

<P>Fix a FreeBSD 14 build failure caused by changing the function signature
of qsort_r() to be aligned with the POSIX and glibc definition of
qsort_r().</P>

<P>Fix various portability issues for the Linux 32-bit musl C library,
GNU/Hurd and Android.  (Addresses Debian Bug: #1056145)</P>

<P>Fix various portability problems in the regression test suite.</P>

<P>Fix various sanitizer, static code analysis, and compiler warnings.</P>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Updated config.guess and config.sub with newer versions from the FSF.</P>

<P>Add Romainian translation.</P>

<P>Update Chinese, Czech, French, Malay, Polish, Swedish, and Ukrainian
translations.</P>

<H2><A NAME="1.47.0">E2fsprogs 1.47.0 (February 5, 2023)</A></H2>

<H3>UI and Features</H3>

<P>Add support for the orphan_file feature, which speeds up workloads that
are deleting or truncating a large number files in parallel.  This
compat feature was first supported in the v5.15 Linux kernel.</P>

<P>The mke2fs program (via the mke2fs.conf file) now enables the
metadata_csum_seed and orphan_file features by default.  The
metadata_csum_seed feature is an incompat feature which is first
supported in the Linux kernel starting in the 4.4 kernel and e2fsprogs
1.43.</P>

<P>Mke2fs now supports the extended option "assume_storage_prezeroed" which
causes mke2fs to skip zeroing the journal and inode tables and to mark
the inode tables as zeroed.</P>

<P>Add support to tune2fs and e2label to set the label and UUID for a
mounted file system using a ioctl, which is more reliable than modifying
the superblock via writing to the block device.  The kernel support for
setting the label landed in v5.17, while the support for adding the UUID
landed in v6.0.  If the ioctls are not supported, tune2fs and e2label
will fall back old strategy of directly modifying the superblock.</P>

<P>Allow tune2fs to disable the casefold feature after scanning all of the
directories do not have the Casefold flag set.</P>

<H3>Fixes</H3>

<P>Fix a potential unbalanced mutex unlock when there is a short read while
using the bounce buffer when using direct I/O.</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Fix various Coverity and compiler warnings.</P>

<P>Add the new function ext2fs_xattrs_read_inode() which takes an in-memory
inode to avoid needing to reread an inode that was already read into
memory.</P>

<P>Teach debugfs logdump command the -n option which forces printing a
specified number of transactions, even when a block missing a magic
number would have stopped the logdump.  (This is for debugging
journalling problems.)</P>


<H2><A NAME="1.46.6">E2fsprogs 1.46.6 (February 1, 2023)</A></H2>

<H3>UI and Features</H3>

<P>Debugfs's ncheck command now allows the inode number to be surrounded by
angle brackets, to be consistent with other debugfs commands.</H3>

<P>Debugfs no longer prints a scary message when debugfs -c (which enables
"catastrophic mode") is used.  This was intended to allow debugfs to
operate on very badly corrupted file systems, but it is now sometimes
used to suppress reading the block and inode bitmaps when they are not
needed.</H3>

<P>Resize2fs will round down the requested new file system size to the
nearest cluster boundary when resizing bigalloc file systems.</H3>

<P>Improve error messages issued by badblocks.</H3>

<P>Fuse2fs now supports an offset=<bytes> option which allows operating on
a file system image which is located starting at the specified offset
from the beginning of the image.</H3>

<H3>Fixes</H3>

<P>Pre-v6.2 Linux kernels had long-standing bug in how the extended
attribute hash was calculated when there were non-ASCII characters in
the xattr name, when the hash would be different depending on whether
the C 'char' type was signed or unsigned.  To address this bug, starting
with e2fsprogs 1.46.6+ and Linux 6.2+, we will accept either the signed
or unsigned hash variant, but only set the unsigned hash variant.  Since
extended attribute names are in practice composed of ASCII characters,
other than various tests (such as generic/454), most users will
hopefully not notice this change.</H3>

<P>Avoid triggering udev in dumpe2fs and "resize2fs -P" for file systems
with MMP enabled by opening the device read-only when reading the MMP
block.</H3>

<P>Fix MMP handling so it can notice when another writer has modify the MMP
block out from under it when stopping a MMP sessions.</H3>

<P>Fix tune2fs so it will detect another device stealing the MMP sessions
while rewriting metadata checksums.</H3>

<P>E2fsck will now check to make sure the journal inode does not have the
encrypt flag set.</H3>

<P>Fix a deadlock bug in e2fsck's error handler when there are errors
trying to write to the file system.</H3>

<P>Fix a bug where e2fsck could fail when specifying an undo file and an
explicit superblock number.</H3>

<P>Fix e2image so it won't potentially loop forever for certain invalid
file systems.</H3>

<P>Fix resize2fs to honor the E2FSPROGS_FAKE_TIME environment variable.
This allows embedded system builders who use resize2fs as part of their
image build process to create reproducible images.</H3>

<P>Fix tune2fs to avoid a crash if the journal replay fails and to make
sure its exit status is non-zero if there is some failure.</H3>

<P>Fix tune2fs, fuse2fs, and debugsfs to update j_tail_sequence when
replaying the journal.</H3>

<P>Add additional bullet-proofing for very badly corrupted file systems.
Try avoid UBSAN warnings, null pointer derferences, and other memory
bugs.  (Addresses CVE-2022-1304)</H3>

<P>Don't fail when the source directory for mke2fs -d doesn't support
extended attributese.</H3>

<P>Check for and handle malloc() failures when computing the log filename
in e2fsck and in the libss library.</H3>

<P>Fix tune2fs and e2fsck to accept pathames which include '=' characters.
Previously arguments to tune2fs and e2fsck which included '=' characters
are presumed to be blkid specifiers such as UUID=xxx or LABEL=yyy.  If a
specifier is both a valid pathname name and blkid tag name specifier,
priority is given to a blkid resolved pathname.</H3>

<P>Improve tune2fs's error messages.</H3>

<P>Fix a bug in tune2fs which could cause it to crash if device goes
off-line just as it being opened.</H3>

<P>Fix the fsck driver so if it is interrupted while running fsck -N it
doesn't end up kllling all processes on the system.</H3>

<P>Fix a crash in badblocks when the user specifies an overly large
number of blocks tested at a time in read/write or nondestructive
mode.</H3>

<P>Update and clarify's chattr's man page and usage message.  Fix spelling
typo's in a variety of different man pages and comments.</H3>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Update to autoconf 2.71.</H3>

<P>Update flags used to create shared library on Darwin/MacOS.</H3>

<P>Speed up e2fsck's clonning of multiply-claimed blocks so it is
substantially faster on very large file systems.</H3>

<P>Add tests/fuzz directory with fuzzers from oss-fuzz.</H3>

<P>Add a Github Actions configuration file so that Github will run CI tests
on Linux, Windows and MacOS on a push to the e2fsprogs github repo.</H3>

<P>Make the mtab parsing in ext2fs_check_mount_point() more careful so it
won't get confused when a block device shows up in the mnt_name field
for a virtual file system.</H3>

<P>Fix the libss's Makefile to create the man page directory before trying
to install its man page.</H3>

<P>Fix various Coverity and compiler warnings.</H3>

<P>Make tests more portable on various different OS's and system
configurations (e.g., with SELinux enabled, MacOS, and Windows)</H3>

<P>Use mallinfo2() instead of mallinfo() where avilable, since mallinfo()
is deprecated on newer glibc versions.</H3>

<P>E2fsck will no longer do a full scan of disconnected directory when
trying to print the parent directory, which is pointless and can slow
down e2fsck if there are a large number of disconnected directories.</H3>

<P>Debugfs will now print the extended attribute's e_hash field.</H3>

<P>Fix the setup-schroot script to work on non-Linux platforms.</H3>

<P>Fix ext2fs_compare_generic_bmap() so it correctly compares all of the
bits in the bitmap, and so that it works correctly when comparing a
bitarray bitmap with a rbtree-based bitmap.  (Fortunately, none of the
programs in e2fsprogs uses bitmap comparison functions.)</H3>

<P>Fix memory leaks on error paths.</H3>

<P>Add support for the configure option --enable-largefile so that
e2fsprogs can utilize largefile support for the MUSL C library.</H3>

<P>Add an note that the dict library code has been modified, as required by
the Kazlib license.</H3>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</H3>

<P>Updated config.guess and config.sub with newer versions from the FSF.</H3>

<P>Add Friulian translation.</H3>

<P>Update Chinese, Czech, Dutch, French, German, Malay, Polish, Serbian,
Spanish, Swedish, and Ukrainian translations.</H3>


<H2><A NAME="1.46.5">E2fsprogs 1.46.5 (December 30, 2021)</A></H2>

<h3>UI and Features</h3>

<P>When resizing a file system and the inode count exceeds the 2**32
maximum, if resize2fs can successfully perform the resize by dropping
the last block group, resize2fs will do that in order to allow the file
system grow operation to succeed.  For example, using the default inode
ratio size of 16k, this will allow a successful resize to 64TB - 128MB
when the storage device is 64TB.</P>

<h3>Fixes</h3>

<P>Avoid a potential infinite loop in resize2fs -P when the file system is
corrupted (introduced in e2fsprogs 1.45.5).  (Addresses github issue
https://github.com/tytso/e2fsprogs/issues/94)</P>

<P>E2fsck now updates the bg_checksum after fixing problems in the block
group descriptor, which eliminates some unnecessary messages printed or
asked of the system administrator.</P>

<P>Fixed some potential deadlock problems in the unix_io handler in the case
of I/O errors.  The fix should also improve the performance of parallel
bitmap loading.</P>

<P>Fixed e2fsck's fast commit handling which could result it in crashing
when trying to merge extents when there were none available to be
merged.</P>

<P>Fix e2fsck's support of quota limit data, which could sometimes get
dropped when the quota data needs to be regenerated, or when processing
the orphan list.</P>

<P>Fix tune2fs to correctly transfer the quota limits when converting quota
files to the internal quota inodes.  Also add support for tune2fs to
properly handle the older version 0 quota files.</P>

<P>Fix debugfs's get_quota and list_quota commands so that the header of
the report printed by these commands correctly reflect that the units of
used space is in bytes instead of blocks.</P>

<h3>Performance, Internal Implementation, Development Support etc.</h3>

<P>Add some additional packages to the setup-schroot script to account for
the fact that the script can be run on older Debian distributions and so
the build dependencies might omit some packages needed to build
e2fsprogs on unstable version of Debian.</P>

<P>Reduce resize2fs's CPU overhead when counting the number of blocks in
use which can reduce the wall clock time for very large file systems
by substantial amount.</P>

<P>Teach libuuid to use getrandom() or getentropy() if available in favor
of reading from /dev/[u]random.</P>

<P>Teach libss to use libreadline.so.8 if it is available.</P>

<P>Update some test expect files to fix some regression tests that were
broken in e2fsprogs 1.46.4.</P>

<P>If the PRINT_FAILED environment variable is set, failed tests will
display the diff output to make it easier to debug test failures on
autobuilders.</P>

<P>Fix various compiler warnings.</P>

<P>Update tst_getsize to use ext2fs_get_size2() to support testing devices
which are larger than 2**32 sectors.</P>

<P>Fixed spelling mistakes in the mke2fs.conf man page.</P>

<P>Update Chinese, Malay, Serbian, Spanish, Swedish, and Ukrainian
translations.</P>


<H2><A NAME="1.46.4">E2fsprogs 1.46.4 (August 18, 2021)</A></H2>

<h3>UI and Features</h3>

<p>The defaults for mke2fs now call for 256 byte inodes for all file
systems (with the exception of file systems for the GNU Hurd, which only
supports 128 byte inodes).  Creating non-Hurd file systems with 128 byte
inodes will trigger a warning message to make sure users are aware of
the potential problems of using small/legacy inode sizes.</p>

<p>The bigalloc feature is now considered supported if the cluster size no
more than 16 times the block size.  So the mke2fs program has been
changes to only warn if the cluster size is larger than that.</p>


<h3>Fixes</h3>

<p>E2fsck now checks to make sure directory entries do not reference
internal quota inodes.</p>

<p>E2image now includes the quota inodes when creating file system image,
since they are part of the file system metadata.</p>

<p>E2fsck now properly accounts the quota usage of the project quota file.</p>

<p>Fix a regression introduced in 1.64.3 where attempting to create a file
system image using mke2fs into a non-existent file would fail.
(Addresses Debian Bug: #992094)</p>

<p>Fix mke2fs to correctly create Posix ACL's on big-endian systems when
copying files from a directory hierarchy.</p>

<p>Updated and clarified the resize2fs man pages.  (Addresses Debian Bug:
#979411)</p>

<h3>Performance, Internal Implementation, Development Support etc.</h3>

<p>Improve various regression tests to be more portable and to reflect the
new default inode size of 256 byte inodes, even for small file systems.</p>

<p>Fixed a GNU Hurd portability problem which was causing tests to fail.</p>

<p>Fixed a test failure in f_baddotdir on big-endian systems.  This wasn't
necessarily a bug per se in e2fsck, but rather e2fsck having different
behaviour on big-endian systems.  (Addresses Debian Bug: #991922)</p>

<p>Use WantedBy=multi-user.target in e2scrub_reap.service.  (Addresses
Debian Bug: #991349)</p>

<p>Synchronize e2fsck/recovery.c with the kernel's fs/jbd2/recovery.c</p>

<p>Fix various Coverity and compiler warnings.</p>

<p>Fix various error pathes to make sure we don't leak resources or
potentially use or try to free uninitialized pointers.</p>

<p>Added a setup-schroot command for use on Debian porter boxes.</p>

<p>Updated config.guess and config.sub with newer versions from the FSF.</p>

<p>Update Czech, Dutch, French, Polish, Portuguese, and Swedish translations.</p>

<H2><A NAME="1.46.3">E2fsprogs 1.46.3 (July 27, 2021)</A></H2>

<h3>UI and Features</h3>

<P>Teach the filefrag program the -V option, which will print the version
of the tool, or if -V option is specified twice, will print the list of
supported FIEMAP flags.</P>


<h3>Fixes</h3>

<P>Fix bug in resize2fs where growing a file system with MMP enabled and
there aren't any (or sufficient) reserved block group descriptors,
resize2fs could potentially overwrite the MMP block, leading to file
system corruption.  (Addresses Debian Bug: #984472)</P>

<P>Fix fast_commit portability problems on sparc64 and arm64 architectures
(the latter when running e2fsprogs compiled for arm32).   (Addresses
Debian Bug: #987641)</P>

<P>Fix missing mutex unlock in an error path in the Unix I/O manager.</P>

<P>Fix Direct I/O support in the Unix I/O manager (this was a regression
that was introduced in v1.46.2).</P>

<P>Fix mke2fs to avoid discarding blocks beyond the end of the file system
to be created when creating a file system which is smaller than 16MB and
the file system size was explicitly specified and smaller than the size
of the block device.  (Addresses Debian Bug: #989630)</P>

<P>Teach mke2fs to avoid giving a spurious warning about a pre-existing
partition table and it is creating a file system at a non-zero offset
(so the partition table wouldn't be overwritten in any case).
(Addresses Debian Bug: #989612)</P>

<P>Fix e2image -Q to prevent a multiplcation overflow could corrupt the
generated QCOW2 output file for very large file systems.</P>

<P>When e2fsck repairs '.' and '..' entries in corrupted directories, set
the file type in the directory entry to be EXT2_FT_DIR and do not leave
the file type as EXT2_FT_UNKNOWN.</P>

<P>Fix e2fsck so that the if the s_interval is zero, and the last mount or
write time is in the future, it will fix invalid last mount/write
timestamps in the superblock.  (This was a regression introduced in
v1.45.5.)</P>

<P>Fix potential memory leaks and seg faults when memory allocations fail.</P>

<P>Fix lsattr and chattr to avoid opening or calling EXT2_IOC_[GS]ETFLAGS
on devices, since this can cause some devices to react badly as a
result.  (Thix fixes a regression introduced in v1.46.2 and addresses
Debian Bug: #986332)</P>

<P>Updated and clarified the e2image and filefrag man pages.</P>


<h3>Performance, Internal Implementation, Development Support etc.</h3>

<P>Avoid forking an unnecessary thread in ext2fs_rw_bitmaps().</P>

<P>Avoid unnecessary stat(2) calls on mountpoints when checking if a file
system is mounted.</P>

<P>Add more modern support for Windows I/O.</P>

<P>Fix various compiler and valgrind warnings.</P>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Update Dutch, Malay, and Serbian translations.</P>


<H2><A NAME="1.46.2">E2fsprogs 1.46.2 (February 28, 2021)</A></H2>

<H3>UI and Features</H3>

<P>Teach the tune2fs program to support "random" as an argument to the -c
option, which sets the maximum mount count.  (Addresses Debian Bug:
#926293)</P>

<P>Add support for the FS_NOCOMP_FL flag to chattr and lsattr.</P>

<H3>Fixes</H3>

<P>When resizing a small file systems to a super-large file system size,
avoid issuing some scary bitmap operation warnings.  (Addresses Github
issue https://github.com/tytso/e2fsprogs/issues/60)</P>

<P>Fix the debugfs rdump and ls commands so they will work correctly for
uid's and gid's => 65536.  (Addresses Github issue issue
https://github.com/tytso/e2fsprogs/issues/63)</P>

<P>Fix the debugfs write and symlink commands so they support targets which
contain a pathname (instead of only working when writing a file or
creating a symlink in the current directory).  (Addresses Github issue
https://github.com/tytso/e2fsprogs/issues/61)</P>

<P>Fix Direct I/O support on block devices where the logical block size is
greater 1k.  (This includes Advanced Format HDD's, where the sector size
is 4k, and IBM Mainframe DASD's, where the sector size is 2k.)</P>

<P>Fix debugfs's logdump so it works on file systems whose block size is
greater than 8k.</P>

<P>Fix a where e2fsck could a crash when there is error while e2fsck is
trying to open the file system, and e2fsck calls ext2fs_mmp_stop()
before MMP has been initialized.  (Addresses Debian Bug: #696609)</P>

<P>Improved error checking in the fast commit replay code in e2fsck.</P>

<P>Updated and clarified the chattr man page.</P>

<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Fix various compiler and Coverity warnings.</P>

<P>Update the Spanish translation from the translation project.</P>

<P>Update the e2fsck/iscan.c test program so that it builds again.</P>

<P>Fix an environmental dependency bug for the m_rootdir_acl regression
test.</P>

<P>Avoid the use of loff_t, which is not available for all compilers /
system include files.</P>

<P>Fix failure of the t_mmp_fail test when running on a device with a 4k
logical sector size.</P>


<H2><A NAME="1.46.1">E2fsprogs 1.46.1 (February 9, 2021)</A></H2>

<H3>Fixes</H3>

<P>Fix a bug in libext2fs and debugfs when trying to set an extended
attribute will result in a seg fault.</P>

<P>Fix e2fsck so it properly accepts large_dir directories which are
greater than 4GB in size.</P>

<P>Fix fast commit support on big endian architectures.  Also avoid potential
crash on an error handling case.</P>

<P>Fix mke2fs -d so it correctly handles important a directory or small
file which is stored using inline_data and contains an ACL or extended
attribute.   (Addresses-Debian-Bug: #971014)</P>

<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Fix build failure on systems with pthread && without FUSE support.</P>

<P>Fix various compiler warnings.</P>

<P>Fix portability problems by not depending on the glibc specific qsort_r
function.</P>

<P>Change configure.ac to use AS_HELP_STRING instead of the deprecated
AC_HELP_STRING, and explicitly declare that the configure.ac requires
autoconf 2.69.</P>

<P>Fixed/improved various Debian packaging issues.  (Addresses-Debian-Bug:
#966686)</P>

<P>Update the Czech, French, Malay, Polish, Portuguese, Sweedish, and
Ukranian translations from the translation project.</P>


<H2><A NAME="1.46.0">E2fsprogs 1.46.0 (January 29, 2021)</A></H2>

<H3>UI and Features</H3>

<P>E2fsprogs now supports the fast_commit (COMPAT_FAST_COMMIT) feature.
This feature, first available in Linux version 5.10, adds a fine-grained
journalling which improves the latency of the fsync(2) system call.  It
should also improve the performance of ext4 file systems exported via
NFS.</P>

<P>E2fsprogs now supports the stable_inodes (COMPAT_STABLE_INODES) feature.
This needed to support fscrypt siphash algorithm, which calculates the
initial vector (IV) for encryption based on the UUID and the inode
number.  This means that we can't renumber inodes (for example, when
shrinking a file system) and the UUID can't be changed without breaking
the ability to decrypt the encryption.</P>

<P>E2fsprogs now supports file systems which have both file system
encryption and the casefold feature enabled.  This is used in some
Android handsets, but has not yet landed upstream yet.</P>

<P>E2fsck now will check file names on file systems with case folding
enabled to make sure the characters are valid UTF-8 characters.  This is
done for file systems which enforce strict encodings, and optionally if
the extended "check_encoding" option is requested.</P>

<P>The fuse2fs program now supports the "-o norecovery" option, which will
suppress any journal replay that might be necessary, and mounts the file
system read-only.</P>

<P>E2fsck will now find and fix file system corruptions when the encrypted
files have a different policy from their containing directory.</P>

<P>The "htree" command in debugfs now displays the metadata checksums for
hash tree index blocks.</P>

<P>Dumpe2fs will print the error code that Linux kernels newer than v5.6
will save to indicate the class of error which triggered the ext4_error
event.</P>

<P>E2fsprogs programs (in particular, fuse2fs) can now update htree
directories without clearing the htree index.</P>

<P>Mke2fs now sets the s_overhead_cluster field, so that the kernel doesn't
need to calculate it at mount time.  This speeds up mounting very large
file systems.</P>


<H3>Fixes</H3>

<P>E2fsck will properly handle checking for duplicated file names when case
folding is enabled.</P>

<P>Fix various bugs where a maliciously corrupted file systems could case
e2fsck and other e2fsprogs programs to crash.</P>

<P>Tune2fs will properly recalculate directory block checksums when
clearing the dir_index feature.</P>

<P>Fix a bug in e2fsck directory rehashing which could fail with ENOSPC
because it doesn't take into account the space needed for the metadata
checksum, and doesn't create a sufficiently deep index tree.</P>

<P>Clarify the e2fsck messages when it resets the directory link count when
it is set to the overflow value but it is no longer needed.</P>

<P>The filefrag program can now request the kernel to display the extent
status cache by using "filefrag -E".  (This requires Linux version 5.4
or newer.)</P>

<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Speed up mke2fs when creating large bigalloc file systems by optimizing
ext2fs_convert_subcluster_bitmap().</P>

<P>Bitmap blocks are now read using multiple threads (for systems with
pthread support).  This speeds up dumpe2fs, e2fsck, and debugfs for very
large file systems.</P>

<P>The dumpe2fs and tune2fs will now avoiding to read the block group
descriptors when they are not needed, which speeds up these program when
operating on very large file systems.</P>

<P>Drop use of the sysctl(2) system call, which is deprecated in Linux.</P>

<P>Add support for "configure --enable-developer-features" which enables
features only meant for developer.  The first such feature is "e2fsck -E
clear_all_uninit_bits", which clears the uninitialized bit on all
extents for all inodes.  Note that this can end up exposing uninitialized
data to userspace, and should only used in very specialized situations.</P>

<P>The e2fsck/revoke.c and e2fsck/recovery.c files are now kept idential
with the fs/jbd2 versions of these files in the kernel.</P>

<P>Fix various compiler and Coverity warnings.</P>

<P>Update to use gettext 0.19.8.  This also removes the built-in "intl"
directory as this is now considered deprecated by gettext.  This means
that if the system doesn't have gettext installed on the build system,
we will simply disable NLS support.</P>


<H2><A NAME="1.45.7">E2fsprogs 1.45.7 (January 28, 2021)</A></H2>

<H3>UI and Features</H3>

<P>Mke2fs will now warn when creating a file system on a DAX-capable device
and the block size is incompatible with DAX.</P>

<P>The chattr and lsattr programs now support using the 'x' attribute to
set/get dax support on a particular file.</P>

<P>E2fsprogs now supports the gnu.* extended attribute namespace, which
allows mke2fs -d to import the gnu.translator extended attributes.</P>

<P>Add support for the simultaneous enablement of the casefold and
encryption features, which ext4 supports starting with the v5.5 Linux
kernel.</P>


<H3>Fixes</H3>

<P>When trying to run debugfs on a mounted file system, it's possible for
the superblock to be read in an inconsistent state; debugfs will now
retry the open in the hopes that it will succeed.</P>

<P>Fix an off-by-one error when validating the depth of an htree which
caused e2fsck to potentially fail to notice an invalid htree.</P>

<P>Fix potential buffer overrun in e2fsck when scanning directory blocks in
pass 2. (Addresses Google Bug: #158564737)</P>

<P>Fix tune2fs so that it unlocks the MMP block if it can't perform the
requested operation.</P>

<P>Fix mke2fs so it can import the contents of a directory using the -d
option when it has inode numbers that are greater than 2**32.   Also fix
an ommission were the extended attributes on the top-level directory was
not getting copied to the root directory.</P>

<P>Fix e4crypt so that the add_key operation uses the explicitly provided
salt if it is provided.</P>

<P>Fix resize2fs to prevent it from overflowing the block group descriptors
from overflowing the first block group.  (This can only happen when the
block size is 1k and the file system is very large.)</P>

<P>Fix debugfs's set_super_value command so it can set 64-bit integer
fields, such as s_kbytes_written.</P>

<P>Fix filefrag so that it won't crash if the kernel returns zero for
statfs(2)'s device id or if it returns a blocksize of zero the device's
blocksize.  This only happens with kernel bugs, but filefrag shouldn't
crash when the kernel returns an unexpected value.</P>

<P>Fix a few bad error code returns in the unix and sparse I/O managers.
(These errors rarely happen in real life; these were find thanks to a
static code checker.)</P>

<P>E2fsck will no longer try to fix duplicate file names in an encrypted
directory by mutating the file name since that will cause the decrypted
file name to be gibberish, or to contain invalid characters.</P>

<P>Updated and clarified various man pages.</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>The misc/mke2fs.conf.in script now properly escaping of double quotes
when incorporating the mke2fs.conf into the default_profile.c file.  The
upstream version of the mke2fs.conf.in file doesn't have any double
quotes, but this allows a customized distribution of e2fsprogs to have
double quotes in its default mke2fs profile.</P>

<P>Speeded up mkfs.ext3 by batching calls to ext2fs_zero_blocks when
zeroing the blocks for an indirect-block mapped journal inode.</P>

<P>Fixed portability problem for implementations of grep which don't
support extended regexp's without the -E option.</P>

<P>Fix various compiler and Coverity warnings.</P>

<P>Fixed portability issue which caused a build failure when mkdir -p is
not thread safe; in that case, the Makefiles would not find the
install_sh replacement script.</P>

<P>Fixed various Debian packaging issues.</P>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Update the Dutch, Malay, and Serbian translations from the translation
project.</P>


<H2><A NAME="1.45.6">E2fsprogs 1.45.6 (March 20, 2020)</A></H2>

<H3>UI and Features</H3>

<P>Debugfs will ignore lines in its command files which start with a
comment character ("#").</P>


<H3>Fixes</H3>

<P>Fixed a number of potential out of bounds memory accesses caused by
fuzzed / malicious file systems.  (Addresses Google Bug: #147849134)</P>

<P>Fix a spurious complaint from e2fsck when a directory which previously
had more than 32000 subdirectories has the number of subdirectories
drops below 32000.</P>

<P>Fix an ismounted check when an LVM device is renamed while the device is
mounted.</P>

<P>Mke2fs -d now correctly sets permission with files where the owner
permissions are not rwx.</P>

<P>Improve e2fsck's ability to deal with file systems with very large
number of directories, such that various data structures take more than
2GiB of memory.  Use better structure packing to improve the memory
efficiency of these data structures.</P>

<P>Fix debugfs so it correctly prints inode numbers > 2**31.</P>

<P>Filefrag now supports very large files (with > 4 billion blocks), as
well as block sizes up to 1 GiB.</P>

<P>Updated and clarified various man pages.  (Addresses Debian Bugs:
#953493, #953494, #951808)</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Reserved the error code EXT2_ET_NO_GDESC (which will be used in
e2fsprogs v1.46+)</P>

<P>Added a thread-safe variant of e2p_feature2string(),
e2p_feature_to_string() to the libe2p library.</P>

<P>Fixed portability problems caused by gcc 10.</P>

<P>Fixed portability problem in libcom_err with GNU Hurd.</P>

<P>Fixed various Debian packaging issues.  (Addresses-Debian-Bug: #953926)</P>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Update the Malay translation from the translation project.</P>


<H2><A NAME="1.45.5">E2fsprogs 1.45.5 (January 7, 2020)</A></H2>

<H3>Fixes</H3>

<P>E2fsck will no longer force a full file system check if time-based
forced checks are disabled and the last mount time or last write time in
the superblock are in the future.</P>

<P>Fix a potential out of bounds write when checking a maliciously
corrupted file system.  This is probably not exploitable on 64-bit
platforms, but may be exploitable on 32-bit binaries depending on how
the compiler lays out the stack variables.  (Addresses CVE-2019-5188)</P>

<P>Fixed spurious weekly e-mails when e2scrub_all is run via a cron job
on non-systemd systems.  (Addresses Debian Bug: #944033)</P>

<P>Remove an unnecessary sleep in e2scrub which could add up to an
additional two second delay during the boot up.  Also, avoid trying
to reap aborted snapshots if it has been disabled via e2scrub.conf.
(Addresses Debian Bug: #948193)</P>

<P>If a mischievous system administrator mounts a pseudo-file system such
as tmpfs with a device name that duplicates another mounted file system,
this could potentially confuse resize2fs when it needs to find the mount
point of a mounted file system.  (Who would have guessed?)  Add some
sanity checking so that we can make libext2fs more robust against such
insanity, at least on Linux.  (GNU HURD doesn't support st_rdev.)</P>

<P>Tune2fs now prohibits enabling or disabling uninit_bg if the file system
is mounted, since this could result in the file system getting
corrupted, and there is an unfortunate AskUbuntu article suggesting this
as a way to modify a file system's UUID on a live file system.  (Ext4
now has a way to do this safely, using the metadata_csum_seed feature,
which was added in the 4.4 Linux kernel.)</P>

<P>Fix potential crash in e2fsck when rebuilding very large directories on
file systems which have the new large_dir feature enable.</P>

<P>Fix support of 32-bit uid's and gid's in fuse2fs and in mke2fs -d.</P>

<P>Fix mke2fs's setting bad blocks to bigalloc file systems.</P>

<P>Fix a bug where fuse2fs would incorrectly report the i_blocks fields for
bigalloc file systems.</P>

<P>Resize2fs's minimum size estimates (via resize2fs -M) estimates are now
more accurate when run on mounted file systems.</P>

<P>Fixed potential memory leak in read_bitmap() in libext2fs.</P>

<P>Fixed various UBsan failures found when fuzzing file system images.
(Addresses Google Bug: #128130353)</P>

<P>Updated and clarified various man pages.</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Speed up e2fsck on file systems with a very large number of inodes
caused by repeated calls to gettext().</P>

<P>The inode_io io_manager can now support files which are greater than
2GB.</P>

<P>The ext2_off_t and ext2_off64_t are now signed types so that
ext2fs_file_lseek() and ext2fs_file_llseek() can work correctly.</P>

<P>Reserve codepoint for the fast_commit feature.</P>

<P>Fixed various Debian packaging issues.</P>

<P>Fix portability problems for Illumous and on hurd/i386 (Addresses Debian
Bug: #944649)</P>

<P>Always compile the ext2fs_swap_* functions even on little-endian
architectures, so that debian/libext2fs.symbols can be consistent across
architectures.</P>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Updated config.guess and config.sub with newer versions from the FSF.</P>

<P>Update the Chinese and Malay translations from the translation project.</P>


<H2><A NAME="1.45.4">E2fsprogs 1.45.4 (September 23, 2019)</A></H2>

<H3>Fixes</H3>

<P>A maliciously corrupted file systems can trigger buffer overruns in the
quota code used by e2fsck.  (Addresses CVE-2019-5094)</P>

<P>E2fsck now checks to make sure the casefold flag is only set on
directories, and only when the casefold feature is enabled.</P>

<P>E2fsck will not disable the low dtime checks when using a backup
superblock where the last mount time is zero.  This fixes a failure in
xfstests ext4/007.</P>

<P>Fix e2fsck so that when it needs to recreate the root directory, the
quota counts are correctly updated.</P>

<P>Fix e2scrub_all cron script so it checks to make sure e2scrub_all
exists, since the crontab and cron script might stick around after the
e2fsprogs package is removed.  (Addresses Debian Bug: #932622)</P>

<P>Fix e2scrub_all so that it works when the free space is exactly the
snapshot size.  (Addresses Debian Bug: #935009)</P>

<P>Avoid spurious lvm warnings when e2scrub_all is run out of cron on
non-systemd systems (Addresses Debian Bug: #940240)</P>

<P>Update the man pages to document the new fsverity feature, and improve
the documentation for the casefold and encrypt features.</P>

<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Fixed various debian packaging issues.  (Addresses Debian Bug: #933247,
#932874, #932876, #932855, #932859, #932861, #932881, #932888)</P>

<P>Fix false positive test failure in f_pre_1970_date_encoding on 32-bit
systems with a 64-bit time_t.  (Addresses Debian Bug: #932906)</P>

<P>Fixed various compiler warnings.  (Addresses Google Bug #118836063)</P>

<P>Update the Czech, Dutch, French, German, Malay, Polish, Portuguese,
Spanish, Swedish, Ukrainian, and Vietnamese translations from the
Translation Project.</P>

<H2><A NAME="1.45.3">E2fsprogs 1.45.3 (July 14, 2019)</A></H2>

<H3>UI and Features</H3>

<P>Whether or not automatic online scrubs will be run is now controlled by
a setting in /etc/e2scrub.conf.  To enable automatic online scrubs,
uncomment out the line containing "periodic_e2scrub=1".</P>

<P>The fuse2fs program is now installed in /usr/bin instead of /usr/sbin,
since it does not require root privileges.</P>

<P>Fuse2fs now works with if fusermount from FUSE V3 is installed.
However, in order to provide this compatibility, if you are using a
fusermount from FUSE v2, and you want to mount on top of a non-empty
directory, you will need to specify -o nonempty explicitly.  FUSE V3
always allows mounting on top of non-empty directories, and will fail if
the user or fuse2fs passes the nonempty option.</P>


<H3>Fixes</H3>

<P>Fixed a bug which caused e2fsck to improperly handle file systems that
enabled both the large_dir and inline directories at the same time.</P>

<P>E2scrub_all now correctly handles an encrypted (LUKS) ext[234] file
system stacked on top of an LVM volume.  (Addresses Debian Bug: #931387)</P>

<P>Fixed a bug in "E2scrub_all -r" where it was incorrectly specifying
which volume needed to have its e2scrub snapshot cleaned up.  (Addresses
Debian Bug: #931679)</P>

<P>Fixed the Czech, Dutch, German, and Vietnamese translations which
improperly used positional markers which broke a few translated e2fsck
problem descriptions.  (Addresses Debian Bug: #892173)</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Fixed various debian packaging issues.  (Addresses Debian Bug: #931266,
#923372)</P>

<P>Fixed error checking for calls to posix_{memalign,fadvise}.</P>

<P>Add regression test for checking a file system using fs-verity.</P>

<P>Various regression test cleanups.</P>

<P>Fixed various compiler warnings.</P>

<P>Added xgettext markers to fix incorrectly marked strings in the
e2fsprogs translations template file as being c-style printf strings
when in fact they aren't.</P>

<P>Added utility script which generates the release tarfile using git
archive.</P>

<P>Update the Czech, Dutch, and Portuguese translations from the
Translation Project.</P>


<H2><A NAME="1.45.2">E2fsprogs 1.45.2 (May 27, 2019)</A></H2>

<H3>Fixes</H3>

<P>Fixed various problems with how e2scrub_all is run from cron, when not
all of the required packages are installed, or there are no LVM devices
on the system.  (Addresses Debian Bug: #929186, #929287, #928977)</P>

<P>When mke2fs asks the user if she should proceed, fall back to the
English 'y' or 'Y' characters since there could be a missing translation
prompting the use of the English 'y' character.  (Addresses Debian Bug:
#907034)</P>

<P>Fix spurious complaint of blocks beyond i_size for verity files.</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Fixed various debian packaging issues.</P>

<P>Fixed "make install" failure when the cron.d directory does not exist.</P>

<P>Update the Czech, Malay, Polish, Spanish, Swedish, and Ukarainian
translations.  Add the new Portuguese translation.</P>


<H2><A NAME="1.45.1">E2fsprogs 1.45.1 (May 12, 2019)</A></H2>

<H3>UI and Features</H3>

<P>Teach the e2scrub and e2scub_all commands the -n option, which prints
what these commands would do.</P>

<P>Finalize the casefold support so it is synchronized with what we
actually shipped in the kernel.  This includes updating to Unicode 12.1,
dropping ASCII casefolding support, and switching from NFKD to NFD.  The
the ext4 feature name also changed from fname_encoding to casefold.
Add support for casefold to dumpe2fs and debugfs.</P>

<P>Debugfs now prints non-printable characters using C-style hex escape
sequences (e.g., "\xc1" instead of M-A).  The old scheme printed
filenames in an ambiguous way, which complicated using debugfs for ext4
encryption regression tests.</P>

<P>E2fsck now checks to make sure that all unused bits in the block
allocation bitmaps are set; if there are some unset bits in the block
bitmaps for file systems where the blocks_per_group is less than
8*blocksize (not the default), this can confuse the kernel's multi-block
allocator and return a bogus free extent.  E2fsprogs guarantees this
when it writes out the bitmap blocks, but it's possible that file system
blocks could have gotten corrupted since the last time e2fsprogs wrote
out the bitmap blocks.</P>

<P>E2fsck now has support write out a problem code log which can provide
more debugging and monitoring information.  This can be configured using
/etc/e2fsck.conf.</P>


<H3>Fixes</H3>

<P>Teach e2scrub and e2scrub to give more intelligible error messages when
the lvm2 and util-linux packages are not installed, or if the commands
are not run as root.</P>

<P>Teach e2scrub_all to skip trying to run e2scrub on a logical volume if
its volume group did not have enough space to create a snapshot.
(Addresses Debian Bug: #924301)</P>

<P>E2scrub will tag its snapshots with UDISK_IGNORE so they do not show up
in GUI's.   (Addresses Debian Bug: #926112)</P>

<P>Mark the e2scrub service files to indicate that CAP_SYS_ADMIN and
CAP_SYS_RAWIO are required.  This avoids errors when e2scrub is run an
container where root does not have these capabilities.  (Addresses
Debian Bug: #926138)</P>

<P>Fix mke2fs's check for absurdly large disks.  Previously check was 2^10
too small, so mke2fs would fail when trying to format a 900TB file
system.</P>

<P>Fixed debugfs so it correctly prints ea_in_inode xattr values.</P>

<P>Fixed various casefold bugs.</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Fix autoheader warnings caused by a missing template in AC_CHECK_LIB.</P>

<P>Fix the the "make install-strip" command.</P>

<P>Dropped utf8_* and nls_* symbols from the libext2fs shared library, to
avoid namespace contamination.</P>

<P>Fix the f_valid_ea_in_inode test so actually tests the ea_in_inode
feature.</P>

<P>Fixed various debian packaging issues.  (Addresses Debian Bug: #924275)</P>


<H2><A NAME="1.45.0">E2fsprogs 1.45.0 (March 6, 2019)</A></H2>

<H3>UI and Features</H3>

<P>Tune2fs can now set the file system error bit to force a check at the
next fsck by using the extended option "force_fsck".</P>

<P>E2fsprogs now has an e2scrub script which will allow e2fsck to be run on
volumes that are mounted on an LVM device.  The e2scrub_all will find
all ext* file systems and run them using e2scrub (if possible).</P>

<P>Mke2fs will attempt to use ZERO_RANGE before PUNCH_HOLE so that we don't
lose allocated blocks in preallocated files.</P>

<P>The fuse2fs command now supports a "fakeroot" option to allow an
unprivileged user to fuse2fs to modify rootfs images.</P>

<P>Add initial support for setting the character set encoding and case
folding file system feature.  We don't have support to validate file
names as being valid for a given character set encoding yet, but this
will allow compatibility for this feature when the kernel support
lands.  This includes support in lsattr and chattr to understanding the
casefold attribute flag.</P>

<P>Debugfs can now set the inode's checksum field to test support for
inodes with bad inode checksums.</P>

<P>E2image now accepts the -b and -B options to allow the user to specify
the superblock location when creating a raw or qcow2 image.</P>

<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Add support for building e2fsprogs using Link Time Optimization (LTO),
UBSAN, Address Sanitizer, or Thread Sanitizer.</P>

<H2><A NAME="1.44.6">E2fsprogs 1.44.6 (March 5, 2019)</A></H2>

<H3>Fixes</H3>

<P>If files are created while e4defrag is running, it's quite possible for
succeed_cnt to be larger than total_count, in which case the number of
failures (calculated via total_count - succeed_cnt) will overflow and
become a very large unsigned number.  (Addresses Debian Bug: #888899)</P>

<P>Fix e2fsck so it can correctly handle directories > 2 GiB when the
largedir feature is enabled.</P>

<P>Fix mke2fs's hugefile creation so that we correctly reserve enough
metadata blocks for a given file system size.  Otherwise for certain
unfortunately sized disks/partitions, the hugefile creation would fail.
(Addresses Google Bug: 123239032)</P>

<P>Fix the libext2fs library to be more robust against invalid block group
descriptors to prevent e2fsprogs from crashing (or possibly being
p0wned) by maliciously modified file systems.  (Addresses Google Bugs:
119171089, 119929050)</P>

<P>Fix mke2fs and debugfs so they can correctly copy in files > 2 GiB.</P>

<P>Fix debugfs so its stat command can correct supportly display directory
sizes > 2 GiB.</P>

<P>Fix memory leaks in debugfs, mke2fs, and e2freefrag.</P>

<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Avoid unnecessarily linking badblocks with the libblkid shared library.
(Addresses Debian Bug: #919958)</P>

<P>Stop depending on the debugfs binary for test data, since depending on
the compiler, there might be sufficient aligned zero bytes that the
resulting file(s) created by test cases could have unexpected sparse
blocks, leading to test failures.   (Addresses Google Bug: #122085761)</P>

<P>Fixed various debian packaging issues.</P>


<H2><A NAME="1.44.5">E2fsprogs 1.44.5 (December 15, 2018)</A></H2>

<H3>UI and Features</H3>

<P>When e2fsck notices it could optimize an extent tree, it will now ask
"Optimize?" instead of "Fix?", which was confusing some users since it
implied that something was broken.</P>


<H3>Fixes</H3>

<P>Use 64-bit counters to track the number of files that are defragmented
using in e4defrag, to avoid overflows when more than 2**32 files are
defragmented.  (Addresses Debian Bug: #888899)</P>

<P>Correctly translate Posix ACL's.  This was a regression introduced in
v1.44.   (Addresses Launchpad Bug: #1807288)</P>

<P>Use the online free block counts so e2freefrag's percentages are
correct.</P>

<P>Fix a false warning that tune2fs will take long time to change a UUID if
the metadata_csum feature is not enabled.</P>

<P>E2fsck will only offer to set the inline_data feature flag when the
inline flag is set on the inode, *and* the system.data xattr is present.</P>

<P>E4defrag will handle the case where it is running as root and it can't
find the file system to open more gracefully.  (Addresses Debian Bug:
#907634)</P>

<P>Fix a bug where resize2fs was failing to update the extent tree
checksums in an corner case.  (Addresses Launchpad Bug: #1798562)</P>

<P>Fix fuse2fs's command line parsing when options are specified after the
target device/image.</P>

<P>Fix a bug which could cause e2fsprogs tools to segfault on a corrupted
file system where the journal's s_nr_users is impossibly large.</P>

<P>E2image now includes the mmp block (if needed) when creating a
metadata-only image.</P>

<P>Fix various Verity handling bugs which made it completely unusable in
e2fsprogs 1.44.4.</P>

<P>Fix a bug in tune2fs where it would dereference of freed memory after
replaying the journal.</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Fix groff formatting nits in various man pages.  (Addresses Debian Bug:
#916188)</P>

<P>Fixed various debian packaging issues (Addresses Debian Bug: #915942)</P>

<P>Adjusted the copyright license for lib/blkid/version.c to be LGPL (and
consistent with the rest of files in that directory).</P>

<P>Fix various clang warnings.</P>

<P>Fix "make install" when configure was run with --enable-subset.</P>

<P>Make sure the regression tests clean up their tmpfile if the test script
exits.</P>

<P>Fix build failures on non-glibc systems.</P>


<H2><A NAME="1.44.4">E2fsprogs 1.44.4 (August 18, 2018)</A></H2>

<H3>UI and Features</H3>

<P>Add basic support for the ext4 verity feature (aka fsverity).  It is a
read-only compatibility feature which uses Merkle trees to add
functionality much like dm-verity on a per-file basis.  For this release
we simply allow e2fsck to accept file systems with the verity feature
enable (no special handling is needed) and mke2fs to create file systems
with the verity feature.</P>


<H3>Fixes</H3>

<P>E2fsck will now properly repair a file system that has both the
resize_inode and meta_bg features enabled simultaneously (which is never
supposed to happen, but it could happen in versions of mke2fs before
1.44.3 when it was given parameters where more than 75% of the block
group was used for group descriptor tables).</P>

<P>Avoid a floating point exception crash when libblkid tries probing a
maliciously corrupted HFS+ superblock.</P>

<P>Debugfs's ncheck command now properly will handle inodes that have
multiple hard links.</P>

<P>On platforms that don't supply strdup, the replacement function for
strdup() had a bug which would cause it to crash if it was used.
(Fortunately this only happens if the [scratch_files] feature in e2fsck
is used.)</P>

<P>Fixed support for devices which have non-512 byte block sizes on Apple
Darwin.</P>

<P>E2fsprogs 1.44.3 would fail to compile on very old versions of gcc.
This is now fixed.</P>

<P>Update and clarify man pages.  (Addresses Debian Bug: #757831)</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Instead of building the subset e2fsprogs-libs tar file, add a new
configure option, --enable-subset.  This along with other changes (such
as dropping obsolete files that aren't shipped as part of
e2fsprogs-X.YY.tar.gz) allows us to be able to build the tarball using
the "git archive" command.</P>

<P>Fixed various debian packaging issues (Addresses Debian Bug: #905195)</P>

<P>Update Danish, Spanish, and Swedish translations.</P>
  

<H2><A NAME="1.44.3">E2fsprogs 1.44.3 (July 10, 2018)</A></H2>

<H3>UI and Features</H3>

<P>The debugfs inode_dump command can now print a hex dump of the i_block
array and the extra space in the inode, as a convenience to someone
investigating a corrupted inode.</P>

<P>The debugfs block_dump and inode_dump command can now print low-level
dump of extended attribute data structures in the block or inode.</P>

<P>The dumpe2fs command can now print out information in the Multi-Mount
Protection (MMP) block.  This is also available as e2mmpstatus command
for compatibility with the Lustre utilities.</P>

<P>The debugfs command can now operate on some file systems with
corrupted superblocks so they can be fixed.  This includes file
systems with a corrupted inodes count field and file systems where not
all of the allocation bitmaps have valid locations or are not
readable.</P>

<H3>Fixes</H3>

<P>The inode's project ID is now properly byte-swapped on big-endian
systems.</P>

<P>E2fsprogs now ignores s_desc_size for file systems that do not have
the 64-bit feature set.  This makes it more consistent with the
kernel, so it can now operate on file systems that the kernel is
willing to mount.  </P>

<P>E2fsck now considers device inodes with the extents flag as corrupt
and offer to clear them.</P>

<P>E2fsck more properly handles cases where s_inodes_count is corrupted.</P>

<P>E2fsck no longer spews large number of errors when the superblock
badly corrupted (restoring its behavior pre-1.43).</P>

<P>E2fsck will now offer to set the dir_nlink feature if it is not set
and file system requires the dir_nlink feature because there are too
many subdirectories in a directory.</P>

<P>E2fsck will no longer loop infinitely due to a maliciously crafted
file system which has a fully uninitialized inode table in the first
block group.</P>

<P>E2fsck will no longer hang if the last block in the file system is a
fixed-metadata block.  (Very rare, but could happen.)</P>

<P>E2fsck no longer allows initialized blocks to exist past i_size.  This
is something the Linux implementation of ext4 has never done (and should
never do).</P>

<P>While replaying the journal in e2fsck, certain errors would previously
cause e2fsck to print a non-sensical error message (e.g., "Unknown code
____ 251 while recovering journal").  This has been fixed.</P>

<P>In cases where more than 75% of the block group will be used for group
descriptor table, mke2fs would previously create an invalid file
system with both the meta_bg and resize_inode features enabled.  It
will now disable the resize_inode feature.</P>

<P>The mke2fs program now properly creates a file system which is exactly
1 << 32 blocks.  Previously the s_inodes_count field would overflow,
and the file system would be created with a minimal number of inodes.</P>

<P>Recent kernels will report errors on a file or block device which
occurred before the file or block device was opened via fsync() or
close().  This will cause e2fsck to incorrectly report a failure.  Work
around this by calling fsync() immediately after the file or block
device is opened in the unix_io layer, and throwing away the error.</P>

<P>Filefrag will no longer ignore errors returned by fsync.</P>

<P>Debugfs will no longer print spurious checksum errors when failing to
open a file system for unrelated reasons.</P>

<P>Updated/fixed various man pages.  (Addresses Launchpad Bug: #1743553)</P>



<H3>Performance, Internal Implementation, Development Support, etc.</H3>

<P>Synchronized changes from Android's AOSP e2fsprogs tree.</P>

<P>Debugfs's mknod command now works correctly on some 32-bit systems where
previously it had a portability problem caused by some object files
being compiled with LFS, and some without.  This fixes some regression
test failures on 32-bit MIPS (for example).</P>

<P>Various clean ups, portability, and performance improvements to
e2fsprogs's regression test framework.</P>

<P>Fixed Coverity, sparse, gcc -Wall, and clang warnings/nits.</P>

<P>Update Czech, Dutch, Spanish, French, Polish, Swedish, Ukrainian, and
Vietnamese translations.</P>

<H2><A NAME="1.44.2">E2fsprogs 1.44.2 (May 14, 2018)</A></H2>

<H3>Fixes</H3>

<P>E2fsck now prints a warning message if broken_system_clock is set in
e2fsck.conf and this causes the check interval to be ignored so it is
clear to the user.</P>

<P>Fix e2image handling of e2i files on big endian systems</P>

<P>Add sanity checks for inodes containing xattr values to prevent
maliciously crafted file systems from causing crashes caused by infinite
recursion from causing e2fsck and debugfs to crash.</P>

<P>Fix e2fsck so that quota usage is adjusted when clearing orphaned
inodes.</P>

<P>Fix filefrag so that unknown flags returned by FIEMAP won't cause a
buffer overrun.</P>

<P>Fix mke2fs to print a more useful/correct error message if
ext2fs_close_free() at the end of the file system creation process.</P>

<P>Improve chattr's man page.</P>


<H3>Performance, Internal Implementation, Development Support, etc.</H3>

<P>Demote e2fsprogs in debian packaging from Essential: yes to
XB-Important: yes (Addresses Debian Bug #474540)</P>

<P>Fix intl/Makefile so it uses @AR@ instead of a hard-coded 'ar' (which
matters when cross compiling).</P>

<P>Update Polish translation file.</P>

<P>Fix the address of the FSF in various GPL/LGPL copyright licenses.</P>

<P>Clean up the i_bitmaps test so it doesn't leave temporary files behind.</P>

<P>Remove use of /dev/stdin in the regression tests since not all systems
have /dev/stdin.</P>

<P>Fix the f_bigalloc_badinode and f_bigalloc_orphan_list regression tests
so they uses mke2fs and ebugfs from the build tree.  They may not exist
in the users PATH, and if they not or if they are extremely
old/obsolete, those tests would fail.</P>

<H2><A NAME="1.44.1">E2fsprogs 1.44.1 (March 24, 2018)</A></H2>

<H3>Fixes</H3>

<P>E2fsprogs 1.44.0 introduced a regression introduced which caused e2fsck
to fail to support HTree directories on big-endian systems.  Fix how we
read block numbers for internal htree nodes.</P>

<P>Removed a potential memory leak from fsck.</P>

<P>E2image now correctly creates e2image files for bigalloc file systems.</P>

<P>Dumpe2fs and debugfs now correctly support e2image files for file
systems that have the meta_bg option enabled.</P>

<P>E2fsck and debugfs now correctly handle delete inodes (including
processing the orphaned inode list in the case of e2fsck) for bigalloc
file systems.  (Addresses Google Bug: #73795618)</P>

<P>Portability fixes for GNU Hurd.  (Addresses Debian Bug: #893590)</P>

<P>Portability fixes for building in some cross-build environments.</P>

<P>Portability fixes for MacOS 10.6.8.</P>

<P>Add clarifications to chattr's man page.  (Addresses Debian Bug:
#890390)</P>


<H3>Performance, Internal Implementation, Development Support, etc.</H3>

<P>Debugfs now reads allocation bitmaps much more efficiently when opening
a file system.</P>

<P>Update Sweedish translation file.</P>

<P>Add Vcs-* fields to debian packaging.  (Addresses Debian Bug: #887512)</P>

<P>Fix some test failures on GNU Hurd caused by a different default block
size.</P>

<P>Add new regression tests.</P>
  

<H2><A NAME="1.44.0">E2fsprogs 1.44.0 (March 7, 2018)</A></H2>

<H3>UI and Features</H3>

<P>E2fsprogs now supports the large_dir (INCOMPAT_LARGEDIR) feature.  This
feature allows larger directories to be created, both with directory
sizes over 2GB and and a maximum htree depth of 3 instead of the
current limit of 2.  These features are needed in order to exceed
the currently limit of approximately 10M entries in a single
directory for 4KB blocksize (~100k for 1KB).</P>

<P>E2fsprogs now supports the ea_inode (INCOMPAT_EA_INODE) feature, which
stores large extended attributes in an external inode instead of a
single data block.  This is backwards compatible with a Lustre file
system feature, but it has been extended to support deduplicating
extended attribute values which are used in multiple inodes.</P>

<P>The metadata_csum feature (RO_COMPAT_METADATA_CSUM) is now enabled by
default by mke2fs.</P>

<P>The resize2fs program will no longer complain about resizing bigalloc
file systems as being dangerous when doing an on-line resize (since this
is purely a kernel feature).</P>

<P>Debugfs's ls command will now print the high bits of the inode's mode
bits.</P>

<H3>Fixes</H3>

<P>Fixed some potential buffer overrun bugs in the blkid library and in the
fsck program.</P>

<P>There were some corner cases which tune2fs wouldn't correctly handle
when operating on a file system which was not cleanly mounted and thus
required running the journal because it could be modified.  Tune2fs will
now run the journal before trying to change the superblock, and if the
file system needs to be checked after the journal has been replayed, it
will require it before proceeding.  Also if the file system is busy (for
example, because it is in use by Lustre), but is not present in the
/proc/mounts or /etc/mtab, tune2fs will not try to replay the journal,
since this could do real damage if it the file system is being actively
modified by the kernel.</P>

<P>The libss library (used by debugfs) now supports the version 7 of the
libreadline shared library.</P>

<P>The e2freefrag program will use the GETFSMAP ioctl if it is available
and the file system is mounted, so that the free space statistics will
be more accurate.</P>

<P>The consistency checks for symlinks (especially for encrypted and inline
data file sytems) in e2fsck are now much more careful/stringent.  Also
fixed a bug where creating a symlink using ext2fs_symlink() which was
exactly 60 bytes long when inline data was enabled would result in a
missing system.data xattr.</P>


<H3>Performance, Internal Implementation, Development Support etc.</H3>

<P>Mke2fs now uses io_channel_flush() instead of sync() for the sync_kludge
feature.</P>

<P>E2fsprogs now uses i_size as the primary way of determining whether a
symlink is a fast symlink.</P>

<P>Fix various compiler and UBSAN warnings.</P>

<P>Long running test are now skipped with "make check" and only run when
"make fullcheck".  The test runner will warn when potentially long
running tests are being run via "make check".</P>

<P>E2fsck is now much faster for bigalloc file systems when scanning
extents for bigalloc file systems.  (Addresses Google Bug #36886699)</P>

<P>Update Czech, Spanish, French, Malay, and Ukrainian translations.</P>


<H2><A NAME="1.43.9">E2fsprogs 1.43.9 (February 8, 2018)</A></H2>

<P>Remove the huge file flag from libe2p (and hence from chattr/lsattr),
since it was never made visible by the kernel.  Remove the description
of some compression related flags, and add a description of the
encrypted file flag, and the project hierarchy flag.</P>

<P>Remove a misplaced "MNP is unsupported" message from debugfs.</P>

<P>Fix a build failure in lib/ext2fs/swapfs.c on big-endian systems.
(Addresses Debian Bug #886119)</P>

<P>Fix various Debian packaging issues.  (Addresses Debian Bug #269569).</P>

<H2><A NAME="1.43.8">E2fsprogs 1.43.8 (January 1, 2018)</A></H2>

<P>Fix a bug where updated bitmap checks might not be written to disk.
(Addresses Debian Bug: #883869)</P>

<P>Some newly added fields in the superblocks were not getting byte
swapped (which were not noticed since big endian systems are amazingly
unpopular).  Fix them and compile-time checks to avoid this class of
bugs from happening in the future.  (Lustre Bug #9309)</P>

<P>Fix a potential use after free bug in e2fsck when fixing a corrupted
root node in directory hash tree.</P>

<P>Fix a bug in e2fsck where a badly/maliciously corrupted superblock
(which is not fixed due to the -n option, for example) can cause a
floating point exception when printing the summary statistics.
(Addresses Debian Bug: #879220)</P>

<P>Fix debugfs's ncheck command so that it correctly prints the inode
number when printing an error message.</P>

<P>Fix a bug in e2freefrag where it could print an incorrect free blocks
count on a file system with the 64-bit block number feature.</P>

<P>Update the German, Serbian, Spanish, and Ukrainian translations.</P>

<P>Fix a bug where resize2fs's free blocks sanity check could fail with a
false positive and refuse to check a file system with the 64-bit block
number feature.</P>

<P>Fix and clarify various man pages and documentations.  Also fixed up
some random usage texts that were incorrect.  (Addresses Debian Bugs:
#880483)</P>

<P>Fixed various Debian Packaging Issues.  (Addresses Debian Bugs: #880207,
#881408, #881590, #881591)</P>

<H3>Programming notes</H3>

<P>Fix various compiler warnings.</P>

<P>Clean up Makefile output.</P>

<P>Fix compatibility problems with glibc 2.27 casued by a collision with
copy_file_range().</P>


<H2><A NAME="1.43.7">E2fsprogs 1.43.7 (October 16, 2017)</A></H2>

<P>Fix the error handling code in debugfs, fuse2fs and tune2fs so errors
trying to replay the journal won't accidentally result in a seg fault
if reopening the file system after the journal replay fails for some
reason.</P>

<P>Fix resize2fs to avoid it from either failing or corrupting the file
system image in certain corner cases when doing an off-line resize.</P>

<P>Fix many spelling mistakes in various man pages, code comments, and
program messages.</P>

<P>Fix e2fsck and debugfs so that maliciously corrupted file systems will
not cause buffer overflows.  (Addresses Debian Bugs: #873757, #878104)</P>

<P>Update German translation.  (Addresses Debian Bug: #833514)</P>

<P>Fixed various Debian Packaging Issues.  (Addresses Debian Bugs:
#873812, #873813, #876551)</P>

<H3>Programming notes</H3>

<P>Test descritions have been shorted to fit in 80 columns.</P>

<P>Fix various tests to avoid leaving temp files in /tmp.</P>


<H2><A NAME="1.43.6">E2fsprogs 1.43.6 (August 29, 2017)</A></H2>

<P>Fix printing of quota inconsistency messages on 32-bit platforms in
e2fsck.  Also fix a bug which cause project quota problems to be
labelled as group quota problems.</P>

<P>Fix UI problems caused by fuzzy translations such that some messages
are in English and some are in the foreign language, and it's not
obvious to user how to answer yes/no questions.  (Addresses Debian
Bug: #856586).</P>

<P>Fix some out-of-bounds memory accesses in e2fsck caused by (usually
maliciously) corrupted file systems.  (Addresses Debian Bugs: #871539,
#871540)</P>

<P>Optimize CPU usage in e2fsck for very large, very fragmented sparse
files.</P>

<P>Add an optional mode in e2fsck which trades off additional memory for
CPU time when processing file systems that are heavily hard-linked.
(This can be a very large amount of memory, so this feature is
disabled for now.  How to automatically determine when it would be
helpful to enable this optimization, and when it is _safe_ to enable
this optimization is still a bit of a research problem.)</P>

<P>The mke2fs program will automatically upsize the inode size to 256 if
it is not explicitly specified on command-line and the default inode
size is not large enough to support the project quota feature
requested by the user.  If the inode size is explicitly specified to
be 128 bytes, and the project quota is enabled mke2fs will fail since
with an error explaining that project id's can't be supported when the
inode size is < 256 bytes.</P>

<P>The tune2fs program will not allow the project feature or project
quotas to be enabled in the inode size is 128 bytes.</P>

<P>The tune2fs program now prints a more understandable message explaining
that the file system needs to be checked using e2fsck -f before
running certain complex tune2fs operations.  (Addresses Debian Bug:
#857336)</P>

<P>If the proceed_delay option is enabled in /etc/e2fsck.conf, the message
indicating that user can wait N seconds to proceed was ambiguous.
That message has been made more clear.  (Addresses Debian Bug:
#857336)</P>

<P>Fix LFS bug which caused e2image to fail to create regular e2image
files which are larger than 2 GiB on 32-bit platforms.  (Addresses
Debian Bug: #855246)</P>

<P>Fix FreeBSD portability problem caused by the fact that they no longer
use block devices.  (Disks are character mode devices.)</P>

<P>Update the Czech, French, Polish, Swedish, and Vietnamese translations.</P>

<P>Fixed various Debian Packaging Issues.</P>

<h3>Programming notes</h3>

<P>Avoid changing the blkid cache when running tests.  (Normally the
blkid cache is not writable by the user running tests, but...)</P>

<P>The tar file generation process will now create reproducible
artifacts.</P>

<P>Removed legacy entries for ext4dev in the default mke2fs.conf file.</P>


<H2><A NAME="1.43.5">E2fsprogs 1.43.5 (August 4, 2017)</A></H2>

<P>Fix a bug which could cause e2fsck to loop forever when rebuilding an
encrypted directory with entries with identical prefixes up to an
embedded NUL character.</P>

<P>Fix build when configured with --disable-threads or --enable-profile.</P>

<P>Fix ext2fs_sync_device() so it returns the proper error code if the
BLKFLSBUF ioctl fails for some reason.</P>

<P>Fix a potential crash in tune2fs when enabling project quota when the
file system has no inodes by fixing error handling in the
quota_write_inode() in libsupport.</P>

<P>Fix a bug in debugfs's "ls -p" handling which could cause it to print
garbage after a file name in a directory entry.</P>

<P>Fix a number of bugs in debugfs, dumpe2fs, e2fsck, tune2fs, and
resize2fs where a carefully/maliciously corrupted file systems (found
by American Fuzzy Lop) could these programs to crash or hang.
(Addresses Debian Bug #868489)</P>

<P>E2fsck no longer issues some harmless bitmap warnings caused by a
corrupted file system; since those corruptions will be fixed up by
e2fsck later, there's no point issuing these internal warnings.</P>

<P>E2fsck will now notice invalid quota inode numbers, and offer to fix
them.</P>

<P>Fix a regression introduced in e2fsprogs 1.43 which broke mke2fs's
hugefile creation so that they aren't contiguous.  (Addresses Google
Bugs 62791459 and 638037607)</P>

<P>Fix how backup superblocks are written in big endian systems so they
are all correctly byte swapped.</P>

<P>Fixed tune2fs's support for enabling and disabling project quota.</P>

<P>The badblock program now properly handles languages which have
multi-column wide character such as Chinese.  (Addresses Debian Bug:
#860926)</P>

<P>The mke2fs -U option now accepts "null", "clear", "random", or "time"
just as tune2fs's -U option.</P>

<P>Fix e2fsck's -E bmap2extent feature (which converts a file to use
extents from indirect block maps) so that it handles sparse files correctly.</P>

<P>Fix libext2fs to correctly handle accounting for an external xattr
block on bigalloc file systems.</P>

<P>Fix e2fsck to correctly handle quota accounting when deleting files
that have multiply-claimed blocks pass 1b.</P>

<P>Fix potential buffer overrun bug in e2fsck when using 128 byte inodes.
(Addresses Google Bug 37326362).</P>

<P>E2fsck's extent tree optimization can now be disabled via an
command-line extended option or via an e2fsck.conf configuration
parameter.</P>

<P>The e2fsck program now properly updates the quota accounting when
optimizing the extent tree.  (Addresses Google Bug 36391645)</P>

<P>Fix some error handling in e4crypt when operating on keyring ID's.</P>

<P>Fix e2fsck's quota handling when the bigalloc feature is enabled.</P>

<P>The libext2fs file system now uses readahead when opening file systems
to speed up opening very large file systems with the meta_bg option.</P>

<P>If e2fsck logging is enabled, e2fsck will report the exit code in the
last line of the log file.</P>

<P>Debugfs can now open file systems with a bad superblock checksum, and
the show_super_stats command will print the expected checksum.</P>

<P>Fix a regression introduced in e2fsprogs 1.43.4 where tune2fs was not
able to correctly enable the quota feature.  (Addresses Debian Bug
#855417)</P>

<P>E2fsck will only return an exit status code of 1 if it has fixed a
file system corruption.  If it only performed an optimal optimization
of internal file system metadata, it will now return 0.</P>

<P>Fix e2fsck so it won't check inode fields of deleted inodes.  This was
mostly harmless, but the addition of a check in 1.43.4 to enforce the
requirement that inline data inodes have a system.data attribute
caused a regression in xfstests generic/079.  Fix this and a number of
other checks which could lead to false positive reports of file system
corruption.</P>

<P>Removed a debugging printf in libsupport which could result to some
extraneous and confusing output if the user specifies a quota type.</P>

<P>The debugfs logdump command now accepts a new -S option which will
cause it to print information about the journal superblock.</P>

<P>Added a missing space in debugfs's ls -l output to separate the size
and date fields.</P>

<P>Update the Czech, Danish, Dutch, French, Hungarian, Polish, Serbian,
Spanish, Swedish, Ukrainian, and Vietnamese translations.</P>

<P>Update various man pages.  (Addresses Debian Bugs #867895 and #865584)</P>

<P>Fix various compiler and UBSAN warnings.</P>

<P>Fixed various Debian Packaging Issues.  (Addresses Debian Bugs
#864144 and #866623)</P>

<H3>Programming notes</H3>

<P>The blkid library can now recognize exfat file systems.</P>

<P>Add new test, j_recover_csum3_64bit, which checks to make sure we
correctly recovering 64-bit journals using the v3 checksum format.</P>

<P>Fix portability assumption in tests; don't depend on the existence of
/dev/stdin.</P>

<P>Fix portability with newer versions of glibc and with Cygwin builds on
Windows 8 and Windows 10.</P>

<P>Clean up the comments in problem.c match the message that will
actually be printed.</P>

<P>Removed an unused an obsolete header file.</P>

<H2><A NAME="1.43.4">E2fsprogs 1.43.4 (January 31, 2017)</A></H2>

<P>Fix e2fsck to require that the system.data extended attribute is
always present even for files smaller than 60 bytes, to be consistent
with the kernel.</P>

<P>Fix a bug which was causing mke2fs -d and fuse2fs to improperly handle
Posix ACL's.</P>

<P>Fix a bug which could cause mke2fs -d to fail if there is an
zero-length file in source directory tree.</P>

<P>Clarify the default for the "proceed?" question printed by mke2fs and
tune2fs.  (Addresses Debian Bug: #852727)</P>

<P>Debugfs will now display project quota information.</P>

<P>Debugfs's do_set_xattr now uses C strings to parse extended attribute
values, and will print the extended attributes using either C strings
or hex bytes when using debugfs's do_get_xattr command.  It will now
allow developers to see the contents of the system.data extended
attribute.</P>

<P>Fix a bug in mke2fs where I/O errors weren't getting properly reported
to the user.</P>

<P>Fix multiblock writes in the unaligned Direct I/O fallback code.
(Which is rarely needed on Linux systems, but which is required on
Freebsd systems.)</P>

<P>Make sure the default mke2fs.conf file includes the uninit_bg feature
flag.  (Which was accidentally dropped in v1.43).</P>

<P>Fix a bug in resize2fs when operating on very large file systems which
have a block size different from the VM page size.</P>

<P>If the reported device size is absurdly large, mke2fs will now report
an error instead looping forever or crashing.</P>

<P>Fix various Coverity warnings and other memory leaks in fuse2fs and
extended attribute manipulation functions.</P>

<P>Replace a test file but which had a "non-commercial use-only"
copyright permission file with a newer version from the Cyrus imapd
package which now has a 4-clause BSD license, which was making some
lawyers nervous, even though the test file in question was only used
in lib/et's regression testing and was never included in any compiled
binary.  (Addresses Debian Bug: #840733)</P>

<P>Stop installing mkfs.ext4dev and fsck.ext4dev</P>

<P>Update Chinese, Czech, Polish, Serbian, and Spanish translations and
add the Finnish and Malay translation.  (Addresses-Debian-Bug: #774379)</P>

<P>Update various man pages (Addresses-Debian-Bug: #852726)</P>

<H3>Programming notes</H3>

<P>Fix more FreeBSD-11 compatibility bugs, including some unmasked by
FreeBSD 11-rc2.</P>

<P>Fix the Mac build.</P>

<P>Fix build failure on RHEL 5.x systems caused by an old version of
libmagic.</P>

<P>Fix a number of bugs reported by ASAN that can cause some (mostly
harmless) memory dereferences beyond allocated memory.</P>


<H2><A NAME="1.43.3">E2fsprogs 1.43.3 (September 4, 2016)</A></H2>

<P>Fix e2fsck's handling of timestamps on 32-bit systems.</P>

<P>E2fsck will now check, and if necessary repair the extra isize fields
in the inode and superblock.</P>

<P>Fix crashes on architectures such as sparc64 that are sensitive to
unaligned pointer dereferences in the journal recovery code when
journal checksums are enabled.</P>

<H3>Programming notes</H3>

<P>Support reproducible builds by not capturing the build directory into
the mk_cmds and compile_et scripts.  Also fix debian build rules to
ensure build reproducibility.</P>

<P>Fix debian build rules to ensure build reproducibility and to avoid
hiding the linker flags for e2fsck.static so the build hardening log
scanner can properly audit the build.</P>

<P>Fix compatibility with FreeBSD's pmake and teach the configure script
to force the creation of pmake-compatible Makefiles if the
FORCE_NATIVE_MAKE environment variable is set to a non-empty value.</P>


<H2><A NAME="1.43.2">E2fsprogs 1.43.2 (September 1, 2016)</A></H2>

<P>Fix resize2fs so it will not crash if there is an extended attribute
block but it doesn't need to migrate any blocks during an off-line
resize</P>

<P>Fix a crash when mke2fs or debugfs tries to copy in a directory
hierarchy containing an empty directory</P>

<P>Mke2fs will now use a larger journal by default for filesystems
greater than 128 GB.  (1GB instead of 128 MB.)</P>

<P>Fix an alignment bug in e2fsck which caused sparc64 architectures to
crash when replaying the journal on file systems with a 64-bit block
number.</P>

<P>Clarify the message printed by tune2fs message when the user needs to
run e2fsck so it's clear that the -f flag to e2fsck is needed to
force a full e2fsck scan.  (Addresses Debian Bug: #828022)</P>

<P>Fix a bug in e2fsck caused by a power failure during e2fsck's journal
replay could leave the file system in a state where if the file system
is mounted without doing a full e2fsck scan, the file system could get
corrupted</P>

<P>Fix the logic in e2fsck which decides when to repair legacy negative
timestamp encodings.</P>

<P>Add a command to debugfs to copy the inode structure from one inode to
another.</P>

<P>Fix a typo in debugfs's stat command when printing out the dtime field
on file systems with an extended timestamp.</P>

<P>Fix big endian bugs in the e2undo program.  (Addresses Red Hat Bug
#1344636)</P>

<P>Debugfs's logdump can now properly handle journals larger than 2GB.</P>

<P>Avoid installing the man page for fuse2fs if it has not been built.</P>

<P>Update the Catalan, Chinese, Danish, Dutch, French, German, Polish,
Swedish, Ukrainian translations and added new translations for
Hungarian and Serbian.</P>


<H3>Programming notes</H3>

<P>Fix portability problems in fuse2fs.  Previously it wouldn't build on
systems with older glibc versions where clock_gettime() is only
available in the librt library, and if libintl is not bundled into the
C library.</P>

<P>Remove complicated logic which caused a static code analyzer to flag a
false positive.  (A static code analyzer also found a valid bug in
deciding when to repair a legacy negative timestamp encoding, so
eliminating false positives is important.)</P>

<P>Fixed a bug where the ext2fs library cloud provoke when a
extfs2_zero_blocks() is used (via fallocation, initializing a file
system, uninitialized uninitialized inode table blocks) after a
different file system which also used ext2fs_zero_blocks().</P>

<P>Enable the unix_io manager in the ext2fs library so it can accept the
use of a file descriptor.  This is helpful in cases where the file
descriptor comes from temporary file created using O_TMPFILE, or
passed in from a unix domain socket.</P>

<P>Fix a Windows64 portability bug.</P>


<H2><A NAME="1.43.1">E2fsprogs 1.43.1 (June 8, 2016)</A></H2>

<P>Fixed e2fsck so that it would correctly update the project quota usage
when deleting a corrupted and inode, and fixed mke2fs so it wouldn't
dereference memory beyond the small inode structure (which was wrong,
but worked mostly by accident unless hardening or some security malloc
was in use).</P>

<P>Fixed a large number of FreeBSD portability problems.  (To build on
FreeBSD, however, we still need to use GNU Make and redirect dd to use
GNU dd.)</P>

<P>The configure script now supports --enable-hardening, which enables
stack protection, fortify, read-only relocation tables, immediate
dynamic symbol binding, and text segment ASLR (if the kernel has
userspace ASLR support enabled) by enabling position independent
executable code.  (Distributions who want to do their own special
thing can set CFLAGS, CFLAGS_SHLIB, CLFAGS_STLIB, LDFLAGS,
LDFLAGS_SHLIB and LDFLAGS_STATIC as appropriate.)</P>

<P>The configure script now supports --disable-tdb since on 64-bit
systems, it's much faster to just enable additional swap space.  The
scratch_files feature in e2fsck.conf is mostly only useful on 32-bit
systems.</P>

<P>Fixed the Direct I/O fallback codepath in the Unix I/O manager so that
read/modify/write worked correctly.  Fortunately in practice (with the
exception of the Undo handler when running on FreeBSD) used this buggy
codepath. so file systems weren't getting corrupted.</P>

<P>Mke2fs will now warn if the user provides a label which is too long.
(Addresses Debian Bug: #791630)</P>

<P>Debugfs's rdump command now works correctly when dumping the root
directory of a file system.  (Addresses Debian Bug: #766125)</P>

<P>Fixed a bug in debugfs so it would correctly calculate a block group's
checksum field field on 64-bit systems.</P>

<P>E2fsck now has a much more understandable error message when the
journal superblock is corrupt and the user declines to fix it.
(Addresses Debian Bug: #768162)</P>

<P>Fixed support of extended timestamps on 64-bit systems.</P>

<P>Updated/fixed various man pages.  (Addresses Debian Bugs: #766379,
#761144, #770750, #428361, #766127)</P>

<P>Fixed various Debian Packaging Issues.  (Addresses Debian Bug: #825868)</P>

<H3>Programming notes</H3>

<P>Fixed coverity, sparse, gcc -Wall, and clang warnings/nits.</P>

<P>Fixed Android build makefiles (which was missing a newly added file in
lib/support).</P>

<P>In general, checks on s_creator_os have been removed in favor of
feature flag specific checks; if there is something that can't be
checked via the presence of a feature flag, we will simply check
whether the creator OS is *not* EXT2_OS_HURD which is the one
operating system where there has been extensive abuse of the
s_creator_os flag.</P>

<P>The libmagic library has been suppressed when running the regression
test suite to avoid false test failures caused by differences between
versions of libmagic (and/or the magic number database).</P>

<P>The tests/test_script program now accepts the --failed option, which
will run those tests that had previously failed.</P>

<P>Fixed tests build on those systems which require LDFLAGS to be set.</P>

<P>Fixed the regression test suite so it will properly filter out version
numbers with two components (such as 1.43) from log files before
comparing them with the expected golden output.</P>


<H2><A NAME="1.43">E2fsprogs 1.43 (May 17, 2016)</A></H2>

<P><B>KNOWN BUG:</B> "make check" will have many spurious failures in the tests
	directory.  The fix can be found at:
   <A HREF="https://git.kernel.org/cgit/fs/ext2/e2fsprogs.git/commit/?id=e7d848266a224cc1ed3c74c6746b5c779a5f55ce">https://git.kernel.org/cgit/fs/ext2/e2fsprogs.git/commit/?id=e7d848266a224cc1ed3c74c6746b5c779a5f55ce</A></P>

<P>Add support for the ext4 metadata checksum, checksum seed, inline
data, encryption, project quota, and read-only features.</P>

<P>Support for the very old, experimental, and never-added-to-mainline
compression feature has been removed.</P>

<P>Mke2fs will now create file systems with the metadata_csum and 64bit
features enabled by default.</P>

<P>The mke2fs program will now support multiple -O options (instead of
just ignoring all but the last -O option).</P>

<P>Mke2fs will now correctly determine the size of a file system and
handle the discard operation correctly when the "-E offset=NNN" is
used.  (Addresses Debian Bug: #803629)</P>

<P>The tune2fs program will ask the user for confirmation before starting
dangerous operations if the terminal is available, and it will replay
the journal if necessary.</P>

<P>Add an ext2/3/4 FUSE server</P>

<P>Debugfs can now modify extended attributes and journal transactions.</P>

<P>Debugfs now can properly display and set extended timestamps.</P>

<P>E2fsck will offer to fix extended timestamps that were incorrectly
encoded by older kernels.</P>

<P>Fix miscellaneous MMP bugs in debugfs.</P>

<P>Fix sparse_super2 bugs in mke2fs and resize2fs.</P>

<P>Fix or improve offset support in mke2fs, e2undo, and libext2fs.</P>

<P>The resize2fs command can now convert file systems between 64-bit and
32-bit mode.</P>

<P>Fix potential out-of-bounds memory access in resize2fs when doing a
large off-line file system grow operation.</P>

<P>We now use a new e2undo file format which is much more efficient and
faster than the old tdb-based scheme.  Since it so much faster,
e2fsck, tune2fs, debugfs, and resize2fs now also can support using
creating an undo file.</P>

<P>The mke2fs command can now set the error behavior when initializing
the file system (so the administrator doesn't have to issue a separate
tune2fs -e command).</P>

<P>Teach mke2fs to parse a human-readable argument for -i option.</P>

<P>Teach mke2fs to automatically handle creating file systems > 500T by
automatically enable the meta_bg feature.</P>

<P>Mke2fs will now prompt for user verification before rewriting a file
system's superblock using the -S option.</P>

<P>Mke2fs no longer complains if the user tries to create a file system
using the entire block device (e.g., without using a partition).  The
minor number convention is not used by all block devices, and it's
quite normal in some circumstances to create a file system on /dev/sdc
instead of /dev/sdc1.</P>

<P>Fix an "mke2fs -d" bug which could create inodes with invalid
extended attribute blocks</P>

<P>E2fsck is now much more paranoid about not freeing or corrupting
critical metadata blocks, such as inode table blocks, even if
corrupted indirect blocks or extent trees point at these blocks.</P>

<P>E2fsck now prints block ranges in pass1b instead of listing all of the
blocks exhaustively.</P>

<P>E2fsck will try to expand the root directory if the lost+found can't
be linked to the root directory.  Also, offer to use the root
directory if lost+found can't be created.</P>

<P>E2fsck is now more paranoid handling corrupted extent trees as well as
corrupted journals.</P>

<P>E2fsck can now rebuild extent trees, either (a) to optimize them, (b)
to recover from a corrupted extent tree, or (c) to convert
block-mapped inodes to use extents.</P>

<P>E2fsck now has a readahead mechanism which can significantly speed its
performance, especially on RAID arrays.</P>

<P>E2fsck now has a "yes to all" option which the user can give if she is
tired of answering 'y' to a very large number of questions.</P>

<P>E2fsck will now ignore the badblocks inode if the contents of the
badblocks inode indicate that the portion inode table containing the
badblocks inode is bad.  (We must go deeper...)</P>

<P>E2fsck can now correctly fix directory with holes on bigalloc file
systems.</P>

<P>E2fsck will now check for extent mapped inodes with no extent header
and clear them if found.</P>

<P>E2fsck now checks to make sure the extended attribute header doesn't
result in the xattr extending beyond the bounds of the inode</P>

<P>Fixed a bug in e2fsck to avoid overrunning a buffer containing jbd2
revoke records if the journal is corrupted.</P>

<P>Fixed a bug in e2fsck which could cause it loop forever if a special
inode has too many invalid block mappings.</P>

<P>Fixed a bug in e2fsck which could cause pass1b/c/d processing to get
confused if an attempt to allocate a block can't find any free space
in the file system.</P>

<P>E2fsck will no longer try to force rewrite blocks located beyond the
file system.</P>

<P>The e2fsck program will no longer update the quota inodes when it is
interrupted.</P>

<P>Fix a bug which in rare cases would cause e2fsck -fD to corrupt an
extent-mapped directory.</P>

<P>Fixed a bug in resize2fs which could lead to resize2fs crashing or a
corrupted file system if the file system is almost completely full
when trying grow a file system and we need to allocate blocks to grow
the block group descriptors.</P>

<P>Fixed a bug in resize2fs which could cause it to get fooled trying to
determine the RAID array's stride when flex_bg is enabled.</P>

<P>Fix resize2fs bug that could leave block allocation bitmaps
uninitialized.</P>

<P>The dumpe2fs output has been improved so it is cleaner and always fits
within 80 columns.  Also added a more easily machine-parsable output
of dumpe2fs.</P>

<P>The mke2fs program can now pre-populate a file system from a directory
hierarchy using the -d option.</P>

<P>The mke2fs program now skips zeroing inode table blocks if they were
already zeroed using the discard feature.</P>

<P>Check to make sure file system features which can not be supported by
HURD are not enabled if the file system is created to be
HURD-compatible.</P>

<P>Added a new e2fuzz command that will fuzz an ext4 image for testing
purposes.</P>

<P>The debugfs logdump command can now deal with 64-bit revoke tables
correctly.  Also, "logdump -O" will print the old log contents (before
the journal was replayed).</P>

<P>The debugfs bmap command can now be used to set or allocate a physical
block.</P>

<P>Fixed a bug so "filefrag -B -e -v" does not return a separate entry
for each block.</P>

<P>The filefrag program now accounts for holes in sparse files created by
the file punch operation as an expected/optimal mapping.</P>

<P>The file I/O functions now correctly handle inodes containing
uninitialized blocks.</P>

<P>Fix a bug in tune2fs so that removing uninit_bg feature on a bigalloc
file system won't result in corrupted block bitmaps.</P>

<P>Updated/fixed various man pages.  (Addresses Debian Bug: #798425)</P>

<H3>Programmer's Notes</H3>

<P>Fixed coverity, sparse, gcc -Wall, and clang warnings/nits.</P>

<P>Added Android build files so that e2fsprogs can be built in the
Android source tree.</P>

<P>Reduce the use of libc functions in libext2fs that may not be present
in the boot loader environment, at least for those functions that are
needed by boot loaders such as yaboot.</P>

<P>Developers can now override the debugging and optimization flags by
redefining the CFLAGS makefile macro.</P>

<P>The libext2fs library now has support for fallocate.</P>

<P>The mke2fs command will now ask the user for confirmation if block
device or image file contains an existing file system image, and
stdout and stdin are connected to a tty.</P>

<P>The libext2fs library now picks a more intelligent goal block when
doing block allocations.</P>

<P>The libext2fs library will now automatically set the BLOCK_UNINT flag
if all of the blocks in a block group are free, to speed up future
e2fsck and dumpe2fs operations on the file system.</P>

<P>Add two new functions ext2fs_new_range() and ext2fs_alloc_range() to
libext2fs.</P>

<P>The ext2fs_zero_blocks() command will use FALLOC_FL_ZERO_RANGE for
file-based images.</P>

<P>The ext2fs_bmap() function supports new flags BMAP_UNINIT and
BMAP_ZERO.</P>

<P>The ext2fs_new_block2() function will now call the alloc_block hook
before checking fs->block_map.</P>

<P>Support for the MMP feature can now be disabled at compile time.</P>

<P>Added support to manipulate extended attributes to libext2fs.</P>

<P>Added a lot of new regression tests.</P>

<P>Added endian annotations so it's possible to scan e2fsprogs for endian
problems using a static code analyzer.</P>

<P>Fixed memory leaks in libext2fs.</P>

<P>The e2fsck jbd2 handling code has been resynced with the 3.16 kernel.
There is now a script in the contrib directory which automates most of
the resync process.</P>

<P>The build system will now run cppcheck (a static code analysis tool)
via "make C=1"</P>


<H2><A NAME="1.42.13">E2fsprogs 1.42.12 (May 17, 2015)</A></H2>

<P>Fixed a potential buffer overflow while closing a file system in
libext2fs.  (CVE-2015-1572, Addresses Debian Bug: #778948)</P>

<P>Fixed a bug which could cause e2fsck to corrupt Hurd file systems.
(Addresses Debian Bug: #760275)</P>

<P>Fixed a deadlock which occurs when using systemd and e2fsck.conf's
logging feature.  (Addresses Debian Bug: #775234)</P>

<P>Fixed a bug which could cause programs using libext2's inode table
scanning functions from crashing on certain corrupted file systems.
(Addresses Debian Bug: #773795)</P>

<P>Fixed dumpe2fs so it won't crash if the user doesn't specify a block
device (file system).  (Addresses Debian Bug: #764293)</P>

<P>Fixed e2fsck so if it notices unexpected HTREE blocks in pass 2, it
will report the correct directory inode containing the inconsistency.</P>

<P>If e2fsck fails to grow the dir_info structure due realloc(3) not
having enough memory, it will now fail with explanatory message
instead of staggering on failing with a confusing internal error
messages.</P>

<P>The tune2fs program will zero out the superblock journal backup
information when removing a journal from a file system.</P>

<P>The mke2fs program now enables the large_file feature by default.</P>

<P>Fixed a bug which could cause badblocks to crash if there are millions
and millions of bad blocks.</P>

<P>Fixed some use-after-free bug in resize2fs and e2fsck.</P>

<P>Fixed a memory leak in tune2fs.</P>

<P>Fixed some bigendian bugs that had crept into both indirect and extent
handling inside libext2fs.</P>

<P>Updated/fixed various man pages.</P>

<P>Update Esperanto, German, and Spanish translations.  Added Danish
translation.</P>

<H3>Programmer's Notes</H3>

<P>Fixed coverity, sparse, gcc -Wall, and clang warnings/nits.</P>

<P>Clean up some build system problems (build failures with various
configure options, fix Posix portability issues, etc.)</P>

<P>The functions ext2fs_inode_alloc_stats[2]() and
ext2fs_block_alloc_stats[2]() now check the inode and block numbers
passed to them, to avoid crashes caused by buggy callers.</P>

<P>The libext2fs directory iterator will now check for an invalid
directory entry length instead of possibly walking off the end of the
directory buffer.</P>


<H2><A NAME="1.42.12">E2fsprogs 1.42.12 (August 29, 2014)</A></H2>

<P>Fix various e2fsck bugs when trying to repair bigalloc file systems.</P>

<P>E2fsck can now repair a file system with an overly large
s_first_meta_bg field, which had previously caused all e2fsprogs
programs to crash when trying to open such a file system.</P>

<P>Fix e2fsck so that it can correctly fix a number of rare file system
corruptions that were discovered when using a file system fuzzer.</P>

<P>Fix e2fsck so it does not try to write back block group descriptors if
they have not been modified.</P>

<P>Mke2fs program will now place metadata blocks in the last flex_bg so
they are contiguous.  This reduces free space fragmentation in a
freshly created file system, as well as allowing mke2fs commands which
request extremely large flex_bg size to succeed.</P>

<P>Mke2fs now creates hugefiles more efficiently (with fewer extent tree
blocks).</P>

<P>Fix a 32/64-bit overflow bug that could cause resize2fs to loop
forever. (Addresses-Launchpad-Bug: #1321958)</P>

<P>The resize2fs program will now use much less memory when resizing very
large file systems.</P>

<P>Fix a bug which could cause resize2fs to get confused and produce a
corrupted file system when shrinking a file system that had been
previously expanded and converted to use the meta_bg file system
format, but which no longer needs to use the meta_bg file system
format any longer.  This typically happened with large (> 16TB) file
systems.  (Addresses Debian Bug: #756922)</P>

<P>The e4defrag program will now defrag backwards-allocated files.</P>

<P>Fix tune2fs updating UUID's when manipulating file systems with
external journals (both the file system and journal UUID).</P>

<P>Fix tune2fs so it can remove an external journal for file systems with
a 1k block size.</P>

<P>Add a new debugfs command, "inode_dump", which prints the inode in hex
and ASCII format.</P>

<P>The debugfs's "set_inode_field" will now automatically allocate blocks
for indirect blocks and extent tree blocks.</P>

<P>Fix debugfs's "set_inode_field" so can properly handle
"block[IND|DIND|TIND]".</P>

<P>The debugfs "rdump" command will now take multiple source arguments.</P>

<P>Fixed a double close(2) bug in "rdump" and "rdump -p".</P>

<P>Fix debugfs's argument parsing for the freefrag command.</P>

<P>Fix filefrag to properly handle using the FIBMAP ioctl (with -B).
(Addresses Launchpad Bug: #1356496)</P>

<P>Clarified messages that were confusing users in debugfs, e2fsck,
mke2fs, and resize2fs (Addresses Debian Bugs: #758029, #757543,
#757544)</P>

<P>Dumpe2fs will now complain if extra arguments are given to it.
(Addresses Debian Bug: #758074)</P>

<P>Updated/fixed various man pages.  (Addresses-Debian-Bug: #726760)</P>

<P>Update Czech, Dutch, French, Polish, Spanish, Swedish, Ukrainian, and
Vietnamese translations.</P>

<H3>Programmer's Notes</H3>

<P>The Unix I/O layer will now use pread[64]/pwrite[64] to reduce the
number of system calls issued.</P>

<P>Fixed profiled build.</P>

<P>The libext2fs library will now more efficiently split an extent tree
index block when appending to an end of a file.</P>

<P>Fixed free block accounting for 64-bit file systems.</P>

<P>Add a new function ext2s_inode_size_set() which takes care of all of
the required feature flag modifications.</P>

<P>The regression tests no longer require the presence of the md5sum
program.</P>

<P>Fix build failure on MIPS platforms on Debian (Addresses Debian Bug:
#754605)</P>

<P>Fix various Coverity warnings (#1225003, #1229243, #1252003)</P>

<H2><A NAME="1.42.11">E2fsprogs 1.42.11 (July 9, 2014)</A></H2>

<P>Add support so that mke2fs can create hugefiles so that they are
aligned relative to the beginning of the disk, instead of relative to
the beginning of the partition, using the mke2fs.conf configuration
parameter "hugefiles_align_disk".</P>

<P>Fix a bug which causes e2fsck to abort a journal replay on a file
system with bigalloc enabled.  (Addresses Debian
  Bug: <A HREF="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=744953"
	  TARGET="_blank">#744953</A>)</P>

<P>Add sanity checks so that mke2fs will refuse insanely large flex_bg
counts specified by the -G option.  Insanely large flex_bg sizes can
result in a file system which can't be unmounted, or with extremely
pessimal metadata layouts.</P>

<P>The mke2fs program will provide a better metadata layout for
moderately large (but believable) flex_bg counts, such as 133,072.</P>

<P>The mke2fs program will also check the kernel version number to
determine whether the lazy_itable_init option is supported, so that
lazy inode table initialization can be used even if the ext4 is
compiled as a module which isn't loaded at the time that mke2fs is
run.</P>

<P>Add description of ext4's mount options to the ext4 section 5 man
page.</P>

<P>Improve the chattr man page and clean up the chattr usage message.</P>

<P>E2fsck will now automatically fix a last mount time or last write time
which is in the future in preen mode, instead of aborting the fsck
check.</P>

<P>Mke2fs will now check the file system revision number requested by the
command line, and reject it if it is too large.  A file system with an
unsupported revision number will not be accepted by any of the other
file system tools, and this command line option is rarely used, so
let's try to help the user not shoot their own foot off.</P>

<P>The debugfs program can now set the error count and associated
first_error and last_error fields in the superblock using the
set_super_value command.</P>

<P>Resize2fs will not try to calculate the minimum size of a file system
if it contains errors.  Otherwise a very badly corrupted file system
image can cause the minimum size calculation to loop forever.  Since
resize2fs will not allow a file system marked as containing errors to
be resized.  It's pointless to calculate the minimum size, so just
skip it.</P>

<P>Fixed a typo in one of mke2fs's error message.</P>

<P>If filefrag runs into an error, it will continue processing the rest
of the files specified on the command line, but then exit with an
error code.</P>

<P>Filefrag now prints some additional new flags (such as
FIEMAP_EXTENT_ENCODED), and print unknown flags as hex values.</P>

<P>Fixed support in filefrag for files with > 2**32 blocks on 32-bit
platforms.</P>

<P>Fixed a file descriptor leak in debugfs when copying files.</P>

<P>Fixed a regression introduced in 1.42.10 which caused mke2fs to fail
to create file systems larger than 2GB on 32-bit platforms.
(Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=1099892" TARGET="_blank">#1099892</A>, Debian
  Bug: <A HREF="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=752107"
	  TARGET="_blank">#752107</A>)</P>

<P>Add Esperanto and Ukrainian translations, and update Czech, Dutch,
French, German, Italian, Polish, Swedish, and Vietnamese
translations.</P>

<P>Fixed various compiler warnings.</P>


<H3>Programmer's Notes</H3>

<P>The gcc "-checker" option has been long deprecated, so remove support
from e2fsprogs.  It was causing a few people to be confused when they
tried enabling the configure option.</P>

<P>Update to the latest version of the config.status and config.rpath
files, as well as newer versions of the autoconf files in aclocal.m4.
Also, move the e2fsprogs-specific macros to acinclude.m4, which allows
people who want to use autoreconf to do so.</P>

<P>Make the use of strptime() function in debugfs to be more portable to
fix regression test failures for FreeBSD and MacOS.</P>

<P>A few miscellaneous changes designed to make life easier for
translators.</P>

<P>Fix the f_quota test and some Makefile dependencies if quota support
is not enabled.</P>

<P>Fix cross-compilation support, which got broken in 1.42.10.
(Addresses Debian
  Bug: <A HREF="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=753375"
	  TARGET="_blank">#753375</A>)</P>

<P>Delete lib/ext2_types.h on a make clean, and build it as necessary.</P>

<P>Add a debug program used for libext2fs unit tests.</P>

<P>Clean up the tests so that it avoids using GNU-specific behaviour in
mktemp.  Make sure the temporary files are cleaned up if the tests are
interrupted.</P>

<P>Add a new ext2fs_close_free() helper function which automatically
takes care of freeing the ext2_filsys structure even if ext2fs_close()
returns an error.</P>


<H2><A NAME="1.42.10">E2fsprogs 1.42.10 (May 18, 2014)</A></H2>

<P>Mke2fs now creates file systems in regular files (which is very often
used when maintaining virtual machine images) without requiring the
user to use the force option.  In addition, the mke2fs output has been
made much less verbose and only displays information that users will
be more likely to find useful by default.</P>

<P>Mke2fs now will ask the user to confirm that they want to continue
before wiping out a pre-existing file system, partition table, or LVM
physical volume.</P>

<P>Mke2fs now has the ability to create file systems where all the
metadata is located at the very beginning of the device.  This can be
useful for flash devices which have SLC flash at the beginning of the
disk, for FAT compatibility, for example.  As part of this, mke2fs and
tune2fs can control the location of the data blocks used by the
journal inode.  In addition, the new sparse_super2 feature allows for
even fewer (anywhere from zero to two) backup superblocks.</P>

<P>Mke2fs now uses much less CPU when allocating the blocks used for very
large file systems.</P>

<P>Mke2fs can now support creating a file system at an offset.  This can
be useful when creating a disk image for virtual machines (Addresses
Debian
  Bug: <A HREF="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=497984"
	  TARGET="_blank">#497984</A>)</P>

<P>Previously, e2fsck had a number of very serious bugs when checking a
file system which used the new the quota file system option (where the
quota inodes were stored in hidden inodes) and the quota inode was
inconsistent with the actual usage data.  This problem was documented
in https://ext4.wiki.kernel.org/index.php/Quota.  These problems have
been fixed in 1.42.10, so the quota should be safe to use with
e2fsprogs 1.42.10.</P>

<P>Fixed in a bug in resize2fs which could cause shrink operation fail in
the unlikely situation when the inode table needs to be moved to a
location before the current location.</P>

<P>Resize2fs now has a much more accurate (and less conservative)
estimation of how far the file system can be shrunk.  This allows a
mostly empty filesystem which is a few terabytes, to be shrunk to a
few megabytes in a single resize2fs -M operation.</P>

<P>E2fsck will now force a full file system check if there are any file
system inconsistencies detected in the super block.</P>

<P>The filefrag program will now display the shared extent flag, which is
used by file systems such as btrfs.</P>

<P>If the number of inodes in the file systems is larger than the time
that file system was created (as measured by the number of seconds
since January 1, 1970) e2fsck would print a scary (but otherwise
harmless) warning of file system corruption for each inode in the
orphan list.  This false positive has been fixed.</P>

<P>The e4defrag program has been fixed so it will no longer refuse with
filesystem with the 64-bit or the bigalloc feature enabled.</P>

<P>The logsave program will print a much less scary message which could
lead users to believe something has gone very wrong with e2fsck exits
with a non-zero exit status (since this is normal after e2fsck has
automatically fixed a file system corruption during a preen
operation).   (Addresses Debian
  Bug: <A HREF="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=468821"
	  TARGET="_blank">#468821</A>)</P>

<P>When creating a file system which is larger than 16TB, the
resize_inode option must be disabled -- since the resize_inode simply
doesn't support reserving metadata block numbers which is larger than
32 bits.  The mke2fs program does this automatically if the file
system size is determined automatically.  It will now also do this if
the file size is specified explicitly.</P>

<P>Fixed bugs associated with resize2fs and shrinking bigalloc file
systems.</P>

<P>The e2fsck program will no longer try to add a UUID on a mounted file
system with checksums enabled, since this could leave the file system
checksums broken.</P>

<P>Tune2fs will allow the removal of an external journal from file system
which is marked as needing the journal replayed when the force ("-f")
option is given twice.  (Addresses Debian
  Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=559301"
	  TARGET="_blank">#559301</A>)</P>

<P>Tune2fs will no longer support enabling sparse_super if the meta_bg
file system feature is enabled, since it could result in data loss.
In practice, all modern file systems have sparse_super is enabled, so
it's not worth trying to change how tune2fs handles enabling the
sparse_super feature.</P>

<P>Fixed support for 1k block file systems with the meta_bg feature.</P>

<P>When the superblock is corrupt, e2fsck can't figure out the location
of the alternate superblock.  Unfortunately, the routine that
calculates the location of the alternate superblock uses 8193 if it
can't figure this out, so the message printed by e2fsck always
suggests using "e2fsck -b 8193".  This message has been fixed to
suggest both the superblock location of 8193 and and 32768.
(Addresses Debian
  Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=719185"
	  TARGET="_blank">#719185</A>)</P>

<P>The lookback mount detection code that was introduced in 1.42.9 wasn't
actually compiled in due to an autoconf oops, so it's fixed now in
1.42.10.  (Addresses Debian
  Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=497984"
	  TARGET="_blank">#497984</A>)</P>
    
<P>A bug introduced in 1.42.9 would cause debugfs to print two error
messages if it found an error while parsing a user-supplied block
number.  This has been fixed in 1.42.10.</P>

<P>Update Czech, Dutch, French, German, Polish, Spanish, Swedish, and
Vietnamese translations.  (Addresses Debian
  Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=703048"
	  TARGET="_blank">#703048</A>)</P>

<P>Updated/fixed various man pages.  (Addresses Debian
  Bugs: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=719189"
	   TARGET="_blank">#719189</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=719184" TARGET="_blank">#719184</A>)</P>

<P>Fixed various Debian Packaging Issues.  (Addresses Debian
  Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=718725"
	  TARGET="_blank">#718725</A>)</P>


<h3>Programmer's Notes</h3>

<P>Fixed a lot of coverity, sparse, gcc -Wall, and clang warnings/nits.</P>

<P>Allow the location of pkg-config files to be specified independent of
the libdir location via a makefile variable.</P>

<P>Fixed parse-types.sh not to complain when cross-compiling and the
sizes of types are different between the target architecture and the
architecture of the build system</P>

<P>Allow the regression test suite to work correctly on systems which do
not have the "truncate" or "mksawp" programs.</P>

<P>Allow e2fsck to build correctly on systems (such as Android) that do
not have the signal.h file.</P>

<P>E2fsprogs now has code coverage testing which can be enabled using
"configure --enable-gcov".</P>

<P>The libe2p.h header file can now be used included by C++ programs.</P>

<P>The profile/config file used by e2fsck and mke2fs will interpret
numbers with a leading 0 character to mean that they should be
interpreted as an octal integer.</P>

<P>The extent handling functions in libext2fs have been improved so they
have proper rollback when there is an error splitting an extent.  Also
fix a number of bugs when punching holes in files, and fix an
off-by-one bug when inserting an extent into an empty inode.</P>

<P>The libext2fs library now handles the support of BLOCK_UNINIT by
clearing the portion of block bitmap when it is loaded, instead of
when it is used.  This reduces the chances of bugs, and and simplifies
the code.  It also means that debugfs will properly show that blocks
in uninitialized block groups as being unused when using the testb
command.</P>

<P>The e4defrag program will try to use fadvise64 or posix_fadvise64() if
it is present, which allows 64-bit offsets on 32-bit systems.</P>


<H2><A NAME="1.42.9">E2fsprogs 1.42.9 (December 28, 2013)</A></H2>

<P>Mke2fs will detect an attempt to create a file system on a loop
mounted file and complain without the -FF option.  Also fixed mke2fs
so it allows the creation of a file system on a mounted device with
two -F options, as documented in the man page, instead of three -F
options.</P>

<P>Fixed a large number of bugs in resize2fs, e2fsck, debugfs, and
libext2fs to correctly handle bigalloc and 64-bit file systems.  There
were many corner cases that had not been noticed in previous uses of
these file systems, since they are not as common.  Some of the bugs
could cause file system corruption or data loss, so users of 64-bit or
bigalloc file systems are strongly urged to upgrade to e2fsprogs
1.42.9.</P>

<P>The tune2fs program will now not allow changing the uuid on a mounted
file system which has the uninit_bg feature enabled.  This avoids a
nasty race where the kernel and tune2fs are both retrying rewrite the
group descriptors at the same time, with different ideas about what
the UUID should be.</P>

<P>When e2fsck is rehashing an extent-mapped directory, it's possible
(although very rare) that an extent block will need to be allocated;
fix e2fsck to make sure that the block gets marked as used.</P>

<P>Mke2fs will now properly set the LARGE_FILE feature when creating a
journal >= 2GB --- which can happen when using 64k block size.</P>

<P>Fixed debugfs so that its freei command will correctly handle a request
to free a range of consecutive inodes.</P>

<P>Fixed 2fsck so it will not erroneously complain that an external journal
is invalid if it is exactly 2**32 blocks.</P>

<P>Fixed e2fsck so it won't try checking for, and adding, a missing
lost+found directory when running in read-only mode.</P>

<P>Fixed e2image to avoid some buffer overruns which would cause it to when
creating a standard (non-raw, non-qcow2) image file.  Standard
e2image files are actually very rarely used, so we didn't notice when
the changes to enable the qcow2 format broke this e2image mode.</P>

<P>Fixed mke2fs so that the extended option "-E resize=NNN" will not turn
on the resize_inode feature when the meta_bg feature is set, since
these two features can not be set at the same time.</P>

<P>Fixed tune2fs so that when it disables the quota feature, it updates all
of the backup superblocks.</P>

<P>Fixed dumpe2fs that would cause it to abort when run using an image file
when trying to print the journal information (which is not present in
an e2image created image file).</P>

<P>Fixed a potential integer overflow in e2reefrag.
(Addresses-Debian-Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=718205"
			  TARGET="_blank">#718205</A>)</P>

<P>Enhance debugfs so that when copying a sparse file from a native file
system into the file system image using the "write" command, it will
create a sparse file into the destination file system.</P>

<P>Enhanced debugfs so it can support a command line which is up to 8k
long.</P>

<P>E2image will refuse (unless the -f option is specified to force the
issue) to create a raw or qcow image using a mounted file system,
unless the -f option is specified to force the issue.</P>

<P>E2image has been optimized for using it to efficiently copy a file
system by only copying the allocated blocks, by using the options -ra.
New options (-o and -O) have been added so that a source and
destination offset can be given.  The -p option will print progress
information so the user will know how far along the copy is going.
And finally, the new option -c is useful for updating a file system on
an SSD, by avoiding unnecessary writes.  E2image can also shift a file
system image by doing an in place move.</P>

<P>Fix a regression introduced in 1.42.8 which would cause e2fsck to
erroneously report uninitialized extents past the EOF (as determined by
i_size) to be invalid.</P>

<P>Fixed resize2fs so under a corner case when an inode has a complex
extent tree, it will not corrupt an interior node in the extent tree.</P>

<P>Fixed resize2fs which would sometimes corrupt a file system when
shrinking a file system to a minimum size using resize2fs -M.
(Addresses Debian
  Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=660793"
	  TARGET="_blank">#660793</A>)</P>

<P>Fixed resize2fs so that it will relocate inode table blocks if this
becomes necessary when shrinking the file system.</P>

<P>Fixed resize2fs and e2fsck so they will not crash when hit a failure
while operating on a file system with the MMP feature enabled.</P>

<P>Fixed a bug in debugfs which caused it create an invalid inode when
trying to write a zero-length file.</P>

<P>E2fsck will no longer crash if it tries to delete an invalid
extent-mapped symlink.</P>

<P>E2fsck will no longer crash if it comes across an directory which is
larger than 2GB (which is not allowed in valid file systems).</P>

<P>Fixed debugfs's help texts to fully document all options and otherwise
be more helpful.</P>

<P>Updated/fixed various man pages.  (Addresses Debian
  Bugs: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=586218"
	   TARGET="_blank">#586218</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=669730" TARGET="_blank">#669730</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=698076" TARGET="_blank">#698076</A>)</P>

<P>Fixed various Debian Packaging Issues
  (<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=698879"
  TARGET="_blank">#698879</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721365" TARGET="_blank">#721365</A>)


<H3>Programmer's Notes</H3>

<P>Fix sparse, gcc -Wall and clang nits.</P>

<P>Update config.{guess,sub} to the latest version</P>

<P>Fixed various memory and file descriptor leaks on various error paths,
as well as some missing error return checks, which were found using
Coverity.</P>

<P>Run sparse against source files when building e2fsprogs with 'make
C=1'.  If instead C=2, it configures basic ext2 types for bitwise
checking with sparse, which can help find the (many many) spots where
conversion errors are (possibly) happening.</P>

<P>Allow the regression test to be run in chrooted environments where
/etc/mtab might be missing.</P>

<P>The ext2fs_punch() function, which was introduced in 1.42, was broken
in many ways, but this was never noticed since it wasn't used for
anything significant.  Some of the bugs include failing when trying to
punch a completely sparse file, failing when punching an extent-mapped
inode when the starting block was at the beginning of the inode, and
not being able to punch a single block (where start_blk == end_block).
It also didn't handle being passed an invalid, too-large ending block
number, and didn't handle properly terminate at the right place when
operating on an indirect-mapped inode.</P>

<P>Fixed some minor typo's in the error catalog for libext2fs.</P>

<P>Fixed ext2fs_file_set_size2() so that if it truncates an inode by
setting the file size, to zero the rest of the block to the end of the
file, so that if an ext4 FUSE driver tries to extended the file, that
we don't avoid stale data from being returned.</P>

<P>Fixed ext2fs_bmap() to disallow clients from trying to map or set
logical blocks which are larger than what an extent-mapped or indirect
block-mapped inode can allow.</P>

<P>If debugfs (or some userspace program using libext2fs) creates a file
which is larger than 2GB, make sure the large_file feature flag gets
set.</P>

<P>Fix a bug in ext2fs_link() where if there is multiple empty slots in the
directory which are large enough, the directory entry could get
inserted more than once in the directory.</P>

<P>If quota support is disabled (which is the default), make sure that
all traces of the quota support is removed from usage messages, man
pages, and tune2fs must not be able to enable the quota file system
feature.  (Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=1010709" TARGET="_blank">#1010709</A>)</P>

<P>The ext2fs_file_write() now updates i_size on a successful write,
instead of only updating i_size wen the file is closed via
ext2fs_file_close().</P>

<P>Added a shell script, populate-extfs.sh which uses debugfs to populate
an ext2/3/4 file system image from a given directory.  It is similar
to the genext2fs program, but it supports ext3 and ext4 file system.</P>

<P>Add changes to the libext2fs library to support block group
descriptors larger than 64 bytes (for future compatibility).</P>

<P>Fixed an off-by-one bug in ext2fs_file_set_size2() so that it will not
leave an extra block in the file when truncating the file down to
size.</P>

<P>The html version info pages are now built using makeinfo --html
instead of the unmaintained and now-obsolete texi2html program.</P>


<H2><A NAME="1.42.8">E2fsprogs 1.42.8 (June 20, 2013)</A></H2>

<P>As a part of mke2fs's option parsing cleanup, the use of the -R option
will give a warning that it is deprecated (it has been so documented
since 2005) and -E should be used instead.</P>

<P>Mke2fs will not give warnings about the bigalloc and quota options in
quiet mode.</P>

<P>If an invalid journal size is given to mke2fs, it will now complain
and exit sooner.</P>

<P>Debugfs was erroneously giving spurious error messages for certain
extent_inode subcommands which take arguments (split_node,
replace_node, and insert_node).  This has been fixed.</P>

<P>Fix the parsing of the 's' (sectors) in parse_num_blocks2, which among
other programs is used by mke2fs.</P>

<P>Change mke2fs so that it does not set the root directory to the real
uid/gid of the mke2fs process.  Add the extended option root_owner to
override this behavior.</P>

<P>Fix resize2fs when shrinking file systems to make sure that bitmap
blocks aren't left outside the bounds of the shrunken file system.
This could happen with flex_bg file systems that were grown using
the old online resizing algorithm.</P>

<P>E2fsck will now detect and repair corrupted extent trees which contain
invalid extents at the end of the extent tree leaf block.</P>

<P>E2fsck will now longer complain about zero length extended attribute
values.</P>

<P>Fix a regression introduced in e2fsprogs v1.42 which caused e2image -s
to crash.</P>

<P>Add safety check so tune2fs will not attempt to set the inode size to
be larger than the block size.</P>

<P>Fix e2fsck so it can check a read-only root file system with an
external journal.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=707030" TARGET="_blank">#707030</A></P>

<P>Fix off-line resizing of file systems with flex_bg && !resize_inode
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=696746" TARGET="_blank">#696746</A>)</P>

<P>Fix e2image with large (> 32-bit) file systems (Addresses Debian Bug:
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=703067" TARGET="_blank">#703067</A>)</P>

<P>Enhance chattr to allow clearing the extent flag if the kernel allows
migrating extent based files to use indirect blocks.</P>

<P>Update German translation.</P>

<P>Updated/fixed various man pages.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=712429" TARGET="_blank">#712429</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=712430"
   TARGET="_blank">#712430</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=707609" TARGET="_blank">#707609</A>)</P>

<P>Fixed various Debian Packaging Issues (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=708307" TARGET="_blank">#708307</A>)</P>

<H3>Programmer's Notes</H3>

<P>Use secure_getenv() in preference to __secure_getenv().</P>

<P>Optimize CPU utilization of ext2fs_bg_has_super().</P>

<P>Fix ext2fs_llseek() on 32-bit i386 systems to work correctly when
SEEK_CUR is used with large files.</P>

<P>The ext2fs_read_inode_full() function will no longer use
fs->read_inode() if the caller has requested more than the base 128
byte inode structure and the inode size is greater than 128 bytes.</P>

<P>Fix build failure with --enable-jbd-debug.</P>

<P>Clean up filtering of outputs for the regression tests by using a
common sed script.</P>

<P>Fix gcc -Wall and clang nits.</P>


<H2><A NAME="1.42.7">E2fsprogs 1.42.7 (January 21, 2013)</A></H2>

<P>Add warnings to mke2fs, resize2fs, and tune2fs that the bigalloc and
quota features are still under development.  For more information
please see:
<UL>
<LI> <A HREF="https://ext4.wiki.kernel.org/index.php/Bigalloc" TARGET="_blank">https://ext4.wiki.kernel.org/index.php/Bigalloc</A>
<LI> <A HREF="https://ext4.wiki.kernel.org/index.php/Quota" TARGET="_blank">https://ext4.wiki.kernel.org/index.php/Quota</A>
</UL>
</P>

<P>Add some new options to filefrag from Lustre's patches to e2fsprogs:
<UL>
<LI> add -k option to print extents in kB-sized units (like df -k)
<LI> add -b {blocksize} to print extents in blocksize units
<LI> add -e option to print extent format, even when FIBMAP is used
<LI> add -X option to print extents in hexadecimal format
</UL>
</P>


<P>Fix resize2fs so that it can handle off-line resizes of file systems
with the flex_bg feature but without a resize_inode (or if we run out
of reserved gdt blocks).  This also fixes a problem where if the user
creates a filesystem with a restricted number of reserved gdt blocks,
an off-line resize which grows the file system could potentially
result in file system corruption.</P>

<P>Fix a resize2fs bug which could cause it to corrupt bigalloc file
systems when doing an off-line resize.</P>

<P>Further optimize resize2fs so it doesn't use quite as much CPU when
resizing very large file systems. </P>

<P>Fixed 32-bit overflow bugs which could cause resize2fs to fail and
possibly corrupt the file system while resizing 64-bit file systems.</P>

<P>Fix a bug in mke2fs where parsing "-E resize=NNN" will result in a
mke2fs crash due to a divide-by-zero if the 64bit file system feature
is enabled.</P>

<P>Add better error checking to mke2fs to check for invalid parameters
when creating bigalloc file system.</P>

<P>When creating bigalloc filesystems, the -g option to mke2fs will now
specify the number of clusters per block group.</P>

<P>Add to debugfs the functionality to corrupt a specific file system
block via the "zap_block" command.</P>

<P>Add to debugfs the functionality to print out a hex dump of a block in
the file system via the "block_dump" command.</P>

<P>Add to debugfs the functionality to manipulate the extent tree
directly via the "extent_open" command.</P>

<P>Fixed debugfs's mknod command so that it updates the block group
statistics.</P>

<P>Fix e2fsck so it can detect and fix inconsistencies in the interior
nodes of an inode's extent tree.</P>

<P>Fix a potential memory corruption failure in e2fsck's error path if
the call to ext2fs_open2() fails.</P>

<P>Fix e2fsck if its logging function is enabled in e2fsck.conf, and the
resulting file name for the log file is longer than 100 bytes, that it
properly handles this situation instead of crashing.</P>

<P>E2fsck will now report the amount of memory that it attempted to
allocate when a memory allocation request fails, to make it easier to
track down the problem.</P>

<P>Fix mke2fs's handling of the mmp_update_interval option.  (Addresses
Lustre Bug: LU-1888)</P>

<P>E2image can now include all data blocks in the e2image output file
when the user specifies the -a option.</P>

<P>If e2fsprogs is compiled without --enable-quota, make sure that
tune2fs can not turn on the feature for new-style quota support, since
afterwards, none of the e2fsprogs tools will be willing to touch that
file system.</P>

<P>Optimize e2fsck's so that it uses much less CPU for large file
systems.  This can result in significant speedups, especially on
CPU-constrained systems.  This was primarily done by optimizing
libext2fs's bitmap functions.  (Addresses Google Bug: #7534813)</P>

<P>Fix debugfs's htree command so that all its messages are sent through
the pager.</P>

<P>Fixed debugfs's "dump_file" and "cat" functions work correctly
on file systems whose block size is greater than 8k.</P>

<P>Fix e2freefrag so it works on 64-bit file systems, and so it uses much
less memory.  (Addresses Google Bug: 7269948)</P>

<P>Update the spd_readdir.c file in the contrib directory to include some
additions which were made in 2008 that didn't get folded into the
version which we checked into the e2fsprogs source tree.  These
enhancements include thread safety, support for readdir64_r(), and
safe_getenv() support in case spd_readdir.so is used for setuid binaries.</P>

<P>Update Czech, Dutch, French, German, Polish, Swedish, and Vietnamese
translations</P>

<P>Add a command to debugfs to create symlinks.</P>

<P>Document the bigalloc feature in the mke2fs man page.  (Addresses
Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=669730" TARGET="_blank">#669730</A>)</P>

<H3>Programmer's Notes</H3>

<P>Fix gcc -Wall nits.</P>

<P>Fix a spelling typo in the libext2fs texinfo documentation.</P>

<P>Change the output from "make check" so that tools such as emacs's "M-x
compile" does not mistake the output as containing a compiler error.</P>

<P>Export two new functions from libext2fs: ext2fs_extent_node_split()
and ext2fs_extent_goto2().</P>

<P>The ext2fs_extents_fix_parents() was fixed so it does not modify the
location of the extent handle if its current location is at an
interior node, rather than a leaf node of an inode's extent tree.</P>

<P>Add a regression test to assure that e2fsck can correctly fix an
inconsistent interior node in an inode's extent tree.</P>

<P>The ext2fs_{mark,unmark,test}_block_bitmap_range2() functions now
correctly support bigalloc file systems which use store block usage
information in units of clusters.</P>

<P>Fixed the help text in the configure script for --enable-quota.</P>

<P>The m68k-specific bitops code has been removed since they were
incorrectly treating bit numbers with the high bit set as signed
integers.  Furthermore, modern compilers do a good enough job
optimizing the generic code there is no point in having the m68k
specific asm statements.</P>

<P>Fixed how we link the test programs so they always use the static
libraries, so that we test using the libraries which we have just
built.</P>

<P>Update config.guess and config.sub to the latest versions from the GNU
project.</P>

<P>Fixed the com_err.texinfo file so that it can produce a valid
postscript/pdf printed output.</P>

<P>Add a regression test which checks debugfs's ability to create
symlinks, named FIFO's, and device nodes.</P>

<P>Add a function ext2fs_symlink(), which creates symlinks to the
libext2fs library.</P>

<P>Add debugging code so we can test old kernel interfaces for online
resize to resize2fs.  This backwards compatibility checking is keyed
off of the RESIZE2FS_KERNEL_VERSION, which is designed to allow us to
test the functionality of the kernel's older resize ioctls without
needing to install an old version of resize2fs, and to also test a
modern resize2fs's ability to work with older kernels without having
to install an older version of the kernel.</P>

<H2><A NAME="1.42.6">E2fsprogs 1.42.6 (September 21, 2012)</A></H2>

<P>When mke2fs creates file systems with lazy itable initialization, the
progress updates for writing the inode table happens so quickly that
on a serial console, the time to write the progress updates can be the
bottleneck.  So mke2fs will now only update its progress indicators
once a second.</P>

<P>Resize2fs will skip initializing the inode tables if the kernel
supports lazy_itable_init, which speeds up growing off-line growth of
uninit_bg file systems significantly.  Resize2fs will now also
correctly set the itable_unused field in the block group descriptor to
speed up the first e2fsck after the file system is grown.</P>

<P>Resize2fs has been fixed so that on-line resizing of meta_bg file
systems work correctly.  This is needed to grow file system which are
larger than 16T.</P>

<P>Resize2fs will now correctly handle resizing file systems to 16TB on
32-bit file systems when "16TB" is specified on the command line.</P>

<P>Fix mke2fs so that it will be careful to set the reserved blocks ratio
larger than 50%; this can happen when creating small file systems and
when the last block group is dropped because there are not enough
blocks to support the metadata blocks in the last block group.</P>

<P>Fixed spelling mistake in debugfs's help message.</P>

<P>Fixed a potential seg fault in e2fsck when there is an I/O error while
reading the superblock.</P>

<P>Fixed various Debian Packaging Issues (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=677497" TARGET="_blank">#677497</A>)</P>

<P>Updated/fixed various man pages.  (Addresses Sourceforge Bug:
#3559210)</P>

<H3>Programmer's Notes</H3>

<P>The configure option --enable-relative-symlink was broken so that it
needed to be --enable-symlink-relative-symlinks.  We will support both
for at least two years, but then the wrong configure option will be
removed.</P>

<P>Fixed a regression introduced in 1.42.5 so the link order for
e2fsprogs' libraries will be correct for both static and shared
linking.  (Addresses Sourceforge Bug: #3554345)</P>

<P>Add support for e2fsprogs to be compiled using clang/LLVM.</P>

<P>Fix portability problems on non-Linux systems: avoid compile failures
on systems that don't have malloc.h</P>

<P>Fix f_mmp regression test suite so that debugfs gets killed if the
test is interrupted.</P>


<H2><A NAME="1.42.5">E2fsprogs 1.42.5 (July 29, 2012)</A></H2>

<P>Fixed a bug with mke2fs where if there is only 8 inodes per block
group, the calculation of the number of uninitialized inodes in the
first block group would go negative.  This resulted in "mke2fs -N 256
-t ext4 /tmp/foo.img 256m" trying to write so many blocks that /tmp
would run out of space.  (Addresses Sourceforge Bug: #3528892)</P>

<P>Fixed a bug in how e2fsck would uniquify directory entry names.
(Addresses Sourceforge Bug: #3540545)</P>

<P>Previously, e2fsck would only allow a mounted file system to be
checked if it was the root file system and it was mounted read-only.
Now it will allow any file system mounted read-only to be checked if
the -f option is specified.  This makes it easier to test how e2fsck
handles checking file systems which are mounted without having to test
on the root file system.</P>

<P>Fixed a problem if e2fsck where if the root file system is mounted
read-only, e2fsck would not clear an error indication in the journal
superblock.  Combined with a kernel bug, this would cause the e2fsck
to check the file system after every single boot.</P>

<P>The e4defrag program can now handle device symlinks, such as
/dev/mapper/testvg-testlv, instead of insisting on a less
human-friendly name such as /dev/dm-2.  (Addresses Red Hat Bugzilla:
<A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=707209" TARGET="_blank">#707209</A>)</P>

<P>Fixed filefrag so it will not crash with a segfault on files from a
virtual file system such as /proc.  (e.g., "filefrag
/proc/partitions")</P>

<P>Fixed filefrag so that it correctly reports the number of extents.
(Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=840848" TARGET="_blank">#840848</A>)</P>

<P>Fixed a file descriptor leak in logsave which could cause it to hang.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=682592" TARGET="_blank">#682592</A>)</P>

<P>Fixed e2fsck so that the file system is marked as containing an error
if the user chooses not to fix the quota usage information.</P>

<P>Fixed tune2fs so that it correctly removes the quota feature when the
last quota inode is removed.</P>

<P>Fix tune2fs so that after removing a quota inode, the block bitmap is
updated; otherwise, e2fsck would complain after running 'tune2fs -O
^quota &lt;dev&gt;'.</P>

<P>Fix tune2fs so that when converting a file system from using legacy
quota files to the new quota file system feature with hidden quota
files, the accounting for these files is handled correctly so that
e2fsck doesn't complain.</P>

<P>Improved e2fsck's verbose reporting statistics, and allow the more
verbose reporting to be enabled via /etc/e2fsck.conf.</P>

<P>Fixed various Debian Packaging Issues (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=678395" TARGET="_blank">#678395</A>)</P>

<P>Updated/fixed various man pages.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=680114" TARGET="_blank">#680114</A>)</P>


<H3>Programmer's Notes</H3>

<P>Fixed portability problems on other operating systems (e.g., Hurd and
FreeBsd) caused by the attempted inclusion of <sys/quota.h>.</P>

<P>Make sure that shared libraries link with the shared libraries built
in the build tree, instead of the system provided libraries.
Previously, libraries and executables were linked with the system
libraries if present, and possibly using static archives instead of
shared libraries.  This was also problematic since if libext2fs.so is
linked with a static libcom_err.a from system, the build system would
attempt to link without -lpthread.  (Addresses Sourceforge Bug:
#3542572)</P>


<H2><A NAME="1.42.4">E2fsprogs 1.42.4 (June 12, 2012)</A></H2>

<P>Fixed more 64-bit block number bugs (which could end up corrupting
file systems!) in e2fsck, debugfs, and libext2fs.</P>

<P>Fixed e2fsck's handling of the journal's s_errno field.  E2fsck was
not properly propagating the journal's s_errno field to the superblock
field; it was not checking this field if the journal had already been
replayed, and if the journal *was* being replayed, the "error bit"
wasn't getting flushed out to disk.</P>

<P>Fixed a false positive complaint by e2fsck if all of the extents in
the last extent tree block are uninitialized and located after the end
of the file as defined by i_size.</P>

<P>The dumpe2fs will now display the journal's s_errno field if it is
non-zero, and it will also display the journal's 64-bit feature flag
if present.</P>

<P>Fix e2fsck so that it always opens the device file in exclusive mode
when it might need to modify the file system, and never if the -n
option is specified.  (Previously, there were a few corner cases where
it might get things wrong in either direction.)</P>

<P>E2fsck now correctly truncates or deallocates extent-mapped inodes on
the orphan list.  The root cause was a bug in libext2fs's block
iterator which could end up skipping an extent when the last block in
an extent is removed, causing the current extent to be removed from
the extent tree.</P>

<P>E2fsck now correctly sets the global free block and inode counts when
truncating or removing inodes on the orphan list in preen mode.
Previously, it would leave these values would be set incorrectly,
which is largely a cosmetic issue since the kernel no longer pays
attention to those fields, but it can cause spurious complaints in
subsequent e2fsck runs.</P>

<P>Fix i_blocks accounting when the libext2fs library needs to add or
remove an extent tree block  on bigalloc file systems.</P>

<P>The lsattr and chattr programs now support the No_COW flag for the
benefit of btrfs.</P>

<P>Debugfs now interprets date strings of the form @ddd as ddd seconds
after the beginning of the epoch.  This is handy when setting an inode
number into the d_time field when debugging orphan list handling.</P>

<P>Fix a precedence bug with built-in quota support which might result in
e2fsck paying attention to the quota inode field even if the built-in
quota feature flag is not set.  Fortunately, in practice that
superblock field should be zero for non-built-in quota file systems,
so it's unlikely this bug would have caused problems.</P>

<P>Updated/fixed various man pages.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=674453" TARGET="_blank">#674453</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=674694" TARGET="_blank">#674694</A>)</P>

<h3>Programmer's Notes</h3>

<P>The regression test suite can now run the integration tests in the
tests directory in parallel, via "make -jN check".</P>

<P>Add new test, f_zero_extent_length which tests e2fsck's handling of
the case where all of the extents in the last extent tree block are
uninitialized extents after i_size.</P>

<P>Add a new test, f_jnl_errno, which checks handling of an error
indication set in the journal superblock.</P>

<P>Fix the test f_jnl_64bit so that it properly checks e2fsck's handling
of a 64-bit journal.</P>

<P>Add two tests, f_orphan_indirect_inode and f_orphan_extent_inode which
tests e2fsck's handling of orphan inodes in preen mode, and truncation
of extent inodes on the orphan list.</P>
    
<P>Fixed more OS X portability issues.</P>


<H2><A NAME="1.42.3">E2fsprogs 1.42.3 (May 14, 2012)</A></H2>

<P>Fix a bug in the Unix I/O manager which could cause corruption of file
systems with more than 16TB when e2fsprogs is compiled in 32-bit mode
(i.e., when unsigned long is 32-bits).  Also fix a bug which caused
dumpe2fs to incorrectly display block numbers > 32-bits.</P>

<P>Improve the support for integrated quota files (where quota is a first
class supported feature using hidden files in the ext4 file system).
Previously the quota file was getting rewritten even when it was not
necessary, and e2fsck would erroneously try to hide quota files which
were already hidden.</P>

<P>Quiet complaints in e2fsck when the total free blocks or inodes are
incorrect in the superblock after an system crash, since we don't
update nor depend on the superblock summaries at each commit boundary.</P>

<P>Fixed a regression introduced in 1.42.2 which would cause applications
outside of e2fsprogs which did not pass the EXT2_FLAG_64BIT (and so
would were still using the legacy 32-bit bitmaps) to crash.  This was
due to missing 32-bit compat code in side the function
ext2fs_find_first_zero_generic_bmap().  (Addresses Red Hat Bugzilla:
<A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=808421" TARGET="_blank">#808421</A>)</P>
    
<P>Fix a bug which would cause mke2fs to fail creating the journal if
/etc/mtab and /proc/mounts are missing.  (Addresses Sourceforge Bug:
#3509398)</P>
    
<P>Updated/fixed various man pages.</P>

<P>Update Czech, Dutch, French, German, Polish, Swedish, and Vietnamese
translations</P>

<P>Fixed various Debian Packaging issues.</P>


<h3>Programmer's Notes</h3>

<P>Change the nonsensically wrong types in the function signature of the
inline function ext2fs_find_first_zero_block_bitmap2().  This was
caused by a cut and paste error; fortunately no code in e2fsprogs used
this inline function, and there are any users of this functions
outside of e2fsprogs.</P>

<P>Add support for systems which have valloc(), but which do have
posix_memalign() nor memalign() (such as MacOS 10.5).</P>

<P>Refactor and clean up the allocation of aligned buffers for Direct I/O
support.  Previously some allocations were requesting a greater
alignment factor that what was strictly necessary.  Also optimize
reading and writing bitmaps using Direct I/O when the size of the
bitmap did not fully cover the file system blocksize.</P>

<P>Reserve the codepoints for the INCOMPAT features LARGEDATA and
INLINEDATA.</P>

<P>Improved the regression test suite by adding some new integration
tests (f_jnl_32bit, f_jnl_64bit) which detect breakage of the on-disk
jbd2 format, as well as f_eofblocks which tests the new handling of
uninitialized and initialized blocks beyond i_size.  Also add a new
unit test which verifies 32-bit bitmaps support and the new
find_first_zero primitives.</P>

<P>Add a few dependencies to fix parallel (make -j) builds.</P>

<P>Removed bash'isms which were breaking the regression test suite on
systems where /bin/sh is not bash.</P>

<P>The config.guess and config.sub have been updated to the 2012-02-10
version.</P>
    
<P>Fix a portability problem caused by assuming the present of mntent.h
means that setmntent() exists.  Instead, explicitly test for this in
the configure script.</P>

<P>If the sys/signal.h header file does not exist, don't try to include
it, since it's not available on all systems.</P>

<P>Add support for systems that do not support getpwuid_r()</P>
    
<P>The configure script now supports a new option,
--enable-relative-symlinks, which will install relative symlinks for
the ELF shared library files.  (Addresses Sourceforge Bug: #3520767).</P>
    
<P>When building BSD shared libraries make sure the LDFLAGS variable is
passed to the linker.  Fixing this allows, for example, e2fsprogs to
be built in 32-bit mode on Mac OS X Lion (Addresses Sourceforge Bug:
#3517272)</P>
    
<P>Fix gcc -Wall nitpicks</P>

<H2><A NAME="1.42.2">E2fsprogs 1.42.2 (March 27, 2012)</A></H2>

<P>The resize2fs program uses much less CPU and is much faster for very
large file systems.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=663237" TARGET="_blank">#663237</A>)</P>

<P>The seti and freei commands in debugfs can now take an optional length
argument to set and clear a contiguous range of inodes.</P>

<P>E2fsck will now make explicit checks for the EOFBLOCKS_FL, since we
plan to remove support for it from the kernel file system driver.  It
really wasn't very useful and was causing more problems than it
solves.  Since e2fsck will complain if inodes that should have
EOFBLOCKS_FL do not have the flag set, we are going to remove this
check from e2fsprogs first, and then only remove the flag from the
kernel much later.</P>

<P>The mke2fs program can now use direct I/O via "mke2fs -D".  This will
slow down the mke2fs, but it makes it more polite on a loaded server
by limiting the amount of memory that gets dirtied by mke2fs when it
is using buffered I/O.</P>

<P>E2fsck was needlessly closing and re-opening the file system as a side
effect of adding Multiple Mount Protection (MMP).  This isn't
necessary for non-MMP file systems, so drop it.</P>

<P>Print errors returned by ext2fs_open2() and ext2fs_check_desc() so we
can more easily diagnose memory allocation failures caused by
insufficient memory.  E2fsck will now abort if there are memory
allocation failures when the file system is initially opened and
during the block group descriptor checks.  (Addresses Google Bug:
#6208183)</P>

<P>If there are incorrect block group checks, e2fsck will now report the
incorrect and corrected checksum values.</P>

<P>The e2fsck program can now write log files containing the details of
the problems that were found and fixed directly, via configuration
parameters in /etc/e2fsck.conf.</P>

<P>Added the ability to limit the number of messages reported by e2fsck
for a given problem type.  This avoids a potential bottleneck if there
is a serial console which can cause a boot sequence to take a long
time if e2fsck needs to report many, many file system errors.</P>

<P>The dumpe2fs, debugfs, and tune2fs now use rbtree bitmaps, which cause
them to use much less memory for large file systems.</P>

<P>The dumpe2fs program will now print the expected block group checksum
if it is incorrect.  This helps to diagnose problems caused by
incorrect block group checksums.</P>

<P>E2fsck now checks for extents with a zero length, since the kernel
will oops if it comes across such a corrupted data structure.  (See
https://bugzilla.kernel.org/show_bug.cgi?id=42859)</P>

<P>E2fsck has a number of bugs relating to discard that have been fixed.
(1) Fixed a bug which could cause e2fsck to discard portions of the
inode table which were actually in use.  (2) E2fsck will now avoid
using discard if the block device doesn't zero data on discard, since
otherwise this could cause problems if the file system gets corrupted
in the future.  (3) E2fsck will now avoid using discard when it is run
in read-only mode.  (4) Fixed a bug which caused e2fsck to not issue
discards in the last block group.</P>

<P>E2fsck's CPU utilization in pass 5 has been optimized, which will
speed up e2fsck slightly.</P>

<P>E2image will now skip copying uninitialized bitmap and inode table
blocks.</P>

<P>Fixed mke2fs -S so it does not corrupt the first block group's
information.</P>

<P>E2fsck will now check the new sysfs interface to determine if we are
using the battery or AC mains.  (Addresses SourceForge Bug: #3439277)</P>

<P>Updated/fixed various man pages.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=665427" TARGET="_blank">#665427</A>)</P>

<P>Fixed various Debian Packaging issues.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=665885" TARGET="_blank">#665885</A>)</P>

<H3>Programmer's Notes</H3>

<P>Fixed various portability issues for non-Linux systems, particularly
MacOS X, as well as Linux systems running with the just-released glibc
2.15.</P>

<P>Fix file descriptor leak in ext2fs_close() if the file system with
uninit_bg is opened read/only with a backup superblock.  (Addresses
SourceForge Bug: #3444351)</P>

<P>Fixed an invalid return in a non-void function in the quota code.
(Addresses SourceForge Bug: #3468423)</P>

<P>Fixed the debian rules file so that the calls to dpkg-buildflags works
when the shell is dash.</P>

<P>The debian package build now uses V=1 so that there is more
information about potential build failures in debian build logs.</P>

<P>If the uninit flags get cleared by functions such as
ext2fs_new_inode() or ext2fs_new_block2(), we now make sure the
superblock is marked dirty and the block group descriptor checksum is
updated if necessary.</P>

<P>The debian rules file will now try to load debian/rules.custom of it
exists.  This file can skip various builds for speed reasons if there
is no need for the e2fsck-static or udeb packages.  Available
customizations in the rules file includes SKIP_STATIC=yes,
SKIP_BF=yes, and SKIP_DIETLIBC=yes.</P>

<P>In addition, if the file misc/mke2fs.conf.custom.in exists in the
source tree, it will be used instead of the standard misc.conf file in
the upstream sources.  This makes it easier for Debian-derived systems
to distribute a custom mke2fs.conf file without having to worry about
merge issues if future versions of e2fsprogs makes changes in the
upstream default version of mke2fs.conf.</P>

<H2><A NAME="1.42.1">E2fsprogs 1.42.1 (February 17, 2012)</A></H2>

<P>The mke2fs and e2fsck now use significantly less memory when creating
or checking very large file systems.  This was enabled by adding
extent-based bitmaps which are stored using a red-block tree, since
block and inode allocations tend to be contiguous.</P>

<P>The command mke2fs -S is used as a last ditch recovery command to
write new superblock and block group descriptors, but _not_ to destroy
the inode table in hopes of recovering from a badly corrupted file
system.  So if the uninit_bg feature is enabled, mke2fs -S will now
set the unused inodes count field to zero.  Otherwise, e2fsck -fy
after using mke2fs -S would leave the file system completely empty.</P>

<P>Since mke2fs recognizes mke3fs in argv[0] to mean "mkfs.ext3", also
honor "mke4fs" to work the same as "mke2fs.ext4", since RHEL5 has
installed an mke2fs binary using that name.</P>

<P>The usage and help messages for the -G, -t and -T options in mke2fs
have been fixed.</P>

<P>If e2fsck needs to use the backup group descriptors, the
ext2fs_open2() function clears the UNINIT bits to ensure all of the
inodes in the file systems get scanned.  However, the code which reset
the UNINIT flags did not also recalculate the checksum, which produced
many spurious (and scary) e2fsck messages.  This has been fixed by
resetting checksums when the UNINIT bits are cleared.</P>

<P>Relax a check in e2fsck which required that the block bitmap to be
initialized when the inode bitmap is in use.  This will allow us to
eventually eliminate code from the kernel which forcibly initialized
the block bitmap when the inode bitmap is first used, requiring an
extra journal credit and disk write.  (Addresses Google Bug: #5944440)</P>
    
<P>Make sure rdebugfs (which may be installed setuid or setgid disk) does
not honor environment variables if euid != uid or egid != gid.</P>

<P>Debugfs's ncheck command has been optimized and now is much more
robust with faced with corrupted file systems.  The ncheck command
also now has a -c option which will verify the file type information
in the directory entry to see if matches the inode's mode bits.  This
is extremely useful when trying to use debugsfs to determine which
parts of the file system metadata can be trusted.</P>

<P>E2image will try to use ftruncate64() to set the i_size for raw
images, instead of writing a single null byte.  This avoid allocating
an extra block to the raw image, for those file systems and/or
operating systems that support this.  (Linux does.)  In addition, fix
a logic bug that caused the file to not be properly extended if the
size of the last hole was exactly an multiple of a megabyte.</P>

<P>Fixed a bug in resize2fs where for 1k and 2k file systems, where
s_first_data_block is non-zero, this wasn't taken into account when
calculate the minimum file system size for use with the -M option.</P>

<P>Fixed the badblocks program to honor the -s flag when in read-only -t
mode.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=646629" TARGET="_blank">#646629</A>)</P>

<P>Update Czech, Dutch, French, Polish, and Swedish translations from the
Translation Project.</P>

<P>Fixed various Debian Packaging issues so that dpkg-buildflags is used
if present, which allows e2fsprogs to be built with security hardening
flags.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=654457" TARGET="_blank">#654457</A>)</P>

<h3>Programmer's Notes</h3>

<P>Fix a bug in ext2fs_clear_generic_bmap() when used for 32-bit bitmaps.
This was only an issue for programs compiled against e2fsprogs 1.41
that manipulate bitmaps directly.  (Addresses Sourceforge Bugs:
#3451486)</P>

<P>The libext2fs library now uses sysconf() to fetch the page size, instead
of the deprecated getpagesize().</P>

<P>The ext2fs_get_pathname() function will return a partial path if an a
directory in the path is not a directory, displaying it as an inode
number in angle brackets instead of giving up and displaying an error.
This is much more helpful when a user is trying to debug a corrupted
file system.</P>

<P>Codepoints for the RO_COMPAT_REPLICA feature has been reserved.</P>

<P>Added a new library function, ext2fs_file_get_inode_num(), for use by
fuse2fs.</P>

<P>Fixed a bug in ext2fs_file_set_size2() so that when it is truncating a
file, it actually works.</P>

<P>The block iterator now properly honors the BLOCK_ABORT flag for
extent-based flags.  Previously, it didn't, which generally made code
be less efficient, but it could cause bugs in ext2fs_link(), for
example, by causing it to insert multiple directory entries.</P>

<P>Fixed an (harmless other than causing a compiler warning) use of an
uninitialized variable in e2fsck's MMP code.</P>


<H2><A NAME="1.42">E2fsprogs 1.42 (November 29, 2011)</A></H2>

<P>This release of e2fsprogs has support for file systems > 16TB.  Online
resize requires kernel support which will hopefully be in Linux
version 3.2.  Offline support is not yet available for > 16TB file
systems, but will be coming.</P>

<P>This release of e2fsprogs has support for clustered allocation.  This
reduces the number of block (now cluster) bitmaps by allocating and
deallocating space in contiguous power-of-2 collections of blocks,
which are called clustered.  This is a file system level feature,
called 'bigalloc', which must be enabled when the file system is
initially formatted.  It is not backwards compatible with older
kernels.</P>

<P>Added support for the Multi-Mount Protection (MMP) feature.</P>

<P>E2fsck more efficiently uses scratch files for really big file
systems.  (This is a feature that has to be turned on explicitly; see
[scratch_files] in the e2fsck.conf man page.)</P>

<P>Fix a bug in e2fsck where if the free blocks and inodes counts are
incorrect, e2fsck would fix them without printing an error message.
This would cause a "*** FILE SYSTEM WAS MODIFIED ***" message without
any explanation of what was fixed.</P>

<P>E2fsck will no longer attempt to clone an extended attribute block in
pass1b handling if the file system does not support extended
attributes.</P>

<P>E2fsck will be more careful accidentally asking the user to continue
if the file system is mounted, so that an escape sequence won't cause
a false positive.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=619859" TARGET="_blank">#619859</A>)</P>

<P>E2fsck now uses less cpu time in pass 5 when large portions of the
bitmaps are uninitialized.</P>

<P>E2fsck will no longer segfault when a corrupted file system has a bad
extent, and removing it leads to a block needing to be deallocated.
(Addresses SourceForge Bug: #2971800)</P>

<P>E2fsck will catch termination signals (segfaults, bus errors, sigfpe)
and print debugging information to make it easier to find potential
problems.</P>

<P>E2fsck will check to see if the bad block inode looks insane, and will
skip trying to use if it certain fields which should be zero look
non-zero.  This is to avoid a corrupted bad block inode causing e2fsck
to get confused and do more harm than good.</P>

<P>If e2fsck modifies certain superblock fields which the kernel doesn't
look at, it will now mark the superblock as dirty without marking the
file system as changed.  This avoids signaling the init scripts that
a reboot is necessary, since the kernel isn't going to look at those
fields, so it won't care if they have been changed.</P>

<P>Fixed a bug in the libext2fs library (in the binary search routine of
the icount abstraction) that could (very, very rarely) cause e2fsck to
die in the middle of pass 1 or pass 2 processing.</P>

<P>E2fsck will not try to do a discard operation if the -n option was
specified on the command line.</P>

<P>E2fsck now supports an extended "discard" option which will cause
e2fsck to attempt discard all unused blocks after a full, successful
file system check.</P>

<P>E2fsck will check for the bad block inode to make sure it looks sane
before trusting it, to avoid causing more harm than good to the file
system.</P>

<P>E2fsck now returns additional status bits in its exit code if it
aborts early in the e2fsck run.</P>

<P>E2fsck now correctly calculates the maximum file size in the case of
the huge_file file system feature enabled without extents.</P>

<P>The mke2fs and e2fsck programs now tries to use the punch hole command
as a "discard" when operating on normal files.</P>

<P>The e2image program now supports the qcow2 format, which is a more
efficient way of capturing file system dumps.</P>

<P>Mke2fs now supports the [devices] stanza in mke2fs.conf which allows
per-device defaults to be specified in the configuration file.</P>

<P>Mke2fs now supports the reserved_ratio relation in the [defaults] and
[fs_types] section in mke2fs.conf.</P>

<P>Mke2fs now creates extent-mapped directories for the root and
lost+found directories.</P>

<P>Mke2fs will skip zero'ing the journal if the extended option
"lazy_journal_init" is specified.  This can save a lot of time, but it
does add a small amount of risk if the system crashes before the
journal is overwritten entirely once.  It is especially useful for
testing.</P>

<P>Mke2fs will now create file systems that enable user namespace
extended attributes and with time- and mount count-based file
system checks disabled.</P>

<P>Mke2fs will not set a stride or strip size of one block based on block
device attributes obtained from sysfs.</P>

<P>Mke2fs now displays a progress report during the discard process.</P>

<P>Mke2fs now handles extreme file system parameters correctly which
previously caused the inodes per group to drop below 8, leading to a
segfault.  (The inodes per group must be a multiple of 8, but the code
didn't correctly deal with an inodes per group count less than 8.)</P>

<P>Mke2fs and tune2fs previously would give an error if the user tried
setting the stride and stripe-width parameters to zero; but this is
necessary to disable the stride and stripe-width settings.  So allow
setting these superblock fields to zero.  (Addresses Google Bug:
#4988557)</P>

<P>Mke2fs now gives a warning if the auto-detected block size exceeds the
system's page size.</P>

<P>If the enable_periodic_fsck option is false in /etc/mke2fs.conf (which
is the default), mke2fs will now set the s_max_mnt_count superblock
field to -1, instead of 0.  Kernels older then 3.0 will print a
spurious message on each mount then they see a s_max_mnt_count set to
0, which will annoy users.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=632637" TARGET="_blank">#632637</A>)</P>
    
<P>The default mke2fs.conf now has entries for "big" and "huge", which
are needed for very big file systems.</P>

<P>The resize2fs program now has support for a new online resize ioctl
that can support file systems > 16TB, once it arrives in v3.x kernels.</P>

<P>Fixed bug which caused resize2fs to fail when shrinking an empty file
system down to its minimal size.  (Addresses Sourceforge Bug #3404051)</P>

<P>Fixed tune2fs's mount options parsing.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=641667" TARGET="_blank">#641667</A>)</P>

<P>Allow tune2fs to remove external journals if the device can not be
found.</P>

<P>Debugfs's icheck will now correctly find inodes which use the
searched-for block as an extended attribute block.</P>

<P>Debugfs now has a new "punch" command which remove blocks from the
middle of an inode.</P>

<P>Debugfs now has a new "e2freefrag" command which analyzes the free
space fragmentation of the file system, using the same code as the
e2freefrag program.</P>

<P>Debugfs now has a "filefrag" command which displays information about
a file's fragmentation.</P>

<P>Add support to build a metadata-only, read-only, stripped-down version
of debugfs called rdebugfs.</P>

<P>Fixed a potential stack overrun bug in debugfs.</P>

<P>The badblocks program now correctly recovers from I/O errors when
direct I/O is being used.  The badblocks command now also supports a
-B option which forces the use of buffered I/O, and the -v option will
provide a more detailed breakdown of read, write, and failed
comparison errors.</P>

<P>Added e4defrag tool which uses the EXT4_IOC_MOVE_EXT ioctl.</P>

<P>Added support for journals larger than 2GB.</P>

<P>Support using both hard links and symlinks when installing e2fsprogs.</P>

<P>Add overflow checking to tune2fs -i's fsck interval, which must fit in
a 32-bit field.</P>

<P>The debugfs command now has a new 'blocks' command which prints out
data blocks of a particular inode in a format which is useful for
scripting.</P>

<P>Filefrag will report 0 extents correctly in verbose mode.  (Addresses
RedHat Bugzilla: #653234)</P>

<P>Filefrag has been fixed so its -v report prints the correct expected
block number (previously there had been an off-by-one error).  In
addition, it will now display the number of contiguous extents when -v
is not specified.  This makes it consistent with the number of extents
printed when the -v option was specified.  In addition, the number of
contiguous extents is far more interesting/useful than the number of
physical extents for very large files.  (Addresses Debian Bug:
#631498, #644792)</P>
    
<P>Logsave's usage message has been fixed.  (Addresses Debian Bug:
#619788)</P>

<P>Avoid an infinite loop in ext2fs_find_block_device() if there are
symlink loops in /dev caused by a buggy udev.</P>

<P>Added a useful "fallocate" program to the contrib directory.</P>

<P>Fixed an ABI compatibility problem in libext2fs which broke the dump
program.  Also added back some macros which dump needed so it could
compile against the latest version of ext2_fs.h (Addresses Debian Bug:
#636418)</P>

<P>Fixed parsing of MNTOPT_ options for tune2fs and debugfs (Addresses
Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=641667" TARGET="_blank">#641667</A>)</P>

<P>Added internationalization support for libcom_err error table strings.</P>

<P>Fixed various spelling mistakes found in various output strings found
by I18N translators.</P>

<P>Update translations: French, Chinese, Germany, Indonesian, Swedish,
Vietnamese, Polish, Dutch, Czech.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=520985" TARGET="_blank">#520985</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=620659" TARGET="_blank">#620659</A>)</P>

<P>Fixed various Debian Packaging issues.  (Addresses Debian Bugs:
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=614662"
   TARGET="_blank">#614662</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=632169"
   TARGET="_blank">#632169</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=641838"
   TARGET="_blank">#641838</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=627535"
   TARGET="_blank">#627535</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=629355" TARGET="_blank">#629355</A>)</P>

<P>Updated/clarified man pages.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=639411" TARGET="_blank">#639411</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=642193"
   TARGET="_blank">#642193</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=634883" TARGET="_blank">#634883</A>)</P>

<h3>Programming notes</h3>

<P>Initial support for quota as an integrated feature, where the quota
files are hidden system files that are automatically maintained by
e2fsck is present, although disabled by default.  It must be enabled
by using the configure option --enable-quota.</P>

<P>Reserved the on-disk fields for the metadata checksum and snapshot
features, which are currently in development.</P>

<P>The ext2fs library now has the new functions ext2fs_punch(),
ext2fs_get_memzero() and ext2fs_file_get_inode().</P>

<P>The ext2fs library now has support for calculating the crc32c checksum
(via the new functions ext2fs_crc32c_be and ext2fs_crc32c_le).</P>

<P>The I/O manager now supports the discard operation.</P>

<P>Reserved file system code points for new 1st class quota feature.</P>

<P>Shortened the compilation lines by moving the autoconf defines to
a config.h header file.</P>

<P>Fixed a potential free of an uninitialized pointer in
ext2fs_update_bb_inode().</P>

<P>Fixed miscellaneous gcc -Wall and coverity warnings.</P>

<P>Fixed portability issues for Mac OS X, Hurd, and FreeBSD.</P>

<P>Fixed a build failure when OMIT_COM_ERR is defined.</P>

<P>Improved error checking and fixed memory leaks caused by error return
paths.</P>

<P>Add ext2fs_flush2() and ext2fs_close2() which takes a flag to allow
the fsync() to be skipped.</P>

<P>Added a test for extent-mapped journals by mke2fs and tune2fs.</P>

<P>Added a test for creating a large (over 4GB) journal using mke2fs.</P>

<P>Added a test to make sure the inode size remains constant.</P>

<P>The regression test script now prints the list of which tests failed.</P>

<P>The regression test system now uses /tmp for its scratch files, which
is often a tmpfs mounted file system and hence much faster.</P>

<P>The i_e2image test was fixed so it works with valgrind.</P>

<P>Tests that rely on debugfs are now skipped if debugfs wasn't built.</P>

<P>Fixed the dependencies for "make check" so all required dependencies
are built before running the regression tests.</P>

<P>A link to com_err.h is installed in $(includedir) during a "make install".</P>

<P>The po/*.gmo files are automatically rebuilt if they are missing or
out of date.  This helps out Debian packaging.</P>

<P>Allow ext2fs_get_memalign() to compile on systems that don't have
posix_memalign().</P>

<P>Fixed a namespace leak in libext2fs (tdb_null).</P>


<H2><A NAME="1.41.14">E2fsprogs 1.41.14 (December 22, 2010)</A></H2>

<P>Fix spurious complaint in mke2fs where it would complain if the file
system type "default" is not defined in mke2fs.conf.</P>

<P>The resize2fs program will no longer clear the resize_inode feature
when the number reserved group descriptor blocks reaches zero.  This
allows for subsequent shrinks of the file system to work cleanly for
flex_bg file systems.</P>

<P>The resize2fs program now handles devices which are exactly 16T;
previously it would give an error saying that the file system was too
big.</P>

<P>E2fsck (and the libext2fs library) will not use the extended rec_len
encoding for file systems whose block size is less than 64k, for
consistency with the kernel.</P>

<H3>Programming notes</H3>

<P>E2fsprogs 1.41.13 would not compile on big-endian systems.  This has
been fixed.  (Addresses Sourceforge Bug: #3138115)</P>

<P>The ext2fs_block_iterator2() function passed an incorrect ref_offset
to its callback function in the case of sparse files.  (Addresses
Sourceforge Bug: #3081087)</P>
    
<P>Fix some type-punning warnings generated by newer versions of gcc.</P>


<H2><A NAME="1.41.13">E2fsprogs 1.41.13 (December 13, 2010)</A></H2>

<P>E2fsck now supports the extended option "-E journal_only", which
causes it to only do a journal replay.  This is useful for scripts
that want to first replay the journal and then check to see if it
contains errors.</P>

<P>E2fsck will now support UUID= and LABEL= specifiers for the -j option
(which specifies where to find the external journal).  (Addresses
Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=559315" TARGET="_blank">#559315</A>)</P>

<P>E2fsck now has support for the problems/<problem code>/force_no
configuration option in e2fsck.conf, which forces a problem to not be
fixed.</P>

<P>Dumpe2fs will now avoid printing large negative offsets for the bitmap
blocks and instead print a message which is a bit more helpful for
flex_bg file systems.</P>

<P>Mke2fs will now check the file system type (specified with the -t
option) to make sure it is defined in the mke2fs.conf file; if it is
not, it will print an error and abort.  If the usage type (specified
with the -T option) is not defined in mke2fs.conf, mke2fs will print a
warning but will continue.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=594609" TARGET="_blank">#594609</A>)</P>

<P>Clarified error message from resize2fs clarifying that on-line
shrinking is not supported at all.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=599786" TARGET="_blank">#599786</A>)</P>
    
<P>Fix an e2fsck bug that could cause a PROGRAMMING BUG error to be
displayed.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=555456" TARGET="_blank">#555456</A>)</P>

<P>E2fsck will open the external journal in exclusive mode, to prevent
the journal from getting truncated while it is in use due to a user
accidentally trying to run e2fsck on a snapshotted file system volume.
(Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=587531" TARGET="_blank">#587531</A>)</P>

<P>Fix a bug in e2fsck so it has the correct test for the EOFBLOCKS_FL
flag.</P>

<P>The tune2fs program can now set the uninit_bg feature without
requiring an fsck.</P>

<P>The tune2fs, dumpe2fs, and debugfs programs now support the new ext4
default mount options settings which were added in 2.6.35.</P>

<P>The e2fsck and dumpe2fs programs now support the new ext4 superblock
fields which track where and when the first and most recent file
system errors occurred.  These fields are displayed by dumpe2fs and
cleared by e2fsck.  These new superblock fields were added in 2.6.36.</P>

<P>Debugfs now uses a more concise format for listing extents in its
stat command.  This format also includes the interior extent tree
blocks, which previously was missing from stat's output for
extent-based files.</P>

<P>Debugfs has a new option, -D, which will request Direct I/O access of
the file system.</P>

<P>Mke2fs will skip initializing the inode table if a device supports
discard and the discard operation will result in zero'ed blocks.</P>

<P>Badblocks will now correctly backspace over UTF-8 characters when
displaying its progress bar.  (Addresses Gentoo Bug #309909; Addresses
Debian Bugs
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=583782"
  TARGET="_blank">#583782</A> and
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=587834" TARGET="_blank">#587834</A>)</P>

<P>E2freefrag will now display the total number of free extents.</P>

<P>Resize2fs -P no longer requires a freshly checked filesystem before
printing the minimum resize size.</P>

<P>Fixed a floating point precision error in a binary tree search routine
that can lead to seg fault in e2fsck and resize2fs.</P>

<P>Fixed a bug in e2fsck where if both the original and backup superblock
are invalid in some way, e2fsck will fail going back to the original
superblock because it didn't close the backup superblock first, and
the exclusive open prevented the file system from being reopened.</P>

<P>Fixed a big in e2freefrag which caused getopt parsing to fail on
architectures with unsigned chars.  (Addresses Gentoo Bug: #299386)</P>

<P>Clarified an mke2fs error message so a missed common in an -E option
(i.e., "mke2fs -t ext4 -E stride=128 stripe-width=512 /dev/sda1")
results in a more understandable explanation to the user.</P>

<P>Mke2fs now displays the correct valid inode ratio range when
complaining about an invalid inode ratio specified by the user.</P>

<P>Mke2fs now understands the extended option "discard" and "nodiscard",
and the older option -K is deprecated.  The default of whether
discards are enabled by default can be controlled by the mke2fs.conf
file.</P>

<P>Mke2fs's handling of logical and physical sector sizes has been
improved to reflect the fact that there will be some SSD's with 8k and
16k physical sectors arriving soon.  Mke2fs will no longer force block
size to be the physical sector size, since there will be devices where
the physical sector size is larger than the system's page size, and
hence larger than the maximal supported block size.  In addition, if
the minimal and optimal io size are not exported by the device, and
the physical sector size is larger than the block size, the physical
sector size will be used to set the Raid I/O optimization hints in the
superblock.</P>

<P>E2fsck will now display a better, more specific error message when the
user enters a typo'ed device name, instead of blathering on about
alternate superblocks.</P>

<P>Fixed various Debian Packaging Issues</P>

<P>Updated/clarified man pages (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=580236"
     TARGET="_blank">#580236</A>,
     <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=594004" TARGET="_blank">#594004</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=589345"
   TARGET="_blank">#589345</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=591083" TARGET="_blank">#591083</A>; Addresses Launchpad Bug: #505719)</P>

<P>Update the Chinese, Chzech, Dutch, French, Germany, Indonesian,
Polish, Swedish, and Vietnamese translations.</P>

<H3>Programmer's Notes</H3>

<P>Fix a dependency definition for the static and profiled blkid
libraries which could cause compile failures in some configurations.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=604629" TARGET="_blank">#604629</A>)</P>
    
<P>Add support for Direct I/O in the Unix I/O access layer.</P>

<P>Fixed a memory leak in the Unix I/O layer when changing block sizes.</P>

<P>Fixed minor memory leaks in mke2fs.</P>

<P>Added a new function to the ext2fs library, ext2fs_get_memalign().</P>

<P>The tst_super_size test program will check to make sure the superblock
fields are correctly aligned and will print them out so they can be
manually checked for correctness.</P>

<P>Fixed some makefile dependencies for test programs in lib/ext2fs.</P>

<P>Reserved the feature flags and superblock fields needed for the Next3
snapshot feature.</P>

<P>Reserved the feature flags for EXT4_FEATURE_INCOMPAT_DIRDATA and
EXT4_INCOMPAT_EA_INODE.</P>


<H2><A NAME="1.41.12">E2fsprogs 1.41.12 (May 17, 2010)</A></H2>

<P>Mke2fs now gives a correct error message if the external journal
device is not found.  (Addresses Red Hat Bug
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=572935" TARGET="_blank">#572935</A>)</P>

<P>Resize2fs -P will now refuse to print a minimum size if the file
system is not clean.  Previously it would go ahead and print a minimum
size anyway, which might not be correct, leading to user confusion.</P>

<P>E2fsck now tests for extents that begin at physical block 0 and
rejects them as invalid.  (Addresses Google Bug: #2573806)</P>
    
<P>Fixed a bug in e2fsck which could cause it to crash when trying to
remove an invalid extent and the block bitmaps hadn't yet been loaded.
(Addresses SourceForge Bug: #2971800)</P>
    
<P>E2fsck now will completely skip time-based checks if the system clock
looks insane or the option broken_system_clock is set in
/etc/e2fsck.conf.</P>

<P>E2fsck would previously report an i_blocks corruption for a 4T file
created using posix_fallocate; this bug has been fixed.</P>

<P>E2fsck will now correctly mark a sparse journal as invalid and will
delete and recreate the journal to address the problem.</P>

<P>E2fsck would previously incorrectly ask the user whether she would
like to abort the file system check after finding a problem --- and
then abort regardless of the user's answer.  This is annoying, and
has been fixed.</P>

<P>E2fsck can now continue even if it fails to recreate the resize
inode; previously it would just abort the file system check
altogether.</P>

<P>E2fsck could potentially remove directory entries for inodes found in
the unused region of the inode table; this would generally happen on
ext4 file systems that do not use journalling.  This bug has been fixed
by not clearing these directory entries once it has been established
that bg_unused_inodes may not be trustworthy; once pass #2 has been
completed, e2fsck will restart the file system check from the
beginning, and then it will be safe to delete any directory entries
pointing to inodes that appear to be deleted.  (Addresses Google Bug:
#2642165)</P>
    
<P>E2fsck will not try to set the block group checksums if the user
cancels the fsck with a control-C.  It's a bad idea to set the
checksums if e2fsck hasn't been completed, and it often results an the
error message, "Inode bitmap not loaded while setting block group
checksum info".  (Addresses Launchpad Bug: #582035)</P>

<P>The mke2fs program now queries the kernel for the physical as well as
the logical sector size, and will not allow a blocksize below the
logical, and will strongly encourage a blocksize at least as big as
the physical blocksize.  This is needed for 4k sector drives that
emulate 512 byte sector sizes.</P>

<P>Mke2fs will now allow a flex_bg size of 1.  This is unusual, and
rarely needed, but it is a legal value.</P>

<P>E2fsck will check for cases where the EOFBLOCKS_FL is set when it is
not needed, and offer to clear it; this is a sign of a kernel bug, but
more importantly, some released kernels may crash when this situation
is encountered on ext4 file systems.  (Addresses Google Bug: #2604224)</P>
    
<P>E2fsck will use the EOFBLOCKS_FL flag exclusively to check whether
i_size is correct.  (Kernels starting with 2.6.34 will set
EOFBLOCKS_FL.)</P>

<P>The com_err library will now only output ^M (a CR character) when the
tty is in raw mode.</P>

<P>Update the Czech, Chinese, Dutch, French, Germany, Indonesian, Polish,
and Vietnamese translations.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=571247"
  TARGET="_blank">#571247</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=563487" TARGET="_blank">#563487</A>)</P>


<H3>Programmer's Notes</H3>

<P>The regression test suite now uses its own mke2fs.conf file, so that
downstream distributions want change the mke2fs.conf file which is
distributed in the RPM or dpkg file, without worrying about screwing
up the regression test results.</P>

<P>Always build namei.o so that building with configure --disable-debugfs
works correctly.  Long-term, if we care about reduced e2fsprogs
builds, we need a more general solution for deciding what .o files are
needed for a particular build.  Given that install floppies are going
(gone?) the way the dodo bird, we probably don't care, though.
(Addresses Sourceforge Bug: #2911433)</P>

<P>Add configure options --enable-symlink-build and
--enable-symlink-install, which allow e2fsprogs be built using
symlinks instead of hard links, and to be installed using symlinks
instead of hard links, respectively.  It is useful when the file
system where the build is taking place, or the file system where
e2fsprogs is installed, can't handle hard links for some reason.
(Addresses Sourceforge Bug: #1436294)</P>

<P>Fixed compile warning in mke2fs.c.</P>


<H2><A NAME="1.41.11">E2fsprogs 1.41.11 (March 14, 2010)</A></H2>

<P>E2fsck will no longer give a fatal error and abort if the physical
device has been resized beyond 2**32 blocks.  (Addresses Launchpad
Bug: #521648)</P>

<P>Debugfs has a bug fixed so that "logdump -b <blk>" now properly shows
the allocation status of the block <blk>.  (Addresses Debian Bug:
#564084)</P>
    
<P>E2fsck now prints a much more emphatic and hopefully scary message
when a file system is detected as mounted while doing a read/write
check of the filesystem.  Hopefully this will dissuade users from
thinking, "surely that message doesn't apply to *me*" :-(</P>

<P>E2fsck -n will now always open the file system read-only.  We now
disallow certain combination of options which previously were manual
exceptions; this is bad because it causes users to think they are
smarter than they really are.  So "-n -c", "-n -l", "-n -L", and "-n
-D" are no longer supported.  (Addresses Launchpad Bug: #537483)</P>
    
<P>In e2fsprogs 1.41.10, mke2fs would ask for confirmation to proceed if
it detected a badly aligned partition.  Unfortunately, this broke some
distribution installation scripts, so it now just prints the warning
message and proceeds.  (Addresses Red Hat Bug:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=569021" TARGET="_blank">#569021</A>. Addresses
Launchpad Bug: #530071)</P>
    
<P>Mke2fs would take a long time to create very large journal files for
ext4.  This was caused by a bug in ext2fs_block_iterate2(), which is
now fixed.</P>

<P>E2fsck now understands the EOFBLOCKS_FL flag which will be used in
2.6.34 kernels to make e2fsck not complain about blocks deliberately
fallocated() beyond an inode's i_size.</P>

<P>E2fsprogs 1.41.10 introduced a regression (in commit b71e018) where
e2fsck -fD can corrupt non-indexed directories when are exists one or
more file names which alphabetically sort before ".".  This can happen
with ext2 filesystems or for small directories (take less than a lock)
which contain filenames that begin with a space or some other
punctuation mark.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=573923" TARGET="_blank">#573923</A>, Addresses Launchpad
Bug: #525114)</P>


<H3>Programmer's Notes</H3>

<P>Add new test, f_rehash_dir, which checks to make sure e2fsck -D works
correctly.</P>
    
<P>The libcom_err function now has support for Heimdal's com_right_r
function().  (Addresses Sourceforge Bug: #2963865, Addresses Debian
Bug: #558910)</P>


<H2><A NAME="1.41.10">E2fsprogs 1.41.10 (February 10, 2010)</A></H2>

<P>Fix resize2fs bug which causes it to access invalid memory.</P>

<P>Add libss support for libreadline.so.6.</P>
    
<P>Fix e2fsck's check for extent-mapped directory with an incorrect file
type.</P>

<P>Add new e2fsck.conf configuration option, default/broken_system_clock
to support systems with broken CMOS hardware clocks.  Also, since too
many distributions seem to have broken virtualization scripts now,
e2fsck will by default accept dates which are off by up to 24 hours by
default.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=559776"
  TARGET="_blank">#559776</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=557636" TARGET="_blank">#557636</A>)</P>

<P>Fix a bug where mke2fs may not use the best placement of the inode
table when there is only room for a single block group in the last
flex_bg.</P>

<P>E2fsck is now smarter when it needs to allocate blocks in the course
of fixing file system problems.  This reduces the number of spurious
differences found in pass #5.</P>

<P>E2fsck will no longer rehash directories which fit in a single
directory block.</P>

<P>E2fsck now correctly handles holes in extent-mapped directories (i.e.,
sparse directories which use extents).</P>

<P>Fix big-endian problems with ext2fs_bmap() and ext2fs_bmap2().</P>

<P>Fix a bug in filefrag where on platforms which can allow file systems
with 8k blocks, that it doesn't core dump when it sees a file system
with 8k block sizes.  (Thanks to Mikulas Patocka for pointing this
out.)</P>

<P>E2fsck will correctly fix directories that are have an inaccurate
i_size as well as other problems in a single pass, instead of
requiring two e2fsck runs before the file system is fully fixed.</P>

<P>Fix e2fsck so it will correctly find and detect duplicate directory
entries for non-indexed directories.  ( Addresses Sourceforge Bug:
#2862551)</P>
    
<P>Mke2fs will use BLKDISCARD to pre-discard all blocks on an SSD or
thinly-provisioned storage device.  This can be disabled using the -K
option.</P>

<P>Enhance libext2fs so it works around bug in Linux version 2.6.19
and earlier where the /proc/swaps file was missing the header on
the first line.</P>

<P>Fix bug in Linux version 2.6.19 and earlier where the /proc/swaps file
was missing the header on the first line.</P>

<P>Fix some big-endian bugs in e2fsck and libext2fs.</P>

<P>Fix resize2fs so it works correctly on file systems with external
journals instead of failing early with the error "Illegal inode
number".</P>

<P>Fix libss so that it does not seg fault when using a readline library
which does not supply a readline_shutdown() function.</P>

<P>Updated dumpe2fs's usage message so it correctly gives the right
arguments summary for "-o superblock=<num>" and "-o blocksize=<num>".
(Addresses Launchpad Bug: #448099)</P>
   
<P>Teach libext2fs to ignore the high 32 bits of the i_blocks field
when huge_file file system feature is set, but the inode does not
have the HUGE_FILE_FL flag set.</P>

<P>Fix e2fsck's handling of 64-bit i_blocks fields.</P>

<P>E2fsck will now print "Illegal indirect block", "Illegal
double-indirect block", etc., instead of "Illegal block #-1" or
"Illegal block #-2", etc.  This makes it easier for users to
understand what has gone wrong.  (Addresses SourceForge Bug: #2871782)</P>

<P>Mke2fs now will obtain get device topology information from blkid and
use it to populate the superblock stride and stripe sizes.  It will
also warn if the block device is misaligned</P>

<P>Fix file descriptor leaks in fsck and debugfs.  (Addresses Novell Bug:
##524526)</P>

<P>Fix the libext2fs library code to round up the bitmap size to a 4-byte
boundary, to prevent spurious seg faults caused by the x86
architecture.  This doesn't affect Linux systems, but was a major
problem on a number of *BSD systems.  (Addresses Sourceforge Bug:
#2328708)</P>

<P>Fix resize2fs's minimum size required for a file system so it doesn't
fail when "resize2fs -M" is run.  (Addresses RedHat Bugzilla: #519131)</P>
    
<P>Dumpe2fs now prints summary information about the contents of the
journal.</P>
    
<P>Avoid printing scary error messages when e2fsck starts running
problems on low-memory systems, as it tends to panic and mislead the
user.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=509529" TARGET="_blank">#509529</A>)</P>

<P>Fix blkid's modules.dep parser so it handles compressed (.ko.gz)
modules files.  (Address Red Hat Bug:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=518572" TARGET="_blank">#518572</A>)</P>
    
<P>Fix tune2fs so it can add a journal when an extent-enabled file system
is mounted.  (Addresses Launchpad bug: #416648)</P>

<P>Update Czech, Indonesian, Polish and Vietnamese translations (from the
Translation Project).</P>
    
<P>Update/clarify man pages.  (Addresses Sourceforge Bug: #2822186)</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=540111" TARGET="_blank">#540111</A>)</P>

<H3>Programmer's Notes</H3>

<P>The configure script supports the --with-cc, --with-ccopts, and
--with-ldopts options.  Instead, the more standard use of CC=,
CCFLAGS=, and LDFLAGS= in the configure command line is used instead.
Also, --with-ld, which never worked, was also removed.
(Addresses Sourceforge Bug: #2843248)</P>

<P>The in-tree header files are only used if the in-tree uuid or blkid
libraries are used.  Otherwise, use the system-provided uuid or blkid
header files if using the system-provided libraries.</P>

<P>Fix some build failures caused by --disable-* configure options.</P>

<P>Work around a bug in autoconf 2.64.</P>


<H2><A NAME="1.41.9">E2fsprogs 1.41.9 (August 22, 2009)</A></H2>

<P>Fix a bug in e2fsck routines for reallocating an inode table which
could cause it to loop forever on an ext4 filesystem with the FLEX_BG
filesystem feature with a relatively rare (and specific) filesystem
corruption.  This fix causes e2fsck to try to find space for a new
portion of the inode table in the containing flex_bg, and if that
fails, the new portion of the inode table will be allocated in any
free space available in the filesystem.</P>

<P>Make e2fsck less annoying by only asking for permission to relocate a
block group's inode table once, instead of for every overlapping
block.  Similarly, only ask once to recompute the block group
checksums, instead of once for each corrupted block group's checksum.</P>

<P>Fix filefrag to avoid print the extent header if the FIEMAP ioctl is
not present, and it needs to fall back to using the FIBMAP ioctl.</P>

<P>Fix filefrag to correctly print the number of extents for zero-length
files.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=540376" TARGET="_blank">#540376</A>)</P>

<P>Filefrag now has a -B option which forces the use of the FIBMAP ioctl
to more easily debug the FIBMAP code.</P>

<P>Fixed filefrag for non-extent based files.</P>

<P>Add a new program, e2freefrag, which displays information about the
free space fragmentation in an ext2/3/4 filesystem.</P>

<P>Fix inode resizing via tune2fs -I so that it works correctly in the
face of non-empty bad blocks inodes, and if the filesystem was
formatted using the "mke2fs -E stride=N" option for RAID arrays.</P>

<P>Fix regression in ext2fs_extent_set_bmap() caused e2fsck -fD to fail
and corrupt large directories if the directory needs to shrink by more
than one block.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=537510" TARGET="_blank">#537510</A>)</P>
    
<P>Fix e2fsck's buggy_init_scritps=1 so that the if the last write and/or
last mount times are in the future, they are corrected even if
buggy_init_scripts is set.  This is needed because otherwise resize2fs
will refuse to resize the filesystem, even after running "e2fsck -f".
(Addresses Launchpad bug: #373409)</P>

<P>E2fsck will now print much fuller information when the last mount time
or last written time is in the future, since most people can't seem to
believe their distribution has buggy init scripts, or they have a
failed CMOS/RTS clock battery.</P>

<P>Enhance dumpe2fs to dump the extent information via the 'stat'
command, and more detailed extent information via the new command
'dump_extents'.</P>
    
<P>Update French, Polish, Czech, and Swedish translations from the
Translation Project.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.</P>

<H3>Programmer's Notes</H3>

<P>Fixed miscellaneous gcc -Wall warnings.</P>

<P>Fixed memory leak in error path in ext2fs_block_iterate2()</P>

<P>Fixed non-Linux build of the intl directory by adding support for the
E/Q/V macros.</P>

<P>The bitmap read/write functions now treat uninitialized bitmaps as
unallocated; this fixes a number of problems in all e2fsprogs for ext4
filesystems when there is a need to allocate new blocks or inodes, and
there aren't any free blocks or inodes in the already-used block
groups.</P>

<P>Improve ext2fs_extent_set_bmap() to avoid creating new extents which
get inserted into the extent tree when they are not needed.</P>


<H2><A NAME="1.41.8">E2fsprogs 1.41.8 (July 11, 2009)</A></H2>

<P>Fix resize2fs's online resizing, fixing a regression which in
e2fpsrogs 1.41.7.   (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=535452" TARGET="_blank">#535452</A>)</P>

<P>Fix potential filesystem corruptions caused by using resize2fs to
shrinking ext4 filesystems with extents enabled.  (Addresses Red Hat
Bug: <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=510379" TARGET="_blank">#510379</A>)</P>

<P>Optimize uuid_generate() to avoid running uuidd if it is not setuid or
setgid and the currently running program doesn't have write access to
the uuidd work directory.</P>

<P>Add safety checks (for non-Linux systems) so that uuidd isn't run with
file descriptors 0, 1, and 2 closed; and if they are closed, uuidd
will be careful not to close the file descriptor for its unix domain
socket when it detaches itself from the controlling tty.  Also add
safety checks so that if the unix domain socket between the uuid
library and uuidd program is closed for any reason, both the library
and the uuidd will return an appropriate error code instead of looping
in an infinite loop.</P>

<P>The e2croncheck script, which creates an LVM snapshot and then checks
the ext3/4 filesystem via the LVM snapshot, has been added to the
contrib directory.</P>

<P>Fix the filefrag program for files that have more than 144 extents.</P>

<P>Update French, Polish, Czech, Indonsian, and Swedish translations from
the Translation Project.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=535530" TARGET="_blank">#535530</A>)</P>

<P>Update/clarify man pages.</P>

<H3>Programmer's Notes</H3>

<P>Fix compilation problem when configured with --disable-uuid.</P>

<P>Don't build uuidgen if configured with --disable-uuid.</P>

<P>Add the new library function ext2fs_test_inode_bitmap_range(), and
optimized ext2fs_test_block_bitmap_range(), which will be needed for
future optimizations for e2fsck.</P>

<P>Fix makefile dependencies for libcom_err so that the Makefiles work
well on non-GNU make program.  (Addresses Sourceforge Patches: #2813809)</P>

<P>Enhance the build system so that the full set of commands executed by
the Makefiles are displayed, instead of the Linux kernel summary
output, if the build was configured with --enable-verbose-makecmds, or
if GNU make is in use and the V variable is non-null, i.e., via "make
V=1".</P>

<H2><A NAME="1.41.7">E2fsprogs 1.41.7 (June 29, 2009)</A></H2>

<P>Fix a bug in libext2fs which can cause e2fsck and resize2fs to write
uninitialized data into the portion of the inode beyond the first 128
bytes when operating on inodes mapped via extents; potentially
corrupting filesystems.</P>

<P>Fix memory leaks in e2fsprogs, including a very large memory leak
which can cause e2fsck to run out of memory when checking very large
filesystems using extents.</P>

<P>The logsave program will now filter out the ^A and ^B characters when
writing to the console.</P>

<P>Harden ext2fs_validate_entry() so that lsdel will not read beyond the
end of the block even if the directory block is corrupted.</P>

<P>Fix debugfs from core dumping if the logdump command fails to open the
output file.</P>

<P>Enhance badblocks to print the currently tested block number when
interrupted with ^C.</P>

<P>Fix lsattr to exit with a non-zero status when it encounters errors.
(Addresses RedHat Bugzilla #489841)</P>

<P>Fix e2fsprogs to use the same encoding for rec_len in 64k (and larger)
filesystems as the kernel when encoding rec_len >= 64k.  For 64k
filesystems (currently all that is supported by e2fsprogs, this is
only a minor corner case).</P>

<P>Resize2fs will now update the journal backup fields in the sup0erblock
if the journal is moved; this avoids an unnecessary full fsck after
resizing the filesystem.  (Addresses RedHat Bugzilla: #505339)</P>
    
<P>Fix libext2fs to properly initialize i_extra_size when creating the
journal and resize inodes.</P>

<P>Change badblocks to allow block sizes larger than 4k.</P>

<P>Fix the filefrag program so it correctly checks for errors from the fiemap ioctl.</P>

<P>Update Chinese and Czech translation from the Translation Project.</P>

<P>Clean up various man pages.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=531385"
  TARGET="_blank">#531385</A> and
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=523063" TARGET="_blank">#523063</A>)</P>

<H3>Programmer's Notes</H3>

<P>Add --disable-libuuid option to configure which uses an in-system
installed version of libuuid; the private version is enabled by
default.</P>

<P>Add --valgrind-leakcheck option to the test_script program which runs
valgrind with the appropriate options to find memory leaks.</P>


<H2><A NAME="1.41.6">E2fsprogs 1.41.6 (May 30, 2009)</A></H2>

<P>Fix a critical regression in e2fsck introduced version 1.41.5 which
can undo updates to the block group descriptors after a journal replay.</P>

<P>If e2fsck receives an I/O error while replaying the journal, prompt
the user whether they want to ignore the error or not; if e2fsck is
run in preen mode, force fsck to abort the preen pass.</P>

<P>Fix a bug which would cause e2fsck to core dump if the filesystem
contains a corrupt extent header, and the user declines to clear the
inode.  (Addresses Sourceforge Bug: #2791794)</P>
    
<P>Fix e2fsck to restart only once in the case of multiple block groups
which inodes in use that are in the uninitialized part of the block
group's inode table.</P>

<P>To reduce user confusion, if the /etc/mtab file is missing
ext2fs_check_mount_point and ext2fs_check_if_mounted will return a
new, explicit error code to indicate this case.  This will cause
e2fsck to give a clearer error message when the user is using buggy
rescue CD's that don't properly set up /etc/mtab.  (Addresses Debian
Bug: #527859)</P>
    
<P>Fix e2fsck so that if the primary group descriptors are corrupted, but
the backup superblock is entirely invalid, to go back to using (and
fixing) the primary group descriptors instead of completely giving up
on the filesystem.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=516820" TARGET="_blank">#516820</A>)</P>
    
<P>Change e2fsck to not abort a preen pass if an inode is found to have
i_file_acl_hi non-zero.  Ext3 filesystems don't care, and newer
kernels (post 2.6.29) will ignore this field.  So let's fix it
automatically during the preen pass instead of forcing the user to fix
this up manually.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=526524" TARGET="_blank">#526524</A>)</P>
    
<P>Add resource tracking for e2fsck passes 1b through 1d.</P>

<P>Speed up e2fsck by eliminating unnecessary journal checks if the
filesystem is already mounted and doesn't need recovery (since the
kernel would have run the journal when the filesystem was mounted.)
Also speed up e2fsck by avoiding unnecessary block group descriptor
updates in ext2fs_close().</P>

<P>Add support to chattr to migrate inodes from using direct/indirect
blocks to extents.</P>

<P>Avoid corrupting the filesystem if there is an attempt to shrink a
filesystem using resize2fs smaller than possible by making
ext2fs_set_bmap() more careful not to delete the old block until the
new block can be inserted.  In addition, fix a bug in how the minimum
size of the filesystem (plus a safety margin) is calculated, and
modify resize2fs to refuse to shrink the filesystem below that minimum
size without the force flag.</P>

<P>Teach blkid to try to figure out DM device names using take advantage
of information in sysfs when running on kernels (2.6.29 and later)
which provide this information in /sys/block/dm-<N>/dm/name; this is
much faster than scanning for the device number in /dev/mapper.</P>

<P>Fix blkid to prefer /dev/mapper/<name> device names instead of the
private /dev/dm-X names.</P>

<P>Add an -a option to debugfs's close_filesys command which writes any
changes to the superblock or block group descriptors to all of the
backup superblock locations.</P>
    
<P>Add support to the filefrag program to use the FIEMAP ioctl.</P>

<P>Update Chinese translation from the Translation Project.</P>

<P>Clean up various man pages.  (Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=502971" TARGET="_blank">#502971</A> and
Launchpad Bug: #381854)</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=506064" TARGET="_blank">#506064</A>)</P>

<H3>Programmer's Notes</H3>

<P>Add test code to make sure e2fsck's problem.c doesn't have two problem
codes assigned to duplicate values.</P>

<P>Avoid using a hard-coded path for /bin/rm in block's test_probe.in.
(Addresses Sourceforge Bug: #2780205)</P>

<P>Clean up e2fsck by removing #ifdef RESOURCE_TRACK by adding an empty
function declaration for init_resource_track() and
print_resource_track() when RESOURCE_TRACK is not defined.</P>

<P>The test code which is used to build the tst_csum program has been
moved from from tst_csum.c into csum.c under an #ifdef DEBUG to to
avoid compile problems caused by not having a prototype for
ext2fs_group_desc_csum().  (Addresses Sourceforge Bug #2484331)</P>

<P>Update the config.guess and config.sub file to the latest from the
FSF, to allow e2fsprogs to build on the avr32 platform.  (Addresses
Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=528330" TARGET="_blank">#528330</A>)</P>

<P>Add a new function, ext2fs_extent_open2(), which behaves like
pext2fs_extent_open(), but uses the user-supplied inode structure
when opening an extent instead of reading the inode from disk.</P>


<H2><A NAME="1.41.5">E2fsprogs 1.41.5 (April 23, 2009)</A></H2>

<P>Fix a number of filesystem corruption bugs in resize2fs when growing
or shrinking ext4 filesystems off-line (i.e., when the ext4 filesystem
is not mounted).</P>

<P>Debugfs can now set i_file_acl_high via the set_inodes_field command,
and print a 64-bit file acl.  This is useful for debugging filesystem
corruptions where the high bits of i_file_acl_high are set.  E2fsck
will detect and fix non-zero i_file_acl_high on 32-bit filesystems
since some Linux kernel versions pay attention to this field even when
they shouldn't.</P>

<P>Speed up e2fsck when checking clean filesystems by avoiding
unnecessary block reads, and coalescing the block group descriptor
blocks so they are read using a single read operation.</P>

<P>The libuuid library will now close all file descriptors before running
uuidd.  This avoids problems when the calling program has open sockets
which then never get closed because uuidd is a long-running helper
daemon.  (Addresses Launchpad bug: #305057)</P>

<P>In order to avoid unnecessary full filesystem checks by e2fsck after
an on-line resize, e2fsck will ignore the NEEDS_RECOVERY flag set on
the backup superblocks.  (Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=471925" TARGET="_blank">#471925</A>)</P>

<P>Mke2fs will avoid trying to create the journal when run in
superblock-only mode (mke2fs -S), since the left-over journal in the
inode table will cause mke2fs to fail.</P>

<P>Fix a bug in libext2fs functions that check to see if a particular
device or filesystem image is mounted, which would cause these
functions to report that a file identical to the (relative) pathname
used by a pseudo-filesystem was mounted when in fact it was not.</P>

<P>Update Czech translation from the Translation Project.</P>

<P>Add Chinese (simplified) translation from the Translation Project.</P>

<P>Fix support for external journals (which was broken in e2fsprogs
1.41.4).</P>

<P>Fix a regression in debugfs where the "stat" command when no
filesystem was open would cause debugfs to crash with a segmentation
violation.</P>

<P>Starting in the 2.6.29 linux kernel, the ext4 filesystem driver can be
used to support filesystems without a journal.  Update the blkid
library so it understands this.</P>

<P>The blkid library will remove an entry from the blkid cache
representing the entire disk if partitions are found, since presumably
the device previously had no partition table, but has now transitioned
to using a partition table.</P>

<P>Add a check to mke2fs and tune2fs that the argument to the -m option
(which specifies the reserved ratio) must be greater than zero.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=517015" TARGET="_blank">#517015</A>)</P>

<P>Add support for tracking the number kilobytes written to the
filesystem via the superblock field s_kbytes_written.  It will be
updated by the kernel as well as by e2fsprogs programs which write to
the filesystem.  This is useful for tracking the wear to filesystems
on Solid State Drives.</P>

<P>Fix compatibility issue in the libext2fs info file and makeinfo
version 4.12.  (Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=481620" TARGET="_blank">#481620</A>)</P>

<P>Update/clarify man pages.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=515693"
  TARGET="_blank">#515693</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=365619" TARGET="_blank">#365619</A>)</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details. (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=506279" TARGET="_blank">#506279</A>)</P>

<H3>Programmer's Notes</H3>

<P>Fix Hurd compilation problem in e2fsck and tune2fs (Addresses Debian
Bug: #521602)</P>

<P>Fix various gcc compilation warnings and other programming cleanups.
(Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=486997" TARGET="_blank">#486997</A>)</P>

<P>Add support for building the blkid command statically.</P>

<P>Add support for disabling the built-in blkid library in favor of a
system-installed blkid implementation via the configure option
--disable-libblkid.</P>


<H2><A NAME="1.41.4">E2fsprogs 1.41.4 (January 27, 2009)</A></H2>

<P>Fixed a bug which could sometimes cause blkid to return an exit value
of zero for a non-existent device (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502541" TARGET="_blank">#502541</A>)</P>

<P>Blkid will now recognize ext3 filesystems that have the test_fs flag
set as ext3 filesystems.</P>

<P>The blkid library will now recognize btrfs filesystems and swap
devices currently used by user-level software suspend.</P>

<P>Tune2fs now updates the block group checksums when changing the UUID
to avoid causing e2fsck to complain vociferously at the next reboot.</P>

<P>Tune2fs's inode size resizing algorithms have been fixed so it is not
vastly inefficient for moderate-to-large filesystems, due to some
O(n**2) and O(n*m) algorithms that didn't scale well at all.</P>

<P>Fix tune2fs's inode resizing algorithm so it will not corrupt
filesystems laid out for RAID filesystems; in addition, tune2fs will
refuse to change the inode size for filesystems that have the flex_bg
feature enabled.  (This is a limitation in the current implementation
of tune2fs -I.)</P>

<P>E2fsprogs 1.41 broke debugfs's logdump command for normal ext3/4
filesystems with 32-bit block numbers, when the headers for 64-bit
block numbers was added.  This regression has been fixed.</P>

<P>Debugfs's ncheck command has been fixed to avoid printing garbage
characters at the end of file names.</P>

<P>Fix resize2fs for ext4 filesystems.  Some blocks that that need moving
when shrinking filesystems with uninit_bg feature would not be moved.
In addition, blocks and inode table blocks were not being correctly
freed when shrinking filesystems with the flex_bg feable, which caused
resize2fs -M to fail.  Finally, when blocks are moved, make sure the
uninitialized flag in extents is preserved.</P>

<P>Fix bug which caused dumpe2fs to abort with an error if run on a
filesystem that contained an external journal.</P>

<P>Some distributions used "mke3fs" as an alias for "mkfs.ext3"; check
for this in argv[0] to provide better legacy support for these
distributions.  This is a practice that should NOT be continued,
however.</P>

<P>Mke2fs now has a new option -U, which allows the user to specify the
UUID that should be used for the new filesystem.</P>

<P>Mke2fs will treat devices that are exactly 16TB as if they were 16TB
minus one block.  This allows users who have read that ext3 supports
up to 16TB filesystems and who create a 16TB LVM to not get confused,
since the true limit is really 16TB minus one block.</P>

<P>E2fsck will no longer abort an fsck run if block group has an errant
INODE_UNINIT flag.</P>

<P>E2fsck now distinguishes between fragmented directories and fragmented
files in verbose mode statistics and in the fragcheck report.</P>

<P>Fix a bug in e2fsck which caused it double count non-contiguous
extent-based inodes.</P>

<P>E2fsck will leave some slack space when repacking directories to allow
room for a few directory entries to be added without causing leaf
nodes to be split right away.</P>

<P>Fix a bug which caused e2fsck to crash when it comes across a
corrupted interior node in an extent tree with the error message:
"Error1: Corrupt extent header on inode XXXXXX"</P>

<P>E2fsck problem descriptions involving the journal are no longer
referred to as "ext3" problems, since ext4 filesystems also have
journals.</P>

<P>Fix a long-standing bug in e2fsck which would cause it to crash when
replying journals for filesystems with block sizes greater than 8k.</P>

<P>Update Catalan translation from the Translation Project.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details. (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=503057"
  TARGET="_blank">#503057</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502323"
  TARGET="_blank">#502323</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=511207" TARGET="_blank">#511207</A>)</P>

<H3>Programmer's Notes</H3>

<P>Fix build of e2fsck.profiled, and add support for building profiled
binaries in the misc directory if configured with --enable-profile.</P>

<P>The ext2fs_open() function now performs more sanity checks on the
superblock to avoid potential divide by zero errors by other parts of
library.</P>

<P>The ext2fs_read_inode_full() function now has a safety check to avoid
a segmentation fault on corrupted filesystems.</P>

<P>The ext2fs_new_inode() function now has a sanity check so that if the
s_first_inode field in the superblock is insane, it will return
EXT2_ET_INODE_ALLOC_FAIL instead of returning an invalid inode number.</P>

<P>To avoid segmentation faults, ext2fs_block_alloc_stats() and
ext2fs_inode_alloc_stats() now validates the passed inode or block
number to avoid overrunning an array boundary.</P>

<P>Various signed/unsigned errors for variables containing block numbers
have been fixed.</P>

<P>Accommodations for gcc's stupidity in not realizing that constant
strings that do not contain a '%' character are safe to use in format
strings have been made so that distributions that want to compile
e2fsprogs with -Werror=format-security have an easier time doing so.</P>

<P>Added a new 64-bit getsize interface, ext2fs_get_device_size2().</P>

<P>Added the utility make-sparse.c to the contrib directory.</P>

<P>The ext2fs_block_iterate2() function now reflects errors from
ext2fs_extent_set_bmap() to the caller, if the callback tries to
change a block on an extent-based file, and ext2fs_extent_set_bmap()
fails for some reason (for example, there isn't enough disk space to
split a node and expand the extent tree.</P>

<P>The ext2fs_block_iterate2() function will preserve the uninit flag in
extents when the callback function modifies a block in an extent-based
file.</P>

<P>E2fsck will now flag filesystems that have an insane s_first_ino field
in their superblock, and attempt to use a backup superblock to repair
the filesystem.</P>

<H2><A NAME="1.41.3">E2fsprogs 1.41.3 (October 12, 2008)</A></H2>

<P>E2fsck has been fixed so it prints the correct inode number for
uinit_bg related problems.</P>

<P>E2fsck will now offer to clear the test_fs flag if the ext4 filesystem
is available on linux.  This can be disabled via a configuration
option in /etc/e2fsck.conf.</P>

<P>Fix a file descriptor leak in libblkid when checking to see if an ext4
or ext4dev module exists.</P>

<P>Fix a bug in e2fsck where in preen mode, if there are disk I/O errors
while trying to close a filesystem can lead to infinite loops.
(Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=465679" TARGET="_blank">#465679</A>)</P>
    
<P>Fix a bug in resize2fs where passing in a bogus new size of 0 blocks
will cause resize2fs to drop into an infinite loop.  (Addresses Red
Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=465984" TARGET="_blank">#465984</A>)</P>
    
<P>Add a check in the Unix I/O functions in libext2fs so that when a
device is opened read/write, return an error if the device is
read-only using the BLKROGET ioctl.</P>

<P>Fix debugfs's ncheck command so that it prints all of the names of
hardlinks in the same directory.</P>

<P>Fix a bug in libblkid so it correctly detects whether the ext4 and
ext4dev filesystems are available, so that the ext4dev->ext4
fallback code works correctly.</P>

<H3>Programmer's Notes</H3>

<P>Fix a parallel build problem by making sure util/subst is built before
trying to build the lib/et directory.  (Addresses Sourceforge Bug:
#2143281)</P>

<P>Updated "make depend" information for crc16.o</P>


<H2><A NAME="1.41.2">E2fsprogs 1.41.2 (October 2, 2008)</A></H2>

<P>Fix e2fsck's automatic blocksize detection.  This fixes a regression
from e2fsprogs 1.40.7 which caused e2fsck to fail if the user
specifies a block number using the -b option if the blocksize option
isn't also specified using -B.  Unfortunately, users very commonly
invoke e2fsck using "e2fsck -b 32768 /dev/hdXXX" to use the backup
superblock; in fact e2fsck will often suggest this kind of command
line.  Oops.</P>

<P>Enhance the debugfs's "ncheck" command so it will print all of the
pathnames for the specified inodes.  (Previously, in some cases ncheck
might not print a pathname for an inode at all if some of the other
inodes had multiple hard links.)</P>

<P>Enhance debugfs's "hash" command so the hash seed can be specified via
a command-line option.  In addition, allow the hash algorithm to be
specified by name instead of just by number.</P>

<P>Fix e2fsck so that we don't accidentally print the translation file's
header when asking the user a custom question so there is no prompt
defined for a particular problem record.  For example, the question
"Run journal anyway" will get the PO header tacked on because e2fsck
erroneously passed the null string to _().  (Addresses Launchpad Bug:
#246892)</P>

<P>Enhance badblocks so that it can test a normal file which is greater
than 2GB.</P>

<P>Enhance the badblocks command so that it displays the time and
percentage complete when in verbose mode.  (Addresses Debian Bug:
#429739)</P>

<P>Fix a potential memory leak in a error handling path in debugfs's
ncheck function.</P>

<P>Fix a potential memory corruption problem if a memory allocation fails
in resize2fs.</P>

<P>Fix the usage message for debugfs's logdump command to be consistent
with its man manpage.</P>

<P>Update Polish, French, Vietnamese, Dutch, Indonesian, German, Czech,
and Swedish translations from the Translation Project.</P>

<P>Add documentation for the file I/O functions to the libext2fs.texinfo
file.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=484877" TARGET="_blank">#484877</A>)</P>
    
<P>Update and clarified various man pages.  (Addresses Launchpad Bug
#275272; Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=498100"
  TARGET="_blank">#498100</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=498101"
  TARGET="_blank">#498101</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=498102"
  TARGET="_blank">#498102</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=498103" TARGET="_blank">#498103</A>)</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details. (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=497619" TARGET="_blank">#497619</A>)</P>

<H3>Programmer's Notes</H3>

<P>Fix a potential file descriptor leak in libcom_err by setting the
close-on-exec flag for a fd used for debugging.  (Addresses Red Hat
Bugzilla <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=464689" TARGET="_blank">#464689</A>)</P>

<P>Fix a potential race in libcom_err by using sem_post/sem_init.  SuSE
has been carrying a patch for a long time to prevent a largely
theoretical race condition if a multi-threaded application adds and
removes error tables in multiple threads.  Unfortunately SuSE's
approach breaks compatibility by forcing applications to link and
compile with the -pthread option; using pthread mutexes has
historically been problematic.  We fix this by using sem_post/sem_init
instead.</P>

<P>Fix e2fsprogs-libs build failure due to 'subs' target.  (Addresses
Sourceforge Bug: #2087502)</P>

<P>Avoid linking e2initrd_helper, debugfs, blkid, and fsck with unneeded
libraries when using ELF shared libraries.</P>

<P>Fix ELF shared library when building on systems that don't already
have the e2fsprogs shared libraries already installed.  (Addresses
Sourceforge Bug: #2088537)</P>

<P>Fix the pkg-config files so they work correctly when linking with
static libraries and fix the include directory so programs don't have
to use #include <ext2fs/ext2fs.h>, but can use #include <ext2fs.h>
instead.  (Addresses Sourceforge Bug: #2089537)</P>
    
<P>Make sure ext2fs_swab64() is compiled for all platforms, and not just
for x86.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=497515" TARGET="_blank">#497515</A>)</P>
    
<P>Remove the unused ext2fs_find_{first,ext}_bit_set() functions for all
non-x86 platforms.  (They had been removed for x86 earlier.)</P>

<P>Fix diet libc compilation support, which had bitrotted due to lack of
TLC.  Fixing this improves general portability.</P>

<P>When installing the link library when using ELF shared libraries,
avoid using absolute pathnames if the link library and the shared
library are installed in the same directory.  (Addresses Sourceforge
Bug: #1782913)</P>

<P>Fix gen-tarball so it will work even if the top-level directory has
been renamed to something other than "e2fsprogs".  Also make
gen-tarball print the size of the resulting tar.gz file.</P>

<H2><A NAME="1.41.1">E2fsprogs 1.41.1 (September 1, 2008)</A></H2>

<P>Many people are forgetting to update their mke2fs.conf file, and this
causes ext3, ext4, and ext4dev filesystems won't get created with the
proper features enabled.  We address this in two ways.  First, mke2fs
will issue a warning if there is not definition for an ext3, ext4, or
ext4dev filesystem and the user is trying to create such a filesystem
type.  Secondly, when installing from a source build, "make install"
will provide basic configuration file handling for /etc/mke2fs.conf.
If it exists, and does not mention ext4dev, it will be moved aside to
/etc/mke2fs.conf.e2fpsrogs-old and the new /etc/mke2fs.conf file will
be installed.  If the existing /etc/mke2fs.conf file does mention
ext4dev, then "make install" will install official mke2fs.conf file as
/etc/mke2fs.conf.e2fsprogs-new and issue a message to the user that
they should look to see if any changes need to be merged.</P>

<P>The mke2fs program will now create the journal in the middle of the
filesystem, since this minimizes seek times on average for fsync-heavy
workloads.  In addition, mke2fs will now create journals using extents
for filesystems that support them.  This results in a more efficient
encoding for the journal since it eliminates the need for using
indirect blocks.</P>

<P>The mke2fs program will avoid allocating an extra block to the
journal.  (Addresses Sourceforge Bug: #1483791)</P>

<P>Mke2fs will correctly enforce the prohibition against features
(specifically read-only features) in revision 0 filesystems.  (Thanks
to Benno Schulenberg for noticing this problem.)</P>

<P>Mke2fs previously would occasionally create some slightly non-optimally
placed inode tables; this bug has been fixed.</P>

<P>The mke2fs and tune2fs programs now print the correct usage message
describing the maximum journal size.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=491620" TARGET="_blank">#491620</A>)</P>

<P>Add support for setting the default hash algorithm used in b-tree
directories in tune2fs (from a command-line option) or mke2fs (via
mke2fs.conf).  In addition, change the default hash algorithm to
half_md4, since it is faster and better.</P>

<P>The blkid library will now recognize MacOS hfsx filesystems, and
correctly extract the label and uuid for hfs, hfsx, and hfsplus
filesystems.  (Addresses Sourceforge Feature Requests: #2060292)</P>

<P>The blkid library has improved detection of JFS and HPFS filesystems.
(Addresses Launchpad Bug: #255255)</P>

<P>The blkid library is now much more efficiently handling devicemapper
devices, mainly by no longer using the devicemapper library.  This can
speed up access for systems with a large number of device mapper
devices.</P>

<P>Blkid had a number of cache validation bugs in libblkid that have been
fixed.   (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=493216" TARGET="_blank">#493216</A>)</P>

<P>Resize2fs will now properly close out the "updating inode references"
progress bar so there is a newline printed before printing the final
"resize is successful" message.</P>

<P>Resize2fs will now correctly handle filesystems with extents and/o
uninitialized block groups correctly when file/directory blocks need
to relocated (i.e., when shrinking a filesystem or if the resize_inode
is not present).  To support this, the ext2fs library now supports
initializing inode and block bitmaps that are not yet initialized when
allocating them using ext2fs_new_block() and ext2fs_new_inode().  In
addition, e2fs_block_iterate2() can now support changing the location
of interior nodes of an extent tree, and ext2fs_extent_set_bmap() has
been optimized to avoid creating unnecessary new extents when updating
the location of blocks in the extent tree.  This will also help out
e2fsck's recovery of obscurely corrupted filesystems with extents,
when blocks are claimed by multiple inodes.</P>

<P>Add support for on-line resizing ext4 filesystem with the flex_bg
filesystem feature.  The method for doing so is not optimal, but to do
a better job will require kernel support.</P>

<P>E2fsprogs 1.41.0 introduced a bug in libext2fs which casued e2image and
debugfs programs to not be able to read e2image files; the signed
vs. unsigned bug in the code which read bitmaps from the e2image has
been fixed.   (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=495830" TARGET="_blank">#495830</A>)</P>

<P>Resize2fs is now correctly managing the directory in-use counts when
shrinking filesystems and directory inodes needed to be moved from one
block group to another.  This bug has been around since e2fsprogs
1.26, and is largely harmless, but does cause a filesystem corruption
which will be flagged by e2fsck after the filesystem has been shrunk.</P>
 
<P>E2fsck will no longer issue spurious complaints about the inode size
caused by very large extent-based files, and by blocks reallocated
using fallocate() with the FALLOC_FL_KEEP_SIZE option.  (Addresses
Kernel Bugzilla:
  <A HREF="https://bugzilla.kernel.org/show_bug.cgi?id=11341" TARGET="_blank">#11341</A>)</P>

<P>Mke2fs will now set the creation timestamp on the lost+found directory
and the root directory.  (More generally, all new inodes created using
the ext2fs library will correctly set the creation timestamp.)</P>

<P>E2fsck now correctly calculates ind/dind/tind statistics in the
presence of extent-based files.  In addition, "e2fsck -v" will report
statistics of the depth of extent trees in the filesystem.  E2fsck can
also give an inode fragmentation report using "e2fsck -E fragcheck"
which can be useful when debugging the kernel block allocation
routines.</P>

<P>Fix support for empty directory blocks in ext4 filesystems with 64k
blocksize filesystems.</P>

<P>E2fsck will now print the depth of corrupt htree directories.</P>

<P>Debugfs's htree command now correctly understands extent-based
directories.  It will also print out the minor hash as well as the
major hash.</P>

<P>Debugfs has a new command which will print the supported features of
e2fsprogs, to enable scripts to know whether the installed version of
e2fsprogs can support a specific feature.</P>

<P>Debugfs will now write files using extents for filesystems that
support them.</P>

<P>The error message printed by "tune2fs -I" if the inode size was too
small was rather confusing, so it has been improved.  Also, we won't
try to create an undo log until we know that command-line-specified
parameters such as "tune2fs -I <inode size>" are valid.</P>

<P>Given some filesystems found "in the wild" that had non-zero block
group checksums even though the uninit_bg/gdt_sum feature was not
enabled, e2fsck would issue spurious error messages.  Teach
ext2fs_group_desc_csum_verify() to ignore the block group checksum
entirely if the feature flag is not set.  (Addresses Debian Bug:
#490637)</P>

<P>The blkid program will now print out a user-friendly listing of all of
the block devices in the system and what they contain when given the
-L option.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=490527" TARGET="_blank">#490527</A>)</P>

<P>The filefrag program now has a more accurate calculation for the
number of ideal extents.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=458306" TARGET="_blank">#458306</A>)</P>

<P>The test I/O manager is now enabled by default, but its overhead is
only incurred when it would be enabled via the TEST_IO_FLAGS or
TEST_IO_BLOCK environment variables.</P>

<P>Typographical errors in various program strings and usage messages
have been fixed; most of these were pointed out by the e2fsprogs
message catalog translators.  (Thanks, translators!)</P>

<P>Update and clarified various man pages, as well as some typographical
errors in the libext2fs texinfo file.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.</P>

<P>Add Indonesian and update French, Polish, Dutch, German, Swedish,
Czech, and Vietnamese Translations.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=313697" TARGET="_blank">#313697</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=401092" TARGET="_blank">#401092</A>)</P>

<h3>Programmer's Notes</H3>

<P>Fix portability problem with the badblocks group; for systems that
don't have nanosleep(), try using usleep() instead.</P>

<P>The "make check" target in the e2fsck directory now sets
LD_LIBRARY_PATH before running the various e2fsck internal library
regression tests.</P>

<P>The crc32 regression test in the e2fsck library is now portable to
greater variety of environments, including big-endian systems and
when cross-building e2fsprogs for embedded systems.  (Addresses
Sourceforge Bug: #2019287)</P>

<P>The ext2fs_extent_set_bmap() had some bugs when setting the first
block in a file, or when replacing a single block extent.  Those cases
fortunately were came up relatively rarely when e2fsck was checking
files, but caused some problems when resize2fs was shrinking
extent-based files.</P>

<P>Fix a potential core-dumping bug in libe2p's iterate_on_dir()
function.</P>

<P>Various ext2fs library functions --- ext2fs_block_iterate2(),
ext2fs_initialize() and ext2fs_extent_open() --- now correctly free
allocated memory to avoid memory leaks in all of their error return
paths.</P>

<P>Ext2ed was failing to build because masix support had been removed in
the rest of e2fsprogs, so ext2ed no longer has masix support, either.</P>

<P>The configure script now respects the LDFLAGS environment variable if
it is set when configure is called.  (Addresses Sourceforge Feature
Request: #1937287)</P>

<P>Libuuid is now more portable to the Windows platform.  (Addresses
Sourceforge Feature Request: #1937287)</P>

<P>The configure script now uses AC_MSG_{RESULT,WARN,ERROR} instead of
bare echo commands so that configure flags such as --quiet work
correctly.  (Addresses Sourceforge Patches: #2058794)</P>

<P>A few uses of sprintf have been removed from the ext2fs library to
make life easier for bootloaders with a limited libc environment.
(Addresses Sourceforge Bug: #2049120)</P>

<P>The ext2fs_read_inode() checks the validity of the inode number passed
to it earlier, to avoid doing some needless work when it would fail
anyway.</P>

<P>The ext2fs_open() checks the validity of the blocksize parameter
passed to it earlier, to avoid doing some needless work when it would
fail anyway.</P>

<P>Disable a very annoying automatic "%.sh -> %" GNU make rule in the
top-level Makefile.  That automatic rule is used to better support
SCCS, but it caused problems for a particular niche distribution which
likes to use configure.sh files to store the configure options used to
build a package.  Unfortunately GNU make will use the configure.sh to
replace the configure script, resulting in a self-inflicted fork bomb
leading to an out-of-memory crash.</P>

<P>To support old GNU C compilers don't use C99/C++ comments, but only
K&R style comments, and don't try to use __builtin_expect if __GNUC__
is less than 3.  (__builtin_expect is only supported for gcc versions
2.96 and up, and it's tricky to check for gcc 2.95 vs gcc 2.96; since
this is an optimization, we only try to use __builtin_expect for gcc 3
and up.)</P>

<P>In e2fsck's crc routines, make sure we use WORDS_BIGENDIAN instead of
__LITTLE_ENDIAN, which are only defined by glibc's header files and
hence isn't portable.</P>

<P>For the convenience for some distributions that need a static tune2fs,
the Makefile for misc/ now has a tune2fs.static target.</P>

<P>The ext2fs_block_iterate2() function now supports BLOCK_FLAG_APPEND
for extent-based files</P>

<P>The ext2fs_bmap() function now supports BMAP_ALLOC for extent-based
files.</P>

<P>All source files no longer have any trailing white space.</P>

<P>The io_channel_read_blk64() and io_channel_write_blk64() functions are
now functions instead of C preprocessor macros to provide better
forward compatibility.</P>

<P>The e2fpsrogs translation template now expands the @x abbreviation.</P>

<P>Various namespace leakages in libblkid, libe2p, and libext2fs have
been fixed.</P>

<P>Fix a parallel build problem in e2fsprogs.</P>

<P>E2fsprogs is now more portable to Solaris.
<UL>
<LI> blkid no longer assumes that the TIOCGSIZE and TIOCGWINSZ ioctl's
    are always present.
<LI> Scripts do not assume that /bin/true is always in /bin
<LI> Don't use __FUNCTION__ since Solaris's C99 doesn't support it.
<LI> Flush stdio handles before calling setbuf(), since Solaris will
    discard any pending output to the stream.
<LI> Define _XOPEN_SOURCE to 600 since Solaris's header files are very
    picky about which C compiler can be used for SUSv3 conformance.
    Use of C99 is not compatible with SUSv2 (_XOPEN_SOURCE=500),
    and C89 is not compatible with SUSv3 (_XOPEN_SOURCE=600).
    Since we need some SUSv3 functions, consistently use SUSv3 so
    that e2fsprogs will build on Solaris using c99.
<LI> Solaris C99 does not support varargs C preprocessor macros
<LI> Solaris header files pollute the C namespace if in/netinet.h
    is included, which conflicts with e2fsprogs' use of the kmem_cache_t
    typedef.
<LI> Solaris ships with a pathetically ancient shell in /bin/sh so we
    avoid the use of various more advanced shell constructs such as $().]
</UL></P>

<P>The "make rpm" command will now take some extra configure options from
the build environment without needing to patch the source tree.</P>

<P>The ext2fs_add_dir_block() function will now grow the dblist more
aggressively as an optimization to avoid copying the array too often.</P>

<P>The e2fsck_write_bitmaps() will write the block and inode bitmaps
together instead of in two passes.</P>


<H2><A NAME="1.41.0">E2fsprogs 1.41.0 (July 10, 2008)</A></H2>

<P>Add support for ext4 filesystem features, in particular extents,
uninit_bg, flex_bg, huge_file, and dir_nlink features.  Also add
support for checking journal checksums.  Debugfs will print new
superblock and inode fields that were defined for ext4.  For example,
the nanosecond and i_version fields of an inode, and the
s_min_extra_isize and s_wanted_extra_isize fields from the superblock.
Note: Resize2fs doesn't currently support the combination of flex_bg
and !resize_inode.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=388452"
  TARGET="_blank">#388452</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=425477" TARGET="_blank">#425477</A>)</P>

<P>Tune2fs can support migrating a filesystem from using 128 byte inodes
to 256 byte inodes, so it can take advantage of the full features of
ext4.</P>

<P>Add support for "undo" support.  E2fsck and mke2fs can optionally
record an undo log which can replayed by the program e2undo.</P>

<P>E2fsck could damage a filesystem by trying to relocate inode tables
due to corrupted block group descriptors, where the attempted inode
table relocation would do far more harm than good.  E2fsck has been
fixed to detect this these sorts of corrupted block group descriptors
much earlier in e2fsck processing, so it can try to use the backup
superblock and block group descriptors first.  This should be a much
better strategy for recovering these types of corrupted filesystems.
(Addresses Sourceforge Bug: #1840291)</P>

<P>E2fsck will display a more understandable message when the last check
field in the superblock is in the future.  (Addresses Debian Bug:
#446005).</P>

<P>E2fsck now performs more extensive and careful checks of extended
attributes stored in the inode.</P>

<P>Enhance mke2fs to print a more explanatory error message when
ext2fs_get_device_size() returns EFBIG.  (Addresses Debian Bug:
#488663)</P>

<P>Fix mke2fs to use a default block size of 4k when formatting an
external journal device.  This is done by using a fixed filesystem
type list that consists only of the single filesystem type "journal"
when looking up configuration keys in /etc/mke2fs.conf.  (Addresses
Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=488663" TARGET="_blank">#488663</A>)</P>

<P>Speed up how mke2fs writes the journal data blocks by writing the disk
blocks in larger chunks.</P>

<P>Fix blkid handling of stale devices.  Fix a bug which could cause a
core dump while garbage collecting the blkid cache, and assure that
blkid_find_dev_with_tag() never returns a non-existent device.  Also,
if a filesystem is found at a new /dev location, eliminate any
duplicate stale entries which can not be verified.
(Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=487758"
  TARGET="_blank">#487758</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=487783" TARGET="_blank">#487783</A>)</P>
    
<P>Add more paranoid checks for LVM volumes and swap partitions in
blkid's probe function, to reduce the chances of false positives.</P>

<P>The mke2fs program now has a much more sophisticated system for
controlling configuration parameters of a newly created filesystem
based on a split filesystem and usage type system.  The -t option to
mke2fs was a deprecated alias to -c; it now specifies a filesystem
type (ext2, ext3, ext4, etc.), while the -T option can now be a comma
separated usage list.  The filesystem type information and type
information is used to extract configuration parameters from the
/etc/mke2fs.conf file.</P>

<P>The mke2fs program will no longer complain and request the -f option
when the user tries to create a filesystem with greater than 2**31
blocks.</P>

<P>When creating a filesystem for the GNU Hurd use a fs-type of Hurd and
adjust the mke2fs.conf file so filesystems for the Hurd are created
with a blocksize of 4096 and inode size of 128, which is all it knows
how to handle.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=471977" TARGET="_blank">#471977</A>)</P>
    
<P>Mke2fs will always make sure that lost+found always has at least 2
blocks, even for filesystems with very large blocksizes (i.e., 64kb).</P>

<P>Resize2fs will now print the minimum needed filesystem size if given
the -P option, and will resize the filesystem to the smallest possible
size if given the -M option.</P>

<P>Fix resize2fs to clean up the resize_inode if all of the reserved gdt
blocks are consumed during an off-line resize.</P>

<P>The "ls" command in debugfs now supports the -p option, which causes
it to quote the filenames so that spaces or tabs in directory entries
are easily visible.  (Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=149480" TARGET="_blank">#149480</A>; Addresses
Sourceforge Feature Request: #1201667)</P>

<P>Fix a potential off-by-one buffer overflow in the fs_device_name in an
e2image file.</P>

<P>The chattr program will return a non-zero exit code in case of
failures, and error messages can be suppressed with the -f option.
(Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=180596" TARGET="_blank">#180596</A>)</P>

<P>Fix a bug in badblocks which caused it to overrun an array and likely
crash if more than 8 test patterns are specified using the -t option.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=487298" TARGET="_blank">#487298</A>)</P>
    
<P>Add support to badblocks to limit how quickly it reads from the disk
drive (so it can be used for background scrubbing), and so it will
abort after finding a given number of errors.</P>

<P>Remove support for the legacy big-endian filesystem format which only
existed on extremely long-dead PowerPC kernels almost a decade ago.</P>

<P>Remove MASIX support from e2fsprogs.</P>

<P>Add I/O statistics reporting to e2fsck.</P>

<P>Update Vietnamese, Polish, French, Spanish, German, Catalan, Dutch,
Czech translations.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=487443"
  TARGET="_blank">#487443</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=487675"
  TARGET="_blank">#487675</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=490003" TARGET="_blank">#490003</A>)</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.
(Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=393313"
  TARGET="_blank">#393313</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=487849"
  TARGET="_blank">#487849</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=440983"
  TARGET="_blank">#440983</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=440981" TARGET="_blank">#440981</A>)</P>

<H3>Programmer's Notes</H3>

<P>Factor out bitmap code in preparation for adding 64-bit new-style
bitmaps.</P>

<P>Fix gcc -Wall warnings</P>

<P>Fix the pkg-config files so that private libraries are specified in
"Libs.private:".</P>

<P>Fix the libext2fs.texinfo manual so it builds with modern versions of
texinfo.</P>

<P>Silence the makefile from showing the awk command used to build the</P>

<P>Clean up the badblocks group so to make it more portable and robust.</P>

<P>Avoid using predictable filenames in /tmp in blkid's regression test
suite.  Also remove bashism's in the regression test script.</P>

<P>If the configure script is given --with-diet-libc, don't use thread
local storage, since diet libc doesn't support TLS.  (Addresses
Sourceforge Bug: #2000654)</P>
    
<P>Fix the blkid regression test suite to tolerate older versions of
mkswap that don't support the -U option.</P>

<P>A few library routines have been converted to support 64-bit block
numbers; in particular, the I/O manager functions, the test_io,
inode_io, and unix_io managers have all be converted to support 64-bit
operation.</P>

<P>Debugfs can now be extended for use by test programs.  See
lib/ext2fs/extents.c for an example for how it can be used.  The test
program links against the debugfs object files, and provides
additional commands by defining an auxiliary libss command table.</P>

<P>The lazy_bg filesystem feature, which was only used by developer's
testing, has been removed since it has been largely supplanted by
uninit_bg.  This also simplifies the code.</P>

<H2><A NAME="1.40.11">E2fsprogs 1.40.11 (June 17, 2008)</A></H2>

<P>Mke2fs, tune2fs, and resize2fs now use floating point to calculate the
percentage of reserved blocks.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=452639" TARGET="_blank">#452639</A>)</P>

<P>Updated Spanish and Catalan translations.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=483962"
  TARGET="_blank">#483962</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=483023" TARGET="_blank">#483023</A>)</P>

<P>Add detection for ZFS volumes to the libblkid library.</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=486463" TARGET="_blank">#486463</A>)</P>

<H3>Programmer's notes</H3>

<P>Fix marginal C code in probe_lvm2() function to the blkid library more
portable for older compilers.</P>

<P>Fix build problems on MacOS X.  (Addresses Sourceforge Bug: #1972473)</P>

<P>Fix ext2fs_swap{16,32,64} functions so they can be used by external
applications on big-endian machines.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=484879" TARGET="_blank">#484879</A>)</P>


<H2><A NAME="1.40.10">E2fsprogs 1.40.10 (May 21, 2008)</A></H2>

<P>When deciding whether or not to revalidate a blkid cache entry, if the
device's mtime is newer than the last time the cached entry was
validated, force a revalidation.</P>

<P>Fix a potential data corruption bug in e2fsck in the journal replay.
The chances of this is happening is extremely remote, especially the
default data=ordered or data=writeback modes.  However, if a block
which has been journalled starts with the first four bytes 0xc03b3998,
when e2fsck replays the journal, those four bytes will be replaced
with zero's.  Fortunately, it is highly, highly unlikely for e2fsck
metadata to begin with those fatal 4 byte sequence, and unless
data=ordered mode is in use, data blocks are never journalled.</P>

<P>Updated German, Dutch, Swedish, and Vietnamese translations.</P>

<H3>Programmer's notes</H3>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.</P>

<P>Remove default sizes of types when cross compiling, since autoconf
2.50 can figure this out automatically now.</P>

<H2><A NAME="1.40.9">E2fsprogs 1.40.9 (April 27, 2008)</A></H2>

<P>SuSE's security team audited uuidd and came up with a few minor
issues.  None of them are serious given that uuidd runs setuid as a
unprivileged user which has no special access other than libuuid
directory, but it's good to get them fixed.</P>

<P>One additional fix in ext2fs_swap_inode_full() needed for resize2fs to
work correctly with in-inode extended attributes.</P>

<P>Updated German, Czech, Dutch, French, Polish, Swedish, and Vietnamese
translations.</P>

<P>Debugfs will avoid using a pager if the standard output is not a tty.</P>

<P>Fix debugfs and tune2fs to correctly handle daylight savings time when
parsing a time string.</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.</P>

<P>Fix fsck completion bars when multiple filesystems were being checked
in parallel.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=432865" TARGET="_blank">#432865</A>, Addresses Launchpad Bug:
#203323, Addresses Sourceforge Bug: #1926023)</P>

<P>Fix fsck so that progress information is sent back correctly when
multiple filesystems are being check and the output of fsck is being
redirected to a file descriptor.  Also, include the device name (w/o
spaces) in the progress information sent back via a file descriptor.
(Addresses Launchpad Bug: #203323, Addresses Sourceforge Bug:
#1926023)</P>

<P>Teach fsck to treat "ext4" and "ext4dev" as ext* filesystems.</P>

<P>If logsave receives a SIGTERM or SIGINT signal, it will now pass that
signal to its child process.</P>

<P>Fix mke2fs's creation of are resize inode when there is a non-standard
s_first_data_block setting.</P>

<P>Fix bug in blkid when run by an unprivileged user; most devices were
not reported correctly.  9Addresses Launchpad Bug: #220275)</P>

<P>Mke2fs will not allow the logically incorrect combination of
resize_inode and meta_bg, which had previously caused mke2fs to create
a corrupt filesystem.</P>

<P>Fix fsck in German locales so that a 'j' means yes.
(Addresses Sourceforge Bug: #1947683)</P>

<h3>Programmer's notes:</h3>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.</P>

<P>Update valgrind options in test_script to work with valgrind 3.2.3</P>

<P>Update texinfo.tex to a much newer version from the FSF.</P>

<P>Remove bashism for configure script and from the lib/ss Makefile.
Addresses Sourceforge Bug: 1921969</P>

<P>Fix some silently broken tests: m_no_opt, m_meta_bg, and m_raid_opt.</P>

<P>Fix build system so that if texinfo is not installed, it won't print a
(harmless) error message.</P>

<H2><A NAME="1.40.8">E2fsprogs 1.40.8 (March 13, 2008)</A></H2>

<P>Fixed e2image -I so it works on image files which are larger than 2GB.</P>

<P>Fixed e2fsck's handling of directory inodes with a corrupt size field.  If
the size is larger than the number of blocks found in the inode, don't
try to allocate extra empty blocks at the end of the directory to make
up the difference; there's no point to doing that.  In addition, if
the size is not a multiple of a blocksize, always fix it.</P>

<P>E2fsck handled a pass 2 "should never happen error" by not giving
enough information and then core dumping.  Unfortunately, it was all
too easy to trigger the "should never happen" situation if a
directory's inode size was not correct.  This has been fixed, but
e2fsck has also been taught how to handle this situation more
gracefully, by simply removing the inode hash tree information, so
that it can be rebuilt again after e2fsck's pass 3.  (Addresses
Launchpad Bug: #129395)</P>

<P>Resize2fs had a bug resizing large inodes with extended attributes
that was fixed in 1.40.6; unfortunately, it turned out it wasn't fixed
completely on big-endian systems such as PowerPC.  The bug should be
completely fixed now.  Yay for regression test suites.  (Addresses Red
Hat Bugzilla: #434893)</P>

<P>Updated German, Czech, Dutch, Polish, Swedish, and Vietnamese
translations.  Many thanks to Philipp Thomas from Novell for stepping
up to become the new German translation maintainer!  (Addresses Debian
Bugs: #302512, #370247, #401092, #412882).</P>

<P>When e2fsck is clearing a corrupt inode's HTREE directory information,
make it clear that it is just clearing the HTREE information, not the
entire inode.</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.  </P>

<H3>Programmer's notes</H3>

<P>Add new functions, ext2fs_dblist_get_last() and
ext2fs_dblist_drop_last(), which allows the caller to examine the last
directory block entry added to the list, and to drop if it necessary.</P>

<P>Fixed a portability problem in libblkid with DJGPP.</P>

<P>Fix an obvious typo in an "internal error" message in e2fsck.  Thanks
to Philipp Thomas for pointing this out.</P>

<P>If the info files are not built, change "make install" so it doesn't
fail with an error code.</P>

<H2><A NAME="1.40.7">E2fsprogs 1.40.7 (February 28, 2008)</A></H2>

<P>Remove support for clearing the SPARSE_SUPER feature from tune2fs, and
depreciate the -s option, since it can result in filesystems which
e2fsck can't fix easily.  There are very good reasons for wanting to
disable sparse_super; users who wants to turn off sparse_super can use
debugfs.  (Addresses Sourceforge Bug: #1840286)</P>
    
<P>Add missing options to mke2fs's usage message.  (Addresses Sourceforge
Bug: #1751393)</P>
    
<P>Fix bug in resize2fs when large (greater than 128 byte) inodes are
moved when a filesystem is shrunk; it was only moving the first 128
bytes, so extended attributes were not getting moved.  (Addresses Red
Hat Bugzilla: #434893)</P>

<P>E2fsck now prints an explicit message when the bad block inode is
updated, to avoid confusion about why the filesystem was modified.
(Addresses Sourceforge Bug: #756460)</P>
    
<P>Allow mke2fs and tune2fs manipulate the large_file feature.
Previously we just let the kernel and e2fsck do this automatically,
but e2fsck will no longer automatically clear the large_file feature.
It still isn't really necessary to worry about this feature flag
explicitly, but some users seem to care.  (Addresses Red Hat Bugzilla:
<A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=258381" TARGET="_blank">#258381</A>)</P>
    
<P>Suppress message about an old-style fstab if the fstab file is empty.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=468176" TARGET="_blank">#468176</A>)</P>
    
<P>Fix (really minor) bug in debugfs's find_free_block so it avoids
reporting a free block more than once if there are too few free blocks
in the filesystem.  (Addresses Sourceforge Bug: #1096315)</P>
    
<P>Change e2fsck to no longer clear the LARGE_FILES feature flag
automatically, when there are no more > 2GB files in the filesystem.
It's been almost a decade since there have been kernels that don't
support this flag, and e2fsck clears it quietly without telling the
user why the filesystem has been changed.</P>
    
<P>Fix bug which could cause libblkid to seg fault if a device mapper
volume disappears while it is being probed.  (Addresses RedHat
Bugzilla: #433857)</P>
    
<P>Enhance e2fsck's reporting of unsupported filesystem feature flags.
(Addresses Sourceforge Feature Request: #1175808)</P>
    
<P>Fix option syntax in dumpe2fs for explicit superblock and blocksize
parameters.  What was currently documented in the man page has been
broken for some time, due to getopt() implementation changes.  The
option syntax has been changed to one which is can be more portable
supported and which is consistent with the format for extended options
in mke2fs and tune2fs.  (Addresses Sourceforge Bug: #1830994)</P>
    
<P>Add support to tune2fs to clear the resize_inode feature.  This
requires an fsck afterwards.  (Addresses Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=167816" TARGET="_blank">#167816</A>)</P>

<P>Teach blkid to detect LVM2 physical volumes.  (Addresses Red Hat
Bugzilla: <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=409321" TARGET="_blank">#409321</A>)</P>

<P>Add support for setting RAID stride and stripe-width via mke2fs and
tune2fs.  Teach dumpe2fs to print the RAID parameters.</P>

<P>Add support for setting new superblock fields to debugfs's
set_super_value.</P>

<P>Add support for printing "mostly-printable" extended attributes in
Debugfs.</P>

<P>Add support for the -M option to fsck, which causes it to ignore
mounted filesystem.</P>

<P>Fix uuidd so that it creates the pid file with the correct pid number.
(Addresses Sourceforge Bug: #1893244)</P>

<P>Fix various gcc -Wall warnings.</P>

<P>Update Czech, Dutch, Polish, Swedish, and Vietnamese translations</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.  
(Addresses Sourceforge Patch: #1399325)</P>

<H3>Programmer's notes</H3>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=466929" TARGET="_blank">#466929</A>)</P>

<P>Add new flag EXT2_FLAG_NONFREE_ON_ERROR ext2fs_open2() which returns a
partially filled-in filesystem object on an error, so that e2fsck can
print more intelligent error messages.</P>
    
<P>Add a new function e2p_edit_feature2() which allows the caller to
specify which feature flags are OK to set or clear, and which returns
more specific information about feature flags which are not allowed to
be set/cleared.</P>
    
<P>Set the C locale in the test_script driver since it uses [A-Za-z].
(Addresses Sourceforge Bug: #1890526)</P>

<P>Use fcntl locking instead of lockf in libuuid since Cygwin doesn't
support lockf().</P>

<P>Change configure.in to avoid using the 'dc' command unless it is
absolutely needed. (i.e., when using parsing a WIP-style version
number)  (Addresses Sourceforge Bug: #1893024)</P>

<P>Add portability checks to support compilation under DJGPP.</P>

<P>Update to the latest samba tdb code before the LGPLv3 change, which
fixes a realloc() leak on failure.</P>

<P>Fix memory leak in ext2fs_alloc_block().</P>

<P>Fix makefile dependency issues for various install targets.
(Addresses-Sourceforge-Patches: #1903484, #1903466, #1903456)</P>
    
<P>Improve descriptions for the r_move_itable and r_resize_inode tests.</P>

<H2><A NAME="1.40.6">E2fsprogs 1.40.6 (February 9, 2008)</A></H2>

<P>Add support for returning labels for UDF filesystems in the blkid
library.</P>

<P>Fix bug in the blkid library where cached filesystems was not being
flushed when opening USB devices returned the error ENOMEDIUM.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=463787" TARGET="_blank">#463787</A>)</P>

<P>Added logic to the blkid library to automatically choose whether a
filesystem should be mounted as ext4 or ext4dev, as appropriate.</P>

<P>Allow tune2fs to set and clear the test_fs flag on ext4 filesystems.</P>

<P>Fix a bug in e2fsck which caused it to core dump if e2fsprogs had been
configured with --enable-jbd-debug.</P>

<P>Document the BLKID_FILE environment variable in the libblkid man page</P>

<H3>Programmer's Notes</H3>

<P>Update e2fsprogs translation template and Vietnamese and Czech translations</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=436058" TARGET="_blank">#436058</A>)</P>

<P>Don't try to create $DESTDIR/etc/init.d as part of make install as we
don't install the init.d script (and it's not the recommended way to
start uuidd anyway).  (Addresses Sourceforge Bug: #1885085)</P>

<P>Use thread local storage to fix a theoretical race condition if two
threads try to format an unknown error code at the same time in the
com_err library.</P>

<H2><A NAME="1.40.5">E2fsprogs 1.40.5 (January 27, 2008)</A></H2>

<P>Fix a potential overflow big in e2image if the device name is too
long.</P>

<P>Mke2fs will now create new filesystems with 256 byte inodes and the
ext_attr feature flag by default.  This allows for much better future
compatibility with ext4 and speeds up extended attributes even on ext3
filesystems.</P>

<P>Teach e2fsck to ignore certain "safe" filesystem features which are
set automatically by the kernel.  Having the kernel set features
automagically behind the user's back is a bad idea, and we should try
to break the kernel of this habit, especially for the newer ext4
feature flags.  But for now, we will try to avoid needless full checks
which can annoy users who are doing fresh installs.</P>

<P>Add support in tune2fs and mke2fs for making a filesystem as being "ok
to be used with test kernel code".  This will be needed for using test
filesystems with the latest ext4 kernel code.</P>

<P>Change e2fsck -fD so that it sorts non-htree directories by inode
numbers instead of by name, since that optimizes performances much
more significantly.  (Addresses-Sourceforge-Feature-Request: #532439)</P>

<P>If e2image fills the disk, fix it so it exits right away instead of
spewing large numbers of error messages.
(Addresses-Sourceforge-Feature-Request: #606508)</P>

<P>If ftruncate64() is not available for resize2fs, let it use ftrucate()
instead, but have it check to see if the size would get truncated, and
skip calling ftruncate in that case.</P>

<P>Add support for detecting HFS+ filesystems in the blkid library.</P>

<P>Add support in the blkid library for ext4/ext4dev filesystems.</P>

<P>Fix a bug in blkid where it could die on a floating point exception
when presented with a corrupt reiserfs image.</P>

<P>Fix blkid's handling of ntfs UUID's so that leading zeros are printed
such that UUID string is a fixed length.</P>

<P>Add sample python bindings for the uuid library to the contrib
directory.  (Addresses-Sourceforge-Patches: #778817)</P>

<P>Fix debugfs's 'lsdel' command so it uses ext2fs_block_iterate2 so it
will work with large files.  (Addresses Sourceforge Feature Request:
#1257500 and Sourceforge Support Request: #1253511)</P>
    
<P>Allow the debugfs 'undel' command to undelete an inode without linking
it to a specific destination directory, since this might require
allocating blocks that could overwrite some yet-to-be-recovered
deleted files.  (Addresses-Sourceforge-Feature-Request: #967141)</P>

<P>Update Swedish translations from the Translation Project.</P>

<H3>Programmer's Notes:</H3>

<P>Fix configure handling of --sbindir (which should rarely be used, but
someone did complain, so let's fix it).  (Addresses Sourceforge Bug:
#498381)</P>

<P>Updated e2fsprogs.spec file to include a new uuidd package</P>

<P>Use pkg-config to determine where to find the devmapper library so we
can find out where it is located on different distributions.</P>

<P>Fix Makefile race so that "make -j3 distclean" works correctly</P>

<P>Fix portability problems on non-Linux/non-Hurd/non-Masix systems,
especially on MacOS X systems.  (Addresses Sourceforge Bugs: #1861633,
#1819034, #1863819)</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=459403"
  TARGET="_blank">#459403</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=459475"
  TARGET="_blank">#459475</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=459614" TARGET="_blank">#459614</A>)</P>

<P>Remove the --enable-dynamic-static configure option, and build e2fsck
dynamically by default.  If the user wants e2fsck.static, he/she will
need to build it via "make -C e2fsck e2fsck.static"</P>

<P>Fix various build warnings due to missing prototypes.
(Addresses Sourceforge Patch: #1861663, #1861659)</P>

<H2><A NAME="1.40.4">E2fsprogs 1.40.4 (December 31, 2007)</A></H2>

<P>Improve time-based UUID generation.  A new daemon uuidd, is started
automatically by libuuid if necessary.  This daemon is setuid to allow
updates to /var/lib/libuuid, so the clock sequence number can be
stored and so if the clock is set backwards, it can be detected.
(Addresses Sourceforge Bug: #1529672, Addresses Red Hat Bugzilla:
<A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=233471" TARGET="_blank">#233471</A>)</P>

<P>Filter out the NEEDS_RECOVERY feature flag when writing out the backup
superblocks.  This avoids e2fsck from concluding that a full
filesystem check is required before backing up the superblock due to
changes in the feature flags.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=454926" TARGET="_blank">#454926</A>)</P>

<P>Fix fsck to only treat the '#' character as a comment at the beginning
of the line in /etc/fstab.  Otherwise fstabs for the fuse filesystem
will cause fsck to issue an bogus warning message.
(Addresses Gentoo bug: #195405, Addresses Sourceforge bug: #1826147)</P>

<P>Format control characters and characters with the high eighth bit set
when printing the contents of the blkid cache, to prevent filesystems
with garbage labels from sending escape sequences to the user's screen
that might, for example place it in graphics mode.  (Addresses Ubuntu
Bug: #78087)</P>

<P>Fix sign-extension problem on 64-bit systems in in the com_err
library.  (Addresses Sourceforge Bug: #1809658)</P>

<P>Avoid division by zero error when probing an invalid FAT filesystem in
the blkid library.  (Addresses Sourceforge Bug: #1831627)</P>

<P>Update Dutch, Polish, and Vietnamese translations from the Translation
Project.  Remove the Rwandan translation upon advice of the
Translation Project.</P>

<H3>Programmer's Notes</H3>

<P>Fix the libss "make check" regression test so that it works if the
current directory is not in the user's path or if the libss shared
library is not installed.  (Addresses Sourceforge Bug: #1848974)</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.
(Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=444883"
  TARGET="_blank">#444883</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=441872" TARGET="_blank">#441872</A>)</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=437720"
  TARGET="_blank">#437720</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=451172"
  TARGET="_blank">#451172</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=458017" TARGET="_blank">#458017</A>)</P>

<P>Fix build failure on non-Linux/non-Hurd/non-Masix systems.
(Addresses Sourceforge Bug: #1859778)</P>

<P>Fix Hurd portability issues.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=437720" TARGET="_blank">#437720</A>)</P>


<H2><A NAME="1.40.3">E2fsprogs 1.40.3 (December 5, 2007)</A></H2>

<P>Fix a potential security vulnerability where an untrusted filesystem
can be corrupted in such a way that a program using libext2fs will
allocate a buffer which is far too small.  This can lead to either a
crash or potentially a heap-based buffer overflow crash.  No known
exploits exist, but main concern is where an untrusted user who
possesses privileged access in a guest Xen environment could corrupt a
filesystem which is then accessed by the pygrub program, running as
root in the dom0 host environment, thus allowing the untrusted user to
gain privileged access in the host OS.  Thanks to the McAfee AVERT
Research group for reporting this issue.  (Addresses CVE-2007-5497.)</P>

<P>Fix heuristics in blkid which could cause a disk without partitions to
be incorrectly skipped when a loopback device is present.  (Addresses
Red Hat Bugzilla
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=400321" TARGET="_blank">#400321</A>.)</P>

<P>Fix e2image so that in raw mode it does not create an image file which
is one byte too large.</P>

<P>Change mke2fs's usage message so it recommends the preferred -E option
instead of the deprecated -R option.</P>

<P>Enhance the blkid library so it will recognize squashfs filesystems.
(Addresses Red Hat Bugzilla
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=305151" TARGET="_blank">#305151</A>.)</P>

<P>Enhance e2fsck so it will force the backup superblocks to be backed up
if the filesystem is consistent and key constants have been changed
(i.e., by an on-line resize) or by e2fsck in the course of its
operations.</P>

<P>Enhance blkid's detection of FAT filesystems; so that USB disks with
only a single bootable partition will not get missed.</P>

<P>E2fsck will no longer mark a filesystem as invalid if it has time
errors (i.e., if superblock mount time or last write time is in the
future) and the user refuses to fix the problem.</P>

<P>The Ubuntu init scripts don't properly set the system time correctly
from hardware clock if the hardware clock is configured to tick local
time instead of GMT time.  Work around this as best as we can by
providing an option, buggy_init_scripts, in /etc/e2fsck.conf which can
be set on Ubuntu systems.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=441093" TARGET="_blank">#441093</A>, and Ubuntu
Bug #131201.)</P>

<P>Fix fsck to ignore /etc/fstab entries for bind mounts.  (Addresses Red
Hat Bugzilla #151533.)</P>

<P>Fix e2fsck so that if the superblock is corrupt, but still looks
vaguely like an ext2/3/4 superblock, that it automatically tries to
fall back to the backup superblock, instead of failing with a hard
error.</P>

<P>Make the e2fsprogs program more robust so that they will not crash
when opening a corrupt filesystem where s_inode_size is zero.</P>

<P>Change e2fsck so it uses sscanf() instead of atoi() so it non-numeric
arguments are detected as such and the parse error is reported to the
user.   (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=435381" TARGET="_blank">#435381</A>.)</P>

<P>Change e2fsck so it will not complain if a file has blocks reallocated
up to the next multiple of a system's page size.</P>

<P>Fix bug in ext2fs_check_desc() which will cause e2fsck to complain
about (valid) filesystems where the inode table extends to the last
block of the block group.  (Addresses Red Hat Bugzilla
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=214765" TARGET="_blank">#214765</A>.)</P>

<P>Fix a bug in ext2fs_initialize() which causes mke2fs to fail while
allocating inode tables for some relatively rare odd disk sizes.
(Addresses Red Hat Bugzilla
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=241767" TARGET="_blank">#241767</A>.)</P>

<P>Add Catalan translation and update Dutch and Swedish translations
from the Translation Project.</P>

<P>Fix big-endian byte-swapping bug in ext2fs_swap_inode_full().  We
still had an issue when trying to figure out whether we need to
byte-swap fast symlinks that contained extended attributes.</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.
(Addresses SourceForge Bug #1821333.)</P>


<H3>Programmer's Notes</H3>

<P>Fix mke2fs tests to avoid needing any significant ^M (CR) characters</P>

<P>Add "make check" to the RPM spec file</P>

<P>Fix "make install" and "make uninstall" in misc/Makefile.in so that it
works correctly when the prefix is not the root directory.</P>

<P>Fix the resize2fs tests, r_move_itable and r_resize_inode, so they
clean up after themselves by deleting the test.img temporary file
after completing the test.</P>

<P>Fixed a corner case bug ext2fs_unlink() when trying to delete the
first directory entry in a directory block and the last directory
entry in the previous directory block is not in use.  Fortunately
ext2fs_unlink() is only used by debugfs and e2fsck, and in e2fsck in
places where it is extremely unlikely to run into this corner case.</P>

<P>Fix missing dependency which would cause parallel builds to fail.
(Addresses Sourceforge Bug #1842331.)</P>

<P>Fix a build error on newer gcc caused by lib/ext2fs/ismounted.c
calling open(O_CREATE) with a missing mode parameter.</P>

<P>Fix the test_ss.c in lib/ss so it can be used as an example
application program for the library as well as a regression test
suite.</P>

<P>Fix ext2fs_dblist_dir_iterate() so that error codes and abort codes
are properly passed back up through the call stack.</P>

<H2><A NAME="1.40.2">E2fsprogs 1.40.2 (July 12, 2007)</A></H2>

<P>A recent change to e2fsck_add_dir_info() to use tdb files to check
filesystems with a very large number of filesystems had a typo which
caused us to resize the wrong data structure.  This would cause a
array overrun leading to malloc pointer corruptions and segfaults.
Since we normally can very accurately predict how big the the dirinfo
array needs to be, this bug only got triggered on very badly corrupted
filesystems.</P>

<P>Fix a bug in e2fsck which caused it to incorrectly salvage
directories when the last entry's rec_len is bogusly too big.  This
resulted in a nonsense filesystem corruption to be reported, and
required a second run of e2fsck to fully fix up the directory.</P>

<P>Update tune2fs man page to include more discussion of reserved blocks
(Addresses Launchpad bug #47817)</P>

<P>Update Turkish, Polish, Dutch, and Vietnamese PO files from the
Translation Project</P>
    
<H2><A NAME="1.40.1">E2fsprogs 1.40.1 (July 7, 2007)</A></H2>

<P>Fix bug which could cause libblkid to loop forever.  When revalidating
a partition where there is obsolete information in /etc/blkid.tab, we
end up freeing a the type tag without clearing dev->bid_type, causing
blkid_verify() to loop forever.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=432052" TARGET="_blank">#432052</A>)</P>
    
<P>The Turkish translation has a bug in it where it has the translation
of "E@e '%Dn' in %p (%i)" to "E@E".  This causes @E to be expanded at
@E, recursively, forever, until the stack fills up and e2fsck core
dumps.  We fix this by making e2fsck stop @-expansions after a
recursive depth of 10, which is far more than we need.
(Addresses Sourceforge Bug: #1646081)</P>
    
<P>Compile the default mke2fs.conf into mke2fs program.  People are
getting surprised by mke2fs creating filesystems with different
defaults than earlier versions of mke2fs if mke2fs.conf is not
present.  So we now create a built in version of mke2fs.conf file
which is used by mke2fs if the /etc/mke2fs.conf is not present.
(Addresses SourceforgeBug: #1745818)</P>

<P>Improve the config/parse_types.sh helper script.  Fix a potential
security problem if e2fsprogs is built as root (as Gentoo does!).  In
addition fix the script and how it is called from the configure script
so that it does the right thing when cross-compiling.  (Fixes Gentoo
bug: #146903)</P>
    
<P>Update Vietnamese, French, and Dutch PO files from the Translation
Project.  Also created a new e2fsprogs.pot file for translator.</P>
    
<P>Fix bogus strip permission errors when building under Debian.  When
building the e2fsprogs dpkg's, the dh_strip command emits a large
number of error messages caused by the permissions not being right.
So run dh_fixperms before running dh_strip.</P>

<H3>Programmer's Notes:</H3>

<P>Add new function: profile_set_default().  This function sets the value
of the pseudo file "<default>".  If the file "<default>" had
previously been passed to profile_init(), then def_string parameter
will be parsed and used as the profile information for the "<default>"
file.</P>
    
<P>Fix mk_cmds's error reporting so that it is unambiguous that it is the
mk_cmds script which is generating the error.  (Obviates Gentoo patch:
e2fsprogs-1.32-mk_cmds-cosmetic.patch)</P>
    
<P>Fix the test suite to use LC_ALL instead of LANG.  LC_ALL is the "high
priority" environment variable that overrides all others, where as
LANG is the lowest priority environment variable.  If LC_ALL is set, it
doesn't matter whether LANG, LANGUAGE, LC_COLLATE, LC_MESSAGES, and
the all the rest are set.  This will assure that the locale when
running the test suites is the "C" locale.  (Obviates Gentoo patch:
e2fsprogs-1.38-tests-locale.patch)</P>

<H2><A NAME="1.40">E2fsprogs 1.40 (June 29, 2007)</A></H2>

<P>Fix divide by zero error in blkid's NTFS probing logic.</P>

<P>Add new blkid -g option which causes the blkid cache to be garbage
collected.</P>

<P>Fix a bug in libblkid which could cause the internal field bid_type to
become corrupted.  Fortunately bid_type isn't used much, and bid_label
and bid_uuid is only used by debugging code, so the impact of this bug
was very minor.</P>

<P>Mke2fs will now store the RAID stride value when a filesystem is
created with a requested RAID stride, and then use it automatically in
resize2fs.</P>

<P>Mke2fs has a sanity check added to make sure (inode_size * num_inodes)
isn't too big.  In some cases Lustre users have tried specifying an
inode size of 4096 bytes, while keeping an inode ratio of one inode
per 4096 bytes.  </P>

<P>Improve sanity check in e2fsck's algorithm for finding a backup
superblock, so that it won't accidentally find a superblock that was
located in the journal, and then later reject it as being not a valid
backup superblock.</P>

<P>Fix e2fsck get_size logic so that it will work with the Linux floppy
driver.  The Linux floppy driver is a bit different from the other
block device drivers, in that if the device has been opened with
O_EXCL, it disallows another open(), even if the second open() does
not have the O_EXCL flag.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=410569" TARGET="_blank">#410569</A>)</P>

<P>Fix error checking of badblock's last-block and start-block arguments.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=416477" TARGET="_blank">#416477</A>)</P>

<P>Fix e2fsck so that it doesn't overwrite the backup superblocks when
recovering a journal until the master superblock has been confirmed as
being sane.</P>

<P>Change the blkid library to be much more paranoid about concluding
that a partition contains an NTFS filesystem, and fetch the UUID and
LABEL information from NTFS filesystems.  (Addresses Launchpad Bug:
#110138)</P>

<P>Factor out the code which sets the default journal size and move it
into libext2fs.</P>

<P>Enhance e2fsck so it will recreate the ext3 journal if the original
journal inode was cleared to due it being corrupt after finishing the
filesystem check.</P>

<P>Fix e2fsck so that it updates the journal inode if it is corrupted and
the backup journal information from the superblock was successfully
used to recover the filesystem.</P>

<P>Fix e2fsck so that it checks all of the blocks in the journal inode
for validity.  The original code only checked the direct blocks to
make sure the journal inode was sane.  Unfortunately, if some or all
of the indirect or doubly indirect blocks were corrupted, this would
not be caught.</P>

<P>Add support in blkid to detect LUKS encrypted partitions.</P>

<P>Add extra sanity checks for extended attributes in the case where the
size is zero but the offset is very large.</P>

<P>Fix byte-swapping issues for large inodes in ext2fs_read_inode_full()
and ext2fs_get_next_inode_full().</P>

<P>Clarify the copyright licenses used by the various libraries in
the top-level COPYING  file (Red Hat Bugzilla:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=166058" TARGET="_blank">#166058</A>)</P>

<P>Make mke2fs's defaults when /etc/mke2fs.conf doesn't exist more sane.</P>

<P>Fix mke2fs and debugfs to support large (> 16 bit) uid's and gid's.</P>

<P>Remove check in e2fsck which requires EA's in inodes to be sorted;
they don't need to be sorted, and e2fsck was previously wrongly
clearing unsorted EA's stored in the inode structure.</P>

<P>Allow mke2fs or tune2fs to create a substantially larger journal (up
to 10,240,000 blocks).</P>

<P>Fix MD superblock detection, and make sure the correct UUID is
reported from the MD superblock.</P>

<P>Fix a signed vs. unsigned bug in debugfs.</P>

<P>Enhance debugfs's date parser so that it accepts integer values.</P>

<P>Fix e2fsck's pass1c accounting so it doesn't terminate too early if a
file with multiply claimed blocks is hard linked. or not at all if the
root directory contains shared blocks</P>

<P>Enhance debugfs so it can modify the block group descriptors using the
command set_block_group_descriptor.</P>

<P>Improve e2fsck's reporting of I/O errors so it's clearer what it was
trying to do when an error happens</P>

<P>Fix a bug in in how e2fsprogs byte swaps inodes containing fast
symlinks that have extended attributes.  (Addresses Red Hat Bugzilla:
<A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=232663" TARGET="_blank">#232663</A> and LTC Bugzilla: #27634)</P>

<P>Fix potential file descriptor leak in ext2fs_get_device_size() in an
error case.</P>

<P>Add libreadline.so.5 support to libss.</P>

<P>Improve badblocks -n/-w exclusive usage message.</P>

<P>Fix dump_unused segfault in debugfs when a filesystem is not open</P>

<P>Fix memory leak in blkid library.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=413661" TARGET="_blank">#413661</A>)</P>

<P>Allow the debugfs lcd command to work w/o a filesystem being open.
(Addresses LTC Bugzilla #27513)</P>

<P>Fix e2fsck to clear i_size for special devices with a bogus i_blocks
field on the first pass.</P>

<P>Fix e2fsck to set the file type of the '..' entry when connecting
a directory to lost+found.  (Addresses Lustre Bug: #11645)</P>

<P>Enhance e2fsck to recover directories whose modes field were corrupted
to look like special files.  This is probably only useful in
artificial test cases, but it will be useful if we ever do the "inodes
in directory" idea for ext4.</P>

<P>Allow debugfs to dump (and rdump) > 2GB files.  (Addresses Debian Bug:
#412614)</P>

<P>Fix resize2fs parsing of size parameter (in sector units).  This was
actually a bug in libe2p's parse_num_blocks() function.  When handling
the 's' suffix, it was ignoring the blocksize information passed in
from the caller and always interpreting the number in terms of a 1k
blocksize.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=408298" TARGET="_blank">#408298</A>)</P>

<P>There was a floating point precision error which could cause e2fsck to
loop forever on really big filesystems with a large inode count.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=411838" TARGET="_blank">#411838</A>)</P>

<P>Fix memory leak in ext2fs_write_new_inode()</P>

<P>Add support for using a scratch files directory to reduce e2fsck's
emory utilization on really big filesystems.  This uses the TDB
library.  See the [scratch_files] section of the e2fsck.conf man page
for more details.</P>

<P>Fixed type-punning bug which caused dumpe2fs to crash on the Arm
platform (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=397044" TARGET="_blank">#397044</A>)</P>

<P>Add explanatory message to badblocks that -n and -w are mutually exclusive
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=371869" TARGET="_blank">#371869</A>)</P>

<P>Allow debugfs and dumpe2fs to support fs features under development.</P>

<P>Add support for the new flag EXT2_FLAG_SOFTSUPP_FEATURES flag to
ext2fs_open() , which allows application to open filesystems with features
which are currently only partially supported by e2fsprogs.</P>

<P>Allow unix_io to support offsets greater than 2G (Addresses
SourceForge Bug: #1547922)</P>

<P>Fixed overflow and signed/unsigned problems caused by the number of
blocks or inodes exceeding 2**31 or being close to 2**32-1.</P>

<P>Add support for unsigned directory hash calculations with hints in the
superblock to fix cross-architectural portability for htree
directories with filenames where the high 8th bit is set.  (Addresses
Debian: <A HREF="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=389772"
	   TARGET="_blank">#389772</A>)</P>

<P>Fix resize2fs so that it gives user-intelligible error messages if the
filesystem or the kernel does not support on-line resizing.
(Addresses Debian
  Bug: <A HREF="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=380548"
	  TARGET="_blank">#380548</A>)</P>

<P>Require mke2fs -F -F for really dangerous operations, since -F is
needed for less dangerous operations such as creating filesystems
images in regular files, or creating filesystems on whole block
devices.  These relatively innocuous usages should NOT be confused
with running mke2fs on an apparently-mounted or in-use filesystem.</P>

<P>Allow the default inode size to be specified into the mke2fs.conf
file.</P>

<P>Make the smallest default journal size is big enough so that on-line
resizing should always work.</P>

<P>Fix silly spelling error in e2fsck.  (Addresses SourceForge bug:
#1531372)</P>

<P>Fix debugfs coredump when lsdel is run without an open filesystem
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=378335" TARGET="_blank">#378335</A>)</P>

<P>Fix debugfs display bug us that bytes that have the high bit set are
displayed as "ec" instead of "ffffffec".</P>

<P>Add support in lsattr so it will display the EXT4_EXTENTS_FL flag.</P>

<P>Device mapper scanning wasn't working in the blkid library because the
pathnames had an extra "/dev" when they were being probed.</P>

<P>Add GFS/GFS2 support to the blkid library.</P>

<P>Fix blkid support of empty FAT filesystem labels.</P>

<P>Avoid recursing forever (or for a long time) when the blkid library
searches for a device and there are symlinks to directories in /dev.</P>

<P>Avoid unaligned halfword access in blkid when accessing FAT
superblocks, as this will cause Sparc/Solaris systems to throw a
SIGBUS error.</P>

<P>The latest devmapper libraries requires pthreads, add -lpthreads to
the static link libraries for e2fsck.static if devmapper is enabled.
(Addresses Debian bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=388718" TARGET="_blank">#388718</A>)</P>

<P>Improve the (non-installed, for experts only) findsuper program by
printing the uuid and label from the superblocks, as well as the
starting and ending offsets of the filesystem given the information in
the superblock.  Omit by default printing superblocks that are likely
found in located in an ext3 journal unless an explicit -j option is
given.</P>

<P>Updated French and Dutch translations and added Vietnamese translation.</P>

<P>Use FreeBSD's DIOCGMEDIASIZE and DIOCGDINFO ioctls if available when
determining a partition's size, since binary searching to determine
the device doesn't work on FreeBSD.</P>

<P>Documentation about UUID's is available in enough places, and it's
awkward to deal with debian-legal's insanities.  So I'm caving in the
"more-lunatic-than-RMS" wing of Debian by removing RFC-4122 so we
don't have do the dfsg tarball.  Also remove the rule that only tried
to install RFC-4122 on Ubuntu, since Ubuntu seems to want to fetch
e2fsprogs exclusively from Debian.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=407107" TARGET="_blank">#407107</A>)</P>

<P>Fix the info-dir line so that the menu name does not contain a .info
prefix.  First of all, it's ugly, secondly, it causes the install-info
command to fail to remove the com_err info file from the
/usr/share/info/dir file when the comerr-dev package is removed and
purged.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=401711" TARGET="_blank">#401711</A>)</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=369761"
  TARGET="_blank">#369761</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=373004"
  TARGET="_blank">#373004</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=379695" TARGET="_blank">#379695</A>)</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=389554"
     TARGET="_blank">#389554</A>,
     <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=390664"
	TARGET="_blank">#390664</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=413208"
	TARGET="_blank">#413208</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=419605"
	TARGET="_blank">#419605</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=408352"
   TARGET="_blank">#408352</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=415560"
   TARGET="_blank">#415560</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=399155" TARGET="_blank">#399155</A>)</P>


<H3>Programmer's notes:</H3>

<P>E2fsck now supports the %It expansion when printing a problem report.
It will print the type of the inode in the problem context.</P>

<P>Fix misc/Makefile.in so that it builds even if e2fsck hasn't been built yet
(Addresses Sourceforge Bug: #1565561)</P>

<P>Remove unused variables and other lint/gcc -Wall cleanups</P>

<P>Add check to ext2fs_get_device_size() so it will return EFBIG for for
filesystems contained in regular files where the filesystem image size
is returned by stat64().</P>

<P>Set local environment variables to C so mk_cmds and compile_et always
work.  (Addresses SourceForge Bug: #1532177)</P>

<P>Added the 64-bit byte swapping function ext2fs_swab64().</P>

<P>Added two new helper functions to prevent 2**31/2**32-1 overflow
problems: ext2fs_div_ceil() and e2p_percent().</P>

<P>Create new ext2fs library inline functions ext2fs_group_first_block()
and ext2fs_group_last_block() in order to calculate the starting and
ending blocks in a block group.</P>

<P>Create the generated files read-only to remind developers not to edit them.</P>

<P>Add support for autoconf 2.60 (with backwards compatibility for older
versions of autoconf).</P>

<P>Added an "make rpm" target to top-level Makefile</P>

<P>Added various FreeBSD portability fixes.</P>

<P>Exclude mercurial files from the RPM build tree to speed up copy/build.</P>

<P>Use root_sysconfdir to define the locations of mke2fs.conf and
e2fsck.conf instead of using a hard-coded /etc pathname.</P>

<P>Prevent e2fsck.h and ext2_ext_attr.h from getting included multiple times.</P>

<P>Fixed "make clean" in blkid's Makefile.in file from removing tst_*.c files.</P>

<P>If diff -u is supported, use it to report test failures.</P>

<P>Updates/improvements to RPM spec file</P>

<P>Add on-disk format definitions for the following new features:
EXT4_FEATURE_RO_COMPAT_HUGE_FILE, EXT4_FEATURE_RO_COMPAT_GDT_CSUM,
EXT4_FEATURE_RO_COMPAT_DIR_NLINK, EXT4_FEATURE_INCOMPAT_64BIT,
EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE</P>

<P>Add a new make target "checked-failed" in the tests directory which
reruns any failed tests</P>

<P>Update draft-leach-uuids-guids-01.txt with rfc4122.txt</P>

<P>Fix miscellaneous bugs reported by Coverity: Dead code, potential nul
pointer dereferences, memory leaks, etc.  None were security-critical
problems.</P>

<P>Fix up usage and decrement error messages in the test_icount program</P>

<P>Add debugging code to the com_err library; if the environment variable
COMERR_DEBUG is set to 1, print out debugging messages as error tables
are added and removed from the com_err library.  If the
COMERR_DEBUG_FILE environment variable is set (and the process is not
setuid) the debugging messages may be redirected to a file.</P>

<P>Change all of the e2fsprogs programs to use the newer add_error_table()
and remove_error_table() interfaces instead of the much older
initialize_*_error_table() function.</P>

<P>Add TDB support into the ext2fs library.  This allows us to have a
guaranteed library we can count on always being present so we can
store data in an on-disk database.</P>

<P>Add support for using TDB to store the icount data, so we don't run out
of memory when checking really large filesystems.</P>

<P>Change the regression test suite so that it skips empty test directories.</P>

<P>Define the l_i_iversion field in ext2_inode.  The l_i_version field is
now defined from the old l_i_reserved1 field in the ext2 inode.  This
field will be used to store high 32 bits of the 64-bit inode version
number.</P>

<P>Add Makefile production rule for e2fsprogs.spec in case it gets
deleted.</P>

<P>Add new function profile_get_uint() to allow for a clean way to fetch
unsigned integers from the context.</P>

<P>Add test to make sure the ext2 superblock structure is 1024 bytes.</P>

<P>Fix typo in name of f_dup4 regression test</P>

<P>Add new function blkid_gc_cache() which performs a garbage collection
pass on the /etc/blkid.tab file.</P>

<P>The ext2fs_open() function now sets EXT2_FLAG_MASTER_SB_ONLY.  In
general, only e2fsck (after the filesystem is clean), tune2fs, and
resize2fs should change the backup superblocks by default.  Most
callers of ext2fs_open() should not be touching any superblock fields
which require the backups to be touched.</P>

<P>Add new function to libext2fs, ext2fs_default_journal_size(), which
returns the default journal size.</P>


<H2><A NAME="1.39">E2fsprogs 1.39 (May 29, 2006)</A></H2>

<P>Fix 32-bit cleanliness in e2fsprogs so that we can support filesystems
between 2**31 and 2**32 blocks.</P>

<P>Change mke2fs to use /etc/mke2fs.conf as a configuration file to
configure the filesystem features, blocksize, and inode_ratio for
different filesystem types.</P>

<P>Mke2fs will now create filesystems hash trees and on-line resizing
enabled by default, based on the new /etc/mke2fs.conf file.</P>

<P>The e2fsprogs tools (resize2fs, e2fsck, mke2fs) will open the
filesystem device node in exclusive mode to prevent accidents by
system administrators.  In the case of resize2fs and mke2fs, it will
only use exclusive mode if the filesystem is not mounted.</P>

<P>Fixed a bug in mke2fs which caused it to to fail when creating the
resize inode for large filesystems.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=346580" TARGET="_blank">#346580</A>)</P>

<P>When allocating space for the RAID filesystems with the stride
parameter, mke2fs will now place each portion of the group's inode
table right up after the superblock (if present) in order to minimize
fragmentation of the free space.</P>

<P>Speed up mke2fs and e2fsck by writing inode and block bitmaps more
efficiently by writing the inode and block bitmaps in one pass, thus
reducing the number of disk seeks required.</P>

<P>Add support for on-line resizing to resize2fs.</P>

<P>Fix blkid library so that logic to determine whether or not a device's
cached information in /etc/blkid.tab needs to be verified or not
doesn't get confused by a system clock which is insane (for example,
if the battery is dead on a Macintosh running PPC Linux.  (Addresses
Red Hat Bug:
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=182188" TARGET="_blank">#182188</A>)</P>

<P>The blkid library will now store the UUID of the external journal used
by ext3 filesystems, so that in the future, the userspace mount binary
can use this to find the location of the external journal and pass
this information to the kernel.</P>

<P>E2fsck will now consult a configuration file, /etc/e2fsck.conf to
control how various options should be handled.  See the e2fsck.conf
man page for more details.   (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=150295" TARGET="_blank">#150295</A>)</P>

<P>E2fsck now prints an explanatory message when delaying a filesystem
check when the system is running on battery.  (Addresses Debian Bug:
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=350306" TARGET="_blank">#350306</A>)</P>

<P>E2fsck will detect if the superblock's last mount field or last write
field is in the future, and offer to fix if so.  (Addresses Debian Bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=327580" TARGET="_blank">#327580</A>) These problems will be fixed automatically in preen mode
since Debian's boot sequence bogusly doesn't set the time correctly
until potentially very late in the bootup process, and this can cause
false positives which will cause users' systems to fail to boot.
(Addresses Debian Bugs
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=343662"
   TARGET="_blank">#343662</A> and
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=343645" TARGET="_blank">#343645</A>)</P>

<P>E2fsck now checks to see if the superblock hint for the location of
the external journal is incorrect, and if so, offer to update it.
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=355644" TARGET="_blank">#355644</A>)</P>

<P>Fix e2fsck from segfaulting on disconnected inodes that contain one or
more extended attributes.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=316736"
  TARGET="_blank">#316736</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=318463" TARGET="_blank">#318463</A>)</P>

<P>E2fsck will stop and print a warning if the user tries running a
read/write badblocks test on a read-only mounted root filesystem.</P>

<P>Fix a memory leak in e2fsck's error paths.  (Thanks to Michael
C. Thompson for pointing these out; they were originally found using
Coverity.)</P>

<P>When resizing a file containing a filesystem, resize2fs will expand or
truncate a file as necessary.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=271607" TARGET="_blank">#271607</A>)</P>

<P>Resize2fs will now automatically determine the RAID stride parameter that
had been used to create the filesystem, and use that for newly created
block groups.   The RAID stride parameter may also be manually specified
on the command line using the new -S option to resize2fs.</P>

<P>Fix mke2fs so that it correctly creates external journals on
big-endian machines (such as a S/390).  </P>

<P>Fix a bug in the e2p library which could cause dumpe2fs to (rarely)
fail to print out the journal or hash seed UUID.  (Thanks to Guillaume
Chambraud for pointing this out.)</P>

<P>Dumpe2fs will now print the size of the journal (if present).</P>

<P>Fix debugfs's set_inode_field command so it can properly set the frag,
fsize, uid_high, gid_high, and author fields in the inode instead of
silently failing, and so that setting the i_size actually sets i_size
correctly.</P>

<P>Add a new debugfs command, set_current_time, which sets fs->now so
that regression test suites can repeatedly modify the filesystem's
last_write fields.</P>

<P>Fix a bug in debugfs's icheck which would incorrectly report the owner
of an extended attribute block.</P>

<P>Fix the debugfs commands htree_dump, dx_hash, and list_dir so they print a
print a usage message when an illegal option character is given.</P>

<P>Fix debugfs's dump_unsued command on filesystems with a 64k blocksize
so it won't core dump.  (Addresses SourceForge bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1424311" TARGET="_blank">#1424311</A>)</P>

<P>Fix mklost+found so that it creates a full-sized directory on
filesystems with larger block sizes.</P>

<P>Fix a file descriptor leak in blkid library.</P>

<P>Fix a display bug in "badblocks -sv" so that the done message properly
clears the block number at the end of the test.  (Addresses Debian Bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=322231" TARGET="_blank">#322231</A>)</P>

<P>Allow fractional percentages to the -m option in mke2fs and tune2fs
(Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=80205" TARGET="_blank">#80205</A>)</P>

<P>Use fstat/fstat64 in getsize.c if the the target is a regular file,
instead of attempting to do a binary search.  Fix some fd leaks in
error cases.</P>

<P>Add support for device mapper library to the blkid library to ensure
that the "best" (i.e., leaf) device is probed by the blkid library.</P>

<P>Fix the blkid library so that it notices when an ext2 filesystem is
upgraded to ext3.</P>

<P>Improve the blkid's library VFAT/FAT detection; it now understands
labels stored in the root directory, and is more paranoid about
checking the FAT superblock values.</P>

<P>Fixed a fd leak in the uuid library which was causing problems for the
LVM tools.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=345832" TARGET="_blank">#345832</A>)</P>

<P>Add support for the reiser4 and software suspend partitions to the
blkid library.  Also add support for extract the label from iso9660
filesystems.</P>

<P>Fix a compile_et bug which miscount the number of error messages if
continuations are used in the .et file.</P>

<P>Add extra sanity checks to protect users from unusual circumstances
where /etc/mtab may not be sane, by checking to see if the device is
reported busy (works on Linux 2.6) kernels.  (Addresses Debian Bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=319002" TARGET="_blank">#319002</A>)</P>

<P>Updated French, Dutch, Polish, and Swedish translations.  (Addresses Debian
Bug: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=343149"
	TARGET="_blank">#343149</A>w,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=341911"
  TARGET="_blank">#341911</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=300871"
  TARGET="_blank">#300871</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=316604"
  TARGET="_blank">#316604</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=316782"
  TARGET="_blank">#316782</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=330789" TARGET="_blank">#330789</A>)</P>

<P>Fix use-after-free bug in e2fsck when finishing up the use of the
e2fsck context structure.</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages and
documentation.  (Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=329859"
     TARGET="_blank">#329859</A>,
     <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=322188"
	TARGET="_blank">#322188</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=316811"
	TARGET="_blank">#316811</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=312515"
   TARGET="_blank">#312515</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=351268"
      TARGET="_blank">#351268</A>,
      <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=357951"
	 TARGET="_blank">#357951</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=347295"
	 TARGET="_blank">#347295</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=316040"
	 TARGET="_blank">#316040</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=368392"
	 TARGET="_blank">#368392</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=368393"
	 TARGET="_blank">#368393</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=368394"
	 TARGET="_blank">#368394</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=368179" TARGET="_blank">#368179</A>)</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=317862"
     TARGET="_blank">#317862</A>,
     <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=320389"
	TARGET="_blank">#320389</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=290429"
	TARGET="_blank">#290429</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=310950"
	TARGET="_blank">#310950</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=310428"
   TARGET="_blank">#310428</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=330737"
      TARGET="_blank">#330737</A>,
      <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=330736"
	 TARGET="_blank">#330736</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=329074"
	 TARGET="_blank">#329074</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=356293"
	 TARGET="_blank">#356293</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=360046"
	 TARGET="_blank">#360046</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=366017"
	 TARGET="_blank">#366017</A>,
	 <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=364516"
	 TARGET="_blank">#364516</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=362544"
   TARGET="_blank">#362544</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=362970" TARGET="_blank">#362970</A>)</P>


<h3>Programmer's notes:</h3>

<P>Update config.guess and config.sub to latest version (2006-02-23) from
FSF.</P>

<P>Fix asm_types.h type conflicts on AMD 64 platforms.  (Addresses Debian
Bugs: <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=360661"
	 TARGET="_blank">#360661</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=360317" TARGET="_blank">#360317</A>)</P>

<P>Fixed the Makefile so that they work correctly on newer versions of
GNU make (i.e., 3.81).</P>

<P>Add valgrind support to the regression test suites, and eliminate
false positives from valgrind.</P>

<P>Add a regression test suite for the blkid library.</P>

<P>Fix a fencepost error in resize2fs caught by valgrind.  </P>

<P>Fix compiler warnings about missing memcpy prototypes.</P>

<P>We no longer have the sparc assembly code in the header file any more,
so we shouldn't set _EXT2_HAVE_HAS_BITOPS_ for the sparc.  This would
break compiles on the sparc architectures when using gcc.</P>

<P>In the libext2fs library, add the new field fs->now which if non-zero
is used instead of the system time when setting various filesystem
fields (last modified time, last write time, etc.)</P>

<P>Fix gcc 4.01 complaints by adding a missing #include <string.h> to
ext2fs.h which is needed since the inline functions use memcpy().
(Addresses Sourceforge Bug #1251062)</P>

<P>Use BUILD_CFLAGS and BUILD_LDFLAGS instead of CFLAGS and LDFLAGS in
the build system when building files in the util directory which are
needed during the build process.  This avoids potential problems when
cross-compiling and some of the options specified in CFLAGS or LDFLAGS
are not recognized as valid by the host compiler.  (Addresses
Sourceforge Bug #1261547)</P>

<P>Clean up the blkid library by making the superblock and generic i/o
functions to be more generic.  Clean up interface to the probe
function, and fix memory leak.  Finally, remove an unneeded reference
to probe.h in the lib/blkid/resolve.c</P>

<P>Add an ext2fs_read_bb_FILE regression test to confirm proper detection
of invalid block #'s.</P>

<P>The x86 asm constraints for ext2fs_{set/clear}_bit have been fixed to
indicate that the the function read/writes the memory location.</P>

<P>Fix various gcc -Wall complaints.</P>

<P>Add a dependency to make sure that the subdirectories are created
before creating all of the object files, in order to address parallel
build problem in the library Makefiles.  (Addresses Sourceforge Bug:
#1261553)</P>

<P>Add $(LDFLAGS) to the command line argument when generating an ELF or
Solaris shared library, to allow cross-compile and other builds that
might need to specify -L paths to needed libraries.  (Addresses
Sourceforge Bug #1261549)</P>

<P>Add a new feature, EXT2_FEATURE_COMPAT_LAZY_BG, which is initially
intended for testing purposes.  It allows an ext2/ext3 developer to
create very large filesystems using sparse files where most of the
block groups are not initialized and so do not require much disk
space.  Eventually it could be used as a way of speeding up mke2fs and
e2fsck for large filesystem, but that would be best done by adding an
RO_COMPAT extension to the filesystem to allow the inode table to be
lazily initialized on a per-block basis, instead of being entirely
initialized or entirely unused on a per-blockgroup basis.</P>

<P>Fix backwards compatibility so e2fsprogs will better compile on Linux
2.0.35 systems.</P>

<P>Make test scripts more robust against locale-related environment variables</P>

<P>Fix type warning problem with sizeof() in ext2fs_open2().</P>

<P>Fix type warning problem with time_t in debugfs.</P>

<H2><A NAME="1.38">E2fsprogs 1.38 (June 30, 2005)</A></H2>

<P>Fix blkid's test programs (built with "make check") compile correctly
even without "configure --enable-blkid-debug".</P>

<P>Fix ia64 core dump bug caused by e2fsprogs running afoul of C99 strict
type aliasing rules on newer gcc compilers.  (Addresses Red Hat
Bugzilla <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=161183" TARGET="_blank">#161183</A>.)</P>

<P>Fix com_err library to make it more compatible with recent changes
made to the com_err library in MIT Kerberos V5 version 1.4.
(Addresses Sourceforge Bug #1150146)</P>

<P>General cleanup of messages printed by e2fsprogs programs for grammar,
consistency, and to make life easier for translators.  Fixed a few
strings containing English that had not been marked as needing
translations.  Removed strings that do not need to be translated, to
make life easier for translators.</P>

<P>Mke2fs and badblocks will take advantage of a feature in Linux 2.6 to
test to see if a device appears to be in use instead of just relying
on /proc/mounts and /etc/mtab.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=308594" TARGET="_blank">#308594</A>).</P>

<P>Fix portability problem in the filefrag program affecting platforms
where the size of an integer is smaller than the size of a long.
(Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=309655" TARGET="_blank">#309655</A>)</P>

<P>Mke2fs will now use a larger journal by default for filesystems
greater than 4GB.  (128 MB instead of 32MB).</P>

<P>Mke2fs will refuse to create filesystems greater than 2**31-1 blocks,
unless forced.  This is to avoid signed vs. unsigned kernel bugs in
block numbers that still need to be fixed.</P>

<P>The blkid program has a new option which will more efficiently search
for device when it is known (or expected) that only one matching
device will be found in the system, such as when doing a lookup by
UUID.</P>

<P>Debian's e2fsprogs-specific initrd fragment will avoid including
unnecessary libraries into the initrd ramdisk by unsetting LD_PRELOAD
and LD_LIBRARY_PATH, and filtering out libraries found in
/etc/ld.so.preload.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=304003" TARGET="_blank">#304003</A>)</P>

<P>Fixed a potential portability issue in the blkid programs for
architectures where the char type is unsigned.  (Addresses Sourceforge
Bug: #1180585)</P>

<P>Fix a bug in filefrag so that it doesn't falsely count an extra
discontinuity when the first block found is an indirect block.
(Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=307607" TARGET="_blank">#307607</A>).</P>

<P>Fix blkid's recognition of cramfs filesystems, and enhance it to be
able to handle cramfs labels.</P>

<P>Fix debugfs's stat command to not core dump when a filesystem is not
open.</P>

<P>Fix e2fsck's handling of error conditions caused by the resize inode
claiming blocks that are also used by other inodes, a filesystem
corruption which was commonly caused by a bug in Fedora Core 3's
resize2fs program.</P>

<P>Fixed bug in filefrag which caused it to fail on non-ext2/3
filesystems.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=303509" TARGET="_blank">#303509</A>)</P>

<P>If the superblock last mount time indicates that the system clock may
not be accurate, then e2fsck will omit checking inodes' deletion time
field for indications of a potential corrupted orphaned inode list.
(Previously e2fsck only omitted these LOW_DTIME checks when the
superblock's last write time looked insane.)</P>

<P>Fixed a IA64 core dump bug in the e2p library which affected dumpe2fs.
(Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=302200" TARGET="_blank">#302200</A>)</P>

<P>Make the blkid library more paranoid about being run from setgid
programs, and to use __secure_getenv() from libc if it is available.</P>

<P>Fixed spelling mistakes, typos, and otherwise clarified man pages.
(Addresses Debian Bugs:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=304591"
     TARGET="_blank">#304591</A>,
     <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=304592"
	TARGET="_blank">#304592</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=304594"
	TARGET="_blank">#304594</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=304597"
	TARGET="_blank">#304597</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=304593" TARGET="_blank">#304593</A>
and Sourceforge Bug: #1189803)</P>

<P>Updated and fixed translations.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.</P>

<H3>Programmer's notes:</H3>

<P>Ext2fs_set_bit(), ext2fs_clear_bit(), and ext2fs_test_bit( have been
changed to take an unsigned int for the bit number.  Negative bit
numbers were never allowed (and didn't make any sense), so this should
be a safe change.  This is needed to allow safe use of block numbers
greater than or equal to 2**31.</P>

<P>The compile_et program will avoid recreating generated foo_err.c and
foo_err.h files if no changes are necessary.  The compile_et program
will also atomically replace these files to avoid a potential parallel
build race problem on SMP systems.  (Addresses Sourceforge Bug:
#1157933)</P>

<P>Added a new function to the blkid library, blkid_probe_all_new(),
which only probes newly added disk devices, and change
blkid_find_dev_with_tag() to use this function so that when a
requested tag is not found, devices that were previously not checked
are searched before searching all devices in the system.</P>

<P>Added new functions to the blkid library, blkid_dev_set_search() and
blkid_dev_has_tag().</P>

<P>E2fsck's problem strings can now use @m and @n as abbreviations for
"multiply-claimed" and "invalid", respectively.</P>

<P>The e2fsprog.pot file now has an explanation of how the @-expansion
and %-expansion works, and strings in e2fsck/problem.c which contain @
characters now have comments in e2fsprogs.pot with the @-expansion to
make life easier for translators.</P>

<P>Fixed missing return values in the ext2fs library which could cause it
to return random garbage in certain error conditions.</P>

<P>Allow the current time to be overridden via the E2FSCK_TIME environment
variable for use in regression tests.</P>

<P>The test script driver program now exits with a non-zero status if
there any of its test that it ran failed.</P>

<P>Fixed problems with parabuilds on SMP systems.  (Addresses Sourceforge
Bug: #1157933)</P>

<P>Fixed "make check" so that it compiles correctly even when e2fsprogs'
header files have not be installed in the system include directories.
(Addresses Sourceforge Bug: #1180572)</P>

<P>Fixed gcc -Wall nits.</P>


<H2><A NAME="1.37">E2fsprogs 1.37 (March 21, 2005)</A></H2>

<P>Add support for checking the validity of Extended Attributes stored in
inodes to e2fsck.</P>

<P>Add support for dumping the contents of large inodes to debugfs,
including the extended attributes stored in inodes.</P>

<P>Fix mke2fs, e2fsck, debugfs, and the ext2fs_mkdir function so that
when we create a new inode we make sure that the extra information in
the inode (any extra fields in a large inode and any ea-in-inode
information) is initialized correctly.  This can take place when
mke2fs creates the root and lost+found directory, when e2fsck creates
a new root inode or a new lost+found directory, and when the user uses
the debugfs write, mknod, or mkdir commands.  Otherwise, the newly
create inode could inherit garbage (or old EA information) from a
previously deleted inode.</P>

<P>Fixed a bug in e2fsck so it would notice if a file with an extended
attribute block was exactly 2**32 blocks, such that i_blocks wrapped
to zero.</P>

<P>Added support to filefrag to detect files which are using the new
experimental file extents format, and use the non-ext2 algorithm in
that case.  Fixed a bug to avoid reporting a false discontinuity if
there is one or more unallocated blocks at the beginning of a file.</P>

<P>Duplicated a check for noticing whether or not the number of blocks
(given a certain blocksize) is greater than 2**32 when the
BLKGETSIZE64 ioctl is not available to ext2fs_get_device_size().  This
allows mke2fs to automatically use a larger blocksize when creating a
filesystem on a very large device when run on systems that do not
support BLKGETSIZE64.</P>

<P>Fix the I18N build which was broken in e2fsprogs 1.36 because the
build system had been switched to treat the .gmo files as shipped
files (for backwards compatibility with systems that have older GNU
I18N tools installed), but the gen_tarball.in script was still
removing the .gmo files from the official source distribution.</P>

<P>Fixed various Debian packaging issues --- see debian/changelog for
details.  (Addresses Debian Bugs
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=296769"
  TARGET="_blank">#296769</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=299341" TARGET="_blank">#299341</A>)</P>

<H3>Programmer's notes:</H3>

<P>Added new functions to the e2p library which convert between a string
and os_type: e2p_os2string() and e2p_string2os(), and used them to
make the generated binaries more compact.</P>

<P>Fixed a compile-time error on Darwin systems.</P>

<P>Cleaned up the lib/ext2fs Makefile slightly.</P>

<H2><A NAME="1.36">E2fsprogs 1.36 (February 5, 2005)</A></H2>

<p>All of the patches that were applied to Fedora Core 3's
e2fsprogs-1.35-11.2 have been integrated, although sometimes with a
lot of bug fixes first.  Users of Fedora Core 3 are strongly
encouraged to upgrade to e2fsprogs 1.36 as soon as possible.</p>

<p>Add support for filesystem with the online resizing via resize inode
feature.  Fixed numerous bugs from the Fedora patches.  The Fedora
patches also didn't bother to do any consistency checking on the
resize inode, or add any tests to the regression test suite.  The "-R
resize=4g" option to mke2fs was a no-op in the Fedora patches, despite
being listed in mke2fs's usage message.  All of these shortcomings
have been corrected.</p>

<p>E2fsck can also also fix filesystems trashed by Fedora's resize2fs
program.  In order to do this, the user must run the commands:
<blockquote>
	debugfs -w /dev/hdXXX -R "features ^resize_inode"</br>
        e2fsck -f /dev/hdXXX
</blockquote>
Optionally, the ext2prepare command can be used to re-enable online
resizing after the filesystem has been fixed.</p>

<p>The fsck program will now accept an optional filedescriptor argument
to the -C option.  (The Fedora version of this patch would sometimes
cause fsck to ignore a parameter on fsck's command line in some rare
cases, sigh.)</p>

<p>Make sure e2fsprogs doesn't write garbage into the reserved portion of
large inodes.</p>

<p>Make sure resize2fs releases the blocks belonging to the old inode
table blocks when moving the inode table.  (Addresses Debian Bug:
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=290894" TARGET="_blank">#290894</A>)</p>

<p>Skip the r_resize_inode test if resize2fs is not compiled (due to
configure --disable-resizer)</p>

<p>E2fsck now checks the summary filesystem accounting information, and
if any of the information is obviously wrong, it will force a full
filesystem check.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=291571" TARGET="_blank">#291571</A>)</p>

<p>Fix e2fsck to not complain when the resize_inode feature is enabled,
s_reserved_gdt_blocks is zero, and there is no DIND block allocated in
the resize inode.</p>

<p>Fix e2fsck to note delete symlinks that contain an extended attribute
after the ext_attr feature flag has been cleared.  (Addresses Red Hat
Bugzilla <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=146284" TARGET="_blank">#146284</A>).</p>

<p>Add new utility program, copy_sparse.c, which is very useful
for dealing with large sparse files (such as e2image files).</p>

<p>Add support for jnl_blocks[] for debugfs's set_super_value.</p>

<p>Fix filefrag so that it works correctly with sparse files.</p>

<p>Filefrag -v will print first and last blocks.</p>

<p>Add interpretation of OS Creator values for FreeBSD and Lites in mke2fs
and dumpe2fs.</p>

<p>Add mke2fs support so that it can support filesystems larger than 4TB
automatically, by retrying with a 4k blocksize if the device size is
too big to be expressed using a 1k blocksize.  (Addresses Sourceforge
bug #1106631)</p>

<p>Change blkid to test for NTFS first because Windows sometimes doesn't
clear enough of the partition to confuse the probing routines into
thinking the old filesystem type is still valid.  (Addresses Debian
Bug <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=291990" TARGET="_blank">#291990</A>)</p>

<p>Add support for swap partition label and uuid's in the blkid library.</p>

<p>Add support to the blkid library to recognize Oracle ASM volumes.</p>

<p>Make blkid -t display all devices that match the specified criteria,
not just the first one, and work more consistently when the blkid
cache file is not available or set to /dev/null.  (Addresses Debian
Bug <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=290530"
       TARGET="_blank">#290530</A> and
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=292425" TARGET="_blank">#292425</A>)</p>

<p>Badblocks will now correctly display block numbers greater than
999,999,999 in its progress display.</p>

<p>The tune2fs program will not allow the user from setting a ridiculous
number of reserved blocks which would cause e2fsck to assume the
superblock was corrupt.  E2fsck's standards for what is a ridiculous
number of reserved block has also been relaxed to 50% of the blocks in
the filesystem.</p>

<p>The blkid library will return vfat in preference to msdos, and ext3 in
preference to ext2 (if the journalling flag is set) so that mount will
do the right thing.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=287455" TARGET="_blank">#287455</A>)</p>
 <p> 
Mke2fs will now use the -E option for extended options; the old -R
(raid options) option is still accepted for backwards compatibility.
Fix a double-free problem in resize2fs.  (Red Hat Bugzilla
<A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=132707" TARGET="_blank">#132707</A>)</p>

<p>Mke2fs will now accept a size in megabytes, gigabytes, and other units
(via "32m" or "4g" on the command line) if the user finds this more
convenient than specifying a block count.</p>

<p>Fix an obscure, hard-to find bug in "e2fsck -S" caused by an inode
cache coherency problem.</p>

<p>Debugfs now supports a new command, set_inode_field, which allows a
user to manually set a specific inode field more conveniently, as well
as set entries in the indirect block map.</p>

<p>Debugfs's set_super_value command has been enhanced so that the user
can set most superblock fields, including the date/time fields and
some of the more newly added superblock fields.</p>

<p>E2fsprogs programs now accept an offset to be passed to the file
specifiers, via the syntax: "/tmp/test.img?offset=1024".</p>

<p>E2fsprogs programs will now accept blocksizes up to 65536; kernel
support on the x86 doesn't exist for now, but it can be useful on
other architectures with page sizes greater than 4k.  There are 2.6
kernel patches out there which enable this, but they are of this
writing still experimental.</p>

<p>The e2image command now takes the -s option which will scramble
directory entries for raw image files.</p>

<p>Fix a file descriptor leak in the filefrag program.</p>

<p>Make sure e2fsck doesn't crash when /proc/acpi/ac_adapter is not
present.</p>

<p>Fix bug in debugfs where kill_file would lead to errors when deleting
devices and symlinks.  (Sourceforge Bugs #954741 and #957244)</p>

<p>Fix bug in the blkid library when detecting the ocfs1 filesystem </p>

<p>Remove obsolete EVMS 1.x and a.out DLL support.</p>

<p>E2fsck will attempt to recover from a journal containing illegal blocks.</p>

<p>Fixed two potential ordering constraint problems in e2fsck which might
cause the filesystem to be corrupted if e2fsck is interrupted during a
(extremely narrow) race window.  Thanks to Junfeng Yang from the
Stanford Metacompilation group for pointing this out.</p>

<p>Fixed bug in e2fsck where it would not accurately detect whether or
not the system is running on adaptor if the ACPI device representing
the AC adapter didn't correspond to the what was used on IBM
Thinkpads.</p>

<p>Change e2fsck to accept directories greater than 32MB.</p>

<p>Fix e2fsck so that a checkinterval of zero disables a time-based check
of the filesystem.</p>

<p>Debugfs will check the DEBUGFS_PAGER environment variable in preference
to the PAGER environment variable.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=239547" TARGET="_blank">#239547</A>)</p>

<p>Tune2fs will not mark rewrite the superblock if the feature bitmasks 
are not modified.</p>

<p>The debugfs program will set the filetype information when creating a
link.</p>

<p>Add debugfs -d option to use a separate source of data blocks when
reading from an e2image file.</p>

<p>Add e2image -I option which allows the e2image metadata to be
installed into a filesystem.</p>

<p>Fixed bug in the badblocks program which caused "done" to always
appear in English even when a translation was available.  (Addresses
Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=252836" TARGET="_blank">#252836</A>)</p>

<p>The blkid program has a new option -o which controls the output format
of the blkid program; this is makes blkid more convenient to use in
shell scripts.</p>

<p>Fix a minor bug in uuid library, which was not using the full 14 bits
of clock sequence when generating UUID's.</p>

<p>Fix a Y8.8888K problem in the uuid library.</p>

<p>Logsave now creates a new session id for itself to avoid getting
killed by init when transitioning between init levels.</p>

<p>Change the licensing of the UUID library to be the 3-clause BSD-style
license; this allows Apple to use the uuid library in Darwin.</p>

<p>Add ocfs and ocfs2 probe support into the blkid library.</p>

<p>Fix a memory and file descriptor leak in the blkid library.</p>

<p>The blkid library will revalidate the device if the system time is
earlier than last verification time of the device, since that
indicates that the system time is probably not trustworthy.</p>

<p>The blkid library will override the default location of the blkid.tab
file by the BLKID_FILE environment variable, if it is available.</p>

<p>Change the getsize functions to use the BLKGETSIZE64 ioctl on Linux 2.6.</p>

<p>Add various portability fixes for lame new versions of glibc, Darwin
and GNU/KFreeBSD, as well as removing XSI:ism's.  (Addresses Debian
Bugs <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=239934"
	TARGET="_blank">#239934</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=264630"
  TARGET="_blank">#264630</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=269044"
  TARGET="_blank">#269044</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=255589"
  TARGET="_blank">#255589</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=289133" TARGET="_blank">#289133</A>)</p>

<p>Add support for Windows 9x/NT under Cygwin.</p>

<p>Updated and clarified various man pages.  (Addresses Debian Bugs
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=236383"
	TARGET="_blank">#236383</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=241940"
	TARGET="_blank">#241940</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=238741"
	TARGET="_blank">#238741</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=242995"
	TARGET="_blank">#242995</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=256669"
	TARGET="_blank">#256669</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=268148"
	TARGET="_blank">#268148</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=256760"
	TARGET="_blank">#256760</A>,
	<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=273679"
	TARGET="_blank">#273679</A>)</p>

<p>Updated and fixed translations.   (Addresses Debian bugs
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=244105"
  TARGET="_blank">#244105</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=262836" TARGET="_blank">#262836</A>)</p>

<p>Update the rpm spec files so that it works better with Fedora core 2
and RH9.</p>

<p>Fixed various Debian packaging issues (see debian/changelog).  In
particular, fixed the Debian initrd scripts.  (Addresses Debian bugs
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=241183"
   TARGET="_blank">#241183</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=248050"
   TARGET="_blank">#248050</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=253595"
   TARGET="_blank">#253595</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=247775" TARGET="_blank">#247775</A>)</p>


<h3>Programmer's notes: </h3>

<p>Fixed various gcc -Wall warnings.</p>

<p>The uuid library now has new functions uuid_unparse_upper() and
uuid_unparse_lower() which forces the case of the hex digits to be
upper case, or lower case.</p>

<p>The build process has been sped up by enhancing the subst program
to update the modtime on the generated files even when the generated
file hasn't changed.</p>

<p>The uuid library now uses C99 stdint.h types instead of custom types.</p>

<p>Updated config.guess and config.sub with newer versions from the FSF.</p>

<p>Removed out of date .cvsignore files from the source distribution.</p>

<p>The ext2fs_unlink() function will return an error if both the name and
inode number are unspecified, to avoid doing something surprising
(such as unconditionally deleting the first directory entry).
Directory entries are now deleted by coalescing them with the previous
directory entry if possible, to avoid directory fragmentation.  This
is not an issue with the e2fsprogs suite, but may be a problem for
some of the users of libext2fs, such as e2tools.</p>

<p>Add support for version numbers of the form "1.36-rc1".</p>

<p>Fix build of mke2fs.static.</p>

<p>Add basic ext2fs library support for large (EA in inode) inodes.</p>

<p>The test_io mechanism can now abort after n reads or writes to a
particular block.  The block is specified by TEST_IO_BLOCK environment
variable, and the read/write count by the TEST_IO_READ_ABORT and
TEST_IO_WRITE_ABORT environment variables.  The block data is now only
dumped if the 0x10 bit is set in TEST_IO_FLAGS.</p>

<p>UUID_DEFINE() in the uuid library now creates a static variable, with
__attribute__ ((unused)) if we are using GCC, so that UUID_DEFINE can
be used in header files.</p>

<p>Add support for the install-strip and install-shlibs-strip targets, as
suggested by the GNU coding guidelines.  "make install" no longer
strips the binaries which are installed.</p>

<p>Remove support for the --enable-old-bitops configure option which was
only for very old sparc systems.</p>

<p>Remove support for --enable-clear-htree; this was only needed during
the early development of the htree patch.</p>

<p>Use Linux-kernel-style makefile output so it is easier to see compiler
warnings.</p>

<p>Update gettext files to version 0.14.1.</p>

<p>Update to use autoconf 2.5x.</p>

<p>Improved support for compiling e2fsprogs under dietlibc.</p>

<p>Make e2fsprogs portable to Solaris and FreeBSD systems.</p>

<p>Add blkid_verify(), blkid_get_library_version(), and
blkid_parse_version_string() functions to the blkid library.</p>

<p>Add pkg-config files for e2fsprogs's libraries.</p>

<p>Fix "make uninstall" to so that it removes everything that is installed.</p>

<p>Add a configure --enable-maintainer-mode option which enables the
makefile rules to rebuild the configure script from configure.in, and
to rebuild the .gmo files in po directory.</p>

<p>Drop the sparc assembly bitwise operations; it's less efficient
than the GCC 3.4 compile code and triggers compiler warnings on
sparc64.  Thanks to Matthias Andree for his analysis and suggestions.
(Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=232326" TARGET="_blank">#232326</A>)</p>


<H2><A NAME="1.35">E2fsprogs 1.35 (February 28, 2004)</A></H2>

<P>E2fsck has a new -k option, which in conjunction with the -c options,
preserves the existing badblocks list.</P>

<P>Cleaned up e2fsck's preen-mode messages during the passes 1b, 1c, and 1d.</P>

<P>E2fsprogs will now deal correctly with symlinks that contain
extended attribute information, which can be created using SE Linux.
(Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=232328" TARGET="_blank">#232328</A>)</P>
                                                                               
<P>Remove a double longjmp into an invalid stack frame bug in e2fsck.
(This was during an abort sequence, which normally worked on Linux and
caused a core dump on other operating systems.)</P>

<P>Fix NLS bug in e2fsck, by avoiding trying to expand an empty string
(the NLS library will replace "" with the .po header information).</P>
 
<P>Fix a bug in mke2fs which caused -T largefile or -T largefile4 to core
dump due to a division by zero error.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=207082" TARGET="_blank">#207082</A>)</P>

<P>Fixed a bug in e2fsck which caused it to incorrectly fix a filesystem
when reconnecting a directory requires creating a lost+found
directory.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=219640" TARGET="_blank">#219640</A>).</P>

<P>Fixed a bug where e2fsck would bomb out if a journal needed to be
replayed when using an alternate superblock.</P>
 
<P>E2fsck will give an extra grace period before actually forcing a check
if the laptop is running on battery.  The next time fsck runs while
the system is on the AC mains, or after the grace period is exceeded,
the filesystem will be checked.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=205177" TARGET="_blank">#205177</A>)</P>

<P>E2fsck will inform the user when there are 5 or fewer mounts before a
filesystem check will be forced.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=157194" TARGET="_blank">#157194</A>)</P>

<P>Fix e2fsck's handling of corrupted indirect blocks in the bad block.
We now correctly handle the case where there is an overlap between a
block group descriptor or a superblock and a bad block indirect block.
In the case where the indirect block is corrupted, we now suggest
"e2fsck -c".</P>

<P>Fix byte swap bugs in e2fsck that caused the journal backup location 
in the superblock and symlinks created by SE Linux to be cleared
by e2fsck on big-endian machines.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=228723" TARGET="_blank">#228723</A>)</P>

<P>E2fsck -c now replaces the current list of bad blocks with the ones
found by badblocks.</P>

<P>Fix bugs in e2fsck and tune2fs which could cause a core dump if a
non-existent LABEL or UUID specifier is to e2fsck or tune2fs.</P>

<P>Fix a potential bug in e2fsck which could cause it to core dump when
trying to print the location of the backup superblock.</P>

<P>Protect against a potential core dump in e2fsck when printing a
message about backup superblocks.</P>

<P>Add support for backing up the journal inode location in the
superblock.  E2fsck will automatically save the journal information in
the superblock if it is not there already, and will use it if the
journal inode appears to be corrupted.  ext2fs_add_journal_inode()
will also save the backup information, so that new filesystems created
by mke2fs and filesystems that have journals added via tune2fs will
also have journal location written to the superblock as well.
Debugfs's logdump command has been enhanced so that it can use the
journal information in the superblock.</P>

<P>E2fsck will now update all superblocks when moving the journal inode.</P>
  
<P>Shrink the size of the e2fsck executable by moving some initialized
variables to the BSS segment.</P>

<P>E2fsck will avoid printing the ^A and ^B characters which bracket the
progress bar when stdout and stdin are a tty device instead of a pipe
to another program.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=204137" TARGET="_blank">#204137</A>)</P>

<P>Debugfs's mkdir command will automatically expand the directory if
necessary.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=217892" TARGET="_blank">#217892</A>)</P>
 
<P>Fixed a bug in debugfs so that copying a file from /dev/null uses the
correct mode bits.  (Addresses Debian Bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=217456" TARGET="_blank">#217456</A>)</P>
 
<P>If the environment variables DEBUFS_PAGER and PAGER are not set,
debugfs now searches for the appropriate pager to use, beginning with
/usr/bin/pager, and then falling back to 'more' and 'less'.
(Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=221977" TARGET="_blank">#221977</A>)</P>

<P>Debugfs will now support 2.6 device numbers where the major or minor
number may be larger than 255.  (Addresses Sourceforge bug #865289)</P>
 
<P>Chattr now stops processing options when it sees '--'.  (Addresses
Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=225188" TARGET="_blank">#225188</A>)</P>

<P>Fix regression tests so they work correctly when e2fsprogs is compiled
with configure --disable-htree.</P>

<P>Fix bug in uuid library when there is no network card and the library
is generating a time-based uuid.  The random MAC address was not
correctly generated to be a multicast address.</P>
 
<P>Add compile_et extensions from Heimdall that were missed the first time
around.</P>

<P>Fix bug in badblocks when using O_DIRECT; we need to make sure that
we're reading from an offset which is page aligned.  For read-only and
read-write tests, we try to recover after an error so that we can
continue reading on page-aligned boundaries.  (Addresses Debian Bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=203713" TARGET="_blank">#203713</A>)</P>
  
<P>Badblocks now checks 64 blocks at a time instead of 16.  (Addresses
Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=232240" TARGET="_blank">#232240</A>)</P>
 
<P>Updated and clarified various man pages.  (Addresses Debian Bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=206845"
   TARGET="_blank">#206845</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=222606"
   TARGET="_blank">#222606</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=214920"
   TARGET="_blank">#214920</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=232406" TARGET="_blank">#232406</A>)</P>

<P>Updated and fixed translations.   (Addresses Debian bugs #200086, #214633)</P>

<P>Fixed various Debian packaging issues (see debian/changelog).</P>

<H3>Programmer's notes:</H3>

<P>Fixed a build problem so that e2fsprogs would compile with the
--enable-profile option to configure selected.  (Addresses Sourceforge
bug #811408)</P>
 
<P>Fixed C++ problems with the ext2fs.h header.  (Addresses Red Hat
Bugzilla Bug
  <A HREF="https://bugzilla.redhat.com/show_bug.cgi?id=112448" TARGET="_blank">#112448</A>)</P>
                                                                               
<P>Centralize code which calculates the location of the superblock
and block group descriptors so that it is in a single library routine.</P>

<P>Added two new functions, ext2fs_file_open2() and
ext2fs_inode_io_intern2() which take a pointer to an inode structure.</P>

<P>Fix compile_et to output the correct prototype for
initialize_xxx_err_table_r() in the header file.  (Addresses Debian
bug <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=204332" TARGET="_blank">#204332</A>)</P>

<P>In the lib/et makefile, make sure com_err.info is deleted on "make clean".</P>
  
<P>Fix 64-bit warnings in e2fsprogs pass1b by using inttypes.h if
present.  This is for when we try stuffing an int into void * pointer.</P>

<P>Fix type-punning which can cause gcc 3.x to miscompile code by getting
confused about pointer aliasing.  ext2fs_getmem(), ext2fs_free_mem(),
and ext2fs_resize_mem() all now take a 'void *' instead of a 'void
**'.  The EVMS code uses an ugly union approach since we don't want to
modify the EVMS interfaces. </P>

<P>Make sure all Makefiles use $(MAKE) rather than hardcoded "make", to
aid build process on systems can use invoke GNU make as "gmake".</P>

<P>Added regression testing for mke2fs.</P>

<P>Fixed gcc -Wall nitpicks.</P>

<P>Fixed various compiler warnings.</P>

<P>Add portability fixes for FreeBSD and for using fsctl under Darwin to
support ext2 ioctl's.</P>


<H2><A NAME="1.34">E2fsprogs 1.34 (July 25, 2003)</A></H2>

<P>Fixed a bug introduced in E2fsprogs 1.30 which caused fsck to spin in
a tight loop while waiting for a child fsck to exit in some cases.
This burns CPU times which slows down the low-level filesystem check.</P>

<P>Added code to mke2fs to assure that the default block size for a
filesystem is at least as big as the sector size of the device, if it
can be determined.</P>

<P>Changed mke2fs and resize2fs to round the default size of a filesystem
to be an even multiple of the VM pagesize in order to avoid a Linux
kernel bug introduced when the storage of the buffer cache was moved
into the page cache.</P>

<P>Mke2fs will warn the user when creating a filesystem with journalling
and a blocksize greater than 4096.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=193773" TARGET="_blank">#193773</A>)</P>

<P>Fixed a bug in resize2fs which caused it to fail on filesystems with a
non-empty bad block list.  Resize2fs now discards any blocks on the
badblock list which are no longer part of the filesystem as the result
of a filesystem shrink.  (Note: this means that shrinking and then
enlarging a filesystem is no longer a reversible operation;
information about bad blocks in the part of the filesystem which is to
be chopped off will be lost.)</P>

<P>Changed resize2fs so the user can use prefixes to specify the units of
the new filesystem size (sectors, kilobytes, megabytes, or gigabytes),
and to make the error and informational messages explicitly display
the blocksize used by the filesystem, in order to avoid confusion.
(Addresses Debian bug:
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=189814" TARGET="_blank">#189814</A>)</P>

<P>Added a new debugfs command, dump_unused, which dumps the contents of
all unused blocks to stdout.  (Useful as an emergency try-to-find
deleted data command.)</P>

<P>Added a new debugfs command, imap, which prints the location of a
specified inode in the inode table.</P>

<P>Fixed a bug in the badblocks program which caused it to use one bit of
randomness in its non-destructive read/write test, instead of using a
full 8 bits of randomness.</P>

<P>Added a new option (-t) to badblocks, which allows the user to control
the test pattern(s) used when checking a disk.</P>

<P>The blkid probe function now more correctly detects UDF filesystems.</P>

<P>Fixed a bug in the blkid library which caused it to not update its
cache if a filesystem changes from having a label to not having a
label.</P>

<P>Fixed a bug in the blkid library which could avoid an infinite loop
in blkid_find_dev_with_tag() if /proc is not mounted and there the
/etc/blkid.tab file has not yet been created.</P>

<P>Fixed the badblocks program so that the destructive read/write test
honors the -c option, and to use O_DIRECT when possible to avoid
thrashing the system block buffer cache.</P>

<P>Fixed various NLS issues.
<UL>
<LI> Added Czech and Sweedish translations
<LI> Removed testing NYC translation
<LI> Fixed NLS support for message abbreviations in e2fsck
<LI> Remove de-utf.po, since we shouldn't have two versions using different
	charset encodings.
<LI> Used ngettext() (abbreviated with the macro P_(str1, str2, n)) to 
	simplify the statistics reporting in e2fsck.
</UL></P>

<P>Changed configure.in so that its defaults for *BSD systems no longer
build an fsck wrapper, and not to install in /usr/local by default.</P>

<P>Fixed some minor spelling errors/typo's in e2fsck and the configure
script.</P>

<P>Fixed various Debian packaging issues (see debian/changelog). </P>

<P>Updated and clarified man pages.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=195616" TARGET="_blank">#195616</A>)</P>

<H3>Programmer's notes:</H3>

<P>Fix gcc -Wall nitpicks.</P>

<P>Updated gettext implementation used by e2fsprogs to 0.11.5, and enable
NLS support by default.  (Added partial workaround for gettext/Darwin
incompatibility problems.)</P>

<P>Added full MIT KRB5 and Himdall compatibility support to the com_err
library and the compile_et program.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=191900" TARGET="_blank">#191900</A>)</P>

<P>Added the blkid_known_fstype() function to the blkid library, which
returns true if it is passed a filesystem type which is recognized by
the blkid probing functions.</P>

<P>Improved the documentation for the blkid library.</P>

<P>Added the ext2fs_get_device_sectsize() function the the ext2fs library, which
returns the hardware sector size of a device, if it is available.</P>

<P>Added a dependency in the blkid library's .so file to the uuid
library, since the former uses the latter.  (Addresses Debian bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=194094" TARGET="_blank">#194094</A>)</P>

<P>Added --with-diet-libc and --disable-evms to the configure script.</P>

<P>Fixed a minor memory leak in the badblocks program.</P>

<P>Fixed a portability problem in tune2fs --- not all systems have strptime().</P>

<P>Fixed a portability problem in debugfs with the use of getopt() more
than once.  Old-style BSD, new-style BSD, and Linux C libraries all do
things differently.</P>

<P>Add support Windows support to ext2fs_get_device_size().</P>

<P>Added (normally disabled) debugging code to the Unix I/O manager which
causes it to disable all userspace caching if the NO_IO_CACHE is
defined.</P>

<P>Changed the test I/O manager so it can always be linked into e2fsck,
mke2fs, and tune2fs if enabled via --enable-test-io-debug to the
configure script.  The test I/O manager will only print any debugging
information if the TEST_IO_FLAGS or TEST_IO_BLOCK environment
variables are set, which specifies which I/O operations are logged and
a block number to watch, respectively.  The log messages are sent to
stderr by default, unless a filename is specified via the
TEST_IO_LOGFILE environment variable.</P>


<H2><A NAME="1.33">E2fsprogs 1.33 (April 21, 2003)</A></H2>

<P>Added a new utility program, logsave, which captures the output of a
command in a log file, even if the containing directory hasn't been
mounted yet (in which case the it saves the output in memory until it
can write out the logfile).  This is useful for capturing the
output of fsck during the boot sequence.</P>

<P>Fixed some portability problems that were causing problems under
the Cygwin32 environment.</P>

<P>Mke2fs now interprets a negative number to the -b option as a minimum
block size.</P>

<P>Fixed a bug in mke2fs which was incorrectly checking the argument to
the -g option if the default block size was used.  (Addresses Debian
bug <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=188319" TARGET="_blank">#188319</A>)</P>

<P>Fsck now explicitly ignores tmpfs and devpts, and it will complain if
it can not find filesystem checkers for jfs, reseirfs, and xfs.</P>

<P>E2fsck now updates the global free block and inode counters from the
block group specific counters quietly.  This is needed for an
experimental patch which eliminates locking the entire filesystem when
allocating blocks or inodes; if the filesystem is not unmounted
cleanly, the global counts may not be accurate.</P>

<P>Imported bug fixes to the EVMS plugin from the EVMS 2.0 tree.  (EVMS
2.0 is not yet supported; this only pulled in the bug fixes: fixed
possible hangs caused by bugs in calling waitpid, and not setting the
pipe to non-blocking mode; also fixed a file descriptor leak; made
sure all functions call log entry/exit functions.)</P>

<P>Badblocks now flushes its output file as bad blocks are discovered.</P>

<P>The uuid library is now more paranoid about assuming the correctness
of the /dev/random device; it mixes in a stream of bytes from
random/srandom, just in case.</P>

<P>Update Debian files to reflect the fact that I am now the Debian
maintainer of e2fsprogs.  Other various Debian-specific packaging
cleanups.</P>

<P>Move the source tarball generation functions from the top-level
makefile to the util/gen-tarball script.  </P>

<P>Updated the Turkish .po translation file.</P>

<P>Added heimdall and MIT krb5 extensions to the com_err library to make
it more compatible with com_err libraries from those distributions.</P>

<P>Changed dumpe2fs to always display the superblock fields relating to
the journalling and/or directory indexing feature even if those
features are not enabled.</P>

<P>Updated and clarify copyright statement vis-a-vis alpha releases of
e2fsprogs.</P>

<P>The ss library will now try to dynamically link to the readline
library and use it if it is present in the system.  This means that
the debugfs program now has line editing and history features.  The
SS_READLINE_PATH environment variable is used to find a readline or
readline-compatible library.</P>

<P>E2fsck now finds most duplicate filenames (all when rebuilding all
directories via the -D option) and offers to delete or rename
duplicate filenames/directory entries.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=176814" TARGET="_blank">#176814</A>).</P>

<P>Fix bug in e2image.  When writing out a raw image file, include data
blocks from symlinks that do not store the symlink within the inode.</P>

<P>Fix bug in resize2fs which incorrectly moved the block and inode
bitmaps for sparse superblock filesystems and incorrectly marked
blocks as in use.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=174766" TARGET="_blank">#174766</A>)</P>
 
<P>Added a new shared library, the blkid library, which efficiently
allows fsck, mke2fs, e2fsck, and tune2fs to be able to look up LABEL
and UUID filesystem specifiers without needing to search all of the
devices in the system.  Instead, the device is looked up in a cache
file, and then verified to make sure the blkid cache is correct.</P>

<P>Tune2fs and e2label will accept LABEL=xxx and UID=yyy specifiers for
the device name, using the blkid library.  (Addresses Debian bugs
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=166048"
   TARGET="_blank">#166048</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=179671" TARGET="_blank">#179671</A>)</P>

<P>Fsck now supports backslash escapes in /etc/fstab so that \040 can be
used for spaces in device labels.</P>

<P>Removed 32-bit limitations for debugfs's dump command.</P>

<P>If the user specifies a large number of inodes, Mke2fs will
automatically adjust the number of blocks per group to find a valid
set of filesystem parameters.</P>

<P>Add workaround to detect broken MD devices where when some of the
underlying devices are marked read-only, writes to the MD device are
silently dropped.  E2fsck will detect if there is an attempt to run
the journal twice, and abort with an error if this is the case.
(Addresses IBM Bugzilla bug #1226)</P>

<P>E2fsck will print an error if more than one of the -p/-a, -n or -y
options are specified.</P>

<P>E2fsck will fix HTREE corruptions in preen mode, without stopping the
boot process.  This is needed because the 2.4 ext2 filesystem
accidentally had the INDEX_FL backwards compatibility code removed.</P>

<P>Mke2fs no longer creates filesystems with the dir_index flag set by
default; the user has to specifically request it.</P>

<P>Update and clarified various man pages. (Addresses Debian bugs
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=173612"
   TARGET="_blank">#173612</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=175233"
   TARGET="_blank">#175233</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=175113"
   TARGET="_blank">#175113</A>, and
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=170497"
   TARGET="_blank">#170497</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=185945"
   TARGET="_blank">#185945</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=188318" TARGET="_blank">#188318</A>)</P>

<P>Created man page for the mk_cmds program (from the libss library).</P>

<H3>Programmer's notes:</H3>

<P>Fix various gcc -Wall nits.</P>

<P>Fixed a lot of portability problems that caused e2fsprogs not to build
successfully under Solaris and Apple/Darwin.</P>

<P>Fixed a Makefile dependency to allow building e2fsprogs using parallel
make jobs.</P>

<P>Changes to create a subset distribution which consists only of the
et, ss, uuid, and blkid libraries.  The configure script and top-level
makefile were changed to support working with a subset distribution.</P>

<P>Removed EXT2_FEATURE_RO_COMPAT_BTREE_DIR mention of since it's not
actually used, and might people who are looking for
EXT2_FEATURE_COMPAT_DIR_INDEX, which is in use.</P>

<P>Updated debian files to fix a number of Lintian warnings.</P>

<P>Updated config.guess and config.sub with newer versions from the FSF.</P>

<P>Removed unnecessary libraries from being linked into the fsck, lsattr, 
chattr, and blkid executables.</P>


<H2><A NAME="1.32">E2fsprogs 1.32 (November 9, 2002)</A></H2>

<P>Fixed a bug in the Unix I/O routines which caused needless writebacks
of clean blocks from the unix_io cache (they were erroneously marked
as being dirty, so they were getting written back to disk before
getting evicted from the disk cache).  This was harmless, but it
significantly slowed down e2fsck.</P>

<P>Made some other minor optimizations to the Unix I/O routines to save a
small amount of CPU time.</P>

<P>Updated internationalization files.</P>

<H2><A NAME="1.31">E2fsprogs 1.31 (November 8, 2002)</A></H2>

<P>Update EVMS ext2fsim plugin with EVMS 1.2.  (We still support
compiling the fsim plugin with EVMS 1.0 and 1.1.)  Add better error
handling for child process that die unexpectedly.  Add a hack to force
mkfs to create filesystems that won't cause problems with hardware
that has 2k or 4k minimum blocksize requirements.  Read from child
processes in non-blocking mode, so that the GUI continues to update.</P>

<P>Fix e2fsck so that it returns the appropriate exit code when the root
filesystem has been changed, so that system's rc scripts will be told that 
the system needs to be rebooted.</P>

<P>Fix a bug in ext2fs_flush/ext2fs_close; when the MASTER_SB_ONLY flag
was set, some of the descriptor blocks that should have been written
out were getting skipped.</P>

<P>Changed e2fsck to force out changes to the backup copies of the
superblock and block group descriptors when important changes are made
to those data structures.</P>

<P>Fix a bug where e2fsck could erroneously mark a filesystem as being
clean if a check of dirty filesystem is interrupted with a ^C.  (Bug
introduced in e2fsprogs 1.28.)</P>

<P>If journal debugging is enabled using --enable-jbd-debug, the debugging
level is now set via the E2FSCK_JBD_DEBUG environment variable.</P>

<P>If byteswapping support is disabled using configure --disable-swapfs,
skip the tests which depend on byte-swapping, so that "make check"
won't bomb out.</P>

<P>Lsattr will now display the indexed directory flag.  Also, some of
the more esoteric compression flags are suppressed unless compression
support has been enabled.</P>

<P>Update man pages.</P>


<H2><A NAME="1.30">E2fsprogs 1.30 (October 31, 2002)</A></H2>

<P>When resizing a filesystem, and inodes need to moved, resize2fs will
update the inode's ctime field, and the mtime field of the containing
directories, so that incremental backups using dump/restore will work
correctly.</P>

<P>In order to avoid spurious errors, e2fsck will check the last
superblock write time to determine whether or not it can safely use
the LOW_DTIME checks to determine if there are inodes on the orphan
inode linked list that had somehow gotten disconnected.  (Addresses
Sourceforge bug #620980)</P>

<P>Partition in /proc/partitions that being with the string "lvm" are
considered real partitions even if they do not end with a number.</P>

<P>Fixed a bug in the the uuid generation function, where if /dev/urandom
is not present, but /dev/random is, and there isn't sufficient
entropy, the get_random_byte function could spin a loop forever.</P>

<P>E2fsck, mke2fs, etc. will now reliably notice when image files are
mounted using the loopback interface.  (Addresses Sourceforge bug
#619119)</P>

<P>When flushing buffers (as is done by badblocks, for example) check to
see if the BLKFLSBUF ioctl succeeds, and if so, avoid using the
FDFLUSH ioctl which causes the MD device driver which causes confusing
syslog messages about obsolete ioctl messages.  (Addresses Sourceforge
bug #545832).</P>

<P>Debugfs's write command now checks to see if the destination filename
exists before creating it.  (Addresses Sourceforge bug #478195.)</P>

<P>When installing man pages, search for compressed man pages using all
commonly used compression extensions (i.e., .Z, .gz, .bz2, etc.)</P>

<P>Fixed a bug in fsck where multiple filesystems specified on the
command were not being checked in parallel due to a logic bug
introduced to support the FSCK_MAX_INST environment variable.</P>

<P>We have added a new superblock field, s_mkfs_time, which indicates
when a filesystem was created.  It is set via mke2fs, and printed out
by dumpe2fs, but is not actually touched by the kernel.</P>

<P>Dumpe2fs has been made more robust by not aborting if there is an
error reading the block/inode bitmaps; instead it will still print out
the location of the block/inode bitmaps and inode table.</P>

<P>Add support for the an alternative block group descriptor layout which
allows for on-line resizing without needing to prepare the filesystem
in advance.  (This is the incompat feature flag meta_bg.)</P>

<P>Add support for storing default mount options in the superblock, so
that the filesystem can be mounted with specific mount options without
needing to specify them on the mount command line or in the /etc/fstab
file.</P>

<P>Add support for a new inode flag, which is to be used for indicating
the top of directory hierarchies for the Orlov block allocator.</P>

<P>Fix e2fsck so that if it creates the lost+found directory, it does so
with the more appropriate permissions of 0700.  Also change
mklost+found so that it also creates the directory 0700.</P>

<P>Fixed format bug in e2fsck if NLS is in use.</P>
  
<P>Add a German translation for e2fsprogs's NLS support.</P>

<P>Fixed e2fsck so that it more handles BAD_BLOCK_IN_INODE_TABLE even at
the beginning of the inode table.  This won't matter much, since if
there is a bad block at the beginning of the inode table, the root
directory won't be available.  But at least e2fsck won't crash in this
case.</P>

<P>Fixed endian problems in the htree code for e2fsck and debugfs.</P>
  
<P>When byte-swapping a filesystem on a PPC architecture, byte-swap the
bitmaps since the historical big-endian ext2 variant had byte-swapped
bitmaps, and the ext2fs library assumes this.  This fixes the
regression test suite on PPC machines.</P>

<P>Fix e2image so that it handles a bad block in the inode table
appropriately.</P>

<P>E2fsck now uses a more sophisticated algorithm to salvage corrupted
directories that recovers more information in the corrupted directory
block.</P>

<P>E2fsck now performs additional consistency checks on indexed (HTREE)
directories.</P>

<P>Fix a bug where e2fsck might get confused about whether a completely
empty directory block is an empty leaf block or an interior htree
node.  This could cause e2fsck to get confused into think that a valid
indexed directory was corrupted.</P>

<P>E2fsck no longer creates an empty directory entry at the end of a
directory block when optimizing a directory.  This would cause some
earlier versions of the dxdir kernel code to corrupt the directory
when attempting to split a node containing an empty directory entry.</P>

<P>E2fsck could sometimes in rare circumstances leave the indexed flag
set after a small directory was optimized by compressing it instead of
indexing it.  (This should never happen in real life, since
directories that small wouldn't have been indexed, but better safe
than sorry.)</P>

<P>E2fsck now only updates the master superblock in all cases.  This
slightly shortens its run time.</P>

<P>Ext2ed can deal with directory entries of length 0; previously it
would get stuck in an infinite loop.</P>

<P>Fsck now has support for reiserfs volumes when parsing LABEL= and UUID=
specifiers.  (Sourceforge patch #613447)</P>

<P>Badblocks will now work correctly on read-only devices such as
CD-ROM's.  (Sourceforge patch #600451)</P>

<P>Updated and clarified man pages.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=167108" TARGET="_blank">#167108</A>)</P>

<H2><A NAME="1.29">E2fsprogs 1.29 (September 24, 2002)</A></H2>

<P>Fixed a bug in e2fsck which could corrupt a directory when optimizing
it (via the -D option) or rebuilding the hash tree index with a 1 in
512 probability, due to a fence post error.</P>

<P>Fixed a bug in the LVM support code which caused LABEL='xxx' not to
work correctly.</P>

<P>Mke2fs now enables the directory indexing flag by default.  (Since
this is a compatible feature flag, it's safe to do so.)</P>

<P>Tune2fs will support setting the directory indexing feature flag.  It
will automatically set up the default hash algorithm and hash seed
fields in the superblock.</P>

<P>If the bone-headed user enters the root filesystem twice in
/etc/fstab, the -R option which skips the root filesystem will skip
all of them.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=159423" TARGET="_blank">#159423</A>).  Note!  This is not a
precedent for dealing intelligently with any other kind of doubled
entry in /etc/fstab!</P>


<H3>Programmer's notes:</H3>

<P>Removed perror declaration in lib/et/internal.h.  All modern systems
can be expected to define perror() these days.  Besides, the lib/et
code wasn't using perror at all anyway.  :-)</P>

<H2><A NAME="1.28">E2fsprogs 1.28 (August 31, 2002)</A></H2>

<P>Add support for the Hashed-Tree Directory Indexing to e2fsck.  Support
for setting the htree flag is not included yet, although it can be
manually turned on via the debugfs program.</P>

<P>Clarified e2fsck error message which is printed when it cannot find
sufficient contiguous block when relocating filesystem metadata.</P>

<P>Added support for building an EVMS plugin module for ext2/3.  This
module is substantially the same as the EVMS module shipping with EVMS
1.1, with one or two bugfixes.  E2fsprogs can also build this plugin
for use with EVMS 1.0 (which did not include the ext2 plugin module),
if the configure --enable-old-evms flag is given.</P>

<P>Fsck will search through EVMS volumes when trying to resolve
filesystem specifications such as LABEL=xxx or UUID=xxx.</P>
  
<P>Added a new utility program, /sbin/findfs, which will return
filesystem specifications such as LABEL=xxx or UUID=xxx, and prints
the device name.</P>

<P>Update and clarified various man pages. (addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=145044" TARGET="_blank">#145044</A>,
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=146437"
   TARGET="_blank">#146437</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=131350"
   TARGET="_blank">#131350</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=151990"
   TARGET="_blank">#151990</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=144621"
   TARGET="_blank">#144621</A>,
   <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=141938" TARGET="_blank">#141938</A>)</P>

<P>If there are no filesystems specified on fsck's command line, fsck now
treat that as if the -As options were given.  Previously it would
simply do nothing.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=153102" TARGET="_blank">#153102</A>)</P>

<P>Mke2fs no longer treats a failure to be able to clear the MD signature
at the end of the filesystem as a fatal error.  (Addresses Debian Bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=155007" TARGET="_blank">#155007</A>)</P>

<P>The e2p library functions (which are used by lsattr and chattr) now
double check to make sure the file is a regular file or directory
before attempting to use the ext2 ioctls.  Some device drivers
unfortunately respond to the ext2 ioctl's with unknown behaviour.
(Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=152029" TARGET="_blank">#152029</A>).</P>

<P>The extended attribute handling has been updated to correspond with
the latest V2 bestbits ACL code.</P>

<P>Fixed bug in e2fsck which caused it to not clear the dtime field when
processing truncated inodes on the orphan list.  This could cause data
loss(!) if a filesystem is rebooted before a truncate has been
committed.</P>

<P>E2fsck now uses red/black trees in pass1b, which removes some O(n**2)
algorithms.  This makes e2fsck much faster in the case of severely
corrupted filesystems where a large number of blocks are claimed by a
large number of inodes.  (Thanks to the 2.5 IDE device driver for
inspiring this work.)</P>

<P>Resize2fs has been significantly sped up when shrinking and expanding
a filesystem by a very small number of blocks (for example, when EVMS
is converting a partition to be an EVMS legacy volume).</P>

<P>Added a new option to e2fsck, -D, which will optimize or compress all
of the directories in the filesystem.</P>

<P>E2fsck now catches SIGINT and SIGTERM to make sure it will can
properly clean up and only exit at safe points.  Fsck will pass
SIGINT/SIGTERM to its child processes, and wait until they have all
exited before it exits.</P>

<P>The uuid parsing code in the uuid library now properly complains when
an illegally formatted uuid is presented to it.  (Addresses Debian bug
<A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=152891" TARGET="_blank">#152891</A>)</P>

<P>Restrict use of the 2.4 setrlimit ABI f*ckup to kernels between 2.4.10
and 2.4.17, since the workaround can cause problems when using a 2.4
kernel with an old version of glibc built with the 2.2 headers.</P>

<P>Fixed a bug in mke2fs where it wasn't properly clearing the initial
superblock used by other filesystems.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=147256" TARGET="_blank">#147256</A>.)</P>

<P>Added support for the synchronous directory feature written by Andrew
Morton.</P>

<P>The debugfs program can delete directories using the rmdir command.</P>

<P>Add support for 8k and 16k filesystems (for systems with page sizes
that are greater or equal to 8k or 16k, respectively).  Note that
these filesystems can not be mounted on x86 systems, or other systems
with only 4k page sizes, due to limitations in the current Linux VM
code.</P>

<P>Resize2fs requires that the filesystem state be valid and have no
errors; otherwise, e2fsck -f must be run first.  (Previously it simply
required that the last fsck time be greater than the last mount time.)</P>

<P>Configure now defaults the man pages directory to /usr/share/man on
Linux systems.</P>

<P>E2fsck now offers to truncate inodes which contain too many blocks (so
that i_blocks would overflow.  Also fixed handling of large sparse
files.</P>

<P>E2fsck now more completely checks for symlink validity, including
requiring NULL termination and length checks.</P>

<P>E2fsck will offer to try forcing a disk write to remap a bad block
after finding a read error when reading a filesystem metadata block.</P>

<P>Fixed a bug in debugfs which caused the -b and -s options to crash
debugfs, as well as breaking the testb, setb, and clearb functions.</P>

<P>Added a bmap command to debugfs which calculates the logical to
physical block mapping for a particular inode.</P>

<P>Fixed a bug in code which checked to see if a device was mounted which
sometimes (rarely) failed in the case of a plain file.</P>

<P>Fixed a bug in resize2fs where when it reported an error, it would
print a message erroneously indicating that the filesystem had been
resized before it aborted.</P>

<P>When resizing a plain file which is smaller than the requested size,
resize2fs will attempt to extended the file so that programs like
e2fsck will not complain that the file is too small.</P>

<P>Resize2fs will print the actual new size of the filesystem when it is
finished resizing.</P>

<P>Fixed a bug in debugfs where "ls -l" would report incorrect file type
information on big-endian systems.</P>

<H3>Programmer's notes:</H3>

<P>Fixed collisions with C++ reserved words.</P>

<P>Added portability fixes for building e2fsprogs on the HURD and AIX.</P>

<P>Added the ext2ed program for creation of test cases.  (ext2ed has many
limitations and bugs which make it unsuitable for production use.)</P>

<P>The ext2fs_read_dir_block2 and ext2fs_write_dir_block now take a new
flag, EXT2_DIRBLOCK_V2_STRUCT, which will will reverse when the
name_len field is byte swapped on big-endian machines, since in the
V2 structure, name_len is a char field which is doesn't need to be
byte swapped --- except if an old-style kernel had byte-swapped the
name_len field as part of the V1 structure.</P>
  
<H2><A NAME="1.27">E2fsprogs 1.27 (March 8, 2002)</A></H2> 

<P>The warning messages for mke2fs now go to standard error.</P>

<P>Fixed to make sure "make check" runs all of the test programs with
LD_LIBRARY_PATH set, so that we test the libraries in the build tree.</P>

<P>The mke2fs program checks the boot sector for the BSD disk label, and
avoids erasing it if it is there.</P>

<P>Fixed a bug in e2fsck which caused it to core dump if the journal
inode was missing when it was supposed to be there.</P>

<P>E2fsck now prints ranges in pass 5 when printing deltas for the block
and inode bitmaps.</P>

<P>Debugfs's "ls -l" command now will print out the file type information
in the directory entry.</P>

<P>Create man pages and hard links for fsck.ext3 and mkfs.ext3.  If
mke2fs is invoked as mkfs.ext3, create the filesystem with a journal.</P>

<P>Debugfs can now examine the experimental directory indexing
information.</P>

<P>Fixed bug in debugfs which caused it to core dump if modify_inode is
called without an open filesystem.</P>

<P>The debugfs lsdel command now runs its output through a pager first.</P>

<P>When installing manual pages, remove the compressed manual pages first.</P>

<P>Synchronized with Debian's packaging information for e2fsprogs-1.26-1.</P>

<P>Fix the 2.4 resource limitation workaround introduced in 1.26 which
actually broke things on mips32, sparc32, and Alpha platforms.</P>

<P>Updated the I18N code so that calls to setlocate(LC_CTYPE, 0) are made
(which is required by the newer libintl libraries).</P>

<H3>Programmer's notes:</H3>

<P>Fixed various gcc -Wall complaints.</P>

<P>Fixed a few memory leaks in the e2fsck journalling code, and in the
ismounted code checking for a swap device.</P>

<P>Add new inode I/O abstraction interface which exports an inode as
an I/O object.</P>
  
<P>Exported ext2_file_flush as a public interface.</P>
  
<P>In ext2_file_write, we now mark the buffer void * argument as a const,
since ext2_file_write doesn't modify the buffer.</P>

<P>Lots of small random portability fixes to make e2fsprogs build under
AIX --- even without the 5L compatibility toolkit, and even using the
uber-crippled AIX native C compiler.</P>


<H2><A NAME="1.26">E2fsprogs 1.26 (February 3, 2002)</A></H2>

<P>Dumpe2fs will keep going now if the bad block inode can't be read.
(Previously it stopped with a fatal error.)</P>

<P>E2fsck will now give an opportunity to run the journal even if the
recovery flag is not set.  This is the default behaviour if e2fsck is
using a backup superblock, since the needs_recovery flag will never be
set in the backup superblock copies.</P>

<P>E2fsck now automatically finds the backup superblock/group descriptors
even when the primary superblock is completely destroyed for 2k and 4k
filesystems.  (Previously it just guessed/assumed that we were dealing
with a 1k filesystem in that case, and users had to manually specify
the backup superblock number.)</P>

<P>Fixed a bug in e2fsck where it dereferences a null pointer when there
is a problem opening a filesystem in preen mode.</P>

<P>E2fsck now handles external journals correctly; previously it trashed
the external journal device if the journal needed to be replayed.</P>

<P>Work around ulimit incompatibility problem caused by recent 2.4
kernels; the unix IO module will automatically try to set any resource
limits to be infinite on startup.</P>

<P>Fixed a bug in e2fsck where it wasn't allocating a new block or inode
bitmap if it wasn't present and the blocksize was 2k or 4k.
(Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=116975" TARGET="_blank">#116975</A>)</P>

<P>E2fsck will check and fix botched ext3 V1 to V2 superblock updates by
clearing the new V2 fields if they do not make sense or if the ext3
superblock is version 1 superblock.</P>

<P>E2fsck will automatically relocate the ext3 journal from a visible
file (i.e., /.journal) to an hidden inode if the filesystem has been
opened read/write.  This allows the users to add a journal while the
filesystem is mounted, but the next time the system is rebooted, the
journal file will disappear.  This avoids problems with backups,
stupid operators with superuser bits, etc.</P>

<P>Fix a bug in fsck where it would not support a filesystem type of
"auto" if the device was specified in terms of LABEL=xxx or UUID=xxx.</P>

<P>Fsck now supports fstab entries of the form "ext3,ext2".  It will also
automatically identify reiserfs filesystems.</P>

<P>The number of processes spawned by fsck can now be limited using the
FSCK_MAX_INST environment variable.</P>

<P>Fsck now searches the LVM proc hierarchy to find logical volumes which
should be searched for  UUID and label information.</P>

<P>Work around a bug in 2.4.10+ kernels by trying to unset the filesize
limit if at all possible, when opening a block device.  (The filesize
limit shouldn't be applied against writes to a block device.)</P>

<P>In mke2fs and e2fsck, specifying the -c option twice will now do
a read/write test on the disk.  Update the man pages to encourage
using the -c option, and to discouraging running badblocks separately,
since users tend to forget to set the blocksize when running 
badblocks.</P>

<P>Mke2fs now automatically clears the immutable attribute on a
pre-existing .journal file left over from a previous failed attempt to
add a journal to an already-mounted filesystem.</P>

<P>Fixed mke2fs's exit codes to consistently indicate when the mke2fs
operation failed.</P>

<P>Mke2fs now creates the lost+found directory with permissions of 0700,
so that files that had previously lived in protected directory are
safe if they get dropped in lost+found and the system administrator
doesn't deal with immediately.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=118443" TARGET="_blank">#118443</A>)</P>

<P>Mke2fs and e2fsck (and all programs that use the
ext2fs_check_if_mounted function) will now properly identify that a
device is mounted, even in cases where devfs has confused things with
multiple devices names with the same identity, or if a dim-witted
system administrator has done something stupid like creating device
file aliases in their home directory.  Also now checks for swap devices
by using /proc/swaps.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=106622" TARGET="_blank">#106622</A>)</P>

<P>Added a new option (-T) to tune2fs which sets the time a filesystem
was last checked.</P>

<P>Speed up e2image when creating sparse raw image files by optimizing
away excess lseek() system calls.</P>

<P>Fix support of large (> 2GB) files when used as a filesystem in
mke2fs, tune2fs, debugfs, and findsuper.</P>

<P>Debugfs's stat and icheck commands now properly deals with large (>
2GB) files.</P>

<P>Debugfs's set_super_value command now prints out the list of valid
superblock fields which can be set using the command.</P>

<P>Debugfs's rm and kill_file command now updates the superblock free block
and inode counts, thus keeping the filesystem consistent.</P>

<P>Debugfs's lsdel command now takes an optional argument which allows
the user to only see the most recently deleted files.</P>

<P>A new command (undel) was added to debugfs which automates
undeleting a deleted inode and linking it back to a directory.</P>

<P>Debugfs's ls command now takes a new option, -d, which lists 
deleted directory entries.</P>

<P>Debugfs's testb, freeb, setb, and find_free_block commands now take an
optional count argument.</P>

<P>Add support for a new ext2 file attribute, EXT2_NOTAIL_FL, which will
be used to signal that a particular inode should not be eligible for
tail-merging --- this is needed for programs like LILO.</P>

<P>The findsuper (an unreleased, uninstalled utility program) has been
improved to add extra validity checks and to add a progress meter.
(It is still an unsupported program; the officially supported way to
recover from a trashed partition table is to use gpart; findsuper is
for wizards only.  :-)</P>

<P>Debugfs was fixed to compile with "configure --disable-swapfs".</P>

<P>Cleaned up various manual pages.   (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=119624"
  TARGET="_blank">#119624</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=120171" TARGET="_blank">#120171</A>)</P>

<P>Added new translation file for Turkish.</P>

<H3>Programmer's notes:</H3>

<P>Fix general gcc -Wall complaints.</P>

<P>E2fsprogs (mostly) works with the dietlibc.</P>

<P>The programming texinfo file has been expanded to include description
of additional libext2fs functions.  (Still not completely done, but a
lot of the more important functions have been documented.)</P>

<P>Added a umask structure to struct_ext2_filsys, which currently only
modifies the behaviour of ext2fs_mkdir(), but if we add any file
creation functions to libext2fs, we should also make sure they respect
the umask setting.</P>

<P>The build-rpm script was fixed to be a bit more safe.</P>

<P>The tests' Makefile now has a way of automating test case creation 
for e2fsck, using "make testnew".</P>

<P>Created a new function, ext2fs_dir_iterate2 which passes more
information to the callback function (identical to the one used by
ext2fs_dblist_dir_iterate).  The directory iterator functions take a
new flag, DIRENT_FLAG_INCLUDE_REMOVED, which will return deleted
directory entries.  If the directory entry is deleted, the callback
function will be called with the entry parameter set to
DIRENT_DELETED_FILE.</P>
  
<P>Added new functions, ext2fs_inode_alloc_stats and
ext2fs_block_alloc_stats, which takes updates block/inode allocation
statistics in the bitmaps, block group descriptors, and superblock
when inodes or blocks are allocated or deallocated.</P>


<H2><A NAME="1.25">E2fsprogs 1.25 (September 20, 2001)</A></H2>

<P>This is primarily a bug-fix release; no new features were added, but
there are a number of embarrassing bug fixes and cleanups applied.</P>

<P>Fix a bug mke2fs which causes stack garbage to be written to disk when
zapping disk sectors.  (This bug could cause mke2fs to core dump for
some kernels, I suspect with security enhancement patches.)</P>

<P>Remove unneeded #include of &lt;linux/config.h&gt; which was breaking
building e2fsprogs on the Hurd.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=112414" TARGET="_blank">#112414</A>.)</P>

<P>Updated tune2fs man page to reflect the fact that adding or removing a
journal doesn't require running e2fsck.</P>

<P>Remove use of AC_REQUIRE from autoconf which had been used to prevent
AC_CANONICAL_HOST from being called twice; unfortunately this causes
recent autoconf to bomb out since they don't allow AC_REQUIRE to be
used outside of autoconf macros.  Fortunately, it doesn't seem to be
necessary any more, anyway.</P>

<P>E2fsck will now not fall back to an alternate superblock if the user
specifies the superblock location explicitly on the command-line.
This allows easier recovery from a situation where the primary
superblock and block groups are slightly corrupted, but the backup
superblocks are completely broken.  </P>

<P>Fix problem which caused compile_et and mk_cmds to blow up if
e2fsprogs was in a directory with a pathname that contained spaces.</P>

<P>We are now more paranoid about checking the entry in /etc/mtab to make
sure the filesystem is really mounted, since some broken distributions
(read: Slackware) don't initialize /etc/mtab before checking non-root
filesystems.  (Slackware also doesn't check the root filesystem
separately, and reboot if the root filesystem had changes applied to
it, which is dangerous and broken, but there's nothing I can do about
that.)</P>

<P>Make UUID library C++ friendly by adding appropriate extern "C"
declarations and using const in the function declarations.</P>

<P>Fix up the com_err texinfo file so that it can product a valid info
file (previously, it could only be used to generate paper
documentation using texinfo.tex).</P>


<H2><A NAME="1.24a">E2fsprogs 1.24a (September 2, 2001)</A></H2>

<P>Fix brown-paper bug in mke2fs which caused it to segfault when
printing the version string.</P>


<H2><A NAME="1.24">E2fsprogs 1.24 (August 30, 2001)</A></H2>

<P>Revert the BLKGETSIZE64 support, since for some distributions, this
ioctl has been used by an unofficial kernel patch to update the last
sector on the disk, and this was causing disk corruption problems as a
result.
</P>

<P>Mke2fs is now more careful about zapping swap space signatures and
other filesystem/raid superblock magic values so that programs like
mount who try to use heuristics to determine the filesystem type of a
partition are less likely to be confused.
</P>

<P>E2fsck will no longer complain if the the mode of EXT2_RESIZE_INO is a
regular file (since Andreas Dilger's on-line resizing tools will set
its mode bits).
</P>

<P>Fixed some minor texinfo, man pages nits for spelling errors,
texinfo warnings, etc.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=110621" TARGET="_blank">#110621</A>.)
</P>

<P>E2fsprogs program no longer print the filesystem version number
(i.e. 0.5b), since it only confuses people and doesn't serve any real
purpose.
</P>

<P>E2fsck will once again compile under libc5, since it will supply its
own version of strnlen if necessary.
</P>

<P>Mke2fs and tune2fs will allow the use of UUID= or LABEL= specifiers
when specifying the external journal device.  tune2fs will also search
devices looking for the external journal debice when removing it.
</P>

<H2><A NAME="1.23">E2fsprogs 1.23 (August 15, 2001)</A></H2>

<P>Add initial support for extended attributes (EA); e2fsck will
correctly handle a filesystem with EA's and check the EA blocks for
corruptions.
</P>

<P>E2fsck's symlink sanity checking has been cleaned up.  It now checks
the i_size value of fast symlinks, and checks for immutable flags
being set of symlinks, etc.
</P>

<P>E2fsck now offers to clear inodes which are special files that have a
non-zero i_blocks or i_size field.  (The i_size field check was in the
previous version of the code, but due to a bug it didn't offer to
clear the inode unless i_size and i_size_high were both non-zero.)
</P>

<P>E2image can now create "raw" image files, which only contain the
filesystem metadata placed in a spare file so that e2fsck, dumpe2fs,
debugfs, etc., can be run directly on the raw image file.
</P>

<P>Add support for the 64-bit block device patches.
</P>

<P>Fixed bugs in creating external journals with a 1k blocksize.
</P>

<P>Add initial support for external journals (so long as the external
journal only supports a single filesystem) in e2fsck.
</P>

<P>Remove requirement for needing to run fsck on a filesystem after
removing a journal (either internal or external).
</P>

<P>The man pages now document how to create and manage external journals.
</P>

<P>Speed up the check of an ext3 filesystems by avoiding a needless flush
of all of the superblock and block group descriptors.
</P>

<P>Speed up creating an internal journal using tune2fs in the case where
the filesystem has a lot blocks already allocated.
</P>

<P>Tune2fs has been fixed to make sure that only error messages go to
stderr, and normal message go to stdout. (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=108555" TARGET="_blank">#108555</A>)
</P>

<P>Fixed a minor bug in mke2fs; if -O none is passed to mke2fs, it will
now not set the sparse_super feature.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=108165" TARGET="_blank">#108165</A>)
</P>

<P>Add support in fsck for the filesystem type "auto".
</P>

<P>Fsck -A will not try to interpret device names for filesystems which
have a pass number is 0.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=106696" TARGET="_blank">#106696</A>).
</P>

<P>Fsck prints a warning message if now valid filesystems are passed to
it.  (Addresses Debian Bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=107458" TARGET="_blank">#107458</A>.)
</P>

<P>E2fsck now gives an explicit warning if there filesystem still has
errors at the end of the run. (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=104502" TARGET="_blank">#104502</A>)
</P>

<P>E2fsck will set the EXT2_ERROR_FS flag if the journal superblock
reflects an error.  E2fsck will also not run the orphan list if the
filesystem contains errors, since the orphan list might be corrupted.
</P>

<P>E2fsck now prints the number of large files when given the -v option.
</P>

<P>Fixed minor memory leaks in e2fsck.
</P>

<P>Some minor man pages updates. (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=30833"
  TARGET="_blank">#30833</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=108174" TARGET="_blank">#108174</A>)
</P>

<H2><A NAME="1.22">E2fsprogs 1.22 (June 22, 2001)</A></H2>

<P>Fixed a bug in e2fsck's handling of orphan inodes which are special
files (i.e., block/character device files, named FIFO's, etc.).
</P>

<P>Fixed a bug accidentally introduced in e2fsprogs 1.21 which caused
tune2fs to fail at adding a journal to a mounted filesystem.
</P>

<P>Fixed a few big-endian bugs in e2fsprogs:
</P>
<UL>
<LI> The directory block functions were accidentally reporting
		some directories as corrupted when they weren't.
<LI> If e2fsprogs is compiled --disable-swapfs, the C language 
		  equivalents weren't being included for big-endian platforms.
		  (Fixes Debian bug
		  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=101686"
		  TARGET="_blank">#101686</A>).
</UL>

<P>Fixed a Hurd compilation problem.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=101361" TARGET="_blank">#101361</A>)
</P>

<H3>Programmer's notes:</H3>


<P>Use platform independent method of defining the BLKFLSBUF and FDFLUSH
ioctls, and allow them to be defined for non-i386 platforms.
</P>

<P>The uuid.h header file is now protected against multiple inclusions.
</P>

<P>E2fsprogs is now being developed using BitKeeper.  Changed the test
scripts to deal with BK's stripping CR characters from text files,
and changed the top-level Makefile.in to avoid including BitKeeper
files when generating the source tarball.
</P>

<H2><A NAME="1.21">E2fsprogs 1.21 (June 15, 2001)</A></H2>

<P>Added new configure flags which allow a subset e2fsprogs to be built;
this is most useful for boot floppies, since the resulting shared
libraries and programs are slimmed down by removing features that
aren't necessary for a boot floppy.  The new flags that were added
are: --disable-swapfs, which removes support for byte swapping old
legacy PPC/68k filesystems, --disable-debugfs, which removes support
for debugfs from the libext2fs library, --disable-imager, which
removes support for the e2image program, and --disable-resizer, which
removes support for resize2fs.</P>

<P>E2fsck now prints the number of mounts or days elapsed since the last
check when e2fsck is forced to check an otherwise clean filesystem.</P>

<P>Tune2fs now prints an informative message about how often a filesystem
will be checked when adding a journal to the filesystem, to remind the
user that he/she may want to adjust those parameters using tune2fs
-c/-i.</P>

<P>Worked around hurd brain-damage which causes e2fsck to sometimes
believe a filesystem is the root filesystem based on device numbers
(since Hurd doesn't have dev_t's, which is arguably a POSIX.1
violation).</P>

<P>Fixed a bug introduced in 1.20 which caused e2fsck to abort with an
erroneous error with the -F option was specified.</P>

<P>Fixed a ext3 recovery bug in the revoke handling; synchronized with
ext3 0.7a.</P>

<P>Fixed two bugs in e2fsck's handling of dup block handling, dealing
with relatively uncommon edge cases: a directory with an indirect
block which is claimed by another file, and when the last inode in the
filesystem has blocks claimed by another file.</P>

<P>E2fsck now checks to see if the i_size field of a fast symlink is too
big, and offers to clear the symlink if so.</P>

<P>E2fsck now checks to see if i_size_high of special files is non-zero,
and offers to clear i_size_high.</P>

<P>Fix e2fsck's handling of incompatible journal flags so that the user
has chance to abort, and then has the option to clear out the journal
entirely.  (Addresses Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=98527" TARGET="_blank">#98527</A>.)</P>

<P>Fixed a bug in fsck which could cause it to core dump if a mix of
standard and non-standard device names are used in /etc/fstab.
(Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=100559" TARGET="_blank">#100559</A>)</P>

<P>Fixed a bug in debugfs which caused read errors when copying a file to
not be noticed.</P>

<P>The debugfs set_super_value command can now modify the s_lastcheck field.</P>

<P>Fixed a bug in lsattr and chattr which was accidentally introduced in
1.20 to support > 2GB files; both lsattr and chattr wasn't reading
directories correctly because the change modified the layout of struct
dirent to be incompatible with the libe2p shared library.</P>

<P>Cleaned up the mke2fs manual page and included a discussion about why
it's good to periodically check the filesystem even when journalling is
enabled.</P>

<H3>Programmer's notes:</H3>

<P>Fix general gcc -Wall complaints.</P>

<P>The types needed by the ext2 header files are now provided by
lib/ext2fs/ext2_types.h, instead of include/asm/types.h.</P>

<P>Integers are now preferred to longs when trying to find a 32-bit type
in ext2_types.h.  Also, if linux/types.h has already been defined,
don't try to redefine the types.</P>

<P>Fixed make depend script so that it automatically corrects the
pathname cleanups performed by make -M, so I don't have to fix them up
by hand.</P>

<P>Fixed the d_loaddump test case to be more robust, and not depend on
bash'isms.</P>

<P>Removed debugfs's dependence on pread(), which was accidentally
introduced in e2fsprogs 1.20</P>

<P>Fixed a performance bug in the libext2fs's icount routine; the size
estimate of the icount array was incorrectly being calculated.</P>

<P>Removed use of the badblocks compatibility functions in the e2fsprogs
programs.</P>

<P>Added paranoia code which protects against strange cases where /etc
isn't on the root filesystem, or if /etc/mtab doesn't exist.</P>

<P>The header file ext2_types.h is now installed.</P>

<P>Autoconf is used to determine when we are on big-endian machines,
instead of doing run-time tests, to save a few bytes of code.</P>

<P>The ext2fs_mark_generic_bitmap and ext2fs_unmark_generic_bitmap
functions are no longer inline functions, which saves space and
doesn't really cost any real performance.</P>

<P>The ext2fs library no longer depends on the e2p library.  (What need
there was of it --- namely, fsetflags, was coded in-line).</P>

<P>Fixed the makefile so that lib/ext2fs/ext2_types.h is generated even
when the user is stupid and tries compiling the package using "make
install" as root.</P>

<P>Miscellaneous code cleanups:
<UL>
<LI> Added missing files from Makefile.in's SRCS file, so that 
		their dependencies would be properly calculated.
<LI> Removed redundant code
<LI> Fixed comments in code
<LI> Removed no-longer needed argsused #pragma.
</UL></p>


<H2><A NAME="1.20">E2fsprogs 1.20 (May 20, 2001)</A></H2>

<P>Add support for replaying the ext3 journal purely in user mode,
including handling the orphaned inode list.  Used code contributed by
Andreas Dilger, with bug fixes and the orphaned inode handling done
by Theodore Ts'o.</P>

<P>The mke2fs and tune2fs programs can create or modify a filesystem to
include an ext3 journal.  Tune2fs also can be used to remove an ext3
journal from a filesystem.</P>

<P>E2fsck will now check for the existence of a linked list of orphan
inodes in the superblock, and clear those inodes before starting the
rest of the filesystem check (but after the journal playback).</P>

<P>E2fsck now validates the file descriptor passed to the -C option,
which saves against the completion bar getting written to an
unexpected location, such as the disk being checked.  (Debian
bug/wishlist
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=55220" TARGET="_blank">#55220</A>)</P>

<P>E2fsck will now bump the filesystem revision number from zero to one
if any of the compatibility bits are set.</P>

<P>Fixed a bug where a badly corrupted directory on a big endian system
could cause e2fsck to die with a bus error.  The
ext2fs_read_dir_block() and ext2fs_process_dir_block() functions in
the ext2 library now does alignment sanity checks on the rec_len field
of the directory entry before using it.</P>

<P>The ext2 library has been enhanced to make tune2fs safe to run on
mounted filesystems.  (Users could usually get away with using tune2fs
on mounted filesystems before, but with the advent of ext3 and
journalling, it became important to make tune2fs was *really* safe for
use even when the filesystem being modified is mounted.)  E2label is
now implemented by tune2fs using an argv[0] dispatch, so that e2label
is also now safe for use on mounted filesystems.</P>

<P>Added a new program, e2image, which creates a backup of critical ext2
filesystem data structures.  The generated image file can be examined
using dumpe2fs and debugfs.  In the future, e2fsck will be able to use
the image file to help recover very badly damaged filesystems.</P>

<P>Fixed a number of LFS bugs in e2fsck; very, very large (> 2**42) files
no longer cause e2fsck to bomb out.  Also treat files > 2GB as being
large file when deciding whether or not the filesystem has large files.</P>

<P>Fixed lsattr and chattr so that they work correctly on large files.
(Fixes Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=72690" TARGET="_blank">#72690</A>.)</P>

<P>Removed limitation in get_device_size() which imposed a one terabyte
filesystem limitation.  (Most 2.2 kernels still have a signed int
problem which cause 1 TB block device limitation.  Fortunately, the
kernel patches to fix this are much easier than fixing the 2TB
limitation in the kernel.  :-)</P>

<P>A max_mount_count of zero is now treated as if no mount count were
set.  (Previously, no mount count was indicated by using -1, and a
mount count of zero caused e2fsck to always be run.)</P>

<P>Mke2fs supports two new filesystem types largefile and largefile4.</P>

<P>Mke2fs now adds some randomness in s_max_mount_count so that multiple
filesystems won't be all checked at the same time under normal
operations.</P>

<P>Fixed bug in the progress bar printing code which could cause e2fsck
to core dump on an illegal filesystem.</P>

<P>Fixed bug in fsck which could allow more than one instance of e2fsck
to be printing a progress bar.  (Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=65267" TARGET="_blank">#65267</A>)</P>

<P>Fsck using a UUID or a LABEL specifier will work even if devfs is
compiled into the kernel and not mounted.  If the pathnames in
/proc/partitions are incorrect, fsck will search /dev for the correct
device (using the new ext2fs_find_block_device library function).
Fsck now also checks the RAID devices first so that they are properly
found when they are in use.  Support has also been added to support
additional IDE disks and the DAC 960 device names.  (Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=94159" TARGET="_blank">#94159</A>)</P>

<P>Fixed a bug in fsck which caused it not deal properly with 16
byte long filesystem labels.</P>

<P>Fsck's -t option has been made a lot more flexible.  The semantics for
what happens if a comma-separated list to fsck has been regularized,
and it is now possible to filter what filesystems will get checked
based what is in the filesystem's fstab entry's option field.  (Debian
bug <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=89483" TARGET="_blank">#89483</A>.)</P>

<P>The dumpe2fs program can now print out the group description
information in hex, and also prints the location of the superblock and
block group descriptor for those block groups that have them.</P>

<P>Mke2fs now clears the ext2 superblock before it starts creating a
filesystem, so that the superblock magic number is only written if the
filesystem creation process successfully completes.</P>

<P>The debugfs program's stat command now pretty-prints the blocks used
by an inode so that it's more compact and informative.</P>

<P>The debugfs stats command now uses the same libe2p code (which is used
by dumpe2fs) to print the superblock header information.  This is more
complete, and it avoids a bit of code duplication.</P>

<P>Added a new debugfs command, set_super_value (ssv) which allows the
user to set arbitrary superblock fields.</P>

<P>Debugfs was extended to support inode numbers in hex (by prefixing
them with 0x), and so that modify_inode can set the inode generation
number.  Also, there is now a new function command called logdump
which will dump an ext3 journal.</P>

<P>Fixed a bug in debugfs so that quitting out of the pager doesn't kill
debugfs.</P>

<P>Debugfs's dump command now stops immediately upon reporting a disk
read error.  (Fixed a bug in ext2fs_file_read library routine which
caused debugfs not to stop.)  (Debian bug
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=79163" TARGET="_blank">#79163</A>)</P>

<P>On systems with /proc/mounts (mainly Linux systems), /proc/mounts is
checked before /etc/mtab is used, since /proc/mounts is more likely to
be accurate.</P>

<P>Added portability fixes for Solaris and Linux/ia64.</P>

<P>Various manual pages were clarified and cleaned up.  (Fixed debian
bugs <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=63442"
	TARGET="_blank">#63442</A>,
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=67446"
  TARGET="_blank">#67446</A>, and
  <A HREF="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=87216" TARGET="_blank">#87216</A>)</P>


<H3>Programmer's notes:</H3>

<P>The e2fsck message printer now supports %Iu and %Ig, which will print
out the inode's user and group owners, respectively.</P>

<P>E2fsprogs now includes its own version of include/linux/ext2_fs.h, so
that no longer dependent on the system having the correct version of
the kernel header files.</P>

<P>Added a new function to libext2, ext2fs_find_block_device(), which
searches the system (i.e., /dev, /devfs, /devices) for a pathname to a
device given its device number.</P>

<P>Added a new function to libext2, ext2fs_sync_device, which centralizes
all of the places which might try to use the BLKFLSBUF or FDFLUSH
ioctls (and usually failing to define them since the system header
files don't usually do this for us, and we're trying to avoid usage of
kernel include files now).</P>

<P>Added new utility programs in tests/progs: random_exercise and
hold_inode.  They aren't built by default; they're useful for
exercising ext3 filesystem code.</P>

<P>Added a new ext2 filesystem flag, EXT2_FLAG_SUPER_ONLY, which causes
the filesystem close functions to only update the superblock, and to
not touch the block group descriptors.  Needed by tune2fs when
modifying a mounted filesystem.</P>

<P>Got rid of struct ext2fs_sb and replaced it with the standard struct
ext2_super_block from include/linux/ext2_fs.h.  Note: this may break
source (but not binary) compatibility of some users of the ext2
library.  Those applications should just simply do a global search and
replace of struct ext2fs_sb with struct ext2_super_block, and include
the new header file <ext2fs/ext2_fs.h> which defines it.</P>

<P>The ino_t type has been renamed ext2_ino_t to protect applications
that attempt to compile -D_FILE_OFFSET_BITS=64, since this
inexplicably changes ino_t(!?).  So we use ext2_ino_t to avoid an
unexpected ABI change.</P>

<P>The Makefiles have been reworked so that "make check" can be run from
the top-level Makefile.</P>

<P>Fix general gcc -Wall complaints and removed dead code.</P>

<P>Remove use of NOARGS, because we assume everyone does ANSI C these
days.</P>

<P>Added build-rpm script from sct.</P>

<P>New functions ext2fs_image_{inode,super,bitmap}_{read,write} added 
to support e2image.</P>

<P>New function ext2fs_flush_icache which must be called if the
application program modifies the inode table blocks without going
through ext2fs_write_inode() interface.</P>

<P>New ext2fs_check_mount_point() function, which will return the mount
point of a device if mounted.</P>

<P>The io_channel abstraction now has an optional interface,
io_channel_write_range, which allows specific byte ranges to be
written.  </P>

<P>The unix_io IO channel now supports write-through caching, so that
journal creation is more efficient.</P>

<P>Added x86 assembly language routines to support byte swapping, to
reduce executable size.</P>

<P>Fixed bug in the utility program subst so that it's possible to
replace a substitution variable with a zero-length string.</P>

<P>Fixed numbering e2fsck pass1 problem numbers; an extra zero had
slipped into some of the problem number.</P>
<H2><A NAME="1.19">E2fsprogs 1.19 (July 13, 2000)</A></H2>

<P>Release the resize2fs program since the timeout before it could
be published it under the GPL has finally expired.</P>

<P>Add experimental support needed for the ext2 compression patches.
This requires compiling e2fsprogs with the --enable-compression flag
to the configure script.</P>

<P>Added ext3 journalling support.  E2fsck will run the journal (if
necessary) by temporarily mounting the filesystem.  /sbin/fsck.ext3 is
installed as a symlink to e2fsck.  Fsck has been taught about ext3,
and treats it the same as ext2 in terms of the progress bar logic.
Dumpe2fs will display the superblock journalling information if the
filesystem has a journal.  The ext2 library will now permit opening an
ext3 filesystem with the recovery flag set.  This is necessary for
on-line dump's to work correctly, but there may be issues with this
working well since ext3 is much less aggressive about syncing blocks to
the filesystem, since they're safe on the journal.</P>

<P>Tune2fs and e2fsck have been changed to allow the mount_count check to
be disabled by setting max_mount_count to -1.  (This was already
supported by the kernel.)</P>

<P>Create a symbolic link for fsck.ext3, since the e2fsprogs utilities
are used for ext3 as well.</P>

<P>Added internationalization support for e2fsprogs; must be enabled
by passing --enable-nls to configure.</P>

<P>Always use the provided ext2fs header files to insulate ourselves from
kernel version changes.  Which include files are used by e2fsprogs
have also been cleaned up to improve portability.</P>

<P>Limit the number of times that e2fsck updates the progress bar so that
people who are booting using a 9600 baud console don't get swamped by
too many updates.</P>

<P>Improved the loop detection algorithm in e2sck's pass #3 so that it is
much, much faster for large filesystems with a large number of
directories.</P>

<P>The memory footprint for e2fsck is now slightly smaller than before.</P>

<P>E2fsck now checks if special devices have a non-zero size, and offers
to clear the size field if it finds such an inode.  </P>

<P>E2fsck now checks if special devices have the append-only flag set,
and offers to clear the inode.</P>

<P>E2fsck now properly handles some "should never fail" cases during a
bitmap copy in pass5.</P>

<P>E2fsck now properly prints control characters in filenames as ^A .. ^Z.</P>

<P>Added non-destructive write testing to the badblocks program,
courtesy of David Beattie.  The badblocks also now has an option to
input the current set of bad blocks, so that known bad blocks are
skipped to speed up the badblocks test.  There is also a persistent
rescan feature which causes badblocks to run until it has completed
some number of passes without discovering any new bad blocks.</P>

<P>Badblocks now checks to see if the device is mounted and refuses to
do the tests involving writing to the device if it is mounted.  Also,
badblocks now allows the number of blocks to be checked to be
defaulted to the size of the partition.</P>

<P>Fixed a bug in fsck which didn't allow non-root users to be able to
check filesystems if there were any LABEL= or UUID= entries in
/etc/fstab.</P>

<P>The Hurd doesn't support the filetype filesystem feature.  The mke2fs
program now makes sure that for the Hurd, the filetype feature is
turned off.  E2fsck will check to see if the filetype feature is
turned on for Hurd filesystems, and offer to turn off the feature.</P>

<P>Mke2fs now has a safety check to make sure the number of blocks do not
exceed 32 bits even on a 64 bit platform.</P>

<P>Really fixed a bug in fsck to allow "fsck -As" to run interactive
fsck's.  (For those people who like to do interactive fsck's in the
/etc/rc scripts!?!)</P>

<P>Debugfs has a few new features: the rdump command, which will do a
recursive dump of a directory and all of its contents, and the lcd
command which does a local chdir (much like the ftp command of the
same name).  In addition, the debugfs program and the open_filesystem
command now takes three new options: -b and -s, which allows the
blocksize and superblock location to be specified, and the -c option
which is used in catastrophic situations where the block group
descriptors are corrupt.  If the -c option is specified, debugfs will
skip trying to read in the block and inode bitmaps.</P>

<P>Debugfs's lsdel command was fixed to handle bad blocks in the inode
table.</P>

<P>A Y2K bug in debugfs's "ls -l" handling was fixed by switching to use
4 digit years.</P>

<P>General improvements in error messages</P>

<UL>
<LI> Mke2fs prints a sane error message if the partition size is zero
	(usually because the partition table wasn't reread by the
	kernel due to the partition being busy), instead of "invalid
	argument passed to ext2 library while initializing superblock".

<LI> Fsck now prints more self-explanatory message if an invalid UUID=
	or LABEL= specification is passed to it.
</UL>

<P>UUID library changed to use the LGPL.</P>

<P>Fixed a bug in the UUID library where very rapid calls to the
time-based UUID generator could cause duplicate UUID's to be returned.
This was not a problem for e2fsprogs, but it could be a problem for
other users of the library.</P>

<P>Make the UUID library more robust in the face of missing or an
improper /dev/urandom or /dev/random files.</P>

<P>Added some random portability fixes for Solaris.</P>

<P>Some minor man page updates.</P>

<P>Fixed a memory leak in the ss library.</P>


<H3>Programmer's notes</H3>


<P>We now try to use lseek64 and open64 from the LFS if possible.</P>

<P>The 3rd parameter in e2p's print_flags is now a flags word, instead of
a boolean option.</P>

<P>The mark and unmark bitmap functions now return the previous state of
the bit that was being changed, which is useful for some speed
optimizations.</P>

<P>The following functions have been added to enhance the badblocks list
handling in libext2fs: ext2fs_write_bb_FILE, ext2fs_read_bb_FILE2, and
ext2fs_badblocks_equal.</P>

<P>The ext2 header files now have the latest journalling fields to the
superblock.</P>

<P>The ext2fs_mkdir function in libext2fs now properly backs out of error
conditions robustly.</P>

<P>Cleaned up makefiles:</P>
<UL>
<LI> to cleanly  compile with the -j flag.
<LI> so distclean removes all generated files.
<LI> so in case of an error while installing header files, the make aborts.
</UL>

<P>Fix test_script so that it works correctly when compiling in the
source directory.</P>

<P>Update libraries to build under a.out shared libraries (again).</P>

<P>Clean up the build process so it's more friendly in case of missing
directories.</P>

<P>The ext2fs header file can now be #include'd into C++ programs.</P>

<P>The e2p.h header file is now installed.</P>

<P>Added workaround to a gawk 3.0.5 bug in lib/ss/mk_cmds.</P>


<H2><A NAME="1.18">E2fsprogs 1.18 (November 10, 1999)</A></H2>

<P>Fix a core dumping bug in e2fsck if an imagic inode is present or
(more rarely) if the filesystem is badly corrupted enough that e2fsck
has to restart pass 1 processing.  E2fsck now closes the filesystem
before freeing a large number of its data structures, so in the case
of future memory faults, at least the fixed filesystem will be fully
written out.</P>

<P>If a filesystem doesn't support imagic inodes, and e2fsck discovers an
imagic inode, it will offer to clear the imagic flag.</P>

<P>E2fsck will now offer to clear the immutable flag on special files
(device/socket/fifos) when running it in non-preen mode.</P>

<P>E2fsck will now set the filetype when creating /lost+found, and when
connected orphaned inodes to /lost+found.</P>

<P>Debugfs's ncheck and icheck commands now handles the case where there
are bad blocks in the inode table without bombing out.</P>

<P>The badblocks list processing code has been made more efficiently for
appending a large number of (ordered) badblocks to the badblocks list.</P>

<P>Some minor man page updates.</P>

<P>Fsck now allows interactive e2fsck's when using fsck -As (not a common
mode, but some people like to do this in boot scripts for silly reasons).</P>

<H3>Programmer's notes</H3>

<P>The internal e2fsck problem code for PR_2_SPLIT_DOT was fixed to meet
with the problem code convention.</P>

<P>The badblocks list regression test program has been updated to work
with previously made API name changes.</P>

<P>The ext2fs_free() command now uses the new badblocks API to avoid
using the compatibility layer.</P>

<P>Added new regression test cases; the run_e2fsck test script now
supports the ability for a test case to run a preparatory command
before running e2fsck.</P>

<H2><A NAME="1.17">E2fsprogs 1.17 (October 26, 1999)</A></H2>

<P>Fixed nasty typo in fsck which caused parallelized fsck's to go into an
infinite loop.</P>

<P>Fixed a bug in fsck where it used strncmp to compare a binary UUID,
thus potentially causing problems if a binary UUID contained a NULL
character.</P>

<P>E2fsck now uses stricter checks for directory entries in pass 2:
zero-length filenames are not allowed; neither are 8 byte long
directory entries.</P>

<P>The debugfs "dirty" command now clears the filesystem valid bit.
(Previously this just set the dirty-as-in-needs-writing-out-to-disk
bit in the in-core superblock image.  The new functionality is more
what the user expects, and is more useful.)</P>

<P>Added a debugging hook to test parallel fsck; if the environment
variable FSCK_FORCE_ALL_PARALLEL, then filesystems on the same drive
will be checked in parallel when they normally would not be.</P>

<H3>Programmer's notes</H3>

<P>Fixed some #ifdef's for compilation under the Hurd OS.</P>

<P>Fixed minor W2K compatibility problems.</P>

<P>Fixed some miscellaneous GCC warnings.</P>

<H2><A NAME="1.16">E2fsprogs 1.16 (October 22, 1999)</A></H2>

<P>Fixed a race condition bug in fsck; when printing a progress bar, if
checking multiple filesystems in parallel, it was possible for fsck to
send e2fsck a SIGUSR1 signal before e2fsck had installed its signal
handler, which would cause it to terminate with a signal 10.</P>

<P>E2fsck now properly handles filesystems that have the
INCOMPAT_FILETYPE feature turned on.  It can be used to convert a
filesystem into using or not using FILETYPE feature.</P>

<P>E2fsck now properly handles filesystems that have the IMAGIC feature
turned on (this is used on Linux AFS servers).</P>

<P>The mke2fs program now creates filesystems that have the filetype and
sparse_superblock features enabled by default, unless it is run on a
pre-2.2 kernel.  These features are not supported by a pre-2.2 kernel,
so there is now a new flag -O which allows the user to specify with
which features she would like to create the filesystem; "mke2fs -O
none" will create a filesystem compatible with 2.0 kernels.</P>

<P>The tune2fs program now has a -O option which allows the user to set
and reset "safe" filesystem features.  Currently, the only ones which
allows to be modified are the filetype and sparse_superblock features.
Note setting or clearing either feature will require running e2fsck on
the filesystem afterwards.  (n.b. Clearing the sparse_superblock feature
requires that there is enough free space on the filesystem for the
extra superblocks which will be created by e2fsck.)</P>

<P>Debugfs can now set and print filesystem features in the superblock
using the "features" command.  Dumpe2fs will print out the complete
set of features when listing the superblock.</P>

<P>Dumpe2fs has new options -f (force) and -h (header-only).</P>

<P>Fixed a bug in e2fsck which could cause the PROGRAMMING ERROR/bonehead
message to come up.  This could happen when decrementing or
incrementing a link count could result in an overflow.</P>

<P>Fixed a bug in e2fsck where the block count on the lost+found
directory would not be properly incremented when the directory was
expanded to the point where an indirect block needed to be allocated.</P>

<P>E2fsck now makes some additional sanity checks on the superblock to
avoid crashing or giving a memory allocation error if some of the
values in the superblock are unreasonable (but the superblock otherwise
looks valid).</P>

<P>Fixed a bug in e2fsck where a very badly corrupted filesystem might
require two passes to completely fix the filesystem.  This happened if
an inode claimed blocks that was part of the filesystem metadata
(typically, when garbage was written into an inode table or indirect
block, since this kind of filesystem corruption normally doesn't
happen otherwise).</P>

<P>On the Alpha, glibc declares st_flags although it isn't actually used;
the configure script was improved to detect this case so that
e2fsprogs can avoid using the non-functional stat field.</P>

<P>The manual pages were updated to use a more consistent formatting
style consistent with standard Unix man pages.  Mke2fs's man page
added documentation for a few previously undocumented options.</P>

<P>Fixed minor display bugs in tune2fs and mke2fs.</P>

<H3>Programmer's notes</H3>

<P>Improved portability of e2fsprogs to non-Unix systems (in particular, NT).</P>

<P>Added features to parse and print feature strings into the e2p library.  
(e2p_feature2string, e2p_string2feature, e2p_edit_feature).</P>

<P>ext2fs_mkdir() and ext2fs_new_dir_block() now creates directories
whose directory entries contain proper filetype information if the
filesystem supports it.</P>

<P>ext2fs_link() now uses the low 3 bits of its flags parameter to pass
the directory entry filetype information.  This is used to set the
directory entry filetype information if the filesystem supports it.</P>

<P>Fixed a bug in ext2fs_expand_dir() where the block count in a
directory's inode would not be properly incremented when the directory
was expanded to the point where an indirect block needed to be
allocated.</P>

<H2><A NAME="1.15">E2fsprogs 1.15 (July 18, 1999)</A></H2>

<P>Add configuration checks so that e2fsprogs will compile cleanly on
Linux 2.3 kernels that have renamed i_version to i_generation.</P>

<P>E2fsck now prints a progress/completion bar (and not just a simple
spinner) if the -C0 option is requested or if it receives a SIGUSR1
signal.  Fsck will automatically manage the (potentially multiple)
e2fsck processes to print completion bars if it is given a -C option,
with the right thing happening if multiple filesystems are being
checked in parallel.</P>

<P>Mke2fs now has better automatic heuristics to determine the filesystem
parameters to be used for a particular filesystem.  Added a new option
-T which allows the user to specify how the filesystem is to be used,
which helps mke2fs do a better job selecting the filesystem parameters.</P>

<P>Mke2fs now creates revision 1 filesystems by default, and with the
sparse superblock feature enabled.  The sparse superblock feature is
not understood by Linux 2.0 kernels, so they will report errors when
mounting the filesystem.  This can be worked around by using the mount
options "check=none".</P>

<P>Fix bug where if /dev/null couldn't be opened (should never happen),
e2fsck would hang in a tight loop.</P>

<P>Make e2fsck handle the case where /lost+found isn't a directory.</P>

<P>E2fsck now uses mallinfo if it exists to get accurate statistics about
its memory usage.</P>

<P>Fix bug in e2fsck where it wouldn't check to see if a disconnected
inode had any problems before connecting it to /lost+found.</P>

<P>Add check to e2fsck so it makes sure that total number of inodes in
the filesystem is a sane number.</P>

<P>Fix fencepost error when clearing an the end of the block bitmap which
caused the last block in the bitmap not to get cleared.</P>

<P>Cleaned up a number of messages in e2fsck:</P>
<UL>
<LI> The message "Group's #'s copy of the group descriptor..."
		was fixed so that the correct number would be displayed.
<LI>  Added missing space in the "disk write-protected" error message
<LI>  Cleaned up the error message printed when a non-interactive
		e2fsck needs to abort a check because the filesystem
		appears to be mounted.
</UL>

<P>Added a new command-line utility, uuidgen, which will create and print
a UUID.</P>

<P>Make debugfs's icheck command more robust by checking to make sure an
inode has valid blocks before iterating over the inode's blocks.</P>

<P>UUID generation now uses a random-based scheme whenever possible to
prevent potential privacy problems.</P>

<P>Man pages for all of the UUID functions in the library were added.</P>

<P>Fixed bug in fsck so it won't coredump if a filesystem not in
/etc/fstab is given to it.</P>

<P>Fsck now understands the UUID=xxxx and LABEL=yyyy forms in /etc/fstab
that most of the other mount utilities understands.</P>

<P>Mke2fs will make a filesystem even if it appears mounted if the force
option is given.</P>

<P>Dumpe2fs has new command-line options which allow a filesystem expert
to specify the superblock and blocksize when opening a filesystem.
This is mainly useful when examining the remains of a toasted
filesystem.</P>

<P>The badblocks program has been updated to display correctly on disks
with large block numbers.</P>

<P>The badblocks program no longer gives spurious errors when errors
occur on non-block boundaries, which is common if the blocksize is
larger than 1k.</P>

<P>Mke2fs will sync the disk device every MKE2FS_SYNC block groups if the
MKE2FS_SYNC environment variable is set.  This is to work around a VM
bug in the 2.0 kernel.  I've heard a report that a RAID user was able
to trigger it even using a 2.2 kernel, but hopefully it will not be
needed for most Linux 2.2 users.</P>

<P>Fixed miscellaneous documentation and man pages.</P>

<H3>Programmer's notes</H3>

<P>Cleaned up functions such as pass1_get_blocks, pass1_read_inode which
in e2fsck's pass1.c really should have been static.</P>

<P>The return value of the uuid_compare() function was changed to make it
match with the conventions used by strcmp, memcmp, and Paul Leach's
UUID sample document.</P>

<P>The "make depend" process has now been made more automated; it now
automatically word-wraps the dependencies, and only replaces source
Makefile.in if there has been a change in the dependencies.  Also, a
top-level "make depend" now recurses through all the subdirectories
automatically.</P>

<P>The Makefile in .../util has been changed so that subst is built using
the native C compiler during a cross-compilation, since the subst
program is only used during the build process.  Also add an explicit
rule to build util/subst by cd'ing to the correct directory and
running Makefile.</P>

<P>The man directories are defined in terms mandir, so that the configure
script can override the location of the manual pages.</P>

<P>The config files have been updated to recognize new machine types for
both the i386 and alpha families.</P>

<P>Fsck has been modified so that it will accurately create an
fsck_instance even when the noexecute flag is set.  This allows for
accurate debugging of the fsck pass structure.  Also, when the verbose
flag is given twice, fsck will print debugging information about when
fsck is waiting for jobs to finish.</P>



<H2><A NAME="1.14">E2fsprogs 1.14 (January 9, 1999)</A></H2>

<P>Fix the fstab parsing code so that it can handle blank lines and
comment characters.  Also, missing pass numbers need to be treated as
zero.</P>

<P>Fixed a bug in e2fsck where under some circumstances (when e2fsck
needs to restart processing after fixing an egregious inconsistency)
it would try to access already freed memory.</P>

<P>E2fsck now prints non-printable characters in directory entries and
pathnames using '^' and 'M-' notation.</P>

<P>Fixed chattr so that it will ignore symbolic links when doing
recursive descent traversals.  For both chattr and lsattr, no longer
print the version string unless the -V option is given.</P>

<P>Allow the system administrator to directly specify the number of
inodes desired in the filesystem, for some special cases where this is
necessary.</P>

<P>Fix portability problems so that e2fsprogs can be compiled under Linux
1.2 systems and Solaris systems.</P>

<P>Update the config.guess file with a more recent version that will
identify newer Linux platforms.</P>

<H3>Programmer's notes</H3>

<P>Ext2fs_read_inode and ext2fs_write_inode will now return an error if
an inode number of zero is passed to them.</P>

<H2><A NAME="1.13">E2fsprogs 1.13 (December 15, 1998)</A></H2>

<P>Fixed a bug in debugfs where an error messages weren't getting printed
when the ext2 library routines to read inodes returned errors in the
stat, cmri and rm commands.</P>

<P>Fixed a bug in mke2fs so that if a ridiculous inode ratio parameter is
provided, it won't create an inode table smaller than the minimum
number of inodes required for a proper ext2 filesystem.</P>

<P>Fsck now parses the /etc/fstab file directly (instead of using
getmntent()), so that it can distinguish between a missing pass number
field and pass number field of zero.  This caused problems for
diskless workstations where all of the filesystems in /etc/fstab have
an explicit pass number of zero, and fsck could not distinguish this
from a /etc/fstab file with missing pass numbers.</P>

<P>E2fsck will create a /lost+found directory if there isn't one in the
filesystem, since it's safer to create the lost+found directory before
it's needed.</P>

<P>Fixed e2fsck so that it would detect bogus immutable inodes which
happen to be sockets and FIFO files, and offer to clear them.</P>

<P>If a filesystem has multiple reasons why it needs to be checked, and
one of the reasons is that it is uncleanly mounted, e2fsck will print
that as the reason why the filesystem is being checked.</P>

<P>Cleaned up the output routines of mke2fs so that it doesn't overflow
an 80 column display when formatting really big filesystems.</P>

<P>Added a sanity check to e2fsck to make sure that file descriptors 0,
1, 2 are open before opening the hard disk.  This avoids a problem
where a broken program might exec e2fsck with those file descriptors
closed, which would cause disastrous results if the kernel returns a
file descriptor for the block device which is also used by FILE *
stdout.</P>

<P>Fixed up the e2fsck progress reporting functions so that the values
reliably reach 100% at the completion of all of the e2fsck passes.</P>

<P>Fixed minor documentation bugs in man pages and usage messages.</P>

<H3>Programmer's notes</H3>

<P>Fixed a number of lint warnings in the ext2fs library and potential
portability problems from other OS's header files that might define
CPP macros for names like "max" and "min".</P>

<P>ext2fs_badblocks_list_add() has been made more efficient when it needs
to grow the bad blocks list.</P>

<P>Fixed a bug in e2fsck which caused it to dereference a freed pointer
just before exiting.</P>

<P>Fixed the substitution process for generating the mk_cmds and compile_et
scripts so that they will work outside of the build tree.</P>

<P>Add sanity check to e2fsck so that if an internal routine
(ext2fs_get_dir_info) returns NULL, avoid dereferencing the pointer
and causing a core dump.  This should never happen, but...</P>

<H2><A NAME="1.12">E2fsprogs 1.12 (July 4, 1998)</A></H2>

<P>E2fsprogs now works with glibc (at least with the version shipped with
RedHat 5.0).  The ext2fs_llseek() function should now work even with
i386 ELF shared libraries and if llseek() is not present.  We also
explicitly do a configure test to see if (a) llseek is in libc, and
(b) if llseek is declared in the system header files.  (See standard
complaints about libc developers don't understand the concept of
compatibility with previous versions of libc.)</P>

<P>The ext2fs library now writes out the block group number in each of
the superblock copies.  This makes it easier to automatically
determine the starting block group of the filesystem when the block
group information is trashed.</P>

<P>Added support for the EXT2_FEATURE_INCOMPAT_FILETYPE feature,
which means that e2fsprogs will ignore the high 8 bits of the
directory entry's name_len field, so that it can be used for other
purposes.</P>

<P>Added support for the EXT2_FEATURE_RO_COMPAT_LARGE_FILE feature.
E2fsprogs will now support filesystems with 64-bit sized files.</P>

<P>Added support for the EXT2_FEATURE_COMPAT_DIR_PREALLOC feature.</P>

<P>Added new program "e2label", contributed by Andries Brouwer.  E2label
provides an easy-to-use interface to modify the filesystem label.</P>

<P>Fixed bug so that lsattr -v works instead of producing a core dump.</P>

<P>Fixed a minor bug in mke2fs so that all groups with bad superblock
backup blocks are printed (not just the first one).</P>

<P>Mke2fs will check the size of the device, and if the user specifies a
filesystem size larger than the apparent size of the device it will
print a warning message and ask if the user wants to proceed.</P>

<P>E2fsck has a new option -C, which sends completion information to the
specified file descriptor.  For the most part, this is intended for
programs to use, although -C 0 will print a spinning character to the
stdout device, which may be useful for users who want to see something
happening while e2fsck goes about its business.</P>

<P>Fixed a bug in e2fsck which could cause a core dump when it needs to
expand the /lost+found directory, and sometimes the bitmaps haven't
been merged in.  Also fixed a related bug where ext2fs_write_dir_block
was used to write out a non-directory block.  (Which would be bad on a
non-Intel platform with byte swapping going on.)</P>

<P>Fixed bug in e2fsck where it would print a "programming error" message
instead of correctly identifying where a bad block was in used when
the bad block was in a non-primary superblock or block group
descriptor.  Also fixed a related bug when sparse superblocks are in
use and there is a bad block where a superblock or block group
descriptor would have been in a group that doesn't include a
superblock.</P>

<P>Fixed a bug in e2fsck (really in libext2fs's dblist function) where if
the block group descriptor table is corrupt, it was possible to try to
allocate a huge array, fail, and then abort e2fsck.
ext2fs_get_num_dirs() now sanity checks the block group descriptor,
and substitutes reasonable values if the descriptors are obviously bogus.</P>

<P>If e2fsck finds a device file which has the immutable flag set and the
i_blocks beyond the normal device number are non-zero, e2fsck will
offer to remove it, since it's probably caused by garbage in the inode
table.</P>

<P>When opening a filesystem, e2fsck specially checks for the EROFS error
code, and prints a specific error message to the user which is more
user friendly.</P>

<P>If the filesystem revision is too high, change the e2fsck to print
that this is either because e2fsck is out of date, or because the
superblock is corrupt.  </P>

<P>E2fsck now checks for directories that have duplicate '.' and '..'
entries, and fixes this corruption.</P>

<P>E2fsck no longer forces a sync of the filesystem (with attendant sleep
calls) at all times.  The ext2fs_flush() function now performs a sync
only if it needed to write data blocks to disk.</P>

<P>Fixed a minor bug in e2fsck's pass1b's file cloning function, where
certain errors would not be properly reported.</P>

<P>Updated and expanded a few points in the man pages which users
complained weren't explicit enough.</P>

<P>Added special case byte-swapping code if compiling on the PowerPC, to
accommodate the strange big-endian variant of the ext2 filesystem that
was previously used on the PowerPC port.</P>

<H3>Programmer's notes:</H3>

<P>Removed C++ keywords from the ext2fs libraries so that it could be
compiled with C++.</P>

<P>E2fsck's internal organization has now been massively reorganized so
that pass*.c don't have any printf statements.  Instead, all problems
are reported through the fix_problem() abstraction interface.  E2fsck
has also been revamped so that it can be called as a library from a
application.</P>

<P>Added new fileio primitives in libext2fs for reading and writing
files on an unmounted ext2 filesystem.  This interface is now used by
debugfs.</P>

<P>Added a new libext2fs function for mapping logical block numbers of
a file to a physical block number.</P>

<P>Added a new libext2fs function, ext2fs_alloc_block(), which allocates
a block, zeros it, and updates the filesystem accounting records
appropriately.</P>

<P>Added a new libext2fs function, ext2fs_set_bitmap_padding(), which
sets the padding of the bitmap to be all one's.  Used by e2fsck pass 5.</P>

<P>The libext2fs functions now use a set of memory allocation wrapper
functions: ext2fs_get_mem, ext2fs_free_mem, and ext2fs_resize_mem,
instead of malloc, free, and resize.  This makes it easier for us to
be ported to strange environments where malloc, et. al. aren't
necessarily available.</P>

<P>Change the libext2fs function to return ext2-specific error codes
(EXT2_DIR_EXISTS and EXT2_DB_NOT_FOUND, for example) instead of using
and depending on the existence of system error codes (such as EEXIST
and ENOENT).</P>

<P>Renamed io.h to ext2_io.h to avoid collision with other OS's header
files.</P>

<P>Add protection against ext2_io.h and ext2fs.h being included multiple
times.</P>

<P>The types used for memory lengths, etc. have been made more portable.
In general, the code has been made 16-bit safe.  Added Mark
Habersack's contributed DOS disk i/o routines.</P>

<P>Miscellaneous portability fixes, including not depending on char's
being signed.</P>

<P>The io_channel structure has a new element, app_data, which is
initialized by the ext2fs routines to contain a copy of the filesystem
handle.</P>

<P>ext2fs_check_directory()'s callback function may now return the error
EXT2_ET_CALLBACK_NOTHANDLED if it wishes ext2fs_check_directory() to
really do the checking, despite the presence of the callback function.</P>


<H2><A NAME="1.11">E2fsprogs 1.11 (June 17, 1997)</A></H2>

<P>Fixed e2fsck to detect (previously ignored) conflicts between the
superblock or block group descriptors and block bitmaps, inode
bitmaps, and inode tables.</P>

<P>Fixed bug in e2fsck so that when the message printed out when a block
or inode bitmap conflicts with other data, it has the correct group
number.</P>

<P>Fixed bug in e2fsck and mke2fs where the blocksize wasn't being passed
to badblocks.  This meant that not all of the filesystem was being
tested for bad blocks! </P>

<P>Fixed an array boundary overrun case which cropped up in
ext2fs_badblocks_list_test when a user tried running "mke2fs -c 
-b 4096".</P>

<P>Adjusted the number of columns printed by mke2fs when displaying the
superblock backups to avoid running over 80 columns when making a
really big filesystem.</P>

<P>Fixed up the man pages for e2fsck, debugfs, badblocks, chattr,
dumpe2fs, fsck, mke2fs, and tune2fs (typos and other minor grammar
fixes), thanks to some suggestions from Bill Hawes (whawes@star.net).</P>

<H3>Programmer's notes:</H3>

<P>Fixed install rule in lib/ss so that ss_err.h is actually getting
installed.</P>

<P>Fixed bug in ext2fs_copy_bitmap; the destination bitmap wasn't getting
passed back to the caller.</P>

<P>Fixed bug in ext2fs_inode_scan_goto_blockgroup; it had not been
setting the current inode number (which meant this function wasn't
working at all).</P>

<P>Fixed bug in ext2fs_resize_generic_bitmap; it had not be zeroing all
blocks in the bitmap when increasing the size of the bitmap.</P>

<P>Changed the initial number of blocks allocated by ext2fs_init_dblist()
to be more realistic.</P>

<P>Added a new function ext2fs_allocate_group_table, which sets up the
group descriptor information (and allocates inode and block bitmaps,
and inode tables for a particular group).  The function was created by
factoring out code form ext2fs_allocate_tables().</P>

<P>Added a new function ext2fs_move_blocks which takes a bitmap of the
blocks to be moved, and moves them to another location on the
boardboard.</P>

<P>Make the unix_io channel's io_channel_flush implementation calls sync()
to to flush the kernel buffers to disk.</P>

<P>Added a new function ext2fs_dblist_count returns the number of
directory blocks in dblist.</P>


<H2><A NAME="1.10">E2fsprogs 1.10 (April 24, 1997)</A></H2>

<P>Mke2fs once again defaults to creating revision #0 filesystems, since
people were complaining about breaking compatibility with 1.2 kernels.
Warning messages were added to the mke2fs and tune2fs man pages that
the sparse superblock option isn't supported by most kernels yet (1.2
and 2.0 both don't support parse superblocks.)</P>

<P>Added new flag to mke2fs -R <raid options>, which allows the user to
tell mke2fs about the RAID configuration of the filesystem.  Currently
the only supported raid option is "stride" which specifies the width
of the RAID stripe.</P>

<P>Fixed bug in e2fsck where pass1b would bomb out if there were any
blocks marked bad in the inode table.</P>

<P>Fixed rare bug in mke2fs where if the user had a very unlucky number
of blocks in a filesystem (probability less than .002) the resulting
filesystem would be corrupt in the last block group.</P>

<P>Fixed bug where if e2fsck tried to allocate a block to fix a
filesystem corruption problem and the filesystem had no free blocks,
ext2fs_new_block() would loop forever.</P>

<P>The configure script now checks explicitly to see if "-static" works,
since that can't be assumed to be true --- RedHat doesn't install
libc-static by default.</P>

<P>Fixed bug in libext2's block iterator functions where under some
circumstances, file with holes would cause the bcount parameter to the
callback function to be incorrect.  This bug didn't affect any of
e2fsprogs programs, but it was discovered by Paul Mackerras, the
author of the PPC boot loader.</P>

<P>Removed use of static variables to store the inode cache in libext2fs.
This caused problems if more than one filesystem was accessed via
libext2fs (static variables in libraries are generally a bad idea).
Again, this didn't affect e2fsprogs programs, but it was discovered by
Paul Mackerras.</P>

<P>Fixed minor bugs and version code drift to assure that e2fsprogs 1.10
will compile cleanly with 1.2.13 kernels (even with a.out shared
libraries!)</P>

<H3>Programmer's notes:</H3>

<P>Added new functions to duplicate an ext2 filesystem handle, and its
associated substructure.  New functions: ext2fs_dup_handle(),
ext2fs_copy_dblist(), ext2fs_badblocks_copy(), ext2fs_copy_bitmap().
Other structures, such as the io_channel and the inode_cache, now have
a ref count so that they only get freed when they are no longer used
by any filesystem handle.  (These functions were added as part of the
development effort for an ext2 resizer).</P>



<H2><A NAME="1.09">E2fsprogs 1.09 (April 14, 1997)</A></H2>

<P>Fixed bug in mke2fs (really in lib/ext2fs/initialize.c) which was
accidentally introduced in the 1.08 release.  The overhead calculation
was accidentally removed, which caused ext2fs_initialize() to not
notice when the filesystem size needed to be adjusted down because
there wasn't enough space in the last block group.</P>

<P>Fixed bug in version parsing library routine; it was always parsing
the library version string, instead of using the passed-in string.</P>

<P>Clarified chattr man page.</P>


<H2><A NAME="1.08">E2fsprogs 1.08 (April 10, 1997)</A></H2>

<P>E2fsck 1.07 was very slow when checking very large filesystems with a
lot of files that had hard links (i.e., news spools).  This was fixed
by seriously revamping the icount abstraction.  Added a formal test
suite for the icount abstraction.</P>

<P>Debugfs now has a "-l" option to the "ls" command, which lists the
inode number, permissions, owner, group, size, and name of the files
in the directory.</P>

<P>Fix a bug in e2fsck where when a directory had its blocks moved to
another location during the pass 1b processing, the directory block
list wasn't updated, so pass 2 wouldn't check (and correct) the
correct directory block.</P>

<P>E2fsck will now treat inodes which contain blocks which are claimed by
the filesystem metadata by treating them as multiply claimed blocks.
This way, the data in those blocks can be copied to a new block during
the pass 1b--1d processing.</P>

<P>E2fsck will attempt to determine the correct superblock number and
display it in the diagnostic and warning messages if possible.</P>

<P>Add support for a new (incompatible) feature, "sparse_super".  This
feature reduces the number of blocks which contain copies of backup
superblocks and block group descriptors.  (It is only an incompatible
feature because of a bug in ext2_free_blocks.)  mke2fs and tune2fs now
support a new -s option; e2fsck will recognize filesystems built with
this feature turned on.</P>

<P>E2fsck now checks the library to make sure is the correct version,
using new library functions.  (This helps to diagnose incorrectly
installed e2fsprogs distributions.)</P>

<P>Dumpe2fs now prints more information; its now prints the the
filesystem revision number, the filesystem sparse_super feature (if
present), the block ranges for each block group, and the offset from
the beginning of the block group.</P>

<P>Mke2fs now distributes the inode and block bitmap blok so that the
won't be concentrated in one or two disks in RAID/striping setups.
Also, if the user chooses a 2k or 4k block group, mke2fs will try to
choose the largest blocks per group that be chosen.  (For 2k blocks,
you can have up to 16384 blocks/group; for 4k blocks, you can have up
to 32768 blocks/group.)  Previously mke2fs would not allow
specification of more than 8192 blocks per group, even if you were
using a 2k or 4k block group.</P>

<H3>Programmer's notes</H3>

<P>Added a new function ext2fs_create_icount2() which takes a "hint"
argument.  This hint argument presets the icount array with the list
of inodes which actually need to be in the icount array.  This really
helps to speed up e2fsck.</P>

<P>Added a new function ext2fs_icount_validate() which checks the rep
invariant for the icount structure.  This is used mostly for testing.</P>

<P>The error message given when a bad inode number is passed to
test_generic_bitmap to reflect EXT2FS_TEST_ERROR (instead of
EXT2FS_UNMARK_ERROR).</P>

<P>Added a new function ext2fs_set_dir_block which sets the block of a
dblist entry, given the directory inode and blockcnt.</P>

<P>Added a new function ext2fs_get_library_version() which returns the
current library version, and ext2fs_parse_version_string() which
returns a version number based on a e2fsprogs version string.</P>

<P>The icount functions will return EINVAL if the passed in inode number
is out of bounds.</P>


<H2><A NAME="1.07">E2fsprogs 1.07 (March 14, 1997)</A></H2>

<P>E2fsck is now uses much less memory when checking really large
filesystems (or rather, filesystems with a large number of inodes).
Previously a filesystem with 1 million inodes required 4 megabytes of
memory to store inode count statistics; that storage requirement has
now been reduced to roughly half a megabyte.</P>

<P>E2fsck can now properly deal with bad blocks appearing inside the
inode table.  Instead of trying to relocate the inode table (which
often failed because there wasn't enough space), the inodes in the bad
block are marked as in use.</P>

<P>E2fsck will automatically try to use the backup superblocks if the
primary superblocks have a bad magic number or have missing meta-data
blocks (or meta-data blocks which are out of range).</P>

<P>E2fsck's pass 3 has been made more efficient; most noticeable on
filesystems with a very large number of directories.</P>

<P>Completely revamped e2fsck's system of printing problem reports.  It
is now table driven, to make them more easily customizable and
extendable.  Error messages which can be printed out during preen mode
are now one line long.</P>

<P>Fixed e2fsck's filesystem swapping code so that it won't try to swap
fast symbolic links or deleted files.</P>

<P>Fixed e2fsck core dumping when fixing a filesystem which has no
directories (not even a root directory).</P>

<P>Added a check to e2fsck to make sure that the length of every
directory entry is a multiple of 4 (since the kernel complains if it
isn't).</P>

<P>Added a check to e2fsck to make sure that a directory entry isn't a
link to the root directory, since that isn't allowed.</P>

<P>Added a check to e2fsck to now make sure the '.' and '..' directory
entries are null terminated, since the 2.0 kernel requires it.</P>

<P>Added check to write_bitmaps() to make sure the superblock doesn't get
trashed if the inode or block bitmap is marked as being block zero.</P>

<P>Added checking of the new feature set fields in the superblock, to
avoid dealing with new filesystem features that this package wasn't
set up to handle.</P>

<P>Fixed a fencepost error in ext2fs_new_block() which would occasionally
try to allocate a block beyond the end of a filesystem.</P>

<P>When the UUID library picks a random IEEE 802 address (because it
can't find one from a network card), it sets the multicast bit, to
avoid conflicting with a legitimate IEEE 802 address.</P>

<P>Mke2fs now sets the root directory's owner to be the real uid of the
user running mke2fs.  If the real uid is non-zero, it also sets
the group ownership of the root directory to be the real group-id of
the user running mke2fs.</P>

<P>Mke2fs now has more intelligent error checking when it is given a
non-existent device.</P>

<P>When badblocks is given the -vv option, it now updates the block that
it is currently testing on every block.</P>

<P>Fixed a bug in fsck where it wouldn't modify the PATH environment
currently correctly if PATH wasn't already set.</P>

<P>Shared libraries now built with dependencies.  This allows the shared
library files to be used with dlopen(); it also makes the transition
to libc 6 easier, since ld.so can tell which libc a particular shared
library expects to use.</P>

<H3>Programmer's notes:</H3>

<P>Added new abstraction (defined in dblist.c) for maintaining a list of
blocks which belongs to directories.  This is used in e2fsck and other
programs which need to iterate over all directories.</P>

<P>Added new functions which test to see if a contiguous range of blocks
(or inodes) are available.  (ext2fs_*_bitmap_range).</P>

<P>Added new function (ext2_inode_has_valid_blocks) which returns true if
an inode has valid blocks.  (moved from e2fsck code).</P>

<P>Added new function (ext2fs_allocate_tables) which allocates the
meta-data blocks as part of initializing a filesystem.  (moved from
mke2fs code).</P>

<P>Added a new I/O manager for testing purposes.  It will either allow a
program to intercept I/O requests, or print debugging messages to
trace the activity of a program using the I/O manager.</P>

<P>The badblocks_list functions now store the bad blocks in a sorted
order, and use a binary search to speed up badblocks_list_test.</P>

<P>The inode scan function ext2fs_get_next_inode() may now return a soft
error returns: MISSING_INODE_TABLE and BAD_BLOCK_IN_INODE_TABLE in
those cases where part of an inode table is missing or there is a bad
block in the inode table.  </P>

<P>Added a new function (ext2fs_block_iterate2) which adds new arguments to
the callback function to return a pointer (block and offset) to the
reference of the block.</P>

<P>Added new function (ext2fs_inode_scan_goto_blockgroup) which allows an
application to jump to a particular block group while doing an inode
scan.</P>

<P>The badblocks list functions were renamed from badblocks_* to
ext2fs_badblocks_*.  Backwards compatibility functions are available
for now, but programs should be modified to use the new interface.</P>

<P>Some of the library functions were reorganized into separate files to
reduce the size of some programs which statically link against the
ext2 library.</P>

<P>Put in some miscellaneous fixes for the Alpha platform.</P>


<H2><A NAME="1.06">E2fsprogs 1.06 (October 7, 1996)</A></H2>

<P>Fixed serious bug in e2fsck: if the block descriptors are bad, don't
smash the backup copies in ext2fs_close().  (The problem was that when
e2fsck -p discovered the problem, while it was closing the filesystem
and exiting, it was also blowing away the backup superblocks on the
disk, which was less than friendly.)  We now make it the case that we
only write out the backup superblock and the back block descriptors if
the filesystem is completely free from problems.</P>

<P>Fixed a bug in block_interate in the lib/ext2fs library which caused
e2fsck to fail on GNU Hurd-created filesystems.</P>

<P>Add support for Linux/FT's bootloader, which actually uses
EXT2_BOOT_LOADER, and sets its mode bits which caused e2fsck to want
to clear the inode.</P>

<P>Add support for the "A" (no atime update) attribute.  (Note: this
attribute is not yet in production kernels.)</P>

<P>The test suite is not automatically run when doing a "make all" from
the top level directory.  Users should manually run "make check" if
they wish to run the test suite.</P>

<P>Upon a preenhalt(), make the printed message more explicit that
running e2fsck "MANUALLY" means without the -p or -a options.</P>

<P>In e2fsck, if a disconnected inode is zero-length, offer to clear it
instead of offering to connect it to lost+found.</P>

<P>In e2fsck, if a filesystem was just unmounted uncleanly, and needs
e2fsck to be run over it, change e2fsck to explicitly display this
fact.</P>

<P>For dumpe2fs and e2fsck, cause the -V option to print out which
version of the ext2fs library is actually getting used.  (This will
help detect mismatches of using a 1.06 utility with a 1.05 library,
etc.)</P>

<H3>Programmers' notes:</H3>

<P>EXT2_SWAP_BYTES was changed to EXT2_FLAG_SWAP_BYTES, which better fits
the naming convention.</P>

<P>In ext2fs_initialize(), make sure the description for the inode bitmap
is correctly initialize.</P>

<P>Fixed minor type typo in ext2fs_allocate_generic_bitmap()</P>

<H2><A NAME="1.05">E2fsprogs 1.05 (September 7, 1996)</A></H2>

<P>Add support for new fields in the ext2 superblock --- volume name,
volume UUID, and last mounted field.  Dumpe2fs displays these fields,
tune2fs and mke2fs allows you to set them.  E2fsck will automatically
generate a UUID for those volumes that don't have them.</P>

<P>Put in support for e2fsck to recognize HURD specific ext2 features ---
most notably, the translator block.  The e2fsprogs tools will now use
the creator_os field in the superblock to correctly handle different
OS-specific variants of the ext2 filesystem.</P>

<P>E2fsck now fixes inodes which have a the deletion time set, but which
have a non-zero i_link_count field by offering to clear the deletion
time.  Previously e2fsck assumed that the inode was deleted (per 0.3c
ext2 kernel behavior) and offered to unlink the file.</P>

<P>If e2fsck sets the clean bit, but nothing else, set the exit code
FSCK_NONDESTRUCT.  After all, e2fsck did fix a filesystem error --- it
set the filesystem valid bit when it was previously cleared.  :-) This
was needed to make the HURD fsck driver happy.</P>

<P>If the  user  refuses to attach an  unattached  inode, e2fsck  will no
longer set the inode's link count.  Otherwise, the  inode would end up
getting marked as unused, which might cause loss of data later.</P>

<P>Make the message issued by e2fsck when the superblock is corrupt less
confusing for users.  It now mentions that another reason for the
"corrupt superblock" message might be that the partition might not be
an ext2 filesystem at all (it might swap, msdos filesystem, ufs, etc.)</P>

<P>Make the libext2 library more robust so that e2fsck won't coredump on
an illegal superblock where the blocksize is zero.  (f_crashdisk is
the test case).</P>

<P>By default, create filesystems where the default checkinterval is 6
months (180 days).  Linux servers can be robust enough that 20 reboots
can be a long, long time.</P>

<P>Added configure flag --enable-old-bitops, which forces the bitops to
use the old (native) bitmask operations.  By default on the sparc
platform, the standard ext2 bit ordering is now used.</P>

<P>Added a new feature to e2fsck to byte-swap filesystems; this can be
used to convert old m68k filesystems to use the standard byte-order
storage for the superblock, inodes, and directory blocks.  This
function is invoked by using the '-s' option to e2fsck.</P>

<P>Debugfs's "dump" command has been enhanced so that it writes out the
exact size of the file so that the nulls at the end of the file are
eliminated.  The command also accept a new "-p" option which will
attempt to preserve the ownership, permissions, and file
modification/access times.</P>

<P>Debugfs has two new options, -f and -R.  The -R option allows the user
to execute a single debugfs command from the command line.  The -f
option allows the user to specify a "command file" containing debugfs
commands which will get executed.</P>

<P>Dumpe2fs now pretty prints the check interval, instead of just
printing the check interval as a number of seconds.</P>

<P>Fix bugs in debugfs: the params command when no filesystem is opened
no longer causes a core dump.  It is now possible to unlink a file
when a pathname containing a '/' is specified.</P>

<P>Tune2fs has a new -C option which sets the number of times the
filesystem has been mounted.</P>

<P>Fix the chattr '-v' option so that it actually works.  Chattr was
being buggy about the -v option parsing.</P>

<H3>Programmers' notes:</H3>

<P>The directory lib/uuid contains a set of library routines to generate
DCE compatible UUIDs.  </P>

<P>Extended ext2fs_namei() to handle symbolic links.  Added new function
ext2fs_nami_follow() which will follow last symbolic link in the case
where the pathname points to a sym link.</P>

<P>The ext2fs_block_iterate function will now return the HURD translator
block, if present.  The new flag BLOCK_FLAG_DATA_ONLY will cause the
iterator to return data blocks only.  The ext2fs.h file now defines
constants BLOCK_COUNT_IND, BLOCK_COUNT_DIND, BLOCK_COUNT_TIND, and
BLOCK_COUNT_TRANSLATOR, which are the magic values passed in the block
count field of the iterator callback function.</P>

<P>The test script driver now takes an optional second argument, which is
the test case to be run.  This allows you to run a test case without
needing to run the entire test suite.</P>

<P>On Linux ELF systems, install the .so files in the correct places
(/usr/lib).  The .so files must be stored in the same directory as the
.a files.</P>

<P>Fixed miscellaneous HURD compilation issues with header file being
included in the right order.</P>

<P>Fixed debugfs so that it resets optind to zero, not one, since setting
optind to zero is more correct.</P>

<H2><A NAME="1.04">E2fsprogs 1.04 (May 16, 1996)</A></H2>

<P>First "official" (1.03 was a limited release only) to support building
e2fsprogs under Linux 2.0 kernels (as well as late model 1.3 and 1.99
kernels).</P>

<P>This package includes a RPM specs file, that it can be built using the
RedHat Package Manager.</P>

<P>E2fsck now prints a hint that if there are lots of incorrectly located
inode bitmaps, block bitmaps, and inode table blocks, the user might
want to try using e2fsck -b 8193 first, to see if that fares any
better.</P>

<P>For ext2 filesystem written with the hurd, debugfs will now print out
the translator field when printing an inode structure.</P>

<H3>Lots of miscellaneous linking/installation cleanups:</H3>

<P>Libraries are now linked using a relative pathname, instead of
relying on -L working correct.  It doesn't, in many cases, including
current versions of GNU ld.  This guarantees that the build tree is
linking with the right libraries, instead of the ones installed in
/usr/lib.</P>

<P>Header files, man pages, and the et/ss shell scripts are now
  generated using a custom substitution script, instead of relying on
  the configure script.  This prevents needless recompilation of
  files; in addition, the custom substitution script is much faster.</P>

<P>e2fsck may now be linked dynamically, by using the
  --enable-dynamic-e2fsck flag to configure.  This is not recommended,
  since it increases e2fsck's dependence on other files, but some
  people need to save disk space, and other critical programs on their
  systems were being linked dynamically anyway.</P>

<P>Programs such as fsck which didn't need to be linked against
  libext2fs (or mke2fs which didn't need to be linked against libe2p)
  only link against libraries they actually need.  Otherwise, those
  programs would require the presence of libraries that otherwise
  could be removed from a rescue diskette.</P>

<P>  The ss include files are now installed correctly so they can
  actually be used by another package.</P>

<P>  If the profiling libraries are built, they are now installed on a
  "make install-libs".</P>


<H2><A NAME="1.03">E2fsprogs 1.03 (March 27, 1996)</A></H2>

<P>Change the m68k bit numbering for bitmasks to match the bit numbering
used by all other ext2 implementations.  (This change was requested by
the m68k kernel development team.)</P>

<P>Support (in-development) filesystem format revision which supports
(among other things) dynamically sized inodes.</P>

<P>Fixed a bug in the ext2 library so that an intelligent error is
returned if mke2fs is run with a ridiculously small number of blocks
for a partition.</P>

<P>Fixed a bug in the ext2 library which required that the device be
openable in read/write mode in order to determine its size.  This
caused e2fsck -n to require read/write access when it was not
previously necessary.</P>

<P>Fixed a bug in e2fsck which caused it to occasionally fail the test
suite depending on which version of the floating point library it was
using.</P>

<P>Fixed a bug in e2fsck so that it now halts with a fatal error when
certain superblock consistency checks fail.  Previously it continued
running e2fsck, with some potential confusing/damaging consequences.</P>

<P>Added new flag to fsck which allows the root to be checked in parallel
with other filesystems.  This is not the safest thing in the world to
do, but some system administrators really wanted it.</P>

<P>Fixed -Wall flames in lib/ss.</P>


<H2><A NAME="1.02">E2fsprogs 1.02 (January 16, 1996)</A></H2>

<P>Fix to allow e2fsprogs to be compiled on recent 1.3 (pl45+) kernels.</P>

<P>Change e2fsck to print statistics of how many non-contiguous files are
on the system.  Note that a file which is larger than 8k blocks, it is
guaranteed to be non-contiguous.</P>

<P>In mke2fs, print a warning message if a user tries to format a whole
disk (/dev/hda versus /dev/hda1).  If a user really wants to format a
whole disk, the -F (force) option forces mke2fs to format a whole disk
as a filesystem.</P>

<P>Fix a bug in fsck where in some cases it might start checking
partitions in the next pass before it finishes checking partitions in
the current pass.  This still won't cause two partitions on the same
disk will be checked, so it's rarely a problem in real life.</P>

<P>Patch lsattr so that it won't hang when checking a named pipe.</P>

<P>Minor compilation fixes:</P>
<UL>
<LI> Fix the order of libraries that were linked in debugfs.
<LI> Allow the sources to be compiled with -ansi turned on.
</UL>

<HR>

<P><A HREF="http://e2fsprogs.sourceforge.net">Back to e2fsprogs page</A></P>

<P><A HREF="ext2.html">Back to ext2fs home page</A></P>

<ADDRESS>
<A HREF="http://thunk.org/tytso">Theodore Ts'o</A>
</ADDRESS> 

<!-- end actual content -->

    </TD>
  </TR>
</TABLE>
<!-- end center table -->

<!-- footer table -->
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2" bgcolor="737b9c">
  <TR>
    <TD align="center"><FONT color="#ffffff"><SPAN class="titlebar">
      All trademarks and copyrights on this page are properties of their respective owners.</SPAN></FONT>
    </TD>
  </TR>
</TABLE>

<!-- end footer table -->

<hr>
<a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=2406&amp;type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a>

</BODY>
</HTML>
